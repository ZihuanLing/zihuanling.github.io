[{"content":"01-åˆè¯†RAG è®©æˆ‘ä»¬èµ°è¿›å­¦ä¹ RAGä¹‹æ—…ï¼Let\u0026rsquo;s GO!!!\nğŸ˜€\næˆ‘ä»¬é¦–å…ˆæ¥äº†è§£RAGæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼\nå¼€å§‹å§ï¼\nâ€‹ â€‹\n","permalink":"https://zihuanling.github.io/post/01first-recognition-rag-z6wl3c.html","summary":"\u003ch1 id=\"01-åˆè¯†rag\"\u003e01-åˆè¯†RAG\u003c/h1\u003e\n\u003cp\u003eè®©æˆ‘ä»¬èµ°è¿›å­¦ä¹ RAGä¹‹æ—…ï¼Let\u0026rsquo;s GO!!!\u003c/p\u003e\n\u003cp\u003eğŸ˜€\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬é¦–å…ˆæ¥äº†è§£RAGæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼\u003c/p\u003e\n\u003cp\u003eå¼€å§‹å§ï¼\u003c/p\u003e\n\u003cp\u003eâ€‹\u003cimg loading=\"lazy\" src=\"assets/image-20241003171225-sjvax61.png\" alt=\"image\"  /\u003e\nâ€‹\u003c/p\u003e","title":"åˆè¯†RAG"},{"content":"vagrant + centos7åˆ›å»º3èŠ‚ç‚¹é›†ç¾¤ å‘ è®¾ç½®èŠ‚ç‚¹çš„ç½‘ç»œçš„æ—¶å€™ï¼Œéœ€è¦ç»™ä¸€ä¸ªå±æ€§nameâ€‹ï¼Œç¡®ä¿èŠ‚ç‚¹å¯åŠ¨çš„æ—¶å€™ï¼Œé›†ç¾¤é‡Œé¢çš„èŠ‚ç‚¹ä¼šç»‘å®šåˆ°åŒä¸€ä¸ªç½‘ç»œå¹³é¢ï¼š**node.vm.network \u0026quot;private_network\u0026quot;, name: \u0026quot;VirtualBox Host-Only Enthernet Adapter\u0026quot;**â€‹ ä¸ºäº†é˜²æ­¢èŠ‚ç‚¹å¯åŠ¨çš„æ—¶å€™ï¼Œ22ç«¯å£è¢«éšæœºåˆ†é…ç»‘å®šå®¿ä¸»æœºç«¯å£ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®å°†å…¶è½¬å‘åˆ°ä¸€ä¸ªå›ºå®šçš„ç«¯å£ï¼šnode.vm.network \u0026quot;forwarded_port\u0026quot;, guest: 22, host: \u0026quot;230#{i}\u0026quot;â€‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦å…ˆå°†åŸæ¥çš„sshè½¬å‘ç«¯å£ç¦ç”¨æ‰ï¼šnode.vm.network \u0026quot;forwarded_port\u0026quot;, guest: 22, host: 2222, id: \u0026quot;ssh\u0026quot;, disabled: \u0026quot;true\u0026quot;â€‹ é…ç½®æ–‡ä»¶ï¼š\n# Vagrantfile Vagrant.configure(\u0026#34;2\u0026#34;) do |config| # config.vm.network \u0026#34;private_network\u0026#34;, auto_config: false (1..3).each do |i| config.vm.define \u0026#34;node#{i}\u0026#34; do |node| # è®¾ç½®è™šæ‹Ÿæœºçš„Box node.vm.box = \u0026#34;generic/centos7\u0026#34; # è®¾ç½®è™šæ‹Ÿæœºçš„ä¸»æœºå node.vm.hostname=\u0026#34;node#{i}\u0026#34; # è®¾ç½®è™šæ‹Ÿæœºçš„IPï¼Œç»‘å®šä¸€ä¸ªå›ºå®šçš„ç½‘å¡ï¼Œç¡®ä¿ node.vm.network \u0026#34;private_network\u0026#34;, ip: \u0026#34;192.168.59.10#{i}\u0026#34;, name: \u0026#34;VirtualBox Host-Only Ethernet Adapter\u0026#34; # è®¾ç½®ç«¯å£è½¬å‘ node.vm.network \u0026#34;forwarded_port\u0026#34;, guest: 22, host: 2222, id: \u0026#34;ssh\u0026#34;, disabled: \u0026#34;true\u0026#34; node.vm.network \u0026#34;forwarded_port\u0026#34;, guest: 22, host: \u0026#34;230#{i}\u0026#34; node.vm.network \u0026#34;forwarded_port\u0026#34;, guest: 2181, host: \u0026#34;218#{i}\u0026#34; # è®¾ç½®ä¸»æœºä¸è™šæ‹Ÿæœºçš„å…±äº«ç›®å½• node.vm.synced_folder \u0026#34;D:/Vagrants/share\u0026#34;, \u0026#34;/home/vagrant/share\u0026#34; # VirtaulBoxç›¸å…³é…ç½® node.vm.provider \u0026#34;virtualbox\u0026#34; do |v| # è®¾ç½®è™šæ‹Ÿæœºçš„åç§° v.name = \u0026#34;node#{i}\u0026#34; # è®¾ç½®è™šæ‹Ÿæœºçš„å†…å­˜å¤§å° v.memory = 6144 # è®¾ç½®è™šæ‹Ÿæœºçš„CPUä¸ªæ•° v.cpus = 1 end end end end â€\n","permalink":"https://zihuanling.github.io/post/vagrant-centos7-create-3-node-cluster-z1lgxuu.html","summary":"\u003ch1 id=\"vagrant--centos7åˆ›å»º3èŠ‚ç‚¹é›†ç¾¤\"\u003evagrant + centos7åˆ›å»º3èŠ‚ç‚¹é›†ç¾¤\u003c/h1\u003e\n\u003ch2 id=\"å‘\"\u003eå‘\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eè®¾ç½®èŠ‚ç‚¹çš„ç½‘ç»œçš„æ—¶å€™ï¼Œéœ€è¦ç»™ä¸€ä¸ªå±æ€§\u003ccode\u003ename\u003c/code\u003eâ€‹ï¼Œç¡®ä¿èŠ‚ç‚¹å¯åŠ¨çš„æ—¶å€™ï¼Œé›†ç¾¤é‡Œé¢çš„èŠ‚ç‚¹ä¼šç»‘å®šåˆ°åŒä¸€ä¸ªç½‘ç»œå¹³é¢ï¼š**\u003ccode\u003enode.vm.network \u0026quot;private_network\u0026quot;, name: \u0026quot;VirtualBox Host-Only Enthernet Adapter\u0026quot;\u003c/code\u003e**â€‹\u003c/li\u003e\n\u003cli\u003eä¸ºäº†é˜²æ­¢èŠ‚ç‚¹å¯åŠ¨çš„æ—¶å€™ï¼Œ22ç«¯å£è¢«éšæœºåˆ†é…ç»‘å®šå®¿ä¸»æœºç«¯å£ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®å°†å…¶è½¬å‘åˆ°ä¸€ä¸ªå›ºå®šçš„ç«¯å£ï¼š\u003ccode\u003enode.vm.network \u0026quot;forwarded_port\u0026quot;, guest: 22, host: \u0026quot;230#{i}\u0026quot;\u003c/code\u003eâ€‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦å…ˆå°†åŸæ¥çš„sshè½¬å‘ç«¯å£ç¦ç”¨æ‰ï¼š\u003ccode\u003enode.vm.network \u0026quot;forwarded_port\u0026quot;, guest: 22, host: 2222, id: \u0026quot;ssh\u0026quot;, disabled: \u0026quot;true\u0026quot;\u003c/code\u003eâ€‹\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eé…ç½®æ–‡ä»¶ï¼š\u003c/p\u003e","title":"vagrant + centos7åˆ›å»º3èŠ‚ç‚¹é›†ç¾¤"},{"content":"ä½¿ç”¨python argparseå®ç°ç®€å•çš„click python3 argparse æ–‡æ¡£\npython3 ArgParseæ•™ç¨‹\néœ€æ±‚ å®ç°ä¸€ä¸ªç±»ä¼¼click commandçš„ç±»ï¼Œæ”¯æŒå°†å‡½æ•°ä½œä¸ºå‘½ä»¤æ³¨å†Œè¿›å»ï¼Œè°ƒç”¨è¿™ä¸ªç±»çš„æ—¶å€™ï¼Œè§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œæ‰§è¡Œå¯¹åº”çš„æ³¨å†Œå‡½æ•°ã€‚\nå¯ä»¥ç”¨è£…é¥°å™¨çš„æ–¹æ³•è¿›è¡Œå‡½æ•°æ³¨å†Œä»¥åŠå‚æ•°æ·»åŠ \nç±»åï¼š Entrance\næ–¹æ³•ï¼š\næ³¨å†Œï¼š Entrance.register å‚æ•°ï¼šEntrance.option å®ç° entrance.py\n# encoding: utf-8 \u0026#34;\u0026#34;\u0026#34;the only entrance for the program\u0026#34;\u0026#34;\u0026#34; import argparse class EntranceConflict(Exception): pass class Entrance: def __init__(self): self.parser = argparse.ArgumentParser() self.sub_parser = self.parser.add_subparsers() self.entrances = {} def register(self, name=None): \u0026#34;\u0026#34;\u0026#34; æ³¨å†Œä¸€ä¸ªå‡½æ•°ä½œä¸ºå…¥å£ å¯ä»¥æŒ‡å®šnameï¼Œå¦åˆ™é»˜è®¤ä½¿ç”¨å‡½æ•°çš„åå­— \u0026#34;\u0026#34;\u0026#34; def decorator(f): entrance_name = name or f.__name__ if entrance_name in self.entrances: raise EntranceConflict(f\u0026#34;entrance {entrance_name} already registered.\u0026#34;) # make parser _parser = self.sub_parser.add_parser(name=entrance_name) _params = f.__entrance_params__ for _args, _kwargs in _params: _parser.add_argument(*_args, **_kwargs) _parser.set_defaults(processor=f) # add parser to entrances self.entrances[entrance_name] = _parser return f return decorator def option(self, *args, **kwargs): \u0026#34;\u0026#34;\u0026#34; æ³¨å†Œä¸€ä¸ªå‡½æ•°çš„å‚æ•° å‚æ•°æ ¼å¼å‚è€ƒ argparse.ArgumentParser.add_argument \u0026#34;\u0026#34;\u0026#34; def decorator(f): # set tmp attrs for f if not hasattr(f, \u0026#39;__entrance_params__\u0026#39;): f.__entrance_params__ = [] f.__entrance_params__.append((args, kwargs)) return f return decorator def __call__(self, *args, **kwargs): args = self.parser.parse_args() # extrac args params = vars(args) processor = params.get(\u0026#39;processor\u0026#39;) if processor: del params[\u0026#39;processor\u0026#39;] return processor(**params) else: print(\u0026#39;un processable entrance: {}\u0026#39;.format(args)) self.parser.print_help() entrance = Entrance() è°ƒç”¨ å†™ä¸€ä¸ªç®€å•çš„è°ƒç”¨demo\nmain.py\nfrom entrance import entrance @entrance.register() @entrance.option(\u0026#39;--user-name\u0026#39;, required=True) @entrance.option(\u0026#39;--age\u0026#39;) def add_user(user_name, age): print(\u0026#34;Added user: {}, age={}\u0026#34;.format(user_name, age)) @entrance.register() @entrance.option(\u0026#39;--user-id\u0026#39;, required=True) def del_user(user_id): print(\u0026#34;deleted user whose id = {}\u0026#34;.format(user_id)) if __name__ == \u0026#39;__main__\u0026#39;: entrance() è¿è¡Œ\n$ python main.py add_user --user-name Mike --age 19 Added user: Mike, age=19 $ python main.py del_user --user-id 10 deleted user whose id = 10 ","permalink":"https://zihuanling.github.io/posts/argparse-entrance-like-click/","summary":"\u003ch1 id=\"ä½¿ç”¨python-argparseå®ç°ç®€å•çš„click\"\u003eä½¿ç”¨python argparseå®ç°ç®€å•çš„click\u003c/h1\u003e\n\u003cp\u003e\u003ca href=\"https://docs.python.org/zh-cn/3/library/argparse.html#module-argparse\"\u003epython3 argparse æ–‡æ¡£\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://docs.python.org/zh-cn/3/howto/argparse.html#id1\"\u003epython3 ArgParseæ•™ç¨‹\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"éœ€æ±‚\"\u003eéœ€æ±‚\u003c/h2\u003e\n\u003cp\u003eå®ç°ä¸€ä¸ªç±»ä¼¼click commandçš„ç±»ï¼Œæ”¯æŒå°†å‡½æ•°ä½œä¸ºå‘½ä»¤æ³¨å†Œè¿›å»ï¼Œè°ƒç”¨è¿™ä¸ªç±»çš„æ—¶å€™ï¼Œè§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œæ‰§è¡Œå¯¹åº”çš„æ³¨å†Œå‡½æ•°ã€‚\u003c/p\u003e\n\u003cp\u003eå¯ä»¥ç”¨è£…é¥°å™¨çš„æ–¹æ³•è¿›è¡Œå‡½æ•°æ³¨å†Œä»¥åŠå‚æ•°æ·»åŠ \u003c/p\u003e\n\u003cp\u003eç±»åï¼š Entrance\u003c/p\u003e\n\u003cp\u003eæ–¹æ³•ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ³¨å†Œï¼š Entrance.register\u003c/li\u003e\n\u003cli\u003eå‚æ•°ï¼šEntrance.option\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å®ç°\"\u003eå®ç°\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eentrance.py\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# encoding: utf-8\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34;the only entrance for the program\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e argparse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eEntranceConflict\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eException\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003epass\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eEntrance\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e __init__(self):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparser \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e argparse\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eArgumentParser()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esub_parser \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparser\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eadd_subparsers()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eentrances \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eregister\u003c/span\u003e(self, name\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34; æ³¨å†Œä¸€ä¸ªå‡½æ•°ä½œä¸ºå…¥å£\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e        å¯ä»¥æŒ‡å®šnameï¼Œå¦åˆ™é»˜è®¤ä½¿ç”¨å‡½æ•°çš„åå­—\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e        \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edecorator\u003c/span\u003e(f):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            entrance_name \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e name \u003cspan style=\"color:#f92672\"\u003eor\u003c/span\u003e f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e__name__\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e entrance_name \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eentrances:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003eraise\u003c/span\u003e EntranceConflict(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;entrance \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eentrance_name\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e already registered.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#75715e\"\u003e# make parser\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            _parser \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esub_parser\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eadd_parser(name\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eentrance_name)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            _params \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e__entrance_params__\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e _args, _kwargs \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e _params:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                _parser\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eadd_argument(\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e_args, \u003cspan style=\"color:#f92672\"\u003e**\u003c/span\u003e_kwargs)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            _parser\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eset_defaults(processor\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ef)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#75715e\"\u003e# add parser to entrances\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eentrances[entrance_name] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e _parser\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e f\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e decorator\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eoption\u003c/span\u003e(self, \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eargs, \u003cspan style=\"color:#f92672\"\u003e**\u003c/span\u003ekwargs):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34; æ³¨å†Œä¸€ä¸ªå‡½æ•°çš„å‚æ•°\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e        å‚æ•°æ ¼å¼å‚è€ƒ argparse.ArgumentParser.add_argument\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e        \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edecorator\u003c/span\u003e(f):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#75715e\"\u003e# set tmp attrs for f\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e hasattr(f, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__entrance_params__\u0026#39;\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e__entrance_params__ \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e []\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e__entrance_params__\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eappend((args, kwargs))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e f\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e decorator\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e __call__(self, \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eargs, \u003cspan style=\"color:#f92672\"\u003e**\u003c/span\u003ekwargs):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        args \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparser\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparse_args()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# extrac args\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        params \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e vars(args)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        processor \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e params\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eget(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;processor\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e processor:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003edel\u003c/span\u003e params[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;processor\u0026#39;\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e processor(\u003cspan style=\"color:#f92672\"\u003e**\u003c/span\u003eparams)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;un processable entrance: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eformat(args))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparser\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eprint_help()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eentrance \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Entrance()\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"è°ƒç”¨\"\u003eè°ƒç”¨\u003c/h2\u003e\n\u003cp\u003eå†™ä¸€ä¸ªç®€å•çš„è°ƒç”¨demo\u003c/p\u003e","title":"Argparse Entrance Like Click"},{"content":"æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨å†™å…¥mongoæ•°æ®çš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦è®°å½•è¿™æ¡æ•°æ®çš„æ’å…¥æ—¶é—´ï¼Œæˆ‘ä»¬ä¸€èˆ¬æƒ…å†µä¸‹å›ç»™è®°å½•å¢åŠ ä¸€ä¸ª create_timeã€‚\nå®é™…ä¸Šï¼Œå¦‚æœæˆ‘ä»¬æ’å…¥çš„æ•°æ®å«æœ‰ ObjectId çš„è¯ï¼Œé‚£ä¹ˆå…¶å®è¿™ä¸ªidæ˜¯åŒ…å«äº†ç”Ÿæˆæ—¶é—´çš„ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä½œä¸ºè®°å½•çš„ä¸»é”®ï¼Œä¸€ä¸¾å¤šå¾—ã€‚\nä»¥pythonä¸ºä¾‹ï¼Œæˆ‘ä»¬æœ‰è¿™æ ·ä¸€æ¡è®°å½•ï¼š\ndocument = { \u0026#34;_id\u0026#34;: ObjectId(\u0026#34;5dfc8ac5d3fa12967b8888ec\u0026#34;), \u0026#34;user\u0026#34;: \u0026#34;mike\u0026#34;, \u0026#34;age\u0026#34;: 19, } è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ObjectIdè‡ªå¸¦çš„generation_timeå±æ€§ï¼Œè·å–è¿™æ¡è®°å½•çš„æ’å…¥æ—¶é—´ï¼š\ntime = ObjectId(\u0026#34;5dfc8ac5d3fa12967b8888ec\u0026#34;).generation_time print(time) è¾“å‡ºï¼š\ndatetime.datetime(2019, 12, 20, 8, 48, 5, tzinfo=\u0026lt;bson.tz_util.FixedOffset object at 0x7f874030f9a0\u0026gt;) éœ€è¦æ³¨æ„åˆ°çš„æ˜¯ï¼Œé‡Œé¢çš„æ—¶åŒºä¿¡æ¯ï¼Œæ˜¾ç¤ºçš„æ˜¯ä¸€ä¸ª FixedOffsetï¼Œå³å›ºå®šåç§»ï¼Œæˆ‘ä»¬çœ‹ generation_time å±æ€§çš„å®šä¹‰ï¼š\nutc = FixedOffset(0, \u0026#34;UTC\u0026#34;) \u0026#34;\u0026#34;\u0026#34;Fixed offset timezone representing UTC.\u0026#34;\u0026#34;\u0026#34; class ObjectId(object): # ... çœç•¥å…¶ä»–ä»£ç  ... @property def generation_time(self): \u0026#34;\u0026#34;\u0026#34;A :class:`datetime.datetime` instance representing the time of generation for this :class:`ObjectId`. The :class:`datetime.datetime` is timezone aware, and represents the generation time in UTC. It is precise to the second. \u0026#34;\u0026#34;\u0026#34; timestamp = struct.unpack(\u0026#34;\u0026gt;I\u0026#34;, self.__id[0:4])[0] return datetime.datetime.fromtimestamp(timestamp, utc) å¯ä»¥çœ‹åˆ°è¿™ä¸ªå±æ€§æ˜¯ä»ä¸€ä¸ªæ—¶é—´æˆ³ç”Ÿæˆçš„ï¼Œå¹¶ä¸”ç”Ÿæˆçš„æ—¶å€™æŒ‡å®šäº†å›ºå®šçš„ UTC-0 æ—¶åŒºï¼Œè€Œæˆ‘ä»¬æ˜¯å¤„äºä¸œå…«åŒºï¼Œå› æ­¤ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ generation_time å±æ€§çš„è¯ï¼Œå¾—åˆ°çš„æ—¶é—´å¹¶éæˆ‘ä»¬å½“å‰æ—¶åŒºçš„æ—¶é—´ï¼Œè¿˜éœ€è¦åšä¸€ä¸ªè½¬åŒ–ï¼Œåªéœ€è¦ç®€å•çš„å¯¹ datetime.datetime å¯¹è±¡è°ƒç”¨astimezoneæ–¹æ³•ï¼Œå³å¯ï¼š\nObjectId(\u0026#34;5dfc8ac5d3fa12967b8888ec\u0026#34;).generation_time.astimezone(None) # output: datetime.datetime(2019, 12, 20, 16, 48, 5, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), \u0026#39;CST\u0026#39;)) å¯ä»¥çœ‹åˆ°ï¼Œç°åœ¨è¾“å‡ºçš„æ—¶é—´ä¿¡æ¯ï¼Œè·Ÿä¹‹å‰çš„è¾“å‡ºç›¸å·®äº†8ä¸ªå°æ—¶ã€‚è°ƒç”¨astimezoneä¼ å…¥Noneçš„æ—¶å€™ï¼Œå°±ä¼šé»˜è®¤è½¬åŒ–ä¸ºæˆ‘ä»¬å½“å‰æ‰€åœ¨çš„æ—¶åŒºï¼ˆä»£ç è¿è¡Œç³»ç»Ÿæ‰€åœ¨çš„æ—¶åŒºï¼Œä¸œ8ï¼‰\nå¯èƒ½æˆ‘ä»¬ä¸æƒ³è¦çœ‹åˆ°è¾“å‡ºè¿™ä¹ˆä¸€é•¿ä¸²çš„ä¿¡æ¯ï¼Œå±•ç¤ºå‡ºæ¥çš„æ—¶å€™å»æ‰æ—¶åŒºä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ replace æ–¹æ³•ï¼š\nObjectId(\u0026#34;5dfc8ac5d3fa12967b8888ec\u0026#34;).generation_time.astimezone(None).replace(tzinfo=None) # output: datetime.datetime(2019, 12, 20, 16, 48, 5) åˆæˆ–è®¸ï¼Œæˆ‘ä»¬éœ€è¦çš„åªæ˜¯ä¸€ä¸ªæ•´å‹çš„æ—¶é—´æˆ³ï¼Œå¯ä»¥è¿™æ ·åšï¼š\nimport struct from bson import ObjectId oid = ObjectId(\u0026#34;5dfc8ac5d3fa12967b8888ec\u0026#34;) timestamp = struct.unpack(\u0026#34;\u0026gt;I\u0026#34;, oid.binary[0:4])[0] # timestamp = 1576831685 ","permalink":"https://zihuanling.github.io/posts/python-mongo-generation-time/","summary":"\u003cp\u003eæœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨å†™å…¥mongoæ•°æ®çš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦è®°å½•è¿™æ¡æ•°æ®çš„æ’å…¥æ—¶é—´ï¼Œæˆ‘ä»¬ä¸€èˆ¬æƒ…å†µä¸‹å›ç»™è®°å½•å¢åŠ ä¸€ä¸ª create_timeã€‚\u003c/p\u003e\n\u003cp\u003eå®é™…ä¸Šï¼Œå¦‚æœæˆ‘ä»¬æ’å…¥çš„æ•°æ®å«æœ‰ \u003ccode\u003eObjectId\u003c/code\u003e çš„è¯ï¼Œé‚£ä¹ˆå…¶å®è¿™ä¸ªidæ˜¯åŒ…å«äº†ç”Ÿæˆæ—¶é—´çš„ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä½œä¸ºè®°å½•çš„ä¸»é”®ï¼Œä¸€ä¸¾å¤šå¾—ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥pythonä¸ºä¾‹ï¼Œæˆ‘ä»¬æœ‰è¿™æ ·ä¸€æ¡è®°å½•ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edocument \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;_id\u0026#34;\u003c/span\u003e: ObjectId(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;5dfc8ac5d3fa12967b8888ec\u0026#34;\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;user\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mike\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;age\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e19\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨\u003ccode\u003eObjectId\u003c/code\u003eè‡ªå¸¦çš„\u003ccode\u003egeneration_time\u003c/code\u003eå±æ€§ï¼Œè·å–è¿™æ¡è®°å½•çš„æ’å…¥æ—¶é—´ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etime \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e ObjectId(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;5dfc8ac5d3fa12967b8888ec\u0026#34;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003egeneration_time\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(time)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¾“å‡ºï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edatetime.datetime(2019, 12, 20, 8, 48, 5, tzinfo=\u0026lt;bson.tz_util.FixedOffset object at 0x7f874030f9a0\u0026gt;)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eéœ€è¦æ³¨æ„åˆ°çš„æ˜¯ï¼Œé‡Œé¢çš„æ—¶åŒºä¿¡æ¯ï¼Œæ˜¾ç¤ºçš„æ˜¯ä¸€ä¸ª FixedOffsetï¼Œå³å›ºå®šåç§»ï¼Œæˆ‘ä»¬çœ‹ \u003ccode\u003egeneration_time\u003c/code\u003e å±æ€§çš„å®šä¹‰ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eutc \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e FixedOffset(\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;UTC\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34;Fixed offset timezone representing UTC.\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eObjectId\u003c/span\u003e(object):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# ... çœç•¥å…¶ä»–ä»£ç  ...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003e@property\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egeneration_time\u003c/span\u003e(self):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34;A :class:`datetime.datetime` instance representing the time of\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e        generation for this :class:`ObjectId`.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e        The :class:`datetime.datetime` is timezone aware, and\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e        represents the generation time in UTC. It is precise to the\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e        second.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e        \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        timestamp \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e struct\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eunpack(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026gt;I\u0026#34;\u003c/span\u003e, self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e__id[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e])[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e datetime\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edatetime\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efromtimestamp(timestamp, utc)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¯ä»¥çœ‹åˆ°è¿™ä¸ªå±æ€§æ˜¯ä»ä¸€ä¸ªæ—¶é—´æˆ³ç”Ÿæˆçš„ï¼Œå¹¶ä¸”ç”Ÿæˆçš„æ—¶å€™æŒ‡å®šäº†å›ºå®šçš„ UTC-0 æ—¶åŒºï¼Œè€Œæˆ‘ä»¬æ˜¯å¤„äº\u003cstrong\u003eä¸œå…«åŒº\u003c/strong\u003eï¼Œå› æ­¤ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ \u003ccode\u003egeneration_time\u003c/code\u003e å±æ€§çš„è¯ï¼Œå¾—åˆ°çš„æ—¶é—´å¹¶éæˆ‘ä»¬å½“å‰æ—¶åŒºçš„æ—¶é—´ï¼Œè¿˜éœ€è¦åšä¸€ä¸ªè½¬åŒ–ï¼Œåªéœ€è¦ç®€å•çš„å¯¹ \u003ccode\u003edatetime.datetime\u003c/code\u003e å¯¹è±¡è°ƒç”¨\u003cstrong\u003eastimezone\u003c/strong\u003eæ–¹æ³•ï¼Œå³å¯ï¼š\u003c/p\u003e","title":"ä½¿ç”¨mongodbè‡ªå¸¦çš„ObjectIDè·å–è®°å½•ç”Ÿæˆæ—¶é—´"},{"content":"é¡¹ç›®åœ°å€ï¼š https://pypi.org/project/pip-tools/\npip-tools æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·é›†åˆï¼Œä¸»è¦æœ‰ä¸¤ä¸ªå‘½ä»¤ï¼š pip-compileï¼Œpip-syncï¼Œç°åœ¨ä¸»è¦ç”¨çš„æ˜¯ pip-compile\nåœ¨å†™pythoné¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä¾èµ–åˆ°å…¶ä»–çš„åŒ…ï¼Œæ¯”å¦‚å†™ä¸€ä¸ªåç«¯çš„æœåŠ¡ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä¾èµ–åˆ°flask/pymysqlè¿™äº›åŸºç¡€çš„åŒ…ï¼Œéšç€å¼€å‘çš„è¿›è¡Œï¼Œæˆ‘ä»¬è¿˜å¯èƒ½ä¼šå¼•å…¥æ›´å¤šçš„ä¾èµ–ã€‚\nè¿™äº›pythonä¾èµ–åŒ…æ„æˆäº†ä¸€ä¸ªå®Œæ•´çš„æœåŠ¡ï¼Œå¼€å‘å®Œæˆåï¼Œæˆ‘ä»¬å°†è¿™äº›æœåŠ¡éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šæ—¶ï¼Œåªéœ€è¦å®‰è£…å¥½å¯¹åº”çš„ä¾èµ–ï¼Œä¾¿å¯ä»¥ç›´æ¥è¿è¡ŒæœåŠ¡ã€‚\nä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä¸å°†ç”Ÿäº§ç¯å¢ƒçš„ä¾èµ–å›ºå®šä¸‹æ¥çš„è¯ï¼Œæ•´ä¸ªæœåŠ¡å¯èƒ½ä¼šå› ä¸ºæŸä¸€æ¬¡æœåŠ¡æ›´æ–°ï¼Œå…¶ä¸­æŸä¸ªçš„æ›´æ–°å¸¦æ¥çš„ä¸å…¼å®¹å¯¼è‡´æ•´ä¸ªæœåŠ¡å´©æºƒã€‚æ¯”å¦‚pyjwtï¼Œåœ¨1.7.1ç‰ˆæœ¬ä¹‹å‰ç”Ÿæˆçš„jwt-tokenæ˜¯ä¸€ä¸ªbytesç±»å‹ï¼Œæˆ‘ä»¬å°†å…¶è½¬æ¢æˆä¸ºå­—ç¬¦ä¸²éœ€è¦ä½¿ç”¨åˆ°decode()æ–¹æ³•ã€‚ä½†æ˜¯åœ¨æ›´æ–°åˆ°2.0ä¹‹åï¼Œç”Ÿæˆçš„jwt-tokenæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚æœæˆ‘ä»¬å¯¹å…¶å†è°ƒç”¨decodeæ–¹æ³•çš„è¯ï¼Œå°±ä¼šå‘ç”Ÿé”™è¯¯ã€‚\nè¿™å°±æ˜¾ç°å‡ºäº†å›ºå®šä¾èµ–çš„é‡è¦æ€§äº†ã€‚\né€šå¸¸ï¼Œå›ºå®šä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨ pip freezeå‘½ä»¤ï¼Œç›´æ¥å°†å¼€å‘ç¯å¢ƒçš„æ‰€æœ‰ç‰ˆæœ¬å›ºå®šä¸‹æ¥åˆ°ä¸€ä¸ª requirements.txt æ–‡ä»¶é‡Œé¢ï¼Œè¿™æ˜¯æ‡’äººåšæ³•ï¼Œå½“ç„¶ä¹Ÿå¾ˆæœ‰æ•ˆã€‚ä½†æ˜¯æ–‡ä»¶é‡Œé¢ä¼šå¸¦æœ‰ä¸€äº›ç³»ç»Ÿçš„ä¾èµ–ç‰ˆæœ¬ï¼Œæ¯”å¦‚urllib ä¹‹ç±»çš„ï¼Œè¿™äº›æˆ‘ä»¬æ˜¯ä¸éœ€è¦å†æ¬¡å®‰è£…çš„ï¼Œæ‰€ä»¥ï¼Œå¦‚æœè¿™äº›ä¾èµ–å‡ºç°åœ¨ requirements.txt æ–‡ä»¶é‡Œé¢ï¼Œå°±ä¼šæ˜¾å¾—ä¸é‚£ä¹ˆå¹²å‡€ã€‚\nè¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ pip-toolsé‡Œé¢çš„ pip-compile å·¥å…·ï¼Œå¯¹ä¾èµ–è¿›è¡Œç¼–è¯‘ï¼Œç”Ÿæˆä¸€ä»½æ¼‚äº®çš„ä¾èµ–æ–‡ä»¶ã€‚\nç›´æ¥ç”Ÿæˆæœ€æ–°ä¾èµ– é¦–å…ˆï¼Œæˆ‘ä»¬å°†é¡¹ç›®ä¸­ç›´æ¥ä¾èµ–çš„åŒ…å†™åˆ°requirements.inæ–‡ä»¶é‡Œé¢ requirements.in\npymysql flask ä½¿ç”¨ pip-compile è‡ªåŠ¨ä½¿ç”¨æœ€æ–°ä¾èµ–ç‰ˆæœ¬ç”Ÿæˆä¾èµ–æ–‡ä»¶ å‘½ä»¤ï¼š pip-compile, è¾“å‡ºrequirements.txtæ–‡ä»¶ï¼š\nrequirements.txt\n# # This file is autogenerated by pip-compile with python 3.8 # To update, run: # # pip-compile # --index-url https://pypi.doubanio.com/simple --trusted-host pypi.doubanio.com click==8.1.3 # via flask flask==2.1.2 # via -r requirements.in importlib-metadata==4.11.4 # via flask itsdangerous==2.1.2 # via flask jinja2==3.1.2 # via flask markupsafe==2.1.1 # via jinja2 pymysql==1.0.2 # via -r requirements.in werkzeug==2.1.2 # via flask zipp==3.8.0 # via importlib-metadata è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä»½æ¼‚äº®çš„ä¾èµ–æ–‡ä»¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°æŸä¸€ä¸ªä¾èµ–åŒ…æ˜¯å“ªä¸ªåŒ…çš„ä¾èµ–ã€‚\nä»æœ¬åœ°å·²æœ‰ä¾èµ–ç”Ÿæˆæ–‡ä»¶ æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬çš„æœåŠ¡å·²ç»éƒ¨ç½²ä¸Šäº‘äº†ï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è¦ä½¿ç”¨å·²æœ‰çš„ï¼ˆæœ¬åœ°å·²å®‰è£…çš„ï¼‰ä¾èµ–ç‰ˆæœ¬æ¥ç”Ÿæˆä¾èµ–æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä»pypiä¸ŠæŸ¥æ‰¾æœ€æ–°çš„ï¼Œå› ä¸ºç°æœ‰æ­£åœ¨è¿è¡Œçš„ç›¸å¯¹ç¨³å®šï¼Œè€Œæ›´æ–°åä¸ç¡®å®šä¼šå¼•å…¥å“ªäº›ä¸å…¼å®¹é—®é¢˜ã€‚\næˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š\nè¿˜æ˜¯å…ˆå°†æˆ‘ä»¬çš„ç›´æ¥ä¾èµ–å†™åˆ° requirements.in æ–‡ä»¶é‡Œé¢ åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ pip freeze --exclude-editable \u0026gt; requirements.txt å‘½ä»¤ï¼Œå°†å½“å‰ç¯å¢ƒçš„æ‰€æœ‰åŒ…ç‰ˆæœ¬å†™åˆ°requirements.txt æ–‡ä»¶é‡Œé¢ ä½¿ç”¨å‘½ä»¤ pip-compile --no-upgradeï¼Œåªç”¨æœ¬åœ°ä¾èµ–ç”Ÿæˆä¸€ä»½æ¼‚äº®çš„ä¾èµ–æ–‡ä»¶ã€‚ é‡æ–°ç”Ÿæˆçš„ä¾èµ–æ–‡ä»¶ï¼š\nrequirements.txt\n# # This file is autogenerated by pip-compile with python 3.8 # To update, run: # # pip-compile # --index-url https://pypi.doubanio.com/simple --trusted-host pypi.doubanio.com click==7.1.2 # via flask flask==1.1.4 # via -r requirements.in itsdangerous==1.1.0 # via flask jinja2==2.11.3 # via flask markupsafe==2.1.1 # via jinja2 pymysql==0.10.1 # via -r requirements.in werkzeug==1.0.1 # via flask åŠ ä¸Šå‚æ•° --no-upgradeï¼Œpip-compile å°±ä¼šä¼˜å…ˆä½¿ç”¨requirements.txté‡Œé¢ï¼Œæˆ‘ä»¬freezeçš„ä¾èµ–ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯åˆ°pypiä¸­å¯»æ‰¾æœ€æ–°çš„ç‰ˆæœ¬ã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œé‡æ–°ç”Ÿæˆçš„ requirements.txt æ–‡ä»¶çš„å„ä¸ªç‰ˆæœ¬éƒ½ç›¸å¯¹è½åä¸€äº›ï¼Œä¾èµ–æ€»æ•°ä¹Ÿå°‘ä¸€ç‚¹ã€‚\n","permalink":"https://zihuanling.github.io/posts/pip-tools-generate-dependencies/","summary":"\u003cp\u003eé¡¹ç›®åœ°å€ï¼š \u003ca href=\"https://pypi.org/project/pip-tools/\"\u003ehttps://pypi.org/project/pip-tools/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003epip-tools æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·é›†åˆï¼Œä¸»è¦æœ‰ä¸¤ä¸ªå‘½ä»¤ï¼š \u003ccode\u003epip-compile\u003c/code\u003eï¼Œ\u003ccode\u003epip-sync\u003c/code\u003eï¼Œç°åœ¨ä¸»è¦ç”¨çš„æ˜¯ \u003ccode\u003epip-compile\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eåœ¨å†™pythoné¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä¾èµ–åˆ°å…¶ä»–çš„åŒ…ï¼Œæ¯”å¦‚å†™ä¸€ä¸ªåç«¯çš„æœåŠ¡ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä¾èµ–åˆ°\u003ccode\u003eflask/pymysql\u003c/code\u003eè¿™äº›åŸºç¡€çš„åŒ…ï¼Œéšç€å¼€å‘çš„è¿›è¡Œï¼Œæˆ‘ä»¬è¿˜å¯èƒ½ä¼šå¼•å…¥æ›´å¤šçš„ä¾èµ–ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™äº›pythonä¾èµ–åŒ…æ„æˆäº†ä¸€ä¸ªå®Œæ•´çš„æœåŠ¡ï¼Œå¼€å‘å®Œæˆåï¼Œæˆ‘ä»¬å°†è¿™äº›æœåŠ¡éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šæ—¶ï¼Œåªéœ€è¦å®‰è£…å¥½å¯¹åº”çš„ä¾èµ–ï¼Œä¾¿å¯ä»¥ç›´æ¥è¿è¡ŒæœåŠ¡ã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä¸å°†ç”Ÿäº§ç¯å¢ƒçš„ä¾èµ–å›ºå®šä¸‹æ¥çš„è¯ï¼Œæ•´ä¸ªæœåŠ¡å¯èƒ½ä¼šå› ä¸ºæŸä¸€æ¬¡æœåŠ¡æ›´æ–°ï¼Œå…¶ä¸­æŸä¸ªçš„æ›´æ–°å¸¦æ¥çš„ä¸å…¼å®¹å¯¼è‡´æ•´ä¸ªæœåŠ¡å´©æºƒã€‚æ¯”å¦‚pyjwtï¼Œåœ¨1.7.1ç‰ˆæœ¬ä¹‹å‰ç”Ÿæˆçš„jwt-tokenæ˜¯ä¸€ä¸ªbytesç±»å‹ï¼Œæˆ‘ä»¬å°†å…¶è½¬æ¢æˆä¸ºå­—ç¬¦ä¸²éœ€è¦ä½¿ç”¨åˆ°\u003ccode\u003edecode()\u003c/code\u003eæ–¹æ³•ã€‚ä½†æ˜¯åœ¨æ›´æ–°åˆ°2.0ä¹‹åï¼Œç”Ÿæˆçš„jwt-tokenæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚æœæˆ‘ä»¬å¯¹å…¶å†è°ƒç”¨\u003ccode\u003edecode\u003c/code\u003eæ–¹æ³•çš„è¯ï¼Œå°±ä¼šå‘ç”Ÿé”™è¯¯ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™å°±æ˜¾ç°å‡ºäº†\u003cstrong\u003eå›ºå®šä¾èµ–\u003c/strong\u003eçš„é‡è¦æ€§äº†ã€‚\u003c/p\u003e\n\u003cp\u003eé€šå¸¸ï¼Œå›ºå®šä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨ \u003ccode\u003epip freeze\u003c/code\u003eå‘½ä»¤ï¼Œç›´æ¥å°†å¼€å‘ç¯å¢ƒçš„æ‰€æœ‰ç‰ˆæœ¬å›ºå®šä¸‹æ¥åˆ°ä¸€ä¸ª requirements.txt æ–‡ä»¶é‡Œé¢ï¼Œè¿™æ˜¯æ‡’äººåšæ³•ï¼Œå½“ç„¶ä¹Ÿå¾ˆæœ‰æ•ˆã€‚ä½†æ˜¯æ–‡ä»¶é‡Œé¢ä¼šå¸¦æœ‰ä¸€äº›ç³»ç»Ÿçš„ä¾èµ–ç‰ˆæœ¬ï¼Œæ¯”å¦‚urllib ä¹‹ç±»çš„ï¼Œè¿™äº›æˆ‘ä»¬æ˜¯ä¸éœ€è¦å†æ¬¡å®‰è£…çš„ï¼Œæ‰€ä»¥ï¼Œå¦‚æœè¿™äº›ä¾èµ–å‡ºç°åœ¨ requirements.txt æ–‡ä»¶é‡Œé¢ï¼Œå°±ä¼šæ˜¾å¾—\u003cstrong\u003eä¸é‚£ä¹ˆå¹²å‡€\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eè¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ pip-toolsé‡Œé¢çš„ \u003ccode\u003epip-compile\u003c/code\u003e å·¥å…·ï¼Œå¯¹ä¾èµ–è¿›è¡Œç¼–è¯‘ï¼Œç”Ÿæˆä¸€ä»½æ¼‚äº®çš„ä¾èµ–æ–‡ä»¶ã€‚\u003c/p\u003e\n\u003ch2 id=\"ç›´æ¥ç”Ÿæˆæœ€æ–°ä¾èµ–\"\u003eç›´æ¥ç”Ÿæˆæœ€æ–°ä¾èµ–\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eé¦–å…ˆï¼Œæˆ‘ä»¬å°†é¡¹ç›®ä¸­ç›´æ¥ä¾èµ–çš„åŒ…å†™åˆ°\u003ccode\u003erequirements.in\u003c/code\u003eæ–‡ä»¶é‡Œé¢\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cem\u003erequirements.in\u003c/em\u003e\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-in\" data-lang=\"in\"\u003epymysql\nflask\n\u003c/code\u003e\u003c/pre\u003e\u003col start=\"2\"\u003e\n\u003cli\u003eä½¿ç”¨ \u003ccode\u003epip-compile\u003c/code\u003e è‡ªåŠ¨ä½¿ç”¨æœ€æ–°ä¾èµ–ç‰ˆæœ¬ç”Ÿæˆä¾èµ–æ–‡ä»¶\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eå‘½ä»¤ï¼š \u003ccode\u003epip-compile\u003c/code\u003e, è¾“å‡ºrequirements.txtæ–‡ä»¶ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cem\u003erequirements.txt\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-txt\" data-lang=\"txt\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e#\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e# This file is autogenerated by pip-compile with python 3.8\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e# To update, run:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e#\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e#    pip-compile\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e#\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e--index-url https://pypi.doubanio.com/simple\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e--trusted-host pypi.doubanio.com\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eclick==8.1.3\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    # via flask\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eflask==2.1.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    # via -r requirements.in\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eimportlib-metadata==4.11.4\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    # via flask\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eitsdangerous==2.1.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    # via flask\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejinja2==3.1.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    # via flask\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emarkupsafe==2.1.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    # via jinja2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epymysql==1.0.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    # via -r requirements.in\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ewerkzeug==2.1.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    # via flask\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ezipp==3.8.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    # via importlib-metadata\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä»½æ¼‚äº®çš„ä¾èµ–æ–‡ä»¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°æŸä¸€ä¸ªä¾èµ–åŒ…æ˜¯å“ªä¸ªåŒ…çš„ä¾èµ–ã€‚\u003c/p\u003e","title":"ä½¿ç”¨Pip Toolsç”Ÿæˆå¥½çœ‹çš„ä¾èµ–æ–‡ä»¶"},{"content":"å‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªjsonæ–‡ä»¶ï¼šexample.jsonï¼Œæˆ‘ä»¬æƒ³è¦å°†è¿™ä¸ªæ–‡ä»¶çš„è¿æ¥æ”¾åˆ°ç½‘ç«™ä¸Šæä¾›ä¸‹è½½ã€‚\nåœ¨HTMLä¸­è¿™æ ·å†™ï¼š\n\u0026lt;a href=\u0026#34;http://lingzihuan.icu/leetcode-submissions.json\u0026#34;\u0026gt;ç‚¹å‡»ä¸‹è½½\u0026lt;/a\u0026gt; ç‚¹å‡»ä¸‹è½½ å½“æˆ‘ä»¬ç‚¹å‡»é“¾æ¥çš„æ—¶å€™ï¼Œchromeæµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€ä¸€ä¸ªé¡µé¢ï¼Œç„¶åå°†jsonæ–‡ä»¶çš„å†…å®¹åŠ è½½è¿›æ¥ï¼Œä½†æ˜¯ï¼Œå½“æˆ‘ä»¬æƒ³è¦å°†æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°çš„æ—¶å€™ï¼Œè¿˜å¾—è‡ªå·±å³é”®ç‚¹å‡»ï¼Œç„¶åé€‰æ‹©â€å¦å­˜ä¸ºâ€œã€‚\nçœ‹è¿‡ Stack Overflow ä¸Šçš„æç¤ºï¼Œçœ‹åˆ°å¯ä»¥ç»™å…¶è®¾å®š downloadå±æ€§ï¼š\n\u0026lt;a href=\u0026#34;http://lingzihuan.icu/leetcode-submissions.json\u0026#34; download\u0026gt;ç‚¹å‡»ä¸‹è½½\u0026lt;/a\u0026gt; ç‚¹å‡»ä¸‹è½½ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œhrefé‡Œé¢çš„å†…å®¹éœ€è¦æ˜¯ä¸å½“å‰ç½‘é¡µåŒæºçš„urlæ‰å¯ä½¿ç”¨ã€‚\n","permalink":"https://zihuanling.github.io/posts/html-a-data-download/","summary":"\u003cp\u003eå‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªjsonæ–‡ä»¶ï¼š\u003ccode\u003eexample.json\u003c/code\u003eï¼Œæˆ‘ä»¬æƒ³è¦å°†è¿™ä¸ªæ–‡ä»¶çš„è¿æ¥æ”¾åˆ°ç½‘ç«™ä¸Šæä¾›ä¸‹è½½ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨HTMLä¸­è¿™æ ·å†™ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-html\" data-lang=\"html\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;http://lingzihuan.icu/leetcode-submissions.json\u0026#34;\u003c/span\u003e\u0026gt;ç‚¹å‡»ä¸‹è½½\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003ca href=\"http://lingzihuan.icu/leetcode-submissions.json\"\u003eç‚¹å‡»ä¸‹è½½\u003c/a\u003e\n\n\n\u003cp\u003eå½“æˆ‘ä»¬ç‚¹å‡»é“¾æ¥çš„æ—¶å€™ï¼Œchromeæµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€ä¸€ä¸ªé¡µé¢ï¼Œç„¶åå°†jsonæ–‡ä»¶çš„å†…å®¹åŠ è½½è¿›æ¥ï¼Œä½†æ˜¯ï¼Œå½“æˆ‘ä»¬æƒ³è¦å°†æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°çš„æ—¶å€™ï¼Œè¿˜å¾—è‡ªå·±å³é”®ç‚¹å‡»ï¼Œç„¶åé€‰æ‹©â€å¦å­˜ä¸ºâ€œã€‚\u003c/p\u003e\n\u003cp\u003eçœ‹è¿‡ Stack Overflow ä¸Šçš„æç¤ºï¼Œçœ‹åˆ°å¯ä»¥ç»™å…¶è®¾å®š \u003ccode\u003edownload\u003c/code\u003eå±æ€§ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-html\" data-lang=\"html\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;http://lingzihuan.icu/leetcode-submissions.json\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edownload\u003c/span\u003e\u0026gt;ç‚¹å‡»ä¸‹è½½\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ca href=\"http://lingzihuan.icu/leetcode-submissions.json\" download\u003eç‚¹å‡»ä¸‹è½½\u003c/a\u003e\n\n\u003cp\u003eéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œhrefé‡Œé¢çš„å†…å®¹éœ€è¦æ˜¯ä¸å½“å‰ç½‘é¡µåŒæºçš„urlæ‰å¯ä½¿ç”¨ã€‚\u003c/p\u003e","title":"HTML aæ ‡ç­¾ä¸‹è½½jsonæ•°æ®"},{"content":"functools æ¨¡å—åº”ç”¨äºé«˜é˜¶å‡½æ•°ï¼Œå³å‚æ•°æˆ–ï¼ˆå’Œï¼‰è¿”å›å€¼ä¸ºå…¶ä»–å‡½æ•°çš„å‡½æ•°ï¼Œå¦‚è£…é¥°å™¨ã€sortedå‡½æ•°çš„keyå‚æ•°ç­‰ã€‚é€šå¸¸æ¥è¯´ï¼Œæ­¤æ¨¡å—åŠŸèƒ½é€‚ç”¨äºæ‰€æœ‰å¯è°ƒç”¨å¯¹è±¡ã€‚\nhttps://docs.python.org/zh-cn/3/library/functools.html\nå‘ç°functoolsé‡Œé¢æœ‰å‡ ä¸ªæœ‰æ„æ€çš„å‡½æ•°ï¼Œè®°å½•ä¸€ä¸‹ï¼š\ncmp_to_key å°†(æ—§å¼çš„)æ¯”è¾ƒå‡½æ•°è½¬æ¢ä¸ºæ–°å¼çš„ key function . åœ¨ç±»ä¼¼äº sorted() ï¼Œ min() ï¼Œ max() ï¼Œ heapq.nlargest() ï¼Œ heapq.nsmallest() ï¼Œ itertools.groupby() ç­‰å‡½æ•°çš„ key å‚æ•°ä¸­ä½¿ç”¨ã€‚æ­¤å‡½æ•°ä¸»è¦ç”¨ä½œå°† Python 2 ç¨‹åºè½¬æ¢è‡³æ–°ç‰ˆçš„è½¬æ¢å·¥å…·ï¼Œä»¥ä¿æŒå¯¹æ¯”è¾ƒå‡½æ•°çš„å…¼å®¹ã€‚\næ¯”è¾ƒå‡½æ•°æ„ä¸ºä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ¥å—ä¸¤ä¸ªå‚æ•°å¹¶æ¯”è¾ƒå®ƒä»¬ï¼Œç»“æœä¸ºå°äºåˆ™è¿”å›ä¸€ä¸ªè´Ÿæ•°ï¼Œç›¸ç­‰åˆ™è¿”å›é›¶ï¼Œå¤§äºåˆ™è¿”å›ä¸€ä¸ªæ­£æ•°ã€‚key functionåˆ™æ˜¯ä¸€ä¸ªæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå¹¶è¿”å›å¦ä¸€ä¸ªç”¨ä»¥æ’åºçš„å€¼çš„å¯è°ƒç”¨å¯¹è±¡ã€‚\nå®ä¾‹ï¼š\nä½¿ç”¨sorted + cmp_to_keyï¼Œå®ç°é€†åºæ’åº\nfrom functools import cmp_to_key def mycmp(a, b): return b - a arr = [1,9,3,7,8,2] arr = sorted(arr, key=cmp_to_key(mycmp)) print(arr) è¾“å‡ºï¼š\n[9, 8, 7, 3, 2, 1] ä¸€èˆ¬çš„ key function åªæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œä½¿ç”¨cmp_to_keyï¼Œå¯ä»¥å®ç°è‡ªå®šä¹‰çš„æ’åºé€»è¾‘ï¼Œå¦‚ä¸Šè¿°ï¼Œä¹Ÿå¯ä»¥å®ç°å…¶ä»–é€»è¾‘ï¼Œæ¯”è¾ƒç»å…¸çš„æ˜¯ leetcode-179æœ€å¤§æ•°ï¼Œè¦æ±‚æˆ‘ä»¬å°†æ•°å­—æŒ‰ç…§ç‰¹å®šçš„è§„å¾‹æ’åºï¼Œç„¶åè¿”å›ä¸€ä¸ªé•¿çš„å­—ç¬¦ä¸²ï¼Œå‚è€ƒç­”æ¡ˆï¼š\nclass Solution: def largestNumber(self, nums: List[int]) -\u0026gt; str: # ç¬¬ä¸€æ­¥ï¼šå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼ŒæŠŠæœ€å¤§çš„æ”¾å·¦è¾¹ # ç¬¬äºŒæ­¥ï¼šæ’åº # ç¬¬ä¸‰æ­¥ï¼šè¿”å›ç»“æœ def compare(x, y): return int(y+x) - int(x+y) nums = sorted(map(str, nums), key=cmp_to_key(compare)) print(cmp_to_key) return \u0026#34;0\u0026#34; if nums[0]==\u0026#34;0\u0026#34; else \u0026#34;\u0026#34;.join(nums) å¦‚ä¸Šè¿°çš„æ’åºï¼Œä¹Ÿå¯ä»¥åšä¸€ä¸ªè‡ªå®šä¹‰çš„æ’åºé€»è¾‘ï¼Œå¦‚ï¼šå¦‚æœæ˜¯å¶æ•°ï¼Œæ’åºåœ¨å‰é¢ï¼Œå¥‡æ•°æ’åºåœ¨åé¢ï¼Œç„¶åå¥‡æ•°å’Œå¶æ•°å„è‡ªæ’åºï¼š\ndef mycmp(a, b): # æ’åºå‡½æ•° if a % 2 == b % 2: # åŒä¸ºå¥‡æ•°æˆ–è€…å¶æ•°ï¼Œè¾ƒå°è€…æ’åœ¨å‰é¢ return a - b elif a % 2 == 0: # a ä¸ºå¶æ•°ï¼Œæ’åœ¨å‰é¢ return 1 else: # bä¸ºå¶æ•°ï¼Œæ’åœ¨å‰é¢ return -1 è¾“å‡ºï¼š\n[2, 8, 1, 3, 7, 9] partial è¿”å›ä¸€ä¸ªæ–°çš„ partialå¯¹è±¡ï¼Œå½“è¢«è°ƒç”¨æ—¶å…¶è¡Œä¸ºç±»ä¼¼äº func é™„å¸¦ä½ç½®å‚æ•° args å’Œå…³é”®å­—å‚æ•° keywords è¢«è°ƒç”¨ã€‚ å¦‚æœä¸ºè°ƒç”¨æä¾›äº†æ›´å¤šçš„å‚æ•°ï¼Œå®ƒä»¬ä¼šè¢«é™„åŠ åˆ° argsã€‚ å¦‚æœæä¾›äº†é¢å¤–çš„å…³é”®å­—å‚æ•°ï¼Œå®ƒä»¬ä¼šæ‰©å±•å¹¶é‡è½½ keywordsã€‚ å¤§è‡´ç­‰ä»·äº:\ndef partial(func, /, *args, **keywords): def newfunc(*fargs, **fkeywords): newkeywords = {**keywords, **fkeywords} return func(*args, *fargs, **newkeywords) newfunc.func = func newfunc.args = args newfunc.keywords = keywords return newfunc ä¾‹å­ï¼šæ¯”å¦‚å°è£…intï¼Œæ„é€ ä¸€ä¸ªäºŒè¿›åˆ¶è½¬10è¿›åˆ¶çš„å‡½æ•°ï¼š\nfrom functools import partial bin2dec = partial(int, base=2) bin2dec.__doc__ = \u0026#34;Convert binary string to decimal int\u0026#34; print(bin2dec(\u0026#34;100100\u0026#34;)) è¾“å‡ºï¼š36\nwrapps è¿™æ˜¯ä¸€ä¸ªä¾¿æ·æ›´æ–° è£…é¥°å™¨wrapperçš„å‡½æ•°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå‡½æ•°ä½¿ç”¨è£…é¥°å™¨åŒ…è£…è¿‡åï¼Œè°ƒç”¨ func.__name__è¾“å‡ºçš„æ˜¯è£…é¥°å™¨çš„wrapperåç§°ï¼Œå¦‚ï¼š\ndef decorator(f): def wrapper(*args, **kwargs): return f(*args, **kwargs) return wrapper @decorator def func(): print(\u0026#39;in func.\u0026#39;) print(func.__name__) è¾“å‡ºï¼š wrapper\nå¦‚æœ decorator åŠ ä¸Šäº† wrapsï¼š\nfrom functools import wraps def decorator(f): @wraps(f) def wrapper(*args, **kwargs): return f(*args, **kwargs) return wrapper @decorator def func(): print(\u0026#39;in func.\u0026#39;) print(func.__name__) è¾“å‡ºï¼šfunc\nå…¶å®è¿™ä¸ªwrapsè°ƒç”¨çš„æ˜¯ functools.update_wrapperï¼Œå¯ä»¥å†™æˆè¿™æ ·ï¼š\nfrom functools import update_wrapper def decorator(f): def wrapper(*args, **kwargs): return f(*args, **kwargs) return update_wrapper(wrapper=wrapper, wrapped=f) å®é™…ä¸Šç”¨çš„æ˜¯ partial(update_wrapper, wrapped=f)ï¼Œå‡½æ•°å®šä¹‰ï¼š\ndef wraps(wrapped, assigned = WRAPPER_ASSIGNMENTS, updated = WRAPPER_UPDATES): \u0026#34;\u0026#34;\u0026#34;Decorator factory to apply update_wrapper() to a wrapper function Returns a decorator that invokes update_wrapper() with the decorated function as the wrapper argument and the arguments to wraps() as the remaining arguments. Default arguments are as for update_wrapper(). This is a convenience function to simplify applying partial() to update_wrapper(). \u0026#34;\u0026#34;\u0026#34; return partial(update_wrapper, wrapped=wrapped, assigned=assigned, updated=updated) singledispatch å°†ä¸€ä¸ªå‡½æ•°è½¬æ¢ä¸º å•åˆ†æ´¾ generic functionã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒæ˜¯å•åˆ†æ´¾çš„ï¼Œå³åªèƒ½æ ¹æ®ä¸€ä¸ªå‚æ•°è¿›è¡Œé€‰æ‹©ã€‚\nå‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªéœ€æ±‚ï¼šå®ç°ä¸€ä¸ªencoderï¼Œå¯¹ä¸åŒç±»å‹çš„æ•°æ®è¿›è¡Œç¼–ç ï¼Œæˆ‘ä»¬æœ‰4ç§æ•°æ®ç±»å‹ï¼šdateã€listã€dictï¼Œstrã€‚\nå¦‚æœä¸ç”¨singledispatchçš„è¯ï¼Œæˆ‘ä»¬åº”è¯¥æ˜¯å†™æˆè¿™æ ·çš„ï¼š\nimport datetime as dt def encode(obj): if isinstance(obj, dt.date): return obj.strftime(\u0026#34;%Y/%m/%d\u0026#34;) elif isinstance(obj, list): return \u0026#34;,\u0026#34;.join(obj) elif isinstance(obj, dict): return \u0026#34;,\u0026#34;.join([f\u0026#34;{k}={v}\u0026#34; for k, v in obj.items()]) elif isinstance(obj, str): return obj è°ƒç”¨ï¼š\nprint(encode(dt.date(2022, 5, 9))) print(encode([\u0026#34;hello\u0026#34;, \u0026#34;world\u0026#34;])) print(encode({\u0026#34;name\u0026#34;: \u0026#34;mike\u0026#34;, \u0026#34;age\u0026#34;: 19})) print(encode(\u0026#34;pure string.\u0026#34;)) è¾“å‡ºï¼š\n2022/05/09 hello,world name=mike,age=19 pure string. å¯ä»¥çœ‹åˆ°ï¼Œencoderæ­£å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æœ‰æ–°çš„ç±»å‹éœ€è¦åŠ å…¥è¿›æ¥çš„è¯ï¼Œå°±éœ€è¦å®šä¹‰æ›´å¤šçš„ç±»å‹ï¼ŒåŠ å…¥æ›´å¤šçš„elifè¯­å¥ï¼Œæ¯”è¾ƒç¹çï¼Œå¼•å…¥singledispatchï¼Œæˆ‘ä»¬å¯ä»¥æ”¹ç¼–æˆè¿™æ ·ï¼š\nimport datetime as dt from functools import singledispatch @singledispatch def encode(obj): return obj @encode.register def _(obj:dt.date): return obj.strftime(\u0026#34;%Y/%m/%d\u0026#34;) @encode.register def _(obj:list): return \u0026#34;,\u0026#34;.join(obj) @encode.register def _(obj:dict): return \u0026#34;,\u0026#34;.join([f\u0026#34;{k}={v}\u0026#34; for k, v in obj.items()]) å¦‚ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨äº†singledispatché‡å†™äº†encoderï¼Œå¹¶æ³¨å†Œäº†3ä¸ªåˆ†å‘å‡½æ•°ï¼Œå¯¹åº”çš„ç±»å‹ä¸ºï¼šdateã€listã€dictï¼Œå½“encoderæ¥æ”¶åˆ°è¿™3ä¸­ç±»å‹çš„objå‚æ•°çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨åˆ†å‘åˆ°å¯¹åº”çš„å‡½æ•°ä¸­å»ã€‚å¦åˆ™ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„encoderå‡½æ•°ã€‚\né‡æ–°è¿è¡Œï¼Œè¾“å‡ºä¸ä¸Šè¿°ä¿æŒä¸€è‡´ã€‚\nè¿™æ ·ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ç‰¹å®šçš„ç±»å‹è§£æçš„æ—¶å€™ï¼Œåªéœ€è¦ä½¿ç”¨ @encode.register ä¸ºå…¶æ³¨å†Œä¸€ä¸ªè§£æå™¨å³å¯ã€‚å¯ä»¥åœ¨ç¼–å†™æœåŠ¡ç«¯çš„æ—¶å€™ï¼Œä¸ºç‰¹å®šçš„ORMæ¨¡å‹ç¼–å†™JSONåºåˆ—åŒ–æ³›å‹å‡½æ•°ã€‚\nå¦‚æœæˆ‘ä»¬å®šä¹‰çš„å‡½æ•°ï¼Œä¸ä½¿ç”¨ç±»å‹æ ‡æ³¨ï¼Œæˆ‘ä»¬ä¹ŸåŒæ ·å¯ä»¥å‘registeræ˜¾å¼ä¸­ä¼ é€’ä¸€ä¸ªç±»å‹ï¼š\n@encode.register(list) def _(obj): return \u0026#34;,\u0026#34;.join(obj) ä¹Ÿå¯ä»¥ä¼ é€’å¤šä¸ªï¼š\n@encode.register(list) @encode.register(dict) def _(obj): return \u0026#34;,\u0026#34;.join(obj) æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ registryå±æ€§ï¼Œè®¿é—®singledispatcheréƒ½æœ‰æ³¨å†Œå“ªäº›å‡½æ•°ï¼š\nprint(encode.registry.items()) # è¾“å‡ºï¼šdict_items([(\u0026lt;class \u0026#39;object\u0026#39;\u0026gt;, \u0026lt;function encode at 0x7f8f53b934c0\u0026gt;), (\u0026lt;class \u0026#39;datetime.date\u0026#39;\u0026gt;, \u0026lt;function _ at 0x7f8f53b93280\u0026gt;), (\u0026lt;class \u0026#39;list\u0026#39;\u0026gt;, \u0026lt;function _ at 0x7f8f53b93c10\u0026gt;), (\u0026lt;class \u0026#39;dict\u0026#39;\u0026gt;, \u0026lt;function _ at 0x7f8f53b931f0\u0026gt;)]) å…¶ä»–ï¼š cacheï¼šç®€å•è½»é‡çº§æœªç»‘å®šå‡½æ•°ç¼“å­˜ cached_property lru_cache reduce ","permalink":"https://zihuanling.github.io/posts/python-functools/","summary":"\u003cp\u003efunctools æ¨¡å—åº”ç”¨äºé«˜é˜¶å‡½æ•°ï¼Œå³å‚æ•°æˆ–ï¼ˆå’Œï¼‰è¿”å›å€¼ä¸ºå…¶ä»–å‡½æ•°çš„å‡½æ•°ï¼Œå¦‚è£…é¥°å™¨ã€sortedå‡½æ•°çš„keyå‚æ•°ç­‰ã€‚é€šå¸¸æ¥è¯´ï¼Œæ­¤æ¨¡å—åŠŸèƒ½é€‚ç”¨äºæ‰€æœ‰å¯è°ƒç”¨å¯¹è±¡ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://docs.python.org/zh-cn/3/library/functools.html\"\u003ehttps://docs.python.org/zh-cn/3/library/functools.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eå‘ç°functoolsé‡Œé¢æœ‰å‡ ä¸ªæœ‰æ„æ€çš„å‡½æ•°ï¼Œè®°å½•ä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003ch2 id=\"cmp_to_key\"\u003ecmp_to_key\u003c/h2\u003e\n\u003cp\u003eå°†(æ—§å¼çš„)æ¯”è¾ƒå‡½æ•°è½¬æ¢ä¸ºæ–°å¼çš„ \u003ca href=\"https://docs.python.org/zh-cn/3/glossary.html#term-key-function\"\u003ekey function\u003c/a\u003e . åœ¨ç±»ä¼¼äº \u003ca href=\"https://docs.python.org/zh-cn/3/library/functions.html#sorted\"\u003e\u003ccode\u003esorted()\u003c/code\u003e\u003c/a\u003e ï¼Œ \u003ca href=\"https://docs.python.org/zh-cn/3/library/functions.html#min\"\u003e\u003ccode\u003emin()\u003c/code\u003e\u003c/a\u003e ï¼Œ \u003ca href=\"https://docs.python.org/zh-cn/3/library/functions.html#max\"\u003e\u003ccode\u003emax()\u003c/code\u003e\u003c/a\u003e ï¼Œ \u003ca href=\"https://docs.python.org/zh-cn/3/library/heapq.html#heapq.nlargest\"\u003e\u003ccode\u003eheapq.nlargest()\u003c/code\u003e\u003c/a\u003e ï¼Œ \u003ca href=\"https://docs.python.org/zh-cn/3/library/heapq.html#heapq.nsmallest\"\u003e\u003ccode\u003eheapq.nsmallest()\u003c/code\u003e\u003c/a\u003e ï¼Œ \u003ca href=\"https://docs.python.org/zh-cn/3/library/itertools.html#itertools.groupby\"\u003e\u003ccode\u003eitertools.groupby()\u003c/code\u003e\u003c/a\u003e ç­‰å‡½æ•°çš„ key å‚æ•°ä¸­ä½¿ç”¨ã€‚æ­¤å‡½æ•°ä¸»è¦ç”¨ä½œå°† Python 2 ç¨‹åºè½¬æ¢è‡³æ–°ç‰ˆçš„è½¬æ¢å·¥å…·ï¼Œä»¥ä¿æŒå¯¹æ¯”è¾ƒå‡½æ•°çš„å…¼å®¹ã€‚\u003c/p\u003e\n\u003cp\u003eæ¯”è¾ƒå‡½æ•°æ„ä¸ºä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ¥å—ä¸¤ä¸ªå‚æ•°å¹¶æ¯”è¾ƒå®ƒä»¬ï¼Œç»“æœä¸ºå°äºåˆ™è¿”å›ä¸€ä¸ªè´Ÿæ•°ï¼Œç›¸ç­‰åˆ™è¿”å›é›¶ï¼Œå¤§äºåˆ™è¿”å›ä¸€ä¸ªæ­£æ•°ã€‚key functionåˆ™æ˜¯ä¸€ä¸ªæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå¹¶è¿”å›å¦ä¸€ä¸ªç”¨ä»¥æ’åºçš„å€¼çš„å¯è°ƒç”¨å¯¹è±¡ã€‚\u003c/p\u003e\n\u003cp\u003eå®ä¾‹ï¼š\u003c/p\u003e\n\u003cp\u003eä½¿ç”¨sorted + cmp_to_keyï¼Œå®ç°é€†åºæ’åº\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e functools \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e cmp_to_key\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emycmp\u003c/span\u003e(a, b):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e b \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e a\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003earr \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003earr \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e sorted(arr, key\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ecmp_to_key(mycmp))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(arr)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¾“å‡ºï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e[9, 8, 7, 3, 2, 1]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¸€èˆ¬çš„ \u003ccode\u003ekey function\u003c/code\u003e åªæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œä½¿ç”¨\u003ccode\u003ecmp_to_key\u003c/code\u003eï¼Œå¯ä»¥å®ç°è‡ªå®šä¹‰çš„æ’åºé€»è¾‘ï¼Œå¦‚ä¸Šè¿°ï¼Œä¹Ÿå¯ä»¥å®ç°å…¶ä»–é€»è¾‘ï¼Œæ¯”è¾ƒç»å…¸çš„æ˜¯ \u003ca href=\"https://leetcode-cn.com/problems/largest-number/\"\u003eleetcode-179æœ€å¤§æ•°\u003c/a\u003eï¼Œè¦æ±‚æˆ‘ä»¬å°†æ•°å­—æŒ‰ç…§ç‰¹å®šçš„è§„å¾‹æ’åºï¼Œç„¶åè¿”å›ä¸€ä¸ªé•¿çš„å­—ç¬¦ä¸²ï¼Œå‚è€ƒç­”æ¡ˆï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eSolution\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elargestNumber\u003c/span\u003e(self, nums: List[int]) \u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003e str:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# ç¬¬ä¸€æ­¥ï¼šå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼ŒæŠŠæœ€å¤§çš„æ”¾å·¦è¾¹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# ç¬¬äºŒæ­¥ï¼šæ’åº\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# ç¬¬ä¸‰æ­¥ï¼šè¿”å›ç»“æœ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecompare\u003c/span\u003e(x, y): \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e int(y\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003ex) \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e int(x\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003ey)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        nums \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e sorted(map(str, nums), key\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ecmp_to_key(compare))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(cmp_to_key)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e nums[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejoin(nums)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦‚ä¸Šè¿°çš„æ’åºï¼Œä¹Ÿå¯ä»¥åšä¸€ä¸ªè‡ªå®šä¹‰çš„æ’åºé€»è¾‘ï¼Œå¦‚ï¼šå¦‚æœæ˜¯å¶æ•°ï¼Œæ’åºåœ¨å‰é¢ï¼Œå¥‡æ•°æ’åºåœ¨åé¢ï¼Œç„¶åå¥‡æ•°å’Œå¶æ•°å„è‡ªæ’åºï¼š\u003c/p\u003e","title":"Python Functools: å‡ ä¸ªæœ‰æ„æ€çš„å·¥å…·å‡½æ•°"},{"content":"å‚è€ƒåœ°å€ï¼š\nhttps://linuxconfig.org/how-to-write-a-simple-systemd-service\nhttps://www.freedesktop.org/software/systemd/man/systemd.service.html\nå‰è¨€ systemdæ˜¯ç³»ç»Ÿçš„æœåŠ¡å’Œè¿›ç¨‹çš„ç®¡ç†å·¥å…·ï¼Œåœ¨linuxç³»ç»Ÿä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ ps aux | headï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç³»ç»Ÿå¯åŠ¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹å°±æ˜¯systemdã€‚\næœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è¦è®©ç¨‹åºè¿è¡Œåœ¨åå°ï¼Œè€Œä¸æ˜¯ä¸€ç›´åœ¨å‰å°ï¼Œå¼€ä¸€ä¸ªç»ˆç«¯æŒ‚ç€ã€‚ï¼ˆä½¿ç”¨nohupå¯ä»¥å®ç°è¿™ä¸ªï¼‰\næœ‰æ—¶å€™ï¼Œæƒ³è¦åœ¨å¼€æœºçš„æ—¶å€™å°±è‡ªåŠ¨å¯åŠ¨æŸä¸ªæœåŠ¡ï¼Œæ¯”å¦‚redisã€mysqlã€nginxè¿™äº›ï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†è¿™äº›ç¨‹åºçš„å¯åŠ¨ç¼–å†™æˆä¸ºä¸€ä¸ªæœåŠ¡ï¼Œè¿™æ ·ï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ï¼Œsystemdä¼šè‡ªåŠ¨åŠ è½½æœåŠ¡é…ç½®ï¼Œç„¶åå¯åŠ¨è¿™äº›æœåŠ¡ã€‚\nç°åœ¨ï¼Œæˆ‘æƒ³è¦åˆ›å»ºä¸€ä¸ªpython jupyter notebookæœåŠ¡ã€‚\nåˆ›å»ºæ–‡ä»¶ systemd serviceså­˜åœ¨è·¯å¾„ /etc/systemd/system ä¸‹ï¼Œæˆ‘ä»¬åœ¨è¿™è·¯å¾„ä¸‹åˆ›å»ºçš„ .service æ–‡ä»¶ï¼Œéƒ½å¯ä»¥ä½œä¸ºç³»ç»ŸæœåŠ¡è¿è¡Œã€‚\næˆ‘ä»¬åˆ›å»ºä¸€ä¸ª notebook.service\nvi notebook.service æ–‡ä»¶åˆ›å»ºå®Œæ¯•åï¼Œæˆ‘ä»¬å¼€å§‹ç¼–å†™é‡Œé¢çš„å†…å®¹ï¼Œä¸€ä¸ª .serviceæ–‡ä»¶é‡Œé¢åŒ…å«ä¸‰ä¸ªå…³é”®éƒ¨åˆ†ï¼š Unit, Service, Install\nUnit å¯¹äºä¸€ä¸ªç®€å•æœåŠ¡æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ [Unit] è¿™ä¸ªå—åªè¦å†™ä¸ŠæœåŠ¡æè¿°å°±å¯ä»¥äº†ï¼Œå­—æ®µä¸ºDescriptionã€‚\n[Unit] Description=Jupyter notebook service at port[8080] Serivce [Service] å—æ˜¯æœåŠ¡é…ç½®çš„é›†åˆï¼Œè¿™é‡Œé¢çš„é…ç½®å£°æ˜äº†è¯¥å¦‚ä½•å»è¿è¡Œè¿™ä¸ªæœåŠ¡ã€‚\n[Service] Type=simple ExecStart=/usr/bin/env /root/miniconda3/bin/jupyter notebook Restart=on-failure User=root WorkingDirectory=/tmp/notebook åœ¨Serivceå£°æ˜ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè¦è¯´æ˜è¿™ä¸ªæœåŠ¡çš„ç±»å‹ Type=simple\nç„¶åï¼Œæ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰ç³»ç»Ÿåº”è¯¥å»æ‰§è¡Œä»€ä¹ˆä¸œè¥¿ï¼š ExecStart=/usr/bin/env /root/miniconda3/bin/jupyter notebookï¼Œ è¿™é‡Œï¼Œæˆ‘ä»¬æŒ‡å®šäº†æ‰§è¡Œ jupyter notebook è¿™ä¸ªå‘½ä»¤ï¼Œå‰é¢åŠ è½½äº†ç”¨æˆ·çš„ç¯å¢ƒå˜é‡ã€‚\néšåæŒ‡å®šè¿™ä¸ªæœåŠ¡çš„é‡å¯ç­–ç•¥ï¼šRestart=on-failureï¼Œ æˆ‘è¦æ±‚çš„æ˜¯å¯åŠ¨å¤±è´¥åé‡å¯\næœ€åï¼Œè¿™ä¸ªæœåŠ¡è¿è¡Œçš„è§’è‰²ï¼šUser=rootï¼Œä»¥åŠè¿è¡Œæ—¶æ‰€åœ¨è·¯å¾„ï¼š WorkingDirectory=/tmp/notebook\nInstall [Install] å—å£°æ˜äº†å½“å‰æœåŠ¡åº”è¯¥åº”è¯¥æ€æ ·å¯ç”¨ï¼Œå¸¸ç”¨çš„å°±æ˜¯ WantedBy=multi-user.target\n[Install] WantedBy=multi-user.target å¯åŠ¨æœåŠ¡ æœåŠ¡å†™å®Œäº†ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å¯åŠ¨èµ·æ¥ï¼š\n# å¯ç”¨ systemctl enable notebook # å¯åŠ¨ systemctl start notebook okï¼Œè‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„ notebook.service å°±åˆ›å»ºå¹¶å¯åŠ¨å®Œæˆäº†ã€‚\nè¿˜æœ‰æ›´å¤šé«˜çº§çš„ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒï¼šhttps://www.freedesktop.org/software/systemd/man/init.html#\n","permalink":"https://zihuanling.github.io/posts/linux-create-service/","summary":"\u003cp\u003eå‚è€ƒåœ°å€ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://linuxconfig.org/how-to-write-a-simple-systemd-service\"\u003ehttps://linuxconfig.org/how-to-write-a-simple-systemd-service\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://www.freedesktop.org/software/systemd/man/systemd.service.html\"\u003ehttps://www.freedesktop.org/software/systemd/man/systemd.service.html\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"å‰è¨€\"\u003eå‰è¨€\u003c/h1\u003e\n\u003cp\u003e\u003ccode\u003esystemd\u003c/code\u003eæ˜¯ç³»ç»Ÿçš„æœåŠ¡å’Œè¿›ç¨‹çš„ç®¡ç†å·¥å…·ï¼Œåœ¨linuxç³»ç»Ÿä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ \u003ccode\u003eps aux | head\u003c/code\u003eï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç³»ç»Ÿå¯åŠ¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹å°±æ˜¯systemdã€‚\u003c/p\u003e\n\u003cp\u003eæœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è¦è®©ç¨‹åºè¿è¡Œåœ¨åå°ï¼Œè€Œä¸æ˜¯ä¸€ç›´åœ¨å‰å°ï¼Œå¼€ä¸€ä¸ªç»ˆç«¯æŒ‚ç€ã€‚ï¼ˆä½¿ç”¨nohupå¯ä»¥å®ç°è¿™ä¸ªï¼‰\u003c/p\u003e\n\u003cp\u003eæœ‰æ—¶å€™ï¼Œæƒ³è¦åœ¨å¼€æœºçš„æ—¶å€™å°±è‡ªåŠ¨å¯åŠ¨æŸä¸ªæœåŠ¡ï¼Œæ¯”å¦‚redisã€mysqlã€nginxè¿™äº›ï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†è¿™äº›ç¨‹åºçš„å¯åŠ¨ç¼–å†™æˆä¸ºä¸€ä¸ªæœåŠ¡ï¼Œè¿™æ ·ï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ï¼Œsystemdä¼šè‡ªåŠ¨åŠ è½½æœåŠ¡é…ç½®ï¼Œç„¶åå¯åŠ¨è¿™äº›æœåŠ¡ã€‚\u003c/p\u003e\n\u003cp\u003eç°åœ¨ï¼Œæˆ‘æƒ³è¦åˆ›å»ºä¸€ä¸ª\u003cstrong\u003epython jupyter notebook\u003c/strong\u003eæœåŠ¡ã€‚\u003c/p\u003e\n\u003ch1 id=\"åˆ›å»ºæ–‡ä»¶\"\u003eåˆ›å»ºæ–‡ä»¶\u003c/h1\u003e\n\u003cp\u003esystemd serviceså­˜åœ¨è·¯å¾„ \u003ccode\u003e/etc/systemd/system\u003c/code\u003e ä¸‹ï¼Œæˆ‘ä»¬åœ¨è¿™è·¯å¾„ä¸‹åˆ›å»ºçš„ \u003ccode\u003e.service\u003c/code\u003e æ–‡ä»¶ï¼Œéƒ½å¯ä»¥ä½œä¸ºç³»ç»ŸæœåŠ¡è¿è¡Œã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª \u003ccode\u003enotebook.service\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evi notebook.service\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ–‡ä»¶åˆ›å»ºå®Œæ¯•åï¼Œæˆ‘ä»¬å¼€å§‹ç¼–å†™é‡Œé¢çš„å†…å®¹ï¼Œä¸€ä¸ª \u003ccode\u003e.service\u003c/code\u003eæ–‡ä»¶é‡Œé¢åŒ…å«ä¸‰ä¸ªå…³é”®éƒ¨åˆ†ï¼š \u003ccode\u003eUnit, Service, Install\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"unit\"\u003eUnit\u003c/h2\u003e\n\u003cp\u003eå¯¹äºä¸€ä¸ªç®€å•æœåŠ¡æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ \u003ccode\u003e[Unit]\u003c/code\u003e è¿™ä¸ªå—åªè¦å†™ä¸ŠæœåŠ¡æè¿°å°±å¯ä»¥äº†ï¼Œå­—æ®µä¸ºDescriptionã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003e[Unit]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eDescription\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eJupyter notebook service at port[8080]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"serivce\"\u003eSerivce\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003e[Service]\u003c/code\u003e å—æ˜¯æœåŠ¡é…ç½®çš„é›†åˆï¼Œè¿™é‡Œé¢çš„é…ç½®å£°æ˜äº†è¯¥å¦‚ä½•å»è¿è¡Œè¿™ä¸ªæœåŠ¡ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003e[Service]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eType\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003esimple\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eExecStart\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e/usr/bin/env /root/miniconda3/bin/jupyter notebook\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eRestart\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eon-failure\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eUser\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eroot\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eWorkingDirectory\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e/tmp/notebook\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåœ¨Serivceå£°æ˜ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè¦è¯´æ˜è¿™ä¸ªæœåŠ¡çš„ç±»å‹ \u003ccode\u003eType=simple\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åï¼Œæ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰ç³»ç»Ÿåº”è¯¥å»æ‰§è¡Œä»€ä¹ˆä¸œè¥¿ï¼š \u003ccode\u003eExecStart=/usr/bin/env /root/miniconda3/bin/jupyter notebook\u003c/code\u003eï¼Œ è¿™é‡Œï¼Œæˆ‘ä»¬æŒ‡å®šäº†æ‰§è¡Œ jupyter notebook è¿™ä¸ªå‘½ä»¤ï¼Œå‰é¢åŠ è½½äº†ç”¨æˆ·çš„ç¯å¢ƒå˜é‡ã€‚\u003c/p\u003e\n\u003cp\u003eéšåæŒ‡å®šè¿™ä¸ªæœåŠ¡çš„é‡å¯ç­–ç•¥ï¼š\u003ccode\u003eRestart=on-failure\u003c/code\u003eï¼Œ æˆ‘è¦æ±‚çš„æ˜¯å¯åŠ¨å¤±è´¥åé‡å¯\u003c/p\u003e\n\u003cp\u003eæœ€åï¼Œè¿™ä¸ªæœåŠ¡è¿è¡Œçš„è§’è‰²ï¼š\u003ccode\u003eUser=root\u003c/code\u003eï¼Œä»¥åŠè¿è¡Œæ—¶æ‰€åœ¨è·¯å¾„ï¼š \u003ccode\u003eWorkingDirectory=/tmp/notebook\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"install\"\u003eInstall\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003e[Install]\u003c/code\u003e å—å£°æ˜äº†å½“å‰æœåŠ¡åº”è¯¥åº”è¯¥æ€æ ·å¯ç”¨ï¼Œå¸¸ç”¨çš„å°±æ˜¯ \u003ccode\u003eWantedBy=multi-user.target\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003e[Install]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eWantedBy\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003emulti-user.target\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch1 id=\"å¯åŠ¨æœåŠ¡\"\u003eå¯åŠ¨æœåŠ¡\u003c/h1\u003e\n\u003cp\u003eæœåŠ¡å†™å®Œäº†ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å¯åŠ¨èµ·æ¥ï¼š\u003c/p\u003e","title":"Linuxåˆ›å»ºç®€å•çš„systemdæœåŠ¡"},{"content":"ä»Šå¤©åšäº†ä¸€é“æœ‰ç‚¹æ„æ€çš„ç®—æ³•é¢˜ç›®ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸‹ã€‚æäº¤è®°å½•\nleetcode 179: æœ€å¤§æ•° ç»™å®šä¸€ç»„éè´Ÿæ•´æ•° numsï¼Œé‡æ–°æ’åˆ—æ¯ä¸ªæ•°çš„é¡ºåºï¼ˆæ¯ä¸ªæ•°ä¸å¯æ‹†åˆ†ï¼‰ä½¿ä¹‹ç»„æˆä¸€ä¸ªæœ€å¤§çš„æ•´æ•°ã€‚\næ³¨æ„ï¼šè¾“å‡ºç»“æœå¯èƒ½éå¸¸å¤§ï¼Œæ‰€ä»¥ä½ éœ€è¦è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²è€Œä¸æ˜¯æ•´æ•°ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums = [10,2] è¾“å‡ºï¼š\u0026ldquo;210\u0026rdquo; ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums = [3,30,34,5,9] è¾“å‡ºï¼š\u0026ldquo;9534330\u0026rdquo;\næç¤ºï¼š\n1 \u0026lt;= nums.length \u0026lt;= 100 0 \u0026lt;= nums[i] \u0026lt;= 109\nä¸Šæœ€ç»ˆACä»£ç ï¼š def greater(a, b): # å¯¹æ¯”å‡½æ•°ï¼Œa \u0026gt; b # a, b expect str return int(a + b) - int(b + a) \u0026gt; 0 # å¿«æ’ def pivot(arr, low, high): x = arr[high] j = low - 1 for i in range(low, high): if greater2(arr[i], x): j += 1 arr[i], arr[j] = arr[j], arr[i] j += 1 arr[j], arr[high] = arr[high], arr[j] return j def quick_sort(arr, low, high): if low \u0026lt; high: pi = pivot(arr, low, high) quick_sort(arr, low, pi - 1) quick_sort(arr, pi + 1, high) class Solution: def largestNumber(self, nums: List[int]) -\u0026gt; str: nums = [str(n) for n in nums] quick_sort(nums, 0, len(nums) - 1) if nums[0] == \u0026#39;0\u0026#39;: return \u0026#39;0\u0026#39; return \u0026#39;\u0026#39;.join(nums) è‡ªå·±å†™ä¸€ä¸ªå¿«æ’æœ‰ç‚¹å¤šæ­¤ä¸€ä¸¾çš„æ„æ€ï¼Œå®Œå…¨å¯ä»¥ç”¨åˆ°pythonè‡ªå¸¦çš„sortedå‡½æ•°ã€‚\nåˆ†æ è¿™æ˜¯ä¸€é“ä¸­ç­‰éš¾åº¦çš„é¢˜ç›®ï¼Œçœ‹åˆ°é¢˜ç›®çš„ç¬¬ä¸€çœ¼ï¼Œæ€è·¯å¾ˆç®€å•ï¼š\nå¯¹æ•°ç»„æ’åº å°†ç»“æœæ„é€ å­—ç¬¦ä¸²è¿”å› å…¶ä¸»è¦éš¾åº¦åœ¨å¯¹æ•°ç»„çš„æ’åºä¸Šï¼Œè·Ÿä¸€èˆ¬æ„ä¹‰ä¸Šçš„æ•°å€¼æ’åºä¸ä¸€æ ·ï¼Œè¿™ä¸æ˜¯ç®€å•çš„å¯¹æ¯”å„è‡ªçš„æ•°å€¼ï¼Œè€Œæ˜¯æœ‰ä¸€å®šè§„å¾‹çš„ã€‚\næ¯”å¦‚ï¼š9 \u0026gt; 83 \u0026gt; 333ï¼Œä¸€å¼€å§‹æƒ³åˆ°çš„æ˜¯å®šä¹‰ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ï¼Œç”¨æ¥åšå­—ç¬¦ä¸²çš„å¯¹æ¯”ï¼Œå†™æˆè¿™æ ·ï¼š\ndef greater(a, b): size_a, size_b = len(a), len(b) if size_a == size_b and a == b: return True mn = min(size_a, size_b) pre_a, pre_b = a[:mn], b[:mn] if pre_a == pre_b: # å‰ç¼€ç›¸ç­‰ï¼Œå°¾éƒ¨é‡æ–°å¯¹æ¯” return greater(a[mn:], b) if size_a \u0026gt; size_b else greater(a, b[mn:]) # å‰ç¼€ä¸ç›¸ç­‰çš„æƒ…å†µ elif pre_a \u0026gt; pre_b: return True else: return False è¿™é‡Œç›´æ¥æ˜¯ç”¨å­—ç¬¦ä¸²å¯¹æ¯”çš„æ–¹å¼ï¼Œæ¥åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å¤§å°å…³ç³»ï¼Œæ¯”è¾ƒç¹çã€‚\nç„¶åç”¨çš„æ˜¯å¿«æ’ï¼Œè‡ªå·±å†™äº†ä¸ª quick_sortï¼Œç”¨æ¥å¯¹numsæ•°ç»„è¿›è¡Œæ’åºã€‚è¿™æ—¶å€™ï¼Œæˆ‘è¿˜ä¸çŸ¥é“ æœ‰ä¸ªå«functools.cmp_to_keyçš„ç¥å¥‡ä¸œè¥¿ï¼Œå¯ä»¥ç”¨æ¥æ„å»ºè‡ªå·±çš„æ¯”è¾ƒå™¨ï¼Œä¼ å…¥sortedå‡½æ•°é‡Œé¢ï¼\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ•°ç»„é‡Œé¢å¯èƒ½å…¨éƒ¨æ˜¯0ï¼Œè¿™æ˜¯ä¸€ä¸ªè¾¹ç•Œæ¡ä»¶ï¼Œè¿™æ—¶å€™åº”è¯¥è¿”å› 0ï¼Œ è€Œä¸æ˜¯0000ä¹‹ç±»çš„ã€‚\nå‚è€ƒé¢˜è§£å¾—åˆ°çš„æƒŠäººæç¤º æç¤º1ï¼šä½¿ç”¨ int(a + b) - int(b + a) \u0026gt; 0 è™½ç„¶æäº¤çš„ä»£ç ACäº†ï¼Œä½†æ˜¯ï¼Œçœ‹äº†ä¸‹ å®˜æ–¹é¢˜è§£ï¼Œå¤ªå¼ºäº†ï¼ŒçœŸæ˜¯å¤ªå¼ºäº†ï¼å¯¹äºæ•°å­¦æ¸£æ¸£æ¥è¯´ï¼Œçœ‹åˆ°çš„ä¸€é€šåˆ†æï¼Œå®Œå…¨è’™äº†ã€‚\nå¤§æ¦‚å¯ä»¥æ€»ç»“ä¸ºï¼š\næœ‰ä¸¤ä¸ªéè´Ÿæ•´æ•°x, yï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œæƒ³è¦å¯¹æ¯”ä»–ä»¬æ‹¼æ¥çš„å­—ç¬¦ä¸²å¤§å°ï¼Œå¯ä»¥ç›´æ¥ç”¨ int(x + y) - int(y + x) \u0026gt; 0 æ¥åˆ¤æ–­xå’Œyçš„æ‹¼æ¥é¡ºåºã€‚\næœ‰äº†è¿™ä¸ªï¼Œæˆ‘å°±å¯ä»¥ç®€åŒ–æˆ‘çš„å¯¹æ¯”ä»£ç äº†ï¼š\ndef greater(a, b): # å¯¹æ¯”å‡½æ•°ï¼Œa \u0026gt; b # a, b expect str return int(a + b) - int(b + a) \u0026gt; 0 æƒŠå‘†äº†.jpg\nå°†å¯¹æ¯”ä»£ç ç®€åŒ–æˆäº†1è¡Œï¼æ•°å­¦å’Œç®—æ³•çš„é­…åŠ›ã€‚ã€‚ã€‚\næç¤º2ï¼šfunctools.cmp_to_key æœ¬æ¥å¯¹æ¯”è¾ƒå‡½æ•°çš„ä¼˜åŒ–å·²ç»è®©äººæƒŠè®¶äº†ï¼Œç„¶åæˆ‘çœ‹åˆ°äº†è¿™ä¸ªï¼š\nclass Solution: def largestNumber(self, nums: List[int]) -\u0026gt; str: # ç¬¬ä¸€æ­¥ï¼šå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼ŒæŠŠæœ€å¤§çš„æ”¾å·¦è¾¹ # ç¬¬äºŒæ­¥ï¼šæ’åº # ç¬¬ä¸‰æ­¥ï¼šè¿”å›ç»“æœ def compare(x, y): return int(y+x) - int(x+y) nums = sorted(map(str, nums), key=cmp_to_key(compare)) print(cmp_to_key) return \u0026#34;0\u0026#34; if nums[0]==\u0026#34;0\u0026#34; else \u0026#34;\u0026#34;.join(nums) æ»¡æ‰“æ»¡ç®—ï¼Œä¹Ÿå°±4è¡Œå§ï¼Œçœ‹åˆ°ç”¨äº† cmp_to_key è¿™ä¸ªä¸œè¥¿ï¼Œæˆ‘ä¸€å¼€å§‹å¯»æ€ç€ï¼š è¿™ä¹Ÿæ²¡æœ‰å®šä¹‰ï¼Œä¹Ÿæ²¡æœ‰importå‘€ï¼Œå“ªå„¿æ¥çš„\ngoogleä¸€æœï¼šfunctools.cmp_to_keyï¼Œç®€å•æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ä»¥æŠŠå‡½æ•°æ„é€ æˆ **å¯ç”¨äºsortedæ’åºçš„key **çš„å‡½æ•°ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚\næºä»£ç å®šä¹‰å¦‚ä¸‹ï¼š\ndef cmp_to_key(mycmp): \u0026#34;\u0026#34;\u0026#34;Convert a cmp= function into a key= function\u0026#34;\u0026#34;\u0026#34; class K(object): __slots__ = [\u0026#39;obj\u0026#39;] def __init__(self, obj): self.obj = obj def __lt__(self, other): return mycmp(self.obj, other.obj) \u0026lt; 0 def __gt__(self, other): return mycmp(self.obj, other.obj) \u0026gt; 0 def __eq__(self, other): return mycmp(self.obj, other.obj) == 0 def __le__(self, other): return mycmp(self.obj, other.obj) \u0026lt;= 0 def __ge__(self, other): return mycmp(self.obj, other.obj) \u0026gt;= 0 __hash__ = None return K æœ‰äº†è¿™ç©æ„å„¿ï¼Œæˆ‘ä¹‹å‰å†™çš„å¿«æ’å¯ä»¥è¯´æ˜¯æµªè´¹åŠŸå¤«ï¼ˆä¸ºå•¥æ²¡æœ‰æ—©ç‚¹é‡ä¸Šä½ ï¼‰\næœ€å åˆ·å®Œé¢˜åï¼Œçœ‹ä¸€ä¸‹å®˜æ–¹æˆ–è€…æ˜¯å¤§ç¥é¢˜è§£ï¼Œå¯èƒ½æœ‰æ„æƒ³ä¸åˆ°çš„æ”¶è·ï¼Œå¯¹è‡ªå·±çš„æå‡ä¹Ÿæ˜¯å¾ˆå¤§çš„\npythonçš„functoolsçœ‹èµ·æ¥æœ‰å¾ˆå¤šæœ‰æ„æ€çš„ä¸œè¥¿ï¼Œæ‰¾ä¸ªæ—¶é—´æ‰’ä¸€æ‰’ï¼\n","permalink":"https://zihuanling.github.io/posts/leetcode-179/","summary":"\u003cp\u003eä»Šå¤©åšäº†ä¸€é“æœ‰ç‚¹æ„æ€çš„ç®—æ³•é¢˜ç›®ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸‹ã€‚\u003ca href=\"https://leetcode-cn.com/submissions/detail/306795694/\"\u003eæäº¤è®°å½•\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"leetcode-179-æœ€å¤§æ•°httpsleetcode-cncomproblemslargest-number\"\u003e\u003ca href=\"https://leetcode-cn.com/problems/largest-number/\"\u003eleetcode 179: æœ€å¤§æ•°\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eç»™å®šä¸€ç»„éè´Ÿæ•´æ•° numsï¼Œé‡æ–°æ’åˆ—æ¯ä¸ªæ•°çš„é¡ºåºï¼ˆæ¯ä¸ªæ•°ä¸å¯æ‹†åˆ†ï¼‰ä½¿ä¹‹ç»„æˆä¸€ä¸ªæœ€å¤§çš„æ•´æ•°ã€‚\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ï¼šè¾“å‡ºç»“æœå¯èƒ½éå¸¸å¤§ï¼Œæ‰€ä»¥ä½ éœ€è¦è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²è€Œä¸æ˜¯æ•´æ•°ã€‚\u003c/p\u003e\n\u003cp\u003eç¤ºä¾‹ 1ï¼š\u003c/p\u003e\n\u003cp\u003eè¾“å…¥ï¼šnums = [10,2]\nè¾“å‡ºï¼š\u0026ldquo;210\u0026rdquo;\nç¤ºä¾‹ 2ï¼š\u003c/p\u003e\n\u003cp\u003eè¾“å…¥ï¼šnums = [3,30,34,5,9]\nè¾“å‡ºï¼š\u0026ldquo;9534330\u0026rdquo;\u003c/p\u003e\n\u003cp\u003eæç¤ºï¼š\u003c/p\u003e\n\u003cp\u003e1 \u0026lt;= nums.length \u0026lt;= 100\n0 \u0026lt;= nums[i] \u0026lt;= 109\u003c/p\u003e\n\u003ch3 id=\"ä¸Šæœ€ç»ˆacä»£ç \"\u003eä¸Šæœ€ç»ˆACä»£ç ï¼š\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egreater\u003c/span\u003e(a, b):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# å¯¹æ¯”å‡½æ•°ï¼Œa \u0026gt; b\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# a, b expect str\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e int(a \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e b) \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e int(b \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e a) \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# å¿«æ’\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epivot\u003c/span\u003e(arr, low, high):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    x \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e arr[high]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    j \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e low \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(low, high):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e greater2(arr[i], x):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            j \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            arr[i], arr[j] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e arr[j], arr[i]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    j \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    arr[j], arr[high] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e arr[high], arr[j]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e j\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003equick_sort\u003c/span\u003e(arr, low, high):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e low \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e high:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        pi \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e pivot(arr, low, high)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        quick_sort(arr, low, pi \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        quick_sort(arr, pi \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, high)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eSolution\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elargestNumber\u003c/span\u003e(self, nums: List[int]) \u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003e str:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        nums \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [str(n) \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e n \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e nums]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        quick_sort(nums, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, len(nums) \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e nums[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejoin(nums)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cem\u003eè‡ªå·±å†™ä¸€ä¸ªå¿«æ’æœ‰ç‚¹å¤šæ­¤ä¸€ä¸¾çš„æ„æ€ï¼Œå®Œå…¨å¯ä»¥ç”¨åˆ°pythonè‡ªå¸¦çš„sortedå‡½æ•°ã€‚\u003c/em\u003e\u003c/p\u003e","title":"LeetCode 179ï¼šæœ€å¤§æ•° -- ä¸€é“æœ‰ç‚¹æ„æ€çš„é¢˜ç›®"},{"content":"å‰è¨€ HDF5 (Hierarchical Data Format) æ˜¯ç”±ç¾å›½ä¼Šåˆ©è¯ºä¼Šå¤§å­¦å„å·´çº³-é¦™æ§Ÿåˆ†æ ¡ï¼Œæ˜¯ä¸€ç§è·¨å¹³å°ä¼ è¾“çš„æ–‡ä»¶æ ¼å¼ï¼Œå­˜å‚¨å›¾åƒå’Œæ•°æ®\nä¼˜åŠ¿ é€šç”¨æ•°æ®æ¨¡å‹ï¼Œå¯ä»¥é€šè¿‡æ— é™å¤šç§æ•°æ®ç±»å‹è¡¨ç¤ºéå¸¸å¤æ‚ã€å¼‚æ„çš„æ•°æ®å¯¹è±¡å’Œå„ç§å„æ ·çš„å…ƒæ•°æ® é«˜é€ŸåŸå§‹æ•°æ®é‡‡é›† å¯ç§»æ¤å’Œå¯æ‰©å±•ï¼Œæ–‡ä»¶å¤§å°æ²¡æœ‰é™åˆ¶ è‡ªæè¿°çš„ï¼Œä¸éœ€è¦å¤–éƒ¨ä¿¡æ¯åº”ç”¨ç¨‹åºæ¥è§£é‡Šæ–‡ä»¶çš„ç»“æ„å’Œå†…å®¹ æ‹¥æœ‰ç”¨äºç®¡ç†ã€æ“ä½œã€æŸ¥çœ‹å’Œåˆ†ææ•°æ®çš„å¼€æºå·¥å…·å’Œåº”ç”¨ç¨‹åºè½¯ä»¶ç”Ÿæ€ç³»ç»Ÿ åœ¨å„ç§è®¡ç®—å¹³å°å’Œç¼–ç¨‹è¯­è¨€ï¼ˆåŒ…æ‹¬Cã€C++ã€Fortran90å’ŒJavaï¼‰ä¸Šè¿è¡Œçš„è½¯ä»¶åº“ã€‚ å‚è€ƒæ–‡ç« é“¾æ¥ï¼š å¤§æ•°æ®å­˜å‚¨ hdf5ç®€ä»‹\nå®è·µ ç¯å¢ƒå®‰è£… å¯¹äºgoè¯­è¨€ï¼Œhdf5å·²ç»æœ‰äº†æ”¯æŒçš„åº“ï¼š gonum/hdf5ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å®‰è£…è¿™ä¸ªåŒ…ï¼Œå¹¶ä¸”ä½¿ç”¨ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªåŒ…ä½¿ç”¨äº† cgoï¼Œä¾èµ–äº†hdf5çš„Cè¯­è¨€åº“ï¼Œå› æ­¤ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±é¢„å…ˆå®‰è£…ï¼Œä½¿ç”¨centosç³»ç»Ÿï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿å®‰è£…ï¼Œç›´æ¥ä½¿ç”¨å‘½ä»¤ï¼š\nyum install -y hdf5 hdf5-devel å½“ç„¶ï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰è½¯ä»¶æºçš„è¯ï¼Œhdf5ä¹Ÿæä¾›äº†æºç å®‰è£…ï¼Œä¸‹è½½ hdf5-1.12.1ï¼Œè§£å‹åï¼Œæ‰§è¡Œå®‰è£…ï¼š\ncd hdf5-1.12.1 ./configure --prefix /usr/local make -j 2 \u0026amp;\u0026amp; make install ç„¶åæˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ï¼Œåä¸º h5ï¼Œç”¨äºç¼–å†™goã€hdf5 çš„ç®€å•æµ‹è¯•ç”¨ä¾‹\nmkdir -p ~/go/src/h5 cd ~/go/src/h5 go mod init # å®‰è£… go get -v gonum.org/v1/hdf5 ä½¿ç”¨ åˆ›å»ºæ–‡ä»¶ func main() { // åˆ›å»ºhdf5æ–‡ä»¶ f, err := hdf5.CreateFile(\u0026#34;data.h5\u0026#34;, hdf5.F_ACC_TRUNC) if err != nil { panic(fmt.Errorf(\u0026#34;failed to create hdf5 file: %e\u0026#34;, err)) } defer f.Close() fmt.Println(\u0026#34;File created.\u0026#34;) } åˆ›å»ºæ–‡ä»¶çš„ä»£ç å°±ä¸€è¡Œï¼š hdf5.CreateFile(\u0026quot;data.h5\u0026quot;, hdf5.F_ACC_TRUNC)ï¼Œå…¶ä¸­ data.h5 ä¸ºæ–‡ä»¶çš„åç§°ï¼Œä½¿ç”¨flagä¸ºhdf5.F_ACC_TRUNCï¼Œå¦‚æœæ–‡ä»¶å·²å­˜åœ¨çš„è¯ï¼Œä¼šæ¸…é™¤åŸå§‹æ–‡ä»¶é‡Œé¢çš„å†…å®¹ã€‚\nå†™å…¥æ•°æ® func write() { var f *hdf5.File var err error if f, err = hdf5.OpenFile(\u0026#34;data.h5\u0026#34;, hdf5.F_ACC_RDWR); err != nil { panic(fmt.Errorf(\u0026#34;failed to create hdf5 file: %e\u0026#34;, err)) } defer f.Close() // å†™å…¥ 10x10 çŸ©é˜µ data := [10][10]int32{} for i := 0; i \u0026lt; 10; i ++ { for j := 0; j \u0026lt; 10; j++ { data[i][j] = int32((i * 10) + (j + 1)) } } // åˆ›å»ºdatatype dtype, err := hdf5.NewDataTypeFromType(reflect.TypeOf(data[0][0])) if err != nil { panic(fmt.Errorf(\u0026#34;failed to create datatype: %s\u0026#34;, err))} // åˆ›å»ºdataspace dims := []uint{10, 10} dspace, err := hdf5.CreateSimpleDataspace(dims, dims) if err != nil { panic(fmt.Errorf(\u0026#34;failed to create datasapce: %s\u0026#34;, err))} // åˆ›å»ºdataset ds, err := f.CreateDataset(\u0026#34;data\u0026#34;, dtype, dspace) if err != nil {\tpanic(fmt.Errorf(\u0026#34;failed to create dataset: %s\u0026#34;, err)) } // å†™å…¥æ•°æ® if err = ds.Write(\u0026amp;data); err != nil { panic(fmt.Errorf(\u0026#34;write dataset error: %s\u0026#34;, err)) } } å†™å…¥çš„è¿‡ç¨‹ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\nhdf5.OpenFile æ‰“å¼€ä¸€ä¸ªhdf5æ–‡ä»¶ å‡†å¤‡å¥½éœ€è¦å†™å…¥çš„æ•°æ®data hdf5.NewDataTypeFromType ä»æ•°æ®åˆ›å»ºDataTypeï¼Œè¡¨æ˜å½“å‰datasetå­˜å‚¨çš„æ•°æ®ç±»å‹ hdf5.CreateSimpleDataspace åˆ›å»ºDataSpaceï¼Œè¡¨æ˜å½“å‰datasetçš„æ•°æ®å­˜å‚¨spaceï¼Œæœ‰æ•°æ®çš„å½¢çŠ¶æ˜¯æ€æ ·çš„ hdf5.CreateDataset åˆ›å»ºdatasetï¼Œä½¿ç”¨å‰ä¸¤ä¸ªæ­¥éª¤åˆ›å»ºçš„ datatypeå’Œdataspaceï¼Œè¿™æ˜¯å­˜å‚¨æ•°æ®çš„ä¸»ç©ºé—´ æœ€åï¼Œè°ƒç”¨dataset.Write å°†æ•°æ®å†™å…¥datasetä¸­ å†™å…¥å®Œæˆåï¼Œæˆ‘ä»¬ä½¿ç”¨ hdf5 å·¥å…· h5ls æŸ¥çœ‹æ•°æ®çš„å†…å®¹ï¼š\n$ h5ls -d data.h5/data data Dataset {10, 10} Data: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100 å‘½ä»¤ h5ls -d data.h5/data æŸ¥çœ‹æ–‡ä»¶ data.h5é‡Œé¢åä¸ºdataçš„datasetï¼Œå‚æ•° -d è¦æ±‚æ‰“å°å‡ºé‡Œé¢çš„æ•°æ®å†…å®¹\nä»å†…å®¹å¯ä»¥è¡¨æ˜ï¼Œè¿™æ˜¯ä¸€ä¸ª 10x10çš„æ•°æ®é›†åˆã€‚è€Œä»è¾“å‡ºè¡¨æ˜ï¼Œæ•°æ®åœ¨hdf5 é‡Œé¢æ˜¯çº¿æ€§å­˜å‚¨çš„ã€‚\nè¯»å–æ•°æ® func read() { var f *hdf5.File var err error if f, err = hdf5.OpenFile(\u0026#34;data.h5\u0026#34;, hdf5.F_ACC_RDWR); err != nil { panic(fmt.Errorf(\u0026#34;failed to create hdf5 file: %e\u0026#34;, err)) } defer f.Close() // è¯»å– 10x10 çŸ©é˜µ data := [10][10]int32{} ds, err := f.OpenDataset(\u0026#34;data\u0026#34;) if err != nil { panic(fmt.Errorf(\u0026#34;failed to open dataset: %s\u0026#34;, err))} ds.Read(\u0026amp;data) fmt.Printf(\u0026#34;data: %v\\n\u0026#34;, data) } è¯»å–æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œæ˜¯è¯»å–æ‰€æœ‰æ•°æ®\nhdf5.OpenFile æ‰“å¼€æ–‡ä»¶ file.OpenDataset æ‰“å¼€dataset ds.Read å°†datasetä¸­çš„æ•°æ®è¯»å–åˆ° data ä¸­ è¿è¡Œç»“æœ\n$ go run main.go data: [[1 2 3 4 5 6 7 8 9 10] [11 12 13 14 15 16 17 18 19 20] [21 22 23 24 25 26 27 28 29 30] [31 32 33 34 35 36 37 38 39 40] [41 42 43 44 45 46 47 48 49 50] [51 52 53 54 55 56 57 58 59 60] [61 62 63 64 65 66 67 68 69 70] [71 72 73 74 75 76 77 78 79 80] [81 82 83 84 85 86 87 88 89 90] [91 92 93 94 95 96 97 98 99 100]] å®šä¹‰çš„ data æ˜¯ 10x10 çš„ï¼Œdatasetä¸­çš„æ•°æ®ä¹Ÿæ˜¯ 10x10 çš„ï¼Œåˆšå¥½å¯ä»¥å®¹çº³æ‰€æœ‰çš„æ•°æ®ã€‚\nå¦‚æœå®šä¹‰çš„dataä¸è¶³10x10ï¼Œåˆ™åªä¼šè¯»å– m x n çš„æ•°æ®é‡å­˜å‚¨äº data ä¸­ï¼Œæ¯”å¦‚dataä¸º 3x3 çŸ©é˜µï¼Œåˆ™åªä¼šè¯»å– 1,2,3,4,5,6,7,8,9 è¿™å‡ ä¸ªæ•°å€¼\nå¦‚æœå®šä¹‰çš„dataè¶…è¿‡ 10x10ï¼Œåˆ™ä¼šæŒ‰ç…§é¡ºåºå­˜å‚¨åˆ°dataä¸­ï¼Œæ¯”å¦‚ 10 x 11, åˆ™ç¬¬ä¸€è¡Œä¸º 1\u0026hellip;11 , ç¬¬äºŒè¡Œ 12\u0026hellip;22 \u0026hellip; ä»¥æ­¤ç±»æ¨ã€‚è¿™ä¹Ÿè¯´æ˜äº†h5æ–‡ä»¶ä¸­çš„æ•°æ®æ˜¯çº¿æ€§å­˜å‚¨çš„ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœdataå¤§å°è¶…è¿‡äº†dataspaceï¼Œåˆ™dataçš„å‰©ä¸‹çš„ç©ºé—´ä¸ºå¯¹åº”çš„é›¶å€¼ã€‚\nend æ›´å¤šæµ‹è¯•ç”¨ä¾‹ä¾‹å­ï¼Œè§ï¼šhttps://github.com/gonum/hdf5/blob/master/h5d_dataset_test.go\n","permalink":"https://zihuanling.github.io/posts/go-hdf5-practise/","summary":"\u003ch1 id=\"å‰è¨€\"\u003eå‰è¨€\u003c/h1\u003e\n\u003cp\u003eHDF5 (Hierarchical Data Format) æ˜¯ç”±ç¾å›½ä¼Šåˆ©è¯ºä¼Šå¤§å­¦å„å·´çº³-é¦™æ§Ÿåˆ†æ ¡ï¼Œæ˜¯ä¸€ç§è·¨å¹³å°ä¼ è¾“çš„æ–‡ä»¶æ ¼å¼ï¼Œå­˜å‚¨å›¾åƒå’Œæ•°æ®\u003c/p\u003e\n\u003ch2 id=\"ä¼˜åŠ¿\"\u003eä¼˜åŠ¿\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eé€šç”¨æ•°æ®æ¨¡å‹ï¼Œå¯ä»¥é€šè¿‡æ— é™å¤šç§æ•°æ®ç±»å‹è¡¨ç¤ºéå¸¸å¤æ‚ã€å¼‚æ„çš„æ•°æ®å¯¹è±¡å’Œå„ç§å„æ ·çš„å…ƒæ•°æ®\u003c/li\u003e\n\u003cli\u003eé«˜é€ŸåŸå§‹æ•°æ®é‡‡é›†\u003c/li\u003e\n\u003cli\u003eå¯ç§»æ¤å’Œå¯æ‰©å±•ï¼Œæ–‡ä»¶å¤§å°æ²¡æœ‰é™åˆ¶\u003c/li\u003e\n\u003cli\u003eè‡ªæè¿°çš„ï¼Œä¸éœ€è¦å¤–éƒ¨ä¿¡æ¯åº”ç”¨ç¨‹åºæ¥è§£é‡Šæ–‡ä»¶çš„ç»“æ„å’Œå†…å®¹\u003c/li\u003e\n\u003cli\u003eæ‹¥æœ‰ç”¨äºç®¡ç†ã€æ“ä½œã€æŸ¥çœ‹å’Œåˆ†ææ•°æ®çš„å¼€æºå·¥å…·å’Œåº”ç”¨ç¨‹åºè½¯ä»¶ç”Ÿæ€ç³»ç»Ÿ\u003c/li\u003e\n\u003cli\u003eåœ¨å„ç§è®¡ç®—å¹³å°å’Œç¼–ç¨‹è¯­è¨€ï¼ˆåŒ…æ‹¬Cã€C++ã€Fortran90å’ŒJavaï¼‰ä¸Šè¿è¡Œçš„è½¯ä»¶åº“ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå‚è€ƒæ–‡ç« é“¾æ¥ï¼š \u003ca href=\"https://cloud.tencent.com/developer/article/1786168\"\u003eå¤§æ•°æ®å­˜å‚¨ hdf5ç®€ä»‹\u003c/a\u003e\u003c/p\u003e\n\u003ch1 id=\"å®è·µ\"\u003eå®è·µ\u003c/h1\u003e\n\u003ch2 id=\"ç¯å¢ƒå®‰è£…\"\u003eç¯å¢ƒå®‰è£…\u003c/h2\u003e\n\u003cp\u003eå¯¹äºgoè¯­è¨€ï¼Œhdf5å·²ç»æœ‰äº†æ”¯æŒçš„åº“ï¼š \u003ca href=\"https://github.com/gonum/hdf5\"\u003egonum/hdf5\u003c/a\u003eï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å®‰è£…è¿™ä¸ªåŒ…ï¼Œå¹¶ä¸”ä½¿ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªåŒ…ä½¿ç”¨äº† \u003ccode\u003ecgo\u003c/code\u003eï¼Œä¾èµ–äº†hdf5çš„Cè¯­è¨€åº“ï¼Œå› æ­¤ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±é¢„å…ˆå®‰è£…ï¼Œä½¿ç”¨centosç³»ç»Ÿï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿å®‰è£…ï¼Œç›´æ¥ä½¿ç”¨å‘½ä»¤ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eyum install -y hdf5 hdf5-devel\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå½“ç„¶ï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰è½¯ä»¶æºçš„è¯ï¼Œhdf5ä¹Ÿæä¾›äº†æºç å®‰è£…ï¼Œä¸‹è½½ \u003ca href=\"https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.12/hdf5-1.12.1/src/hdf5-1.12.1.tar.bz2\"\u003ehdf5-1.12.1\u003c/a\u003eï¼Œè§£å‹åï¼Œæ‰§è¡Œå®‰è£…ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecd hdf5-1.12.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e./configure --prefix /usr/local\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emake -j \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e make install\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åæˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ï¼Œåä¸º \u003ccode\u003eh5\u003c/code\u003eï¼Œç”¨äºç¼–å†™goã€hdf5 çš„ç®€å•æµ‹è¯•ç”¨ä¾‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir -p ~/go/src/h5\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecd ~/go/src/h5\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ego mod init\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# å®‰è£…\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ego get -v gonum.org/v1/hdf5\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ä½¿ç”¨\"\u003eä½¿ç”¨\u003c/h2\u003e\n\u003ch3 id=\"åˆ›å»ºæ–‡ä»¶\"\u003eåˆ›å»ºæ–‡ä»¶\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// åˆ›å»ºhdf5æ–‡ä»¶\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ef\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehdf5\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eCreateFile\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;data.h5\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ehdf5\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eF_ACC_TRUNC\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tpanic(\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eErrorf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;failed to create hdf5 file: %e\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eClose\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;File created.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåˆ›å»ºæ–‡ä»¶çš„ä»£ç å°±ä¸€è¡Œï¼š \u003ccode\u003ehdf5.CreateFile(\u0026quot;data.h5\u0026quot;, hdf5.F_ACC_TRUNC)\u003c/code\u003eï¼Œå…¶ä¸­ data.h5 ä¸ºæ–‡ä»¶çš„åç§°ï¼Œä½¿ç”¨flagä¸º\u003ccode\u003ehdf5.F_ACC_TRUNC\u003c/code\u003eï¼Œå¦‚æœæ–‡ä»¶å·²å­˜åœ¨çš„è¯ï¼Œä¼šæ¸…é™¤åŸå§‹æ–‡ä»¶é‡Œé¢çš„å†…å®¹ã€‚\u003c/p\u003e","title":"Goä¸Hdf5ï¼Œæ•°æ®è¯»å†™å®è·µ"},{"content":"å¾ˆä¹…ä¹‹å‰ç©è¿‡çš„python socketï¼Œä»Šå¤©ç”¨æ¥åšä¸ªåŒå‘çš„é€šä¿¡ç¨‹åºã€‚\næœåŠ¡ç«¯ä»£ç ï¼š server.py\n# coding: utf-8 # tcp stream server import socket import logging import time import datetime as dt from threading import Thread, currentThread # é…ç½®logging logging.basicConfig( level=logging.INFO, format=\u0026#34;%(asctime)s %(levelname)s %(process)s %(threadName)s |%(message)s\u0026#34;, ) class Server: \u0026#34;\u0026#34;\u0026#34; socket æœåŠ¡ç«¯ \u0026#34;\u0026#34;\u0026#34; def __init__(self, host=\u0026#39;localhost\u0026#39;, port=8099): self._sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) self._sock.bind((host, port)) self.msg = None def read(self, conn: socket.socket = None): \u0026#34;\u0026#34;\u0026#34; ä»tcpè¿æ¥é‡Œé¢è¯»å–æ•°æ® \u0026#34;\u0026#34;\u0026#34; while True: try: data = conn.recv(1024).decode() except Exception as e: logging.info(\u0026#34;recv failed: %s\u0026#34;, e) return logging.info(\u0026#34;[R %s]\u0026lt;\u0026lt; %s\u0026#34;, currentThread().getName(), data) self.msg = data time.sleep(1) def write(self, conn: socket.socket = None): \u0026#34;\u0026#34;\u0026#34; å‘tcpè¿æ¥é‡Œé¢å†™å…¥æ•°æ® \u0026#34;\u0026#34;\u0026#34; while True: msg = f\u0026#34;{dt.datetime.now()} - {self.msg}\u0026#34; logging.info(\u0026#34;[W %s]\u0026gt;\u0026gt; %s\u0026#34;, currentThread().getName(), msg) try: conn.send(msg.encode()) except Exception as e: logging.info(\u0026#34;send failed: %s\u0026#34;, e) return time.sleep(1) def serve(self): \u0026#34;\u0026#34;\u0026#34; å¼€å¯æœåŠ¡ \u0026#34;\u0026#34;\u0026#34; self._sock.listen() logging.info(\u0026#34;Serving...\u0026#34;) while True: logging.info(\u0026#34;Waiting for connection...\u0026#34;) conn, addr = self._sock.accept() logging.info(\u0026#34;Recived new conn: %s from %s\u0026#34;, conn, addr) # å¼€å¯è¯»å†™çº¿ç¨‹å¤„ç†å½“å‰è¿æ¥ Thread(target=self.read, args=(conn, )).start() Thread(target=self.write, args=(conn, )).start() if __name__ == \u0026#39;__main__\u0026#39;: s = Server() s.serve() ä»¥ä¸Šå°±æ˜¯æœåŠ¡ç«¯ä»£ç ï¼Œç®€å•çš„å¼€å¯äº†ä¸€ä¸ªsocketæœåŠ¡å™¨ï¼Œæ¥å—è¿æ¥ï¼Œç„¶åå¼€å¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œæ¯éš”ä¸€ç§’ï¼ŒåŒæ—¶å‘è¿æ¥ä¸­è¯»å†™æ•°æ®ã€‚\nå½“ç„¶ï¼Œè¿™ä¸ªè¯»å†™å¯èƒ½ä¸æ˜¯åŒæ—¶å‘ç”Ÿçš„ã€‚\nå®¢æˆ·ç«¯ä»£ç  client.py\n# coding: utf-8 # tcp stream client import socket import logging import time import os from threading import Thread, currentThread # é…ç½®logging logging.basicConfig( level=logging.INFO, format=\u0026#34;%(asctime)s %(levelname)s %(process)s %(threadName)s |%(message)s\u0026#34;, ) class Client: \u0026#34;\u0026#34;\u0026#34; socket å®¢æˆ·ç«¯ \u0026#34;\u0026#34;\u0026#34; def __init__(self, host=\u0026#39;localhost\u0026#39;, port=8099): self._sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) self._addr = (host, port) def read(self): \u0026#34;\u0026#34;\u0026#34; å‘è¿æ¥ä¸­æ¥å—æ•°æ® \u0026#34;\u0026#34;\u0026#34; while True: try: data = self._sock.recv(1024).decode() except Exception as e: logging.info(\u0026#34;recv failed: %s\u0026#34;, e) return logging.info(\u0026#34;[R %s]\u0026lt;\u0026lt; %s\u0026#34;, currentThread().getName(), data) time.sleep(1) def write(self): \u0026#34;\u0026#34;\u0026#34; å‘è¿æ¥ä¸­å‘é€éšæœºæ•° \u0026#34;\u0026#34;\u0026#34; while True: msg = os.urandom(4).hex() logging.info(\u0026#34;[W %s]\u0026gt;\u0026gt; %s\u0026#34;, currentThread().getName(), msg) try: self._sock.send(msg.encode()) except Exception as e: logging.info(\u0026#34;send failed: %s\u0026#34;, e) return time.sleep(1) def run(self): \u0026#34;\u0026#34;\u0026#34; å¼€å¯è¿æ¥ \u0026#34;\u0026#34;\u0026#34; self._sock.connect(self._addr) logging.info(\u0026#34;New connection: %s\u0026#34;, self._sock) r = Thread(target=self.read) r.start() w = Thread(target=self.write) w.start() r.join() w.join() if __name__ == \u0026#39;__main__\u0026#39;: client = Client() client.run() å®¢æˆ·ç«¯åŒæœåŠ¡ç«¯æ˜¯ä¸€æ ·çš„ï¼Œå‘æœåŠ¡ç«¯å‘èµ·ä¸€ä¸ªè¿æ¥ï¼Œç„¶åå¯ç”¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œæ¯éš”ä¸€ç§’å‘è¿æ¥ä¸­å‘é€/æ¥å—æ•°æ®\nè¿è¡Œ è¿è¡Œserverå’Œclientï¼Œå°±å¯ä»¥çœ‹åˆ°äº†æ­£å¸¸çš„è¾“å‡ºï¼š\næœåŠ¡ç«¯è¾“å‡º\n$ python server.py 2022-04-22 14:22:11,901 INFO 76227 MainThread |Serving... 2022-04-22 14:22:11,901 INFO 76227 MainThread |Waiting for connection... 2022-04-22 14:22:20,788 INFO 76227 MainThread |Recived new conn: \u0026lt;socket.socket fd=6, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=(\u0026#39;127.0.0.1\u0026#39;, 8099), raddr=(\u0026#39;127.0.0.1\u0026#39;, 56814)\u0026gt; from (\u0026#39;127.0.0.1\u0026#39;, 56814) 2022-04-22 14:22:20,789 INFO 76227 Thread-2 |[W Thread-2]\u0026gt;\u0026gt; 2022-04-22 14:22:20.789066 - None 2022-04-22 14:22:20,789 INFO 76227 MainThread |Waiting for connection... 2022-04-22 14:22:20,789 INFO 76227 Thread-1 |[R Thread-1]\u0026lt;\u0026lt; 8903a9aa 2022-04-22 14:22:21,793 INFO 76227 Thread-2 |[W Thread-2]\u0026gt;\u0026gt; 2022-04-22 14:22:21.793070 - 8903a9aa å®¢æˆ·ç«¯è¾“å‡º\n$ python client.py 2022-04-22 14:22:20,788 INFO 76320 MainThread |New connection: \u0026lt;socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=(\u0026#39;127.0.0.1\u0026#39;, 56814), raddr=(\u0026#39;127.0.0.1\u0026#39;, 8099)\u0026gt; 2022-04-22 14:22:20,789 INFO 76320 Thread-3 |[W Thread-3]\u0026gt;\u0026gt; 8903a9aa 2022-04-22 14:22:20,789 INFO 76320 Thread-2 |[R Thread-2]\u0026lt;\u0026lt; 2022-04-22 14:22:20.789066 - None 2022-04-22 14:22:21,793 INFO 76320 Thread-3 |[W Thread-3]\u0026gt;\u0026gt; 5606048f 2022-04-22 14:22:21,793 INFO 76320 Thread-2 |[R Thread-2]\u0026lt;\u0026lt; 2022-04-22 14:22:21.793070 - 8903a9aa å·¥ä½œæ­£å¸¸ï¼Œçœ‹èµ·æ¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚\nä¼˜åŒ– çº¿ç¨‹åŒ–å®¢æˆ·ç«¯ å°†æ¯ä¸ªå®¢æˆ·ç«¯ä½œä¸ºä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶ååŒæ—¶å¼€å¯å¤šä¸ª\nclient.py\nclass Client(Thread): pass if __name__ == \u0026#39;__main__\u0026#39;: cs = [Client() for _ in range(3)] for c in cs: c.start() for c in cs: c.join() ä¼˜åŒ–æœåŠ¡ç«¯ æœåŠ¡ç«¯ï¼Œæœ‰ä¸ªmsgå˜é‡æ˜¯çº¿ç¨‹å†²çªçš„ï¼Œå­˜åœ¨èµ„æºæŠ¢å¤ºé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¿¡æ¯æ± ï¼Œä¸åŒè¿æ¥çš„ä¿¡æ¯ç‹¬ç«‹å­˜å‚¨\nserver.py\nclass Server: def __init__(self, host=\u0026#39;localhost\u0026#39;, port=8099): # ... self.msg = {} def read(self, conn: socket.socket = None): # ... self.msg[conn.fileno()] = data def write(self, conn: socket.socket = None): # ... msg = f\u0026#34;{dt.datetime.now()} - {self.msg.get(conn.fileno())}\u0026#34; def serve(self): # ... while True: # ... conn, addr = self._sock.accept() self.msg[conn.fileno()] = \u0026#39;\u0026#39; # ... æä¸ªèŠå¤©æœåŠ¡ç¨‹åº æƒ³è¦å¹²ä»€ä¹ˆï¼Ÿ\næä¸€ä¸ªç±»ä¼¼å¾®ä¿¡èŠå¤©æœåŠ¡å™¨ä¸€æ ·çš„ä¸œè¥¿ï¼Œä¸»è¦ç”¨ä½œæ¶ˆæ¯çš„ä¸­è½¬ï¼Œå®¢æˆ·ç«¯é€šè¿‡æœåŠ¡ç«¯ï¼Œå‘ç°å…¶ä»–ç”¨æˆ·ï¼Œå¹¶å‘å…¶ä»–ç”¨æˆ·å‘é€æ¶ˆæ¯ã€‚\nå°±åƒè¿™æ ·ï¼š\ngraph LR client1 --\u0026gt; server --\u0026gt; client2 client2 --\u0026gt; server --\u0026gt; client1 éœ€è¦è§£å†³å“ªäº›é—®é¢˜ï¼š\næ€ä¹ˆå­˜å‚¨ä¸€ä¸ªè¿æ¥ åˆ¶å®šç”¨æˆ·çš„åœ¨çº¿æœºåˆ¶ï¼ˆè¿æ¥è¶…æ—¶ï¼‰ ç”¨æˆ·è®¤è¯ï¼Ÿï¼ˆæ²¡å¿…è¦æè¿™ä¹ˆå¤æ‚ï¼‰ å…¶ä»–ã€‚ã€‚ã€‚ã€‚å¾…ç»­ã€‚\n","permalink":"https://zihuanling.github.io/posts/python-socket-bothway-connection/","summary":"\u003cp\u003eå¾ˆä¹…ä¹‹å‰ç©è¿‡çš„python socketï¼Œä»Šå¤©ç”¨æ¥åšä¸ªåŒå‘çš„é€šä¿¡ç¨‹åºã€‚\u003c/p\u003e\n\u003ch3 id=\"æœåŠ¡ç«¯ä»£ç \"\u003eæœåŠ¡ç«¯ä»£ç ï¼š\u003c/h3\u003e\n\u003cp\u003eserver.py\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# coding: utf-8\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# tcp stream server\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e socket\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e logging\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e time\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e datetime \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e dt\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e threading \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e Thread, currentThread\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# é…ç½®logging\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003elogging\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ebasicConfig(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    level\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003elogging\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eINFO,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    format\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%(asctime)s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%(levelname)s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%(process)s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%(threadName)s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e |\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%(message)s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eServer\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34; socket æœåŠ¡ç«¯ \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e __init__(self, host\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;localhost\u0026#39;\u003c/span\u003e, port\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8099\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e_sock \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e socket\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esocket(socket\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eAF_INET, socket\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eSOCK_STREAM)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e_sock\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ebind((host, port))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emsg \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eread\u003c/span\u003e(self, conn: socket\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esocket \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34; ä»tcpè¿æ¥é‡Œé¢è¯»å–æ•°æ® \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e conn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecv(\u003cspan style=\"color:#ae81ff\"\u003e1024\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eException\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                logging\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003einfo(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;recv failed: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e, e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            logging\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003einfo(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[R \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e]\u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e, currentThread()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003egetName(), data)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emsg \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e data\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            time\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esleep(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ewrite\u003c/span\u003e(self, conn: socket\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esocket \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34; å‘tcpè¿æ¥é‡Œé¢å†™å…¥æ•°æ® \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            msg \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003edt\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edatetime\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003enow()\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e - \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eself\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emsg\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            logging\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003einfo(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[W \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e]\u0026gt;\u0026gt; \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e, currentThread()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003egetName(), msg)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                conn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esend(msg\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eencode())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eException\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                logging\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003einfo(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;send failed: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e, e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            time\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esleep(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eserve\u003c/span\u003e(self):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34; å¼€å¯æœåŠ¡ \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e_sock\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003elisten()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        logging\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003einfo(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Serving...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            logging\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003einfo(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Waiting for connection...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            conn, addr \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e_sock\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eaccept()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            logging\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003einfo(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Recived new conn: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e from \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e, conn, addr)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#75715e\"\u003e# å¼€å¯è¯»å†™çº¿ç¨‹å¤„ç†å½“å‰è¿æ¥\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            Thread(target\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eself\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread, args\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e(conn, ))\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estart()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            Thread(target\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eself\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite, args\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e(conn, ))\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estart()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e __name__ \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__main__\u0026#39;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    s \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Server()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eserve()\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä»¥ä¸Šå°±æ˜¯æœåŠ¡ç«¯ä»£ç ï¼Œç®€å•çš„å¼€å¯äº†ä¸€ä¸ªsocketæœåŠ¡å™¨ï¼Œæ¥å—è¿æ¥ï¼Œç„¶åå¼€å¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œæ¯éš”ä¸€ç§’ï¼ŒåŒæ—¶å‘è¿æ¥ä¸­è¯»å†™æ•°æ®ã€‚\u003c/p\u003e","title":"ä½¿ç”¨python socketå®ç°åŒå‘çš„tcpé€šä¿¡"},{"content":"å­¦ä¹ ç½‘ç«™ï¼š https://gobyexample.com/reading-files\nå¯ä»¥ç›´æ¥è¯»å–æ–‡ä»¶é‡Œé¢çš„æ‰€æœ‰å†…å®¹åˆ°å†…å­˜é‡Œé¢ï¼š\ndata, err := os.ReadFile(\u0026#34;/tmp/data\u0026#34;) fmt.Println(string(data)) æœ‰æ—¶å€™æƒ³è¦è‡ªå®šä¹‰ä¸€äº›æ“ä½œï¼Œæ¯”å¦‚è¯»å–æ–‡ä»¶é‡Œé¢çš„æŸäº›å†…å®¹ï¼Œä»æŸä¸ªä½ç½®å¼€å§‹è¯»å–ç­‰ï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ os.Open æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ª os.File å¯¹è±¡ã€‚\nf, err := os.Open(\u0026#34;/tmp/data\u0026#34;) æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªç¼“å­˜ï¼ˆ5ä¸ªå­—èŠ‚çš„[]byteç±»å‹ï¼‰ï¼Œç„¶åä»æ–‡ä»¶ä¸­è¯»å–å†…å®¹ï¼Œè¯»å–çš„å†…å®¹å¤§å°ä¸Šé™ä¸º5ï¼š\nb1 := make([]byte, 5) n1, err := f.Read(b1) fmt.Printf(\u0026#34;%d bytes read from file: %s\\n\u0026#34;, n1, string(b1)) è°ƒç”¨ f.Readæ¥è¯»å–æ–‡ä»¶ï¼Œè¿”å›ä¸¤ä¸ªç»“æœï¼Œç¬¬ä¸€ä¸ªä¸ºå®é™…è¯»å–çš„å†…å®¹é•¿åº¦ï¼Œç¬¬äºŒä¸ªä¸ºerrorã€‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªé•¿åº¦ä¸º5çš„ b1 æ¥å­˜å‚¨æ–‡ä»¶å†…å®¹ï¼Œä½†æ˜¯æ–‡ä»¶é‡Œé¢çš„å†…å®¹é•¿åº¦å¯èƒ½åªæœ‰3ï¼Œå› æ­¤ï¼Œn1ä¸ä¸€å®šç­‰äº5ï¼Œå®ƒæ˜¯å®é™…è¯»å–çš„é•¿åº¦ã€‚\nåŒæ ·ï¼Œæˆ‘ä»¬è¿˜èƒ½ç”¨ os.Seekï¼Œæ¥æŸ¥æ‰¾æ–‡ä»¶çš„ä½ç½®ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º offsetï¼Œæ„å‘³ç€åç§»é‡ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º whenceï¼Œ\n0è¡¨ç¤ºä»æ–‡ä»¶çš„å¼€å§‹ä½ç½®è¿›è¡Œåç§»æŸ¥æ‰¾ 1è¡¨ç¤ºä»æ–‡ä»¶çš„å½“å‰ä½ç½®å¼€å§‹åç§»ï¼Œå¦‚æœä¹‹å‰å·²ç»è®¾ç½®è¿‡åç§»ï¼Œå†æ¬¡è®¾ç½®åˆ™ä»å½“å‰ä½ç½®å¼€å§‹åç§» 2è¡¨ç¤ºä»æ–‡ä»¶çš„æœ«å°¾å¼€å§‹åç§» o2, err := f.Seek(6, 0) b2 := make([]byte, 2) n2, err := f.Read(b2) fmt.Printf(\u0026#34;%d bytes read at %d\\n\u0026#34;, n2, o2) fmt.Printf(\u0026#34;Value is : %s\\n\u0026#34;, string(b2[:n2])) golang çš„ ioåŒ…æä¾›äº†ä¸€äº›æœ‰ç”¨çš„å‡½æ•°ï¼Œå¸®åŠ©æˆ‘ä»¬é«˜æ•ˆè¯»å–ã€‚æ¯”å¦‚ io.ReadAtLeastï¼Œå¯ä»¥æ›´å¥å£®åœ°å®ç°ä¸Šçš„è¯»å–æ“ä½œï¼š\no3, err := f.Seek(6, 0) b3 := make([]byte, 2) n3, err := io.ReadAtLeast(f, b3, 2) fmt.Printf(\u0026#34;%d bytes @ %d: %s\\n\u0026#34;, n3, o3, string(b3)) å¦‚æœæƒ³è¦å°†æ–‡ä»¶æŒ‡é’ˆå€’å›åˆ°æœ€åˆçš„ä½ç½®ï¼Œæ²¡æœ‰å†…ç½®çš„å‡½æ•°ï¼Œä½†æ˜¯ä½¿ç”¨ f.Seek(0, 0) å¯ä»¥å®ç°åŒæ ·çš„æ•ˆæœï¼š\n_, err := f.Seek(0, 0) golangçš„ bufio åŒ…æä¾›äº† ç¼“å†²è¯»å–å™¨ï¼Œå®ƒæä¾›å’Œé¢å¤–çš„è¯»å–æ–¹æ³•ï¼Œå¯¹äºå°‘é‡çš„è¯»å–å¾ˆæœ‰ç”¨ï¼š\nr4 := bufio.NewReader(f) b4, err := r4.Peek(5) fmt.Printf(\u0026#34;5 bytes: %s\\n\u0026#34;, string(b4)) æœ€åï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ç»“æŸçš„æ—¶å€™å…³é—­æ–‡ä»¶ï¼š\nf.Close() ä½†æ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨æ‰“å¼€æ–‡ä»¶ä¹‹åï¼Œä½¿ç”¨ defer f.Close() æ¥è¿›è¡Œä¼˜é›…çš„å…³é—­æ–‡ä»¶ï¼š\nf, err := os.Open(\u0026#34;/tmp/data\u0026#34;) defer f.Close() å®Œæ•´ä»£ç ï¼š\nfunc check(err error) { if err != nil { panic(err) } } func main() { // ReadFile data, err := os.ReadFile(\u0026#34;/tmp/data\u0026#34;) check(err) fmt.Printf(\u0026#34;data: %s\\n\u0026#34;, string(data)) // Open file f, err := os.Open(\u0026#34;/tmp/data\u0026#34;) check(err) b1 := make([]byte, 5) n1, err := f.Read(b1) check(err) fmt.Printf(\u0026#34;%d size of data read: %s\\n\u0026#34;, n1, string(b1)) // Seek o1, err := f.Seek(6, 0) check(err) b2 := make([]byte, 2) n2, err := f.Read(b2) check(err) fmt.Printf(\u0026#34;%d bytes read @ %d: %s\\n\u0026#34;, n2, o1, string(b2)) // io.ReadAtLeast o3, err := f.Seek(6, 0) b3 := make([]byte, 2) n3, err := io.ReadAtLeast(f, b3, 2) check(err) fmt.Printf(\u0026#34;io.ReadAtLeast, %d bytes read @ %d: %s\\n\u0026#34;, n3, o3, string(b3)) // rewind _, err = f.Seek(0, 0) check(err) // bufio r4 := bufio.NewReader(f) b4, err := r4.Peek(5) check(err) fmt.Printf(\u0026#34;5 bytes read from bufio: %s\\n\u0026#34;, string(b4)) // close file f.Close() } ","permalink":"https://zihuanling.github.io/posts/go-readfiles/","summary":"\u003cp\u003eå­¦ä¹ ç½‘ç«™ï¼š \u003ca href=\"https://gobyexample.com/reading-files\"\u003ehttps://gobyexample.com/reading-files\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eå¯ä»¥ç›´æ¥è¯»å–æ–‡ä»¶é‡Œé¢çš„æ‰€æœ‰å†…å®¹åˆ°å†…å­˜é‡Œé¢ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eos\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eReadFile\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/tmp/data\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(string(\u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœ‰æ—¶å€™æƒ³è¦è‡ªå®šä¹‰ä¸€äº›æ“ä½œï¼Œæ¯”å¦‚è¯»å–æ–‡ä»¶é‡Œé¢çš„æŸäº›å†…å®¹ï¼Œä»æŸä¸ªä½ç½®å¼€å§‹è¯»å–ç­‰ï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ \u003ccode\u003eos.Open\u003c/code\u003e æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ª \u003ccode\u003eos.File\u003c/code\u003e å¯¹è±¡ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ef\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eos\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eOpen\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/tmp/data\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªç¼“å­˜ï¼ˆ5ä¸ªå­—èŠ‚çš„[]byteç±»å‹ï¼‰ï¼Œç„¶åä»æ–‡ä»¶ä¸­è¯»å–å†…å®¹ï¼Œè¯»å–çš„å†…å®¹å¤§å°ä¸Šé™ä¸º5ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eb1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e make([]\u003cspan style=\"color:#66d9ef\"\u003ebyte\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003en1\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eRead\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eb1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%d bytes read from file: %s\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003en1\u003c/span\u003e, string(\u003cspan style=\"color:#a6e22e\"\u003eb1\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè°ƒç”¨ \u003ccode\u003ef.Read\u003c/code\u003eæ¥è¯»å–æ–‡ä»¶ï¼Œè¿”å›ä¸¤ä¸ªç»“æœï¼Œç¬¬ä¸€ä¸ªä¸ºå®é™…è¯»å–çš„å†…å®¹é•¿åº¦ï¼Œç¬¬äºŒä¸ªä¸º\u003ccode\u003eerror\u003c/code\u003eã€‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªé•¿åº¦ä¸º5çš„ b1 æ¥å­˜å‚¨æ–‡ä»¶å†…å®¹ï¼Œä½†æ˜¯æ–‡ä»¶é‡Œé¢çš„å†…å®¹é•¿åº¦å¯èƒ½åªæœ‰3ï¼Œå› æ­¤ï¼Œn1ä¸ä¸€å®šç­‰äº5ï¼Œå®ƒæ˜¯å®é™…è¯»å–çš„é•¿åº¦ã€‚\u003c/p\u003e\n\u003cp\u003eåŒæ ·ï¼Œæˆ‘ä»¬è¿˜èƒ½ç”¨ \u003ccode\u003eos.Seek\u003c/code\u003eï¼Œæ¥æŸ¥æ‰¾æ–‡ä»¶çš„ä½ç½®ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º \u003ccode\u003eoffset\u003c/code\u003eï¼Œæ„å‘³ç€åç§»é‡ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º \u003ccode\u003ewhence\u003c/code\u003eï¼Œ\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e0è¡¨ç¤ºä»æ–‡ä»¶çš„å¼€å§‹ä½ç½®è¿›è¡Œåç§»æŸ¥æ‰¾\u003c/li\u003e\n\u003cli\u003e1è¡¨ç¤ºä»æ–‡ä»¶çš„å½“å‰ä½ç½®å¼€å§‹åç§»ï¼Œå¦‚æœä¹‹å‰å·²ç»è®¾ç½®è¿‡åç§»ï¼Œå†æ¬¡è®¾ç½®åˆ™ä»å½“å‰ä½ç½®å¼€å§‹åç§»\u003c/li\u003e\n\u003cli\u003e2è¡¨ç¤ºä»æ–‡ä»¶çš„æœ«å°¾å¼€å§‹åç§»\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eo2\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSeek\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eb2\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e make([]\u003cspan style=\"color:#66d9ef\"\u003ebyte\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003en2\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eRead\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eb2\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%d bytes read at %d\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003en2\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eo2\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Value is : %s\\n\u0026#34;\u003c/span\u003e, string(\u003cspan style=\"color:#a6e22e\"\u003eb2\u003c/span\u003e[:\u003cspan style=\"color:#a6e22e\"\u003en2\u003c/span\u003e]))\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003egolang çš„ \u003ccode\u003eio\u003c/code\u003eåŒ…æä¾›äº†ä¸€äº›æœ‰ç”¨çš„å‡½æ•°ï¼Œå¸®åŠ©æˆ‘ä»¬é«˜æ•ˆè¯»å–ã€‚æ¯”å¦‚ \u003ccode\u003eio.ReadAtLeast\u003c/code\u003eï¼Œå¯ä»¥æ›´å¥å£®åœ°å®ç°ä¸Šçš„è¯»å–æ“ä½œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eo3\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSeek\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eb3\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e make([]\u003cspan style=\"color:#66d9ef\"\u003ebyte\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003en3\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eio\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eReadAtLeast\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ef\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eb3\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%d bytes @ %d: %s\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003en3\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eo3\u003c/span\u003e, string(\u003cspan style=\"color:#a6e22e\"\u003eb3\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦‚æœæƒ³è¦å°†æ–‡ä»¶æŒ‡é’ˆå€’å›åˆ°æœ€åˆçš„ä½ç½®ï¼Œæ²¡æœ‰å†…ç½®çš„å‡½æ•°ï¼Œä½†æ˜¯ä½¿ç”¨ \u003ccode\u003ef.Seek(0, 0)\u003c/code\u003e å¯ä»¥å®ç°åŒæ ·çš„æ•ˆæœï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e_\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSeek\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003egolangçš„ \u003ccode\u003ebufio\u003c/code\u003e åŒ…æä¾›äº† \u003cstrong\u003eç¼“å†²è¯»å–å™¨\u003c/strong\u003eï¼Œå®ƒæä¾›å’Œé¢å¤–çš„è¯»å–æ–¹æ³•ï¼Œå¯¹äºå°‘é‡çš„è¯»å–å¾ˆæœ‰ç”¨ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003er4\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ebufio\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eNewReader\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ef\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eb4\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003er4\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePeek\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;5 bytes: %s\\n\u0026#34;\u003c/span\u003e, string(\u003cspan style=\"color:#a6e22e\"\u003eb4\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœ€åï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ç»“æŸçš„æ—¶å€™å…³é—­æ–‡ä»¶ï¼š\u003c/p\u003e","title":"go: è¯»å–æ–‡ä»¶"},{"content":"gRPC ä¸€ä¸ªé«˜æ€§èƒ½ã€å¼€æºçš„é€šç”¨RPCæ¡†æ¶ã€‚\ngPPCæ˜¯ä¸€ä¸ªç°ä»£çš„å¼€æºé«˜æ€§èƒ½çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ¡†æ¶ï¼Œå¹¶ä¸”å¯ä»¥è¿è¡Œåœ¨ä»»ä½•ç¯å¢ƒä¸­ã€‚å®ƒå¯ä»¥æœ‰æ•ˆåœ°è¿æ¥æ•°æ®ä¸­å¿ƒå†…å’Œè·¨æ•°æ®ä¸­å¿ƒçš„æœåŠ¡ï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡ã€è·Ÿè¸ªã€å¥åº·æ£€æŸ¥å’Œèº«ä»½éªŒè¯ã€‚å®ƒä¹Ÿé€‚ç”¨äºåˆ†å¸ƒå¼è®¡ç®—çš„æœ€åä¸€è‹±é‡Œï¼Œå°†è®¾å¤‡ã€ç§»åŠ¨åº”ç”¨ç¨‹åºå’Œæµè§ˆå™¨è¿æ¥åˆ°åç«¯æœåŠ¡ã€‚\ngRPC is a modern open source high performance Remote Procedure Call (RPC) framework that can run in any environment. It can efficiently connect services in and across data centers with pluggable support for load balancing, tracing, health checking and authentication. It is also applicable in last mile of distributed computing to connect devices, mobile applications and browsers to backend services.\ngithub åœ°å€ï¼š https://github.com/grpc/grpc\nåŸæ¥æ˜¯ç”¨ C++ å†™çš„ï¼Œåæ¥ä¹Ÿæœ‰äº†goè¯­è¨€ç‰ˆæœ¬ï¼šhttps://github.com/grpc/grpc-go\ngRPC å’Œ go gPPCæ”¯æŒå¤šä¸ªè¯­è¨€å’Œå¹³å°ï¼ŒåŒ…æ‹¬GOã€Pythonã€C++ã€Nodejsç­‰ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å­¦ä¹ çš„æ˜¯ä½¿ç”¨goæ¥ä½“éªŒä¸€ä¸‹gRPCçš„åŠŸèƒ½ã€‚\nå­¦ä¹ åœ°å€ï¼šhttps://www.grpc.io/docs/languages/go/quickstart/\nå‰æœŸå‡†å¤‡ï¼š golangå®‰è£… protobuf ç¼–è¯‘å™¨ï¼Œprotocï¼Œç¬¬ä¸‰ä¸ªç‰ˆæœ¬ ä¹‹å‰å·²ç»ç®€å•ä½“éªŒè¿‡äº†protobufï¼š æ–‡ç« ï¼šgo-proto\nå®‰è£…æ”¯æŒgoè¯­è¨€çš„protocç¼–è¯‘å™¨æ’ä»¶ $ go install google.golang.org/protobuf/cmd/protoc-gen-go@v1.28 $ go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@v1.2 okï¼Œè‡³æ­¤ï¼Œå‰æœŸçš„ç¯å¢ƒå‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ä½“éªŒgolangç‰ˆæœ¬çš„gRPCäº†ã€‚\næˆ‘ä»¬æ¥ä¸‹æ¥ä½¿ç”¨ä¸Šæ¬¡å†™çš„protobufå­¦ä¹ ä¾‹å­ï¼Œä¿®æ”¹ä¸€ä¸‹ï¼Œè®©å…¶å¯ä»¥ç”¨ä¸ŠgRPCã€‚\nä¸Šæ‰‹ä½“éªŒ ç¼–è¯‘å‘½ä»¤ protoc --go_out=. --go_opt=paths=source_relative --go-grpc_out=. --go-gprc_opt=paths=source_relative proto/media.proto ç›¸æ¯”ä¸Šæ¬¡çš„å•çº¯ç¼–è¯‘protobufï¼Œæˆ‘ä»¬è¿™æ¬¡æ·»åŠ å¯¹grpcçš„æ”¯æŒï¼Œä¸»è¦æ˜¯æ–°å¢äº†ä¸¤ä¸ªflagï¼š--go-grpc_out=. --go-grpc_opt=paths=source_relative\nè¿è¡Œä¸Šé¢çš„ç¼–è¯‘å‘½ä»¤ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå½“å‰çš„è·¯å¾„ä¸‹å¹¶æ²¡æœ‰ç”Ÿæˆåˆ«çš„ä¸œè¥¿ï¼Œè¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬çš„protoä¸­æ²¡æœ‰å®šä¹‰grpcç›¸å…³çš„æœåŠ¡ã€‚\nå®šä¹‰gRPCæœåŠ¡ æˆ‘ä»¬å¯ä»¥åœ¨protoæ–‡ä»¶ä¸­è¿™æ ·å†™ï¼š\nproto/media.proto\n// ä¸Šä¼ çš„è¯·æ±‚ä½“ message UploadRequest { Picture pic = 1; } // ä¸Šä¼ å›¾ç‰‡çš„å“åº”ä½“ message UploadReply { int32 status = 1; string msg = 2; } // å®šä¹‰ä¸€ä¸ªrpcå¤šåª’ä½“æœåŠ¡ service Media { rpc UploadPicture(UploadRequest) returns (UploadReply) {} } æˆ‘ä»¬ä¸Šæ¬¡å®šä¹‰äº†ä¸€ä¸ªåä¸º Picture çš„messageï¼Œç”¨æ¥è¡¨ç¤ºå›¾ç‰‡æ¶ˆæ¯ï¼Œè¿™æ¬¡ï¼Œæˆ‘ä»¬æ–°å¢äº†ä¸¤ä¸ªæ¶ˆæ¯ï¼ŒUploadRequestå’ŒUploadReplyï¼Œåˆ†åˆ«è¡¨ç¤ºä¸Šä¼ çš„æ¶ˆæ¯å†…å®¹å’Œè¿”å›çš„ä¸Šä¼ ç»“æœã€‚\nå¦å¤–å®šä¹‰äº†ä¸€ä¸ªæœåŠ¡ï¼šMediaï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæ–¹æ³• UploadPictureï¼Œç”¨äºä¸Šä¼ å›¾ç‰‡ã€‚\né‡æ–°è¿è¡Œprotocç¼–è¯‘å‘½ä»¤ï¼Œå°±ä¼šçœ‹åˆ°ï¼Œprotoç›®å½•ä¸‹ï¼Œç”Ÿæˆäº†ä¸€ä¸ª media_grpc.pb.goæ–‡ä»¶ï¼Œé‡Œé¢å®ç°äº†æˆ‘ä»¬åœ¨protoæ–‡ä»¶ä¸­å®šä¹‰çš„gRPCæœåŠ¡ã€‚\nå®ç°rpcæœåŠ¡çš„é€»è¾‘ æˆ‘ä»¬åœ¨protoæ–‡ä»¶ä¸­å®šä¹‰äº†ç›¸å…³çš„åè®®ï¼Œä»¥åŠæœåŠ¡ã€‚åŒæ—¶ç¼–è¯‘ä¹Ÿç”Ÿæˆäº†å¯¹åº”çš„æœåŠ¡ä»£ç ï¼Œä½†æ˜¯ï¼Œç”Ÿæˆçš„ä»£ç åªæ˜¯æˆ‘ä»¬æœåŠ¡çš„ä¸€ä¸ªæŠ½è±¡ï¼Œè€Œå…·ä½“çš„ä¸šåŠ¡å¤„ç†é€»è¾‘ï¼Œè¿˜éœ€è¦æˆ‘ä»¬è‡ªå·±å»å®ç°ã€‚\nserver/server_main.go\n// å®ç°åª’ä½“æœåŠ¡ type server struct { proto.UnimplementedMediaServer } // UploadPicture å®ç°ä¸Šä¼ å›¾ç‰‡æ¥å£ func (s *server) UploadPicture(ctx context.Context, req *proto.UploadRequest) (*proto.UploadReply, error) { log.Println(\u0026#34;Processing upload picture request.\u0026#34;) picture := req.GetPic() log.Printf(\u0026#34;Got picture: %v\\n\u0026#34;, picture) return \u0026amp;proto.UploadReply{ Status: 1, Msg: \u0026#34;Good job.\u0026#34;, }, nil } func main() { l, _ := net.Listen(\u0026#34;tcp\u0026#34;, \u0026#34;:8099\u0026#34;) s := grpc.NewServer() proto.RegisterMediaServer(s, \u0026amp;server{}) log.Printf(\u0026#34;Server listening at: %v\\n\u0026#34;, l.Addr()) if err := s.Serve(l); err != nil { log.Fatalf(\u0026#34;server error: %v\\n\u0026#34;, err) } } ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç»„åˆ proto.UnimplementedMediaServerï¼Œæ¥å®ç°æŠ½è±¡çš„MediaServeræ¥å£ï¼Œç„¶åå†å®ç° UploadPictureè¿™ä¸ªæ–¹æ³•ï¼Œæ–¹æ³•å¾ˆç®€å•ï¼Œæˆ‘ä»¬ä»è¯·æ±‚ä½“ä¸­è·å–å¯¹åº”çš„æ•°æ®ï¼Œæ‰“å°å‡ºæ¥ï¼Œç„¶åç»™å®¢æˆ·ç«¯è¿”å›ä¸€å¥ â€œgood jobâ€ã€‚\nç„¶åæ˜¯å¼€å¯æœåŠ¡ï¼Œè¿™é‡Œçš„å…³é”®å¥æ˜¯ s := grpc.NewServer æ¥å®ä¾‹åŒ–ä¸€ä¸ªgrpcæœåŠ¡ï¼Œç„¶åè°ƒç”¨ proto.RegisterMediaServer æ¥å‘è¿™ä¸ªgrpcæœåŠ¡ä¸­æ³¨å†Œæˆ‘ä»¬å®šä¹‰çš„åª’ä½“æœåŠ¡ã€‚æœ€åï¼Œs.Serveå¼€å¯æœåŠ¡ã€‚\nå®ç°å®¢æˆ·ç«¯è°ƒç”¨ å®¢æˆ·ç«¯çš„è°ƒç”¨ç›¸å¯¹æ¥è¯´ç®€å•ï¼Œä¸éœ€è¦å†å»å®ç°ä»€ä¹ˆæ¥å£ï¼Œåªè¦ç®€å•çš„å‘è¿æ¥ä¸­å‘é€è¯·æ±‚å³å¯\nfunc main() { conn, err := grpc.Dial(\u0026#34;localhost:8099\u0026#34;, grpc.WithTransportCredentials(insecure.NewCredentials())) if err != nil { log.Fatalf(\u0026#34;gRPC failed to dial, error: %v\u0026#34;, err) } defer conn.Close() client := proto.NewMediaClient(conn) pic := \u0026amp;proto.Picture{ Name: \u0026#34;pandas\u0026#34;, Type: proto.Picture_JPG, Data: []byte{1, 2, 3, 4, 5, 6, 7}, } ctx, cancel := context.WithTimeout(context.Background(), time.Second) defer cancel() req := proto.UploadRequest{Pic: pic} resp, err := client.UploadPicture(ctx, \u0026amp;req) if err != nil { log.Fatalf(\u0026#34;client call grpc service error: %v\u0026#34;, err) } log.Printf(\u0026#34;rpc response message: %v\\n\u0026#34;, resp.GetMsg()) } å®¢æˆ·ç«¯ä¸­ï¼Œæˆ‘ä»¬è¿™æ¬¡ä½¿ç”¨ grpc.Dialæ¥å‘æœåŠ¡ç«¯å‘èµ·ä¸€ä¸ªè¿æ¥ï¼Œç„¶åç¬¬äºŒä¸ªå‚æ•°æ˜¯ grpc.WithTransportCredentials(insecure.NewCredentials())ï¼Œæ„å‘³ç€å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚éœ€è¦è¿›è¡Œä¸€å®šçš„éªŒè¯ã€‚ï¼ˆï¼Ÿï¼‰\nç„¶åç›´æ¥è°ƒç”¨ proto.UploadPictureï¼Œå³å¯å‘æœåŠ¡ç«¯ä¸­å‘é€ä¸Šä¼ å›¾ç‰‡è¯·æ±‚ã€‚\nè¿è¡Œ è¿è¡Œä¸Šè¿°ä»£ç \næœåŠ¡ç«¯è¾“å‡ºï¼š\n2022/04/17 00:00:25 Server listening at: [::]:8099 2022/04/17 00:10:07 Processing upload picture request. 2022/04/17 00:10:07 Got picture: name:\u0026#34;pandas\u0026#34; type:JPG data:\u0026#34;\\x01\\x02\\x03\\x04\\x05\\x06\\x07\u0026#34; å®¢æˆ·ç«¯è¾“å‡ºï¼š\n2022/04/17 00:10:07 rpc response message: Good job. å¯ä»¥çœ‹åˆ°ï¼Œè¡¨ç°ç¬¦åˆé¢„æœŸã€‚\næ€»ç»“ æƒ³è¦åœ¨goä¸Šä½¿ç”¨grpcï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªä¸»è¦æ­¥éª¤ï¼š\nå‰æœŸå‡†å¤‡ï¼Œgolangã€protobufç¼–è¯‘å™¨ï¼ˆprotocï¼‰ã€ä¸¤ä¸ªgoè¯­è¨€çš„protobufæ’ä»¶ï¼šprotoc-gen-goã€protoc-gen-go-grpc ç¼–å†™æœåŠ¡çš„protobufä»£ç ï¼Œéœ€è¦ä½¿ç”¨serviceå…³é”®å­—ï¼Œå»å®šä¹‰ä¸€ä¸ªgrpcæœåŠ¡ ä½¿ç”¨protocç¼–è¯‘protoæ–‡ä»¶ï¼Œç”Ÿæˆgoä»£ç ï¼Œç¼–è¯‘å‚æ•°ä¸ºï¼šprotoc --go_out=. --go_opt=paths=source_relative --go-grpc_out=. --go-grpc_opt=paths=source_relative æœåŠ¡ç«¯å®ç°å¯¹åº”çš„æœåŠ¡é€»è¾‘ï¼Œå¹¶å¼€å¯grpcæœåŠ¡ã€‚ç”Ÿæˆçš„åªæ˜¯ç®€å•çš„æœåŠ¡ä»£ç ï¼Œä»¥åŠæœåŠ¡æ¥å£ï¼Œæˆ‘ä»¬åœ¨protoä¸­å®šä¹‰çš„rpcæœåŠ¡å…·ä½“ä¸šåŠ¡é€»è¾‘å¹¶æ²¡æœ‰è¢«å®ç°ï¼Œè¿˜éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å®ç°å…·ä½“çš„æœåŠ¡æ¥å£ï¼Œç„¶åï¼Œä½¿ç”¨ proto.RegisterMediaServeræ¥å‘å¯¹åº”çš„grpcæœåŠ¡ä¸­æ³¨å†Œæˆ‘ä»¬è‡ªå·±å®ç°çš„æœåŠ¡ å®¢æˆ·ç«¯å‘èµ·è¿æ¥ï¼Œéœ€è¦ä½¿ç”¨grpc.Dialï¼Œå¹¶ä¸”ç¬¬äºŒä¸ªå‚æ•°ä¼  grpc.WithTransportCredentials(insecure.NewCredentials())ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ ","permalink":"https://zihuanling.github.io/posts/go-grpc-protobuf/","summary":"\u003ch1 id=\"grpc\"\u003egRPC\u003c/h1\u003e\n\u003cp\u003eä¸€ä¸ªé«˜æ€§èƒ½ã€å¼€æºçš„é€šç”¨RPCæ¡†æ¶ã€‚\u003c/p\u003e\n\u003cp\u003egPPCæ˜¯ä¸€ä¸ªç°ä»£çš„å¼€æºé«˜æ€§èƒ½çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ¡†æ¶ï¼Œå¹¶ä¸”å¯ä»¥è¿è¡Œåœ¨ä»»ä½•ç¯å¢ƒä¸­ã€‚å®ƒå¯ä»¥æœ‰æ•ˆåœ°è¿æ¥æ•°æ®ä¸­å¿ƒå†…å’Œè·¨æ•°æ®ä¸­å¿ƒçš„æœåŠ¡ï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡ã€è·Ÿè¸ªã€å¥åº·æ£€æŸ¥å’Œèº«ä»½éªŒè¯ã€‚å®ƒä¹Ÿé€‚ç”¨äºåˆ†å¸ƒå¼è®¡ç®—çš„æœ€åä¸€è‹±é‡Œï¼Œå°†è®¾å¤‡ã€ç§»åŠ¨åº”ç”¨ç¨‹åºå’Œæµè§ˆå™¨è¿æ¥åˆ°åç«¯æœåŠ¡ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003egRPC is a modern open source high performance Remote Procedure Call (RPC) framework that can run in any environment. It can efficiently connect services in and across data centers with pluggable support for load balancing, tracing, health checking and authentication. It is also applicable in last mile of distributed computing to connect devices, mobile applications and browsers to backend services.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003egithub åœ°å€ï¼š \u003ca href=\"https://github.com/grpc/grpc\"\u003ehttps://github.com/grpc/grpc\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eåŸæ¥æ˜¯ç”¨ \u003ccode\u003eC++\u003c/code\u003e å†™çš„ï¼Œåæ¥ä¹Ÿæœ‰äº†goè¯­è¨€ç‰ˆæœ¬ï¼šhttps://github.com/grpc/grpc-go\u003c/p\u003e\n\u003ch1 id=\"grpc-å’Œ-go\"\u003egRPC å’Œ go\u003c/h1\u003e\n\u003cp\u003egPPCæ”¯æŒå¤šä¸ªè¯­è¨€å’Œå¹³å°ï¼ŒåŒ…æ‹¬GOã€Pythonã€C++ã€Nodejsç­‰ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å­¦ä¹ çš„æ˜¯ä½¿ç”¨goæ¥ä½“éªŒä¸€ä¸‹gRPCçš„åŠŸèƒ½ã€‚\u003c/p\u003e","title":"go: grpcå’Œprotobuf"},{"content":"Google protocol buffers ç®€ç§°protobufï¼Œå®ƒæ˜¯è°·æ­Œæä¾›çš„è·¨è¯­è¨€ï¼Œè·¨å¹³å°çš„ï¼Œå¯æ‰©å±•çš„ç”¨æ¥å°†ç»“æ„åŒ–çš„æ•°æ®è¿›è¡Œåºåˆ—åŒ–çš„ä¸€ç§æœºåˆ¶ã€‚å°±åƒXMLï¼Œä½†æ˜¯æ›´åŠ ç²¾ç®€ã€å¿«é€Ÿå’Œç®€å•ã€‚æˆ‘ä»¬å¯ä»¥å…ˆé¢„å…ˆå®šä¹‰æˆ‘ä»¬çš„åè®®ï¼ˆå†™åˆ°ä¸€ä¸ª .proto æ–‡ä»¶é‡Œé¢ï¼‰ï¼Œé‡Œé¢å£°æ˜äº†æˆ‘ä»¬éœ€è¦æ€ä¹ˆå»å°†æ•°æ®ç»“æ„åŒ–ï¼Œç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä»½protoï¼Œå»ç”Ÿæˆæˆ‘ä»¬æŒ‡å®šçš„è¯­è¨€æºä»£ç æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå¾ˆæ–¹ä¾¿åœ°ä»å„ç§æ•°æ®æµä¸­è¯»å–ç»“æ„åŒ–æ•°æ®ï¼Œæˆ–è€…æ˜¯å†™å…¥ç»“æ„åŒ–æ•°æ®ã€‚å¹¶ä¸”æ˜¯è·¨è¯­è¨€çš„ã€‚\nProtocol buffers are Google\u0026rsquo;s language-neutral, platform-neutral, extensible mechanism for serializing structured data â€“ think XML, but smaller, faster, and simpler. You define how you want your data to be structured once, then you can use special generated source code to easily write and read your structured data to and from a variety of data streams and using a variety of languages.\nå®‰è£…protocç¼–è¯‘å™¨ .protoæ–‡ä»¶åªæ˜¯æˆ‘ä»¬å®šä¹‰çš„åè®®æ–‡ä»¶ï¼Œä¸€èˆ¬æ¥è®²ï¼Œç¼–ç¨‹è¯­è¨€æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™ä»½æ–‡ä»¶çš„ï¼ˆé™¤éæ˜¯è‡ªå·±é’ˆå¯¹protoå†™ä¸€ä¸ªè‡ªå®šä¹‰çš„è§£æé€»è¾‘ï¼Œä½†æ˜¯æ²¡äººä¼šè¿™ä¹ˆé—²ï¼‰ï¼Œæˆ‘ä»¬æƒ³è¦çš„ï¼Œåº”è¯¥æ˜¯ç®€å•é«˜æ•ˆçš„å¼€å‘ï¼Œå¯ä»¥å³å†™å³ç”¨é‚£ç§ã€‚\nå› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ç‰¹å®šçš„ç¼–ç¨‹è¯­è¨€ç¼–å†™æœåŠ¡æ—¶ï¼Œéœ€è¦å°†æˆ‘ä»¬å®šä¹‰çš„ .proto æ–‡ä»¶ç¿»è¯‘ï¼ˆç¼–è¯‘ï¼‰æˆä¸ºå¯¹åº”çš„è¯­è¨€æ–‡ä»¶ï¼Œè¿™æ—¶ï¼Œgoogle ç»™æˆ‘ä»¬æä¾›äº† protocã€‚\nä¸‹è½½ æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªåœ°æ–¹ä¸‹è½½ï¼š protobuf v3.20.0 ï¼Œé‡Œé¢æœ‰å¾ˆå¤šçš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„å¹³å°ã€‚\nå®‰è£… å°†å…¶è§£å‹ä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª binç›®å½•ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª protocçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ‘ä»¬å°†å…¶æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­çš„Pathä¸­å»ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œprotocå‘½ä»¤äº†ã€‚\néªŒè¯å®‰è£… æˆ‘ä»¬æ·»åŠ å®Œç¯å¢ƒå˜é‡åï¼Œæ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œæˆ‘ä»¬è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯ä¸€ä¸‹å®‰è£…æ˜¯å¦æˆåŠŸï¼š\n\u0026gt;protoc --version libprotoc 3.20.0 ç¼–å†™è‡ªå·±çš„protobufåè®® æˆ‘æƒ³è¦å®ç°ä¸€ä¸ªåè®®ï¼Œå¯ä»¥ä¼ è¾“å¤šåª’ä½“æ•°æ®ï¼Œä¸”åç«¯æ˜¯ç”¨goå†™çš„ã€‚\né¦–å…ˆåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œåä¸º learnProtoï¼Œè¡¨ç¤ºè¿™æ˜¯æˆ‘ç”¨æ¥å­¦ä¹ protobufçš„ç»ƒæ‰‹é¡¹ç›®ã€‚ç„¶ååˆ›å»ºä¸€ä¸ªprotoæ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜æ”¾æˆ‘ä»¬çš„protoæ–‡ä»¶ã€‚\n// learnProto/proto/media.proto syntax = \u0026#34;proto3\u0026#34;; message Picture { string name = 1; // å›¾ç‰‡çš„åç§° enum PicTypes { PNG = 0; JPG = 1; JPEG = 2; BMQ = 3; } PicTypes type = 2; // å›¾ç‰‡ç±»å‹ bytes data = 3; // å›¾ç‰‡æ•°æ® } é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨æ–‡ä»¶çš„å¼€å§‹ä½ç½®ï¼Œå†™ä¸Š syntax = \u0026quot;proto3\u0026quot;ï¼Œè¯´æ˜è¿™ä¸ªprotoæ˜¯ç”¨çš„proto3ç‰ˆæœ¬ã€‚\nä¸Šè¿°protoæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ¶ˆæ¯çš„ç»“æ„ï¼šå›¾ç‰‡\nè¿™ä¸ªæ¶ˆæ¯çš„ç»“æ„æœ‰3ä¸ªå­—æ®µï¼š\nåç§°ï¼šä½¿ç”¨çš„æ˜¯stringç±»å‹ ç±»å‹ï¼šæˆ‘ä»¬è‡ªå®šä¹‰äº†ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œç”¨æ¥è¡¨ç¤ºå…è®¸è¿›è¡Œä¼ è¾“çš„å›¾ç‰‡æ ¼å¼ æ•°æ®ï¼šå›¾ç‰‡çš„æ•°æ®åº”è¯¥æ˜¯å­—èŠ‚ç±»å‹çš„ è¿™æ ·ï¼Œæˆ‘ä»¬å°±å†™å¥½äº†è‡ªå·±çš„protoåè®®ï¼Œæˆ‘ä»¬å°†è¦ä½¿ç”¨è¿™ä¸ªåè®®æ¥è¿›è¡Œå›¾ç‰‡æ–‡ä»¶çš„ä¼ è¾“ã€‚\nç¼–è¯‘åè®® **é‡è¦ï¼š**æˆ‘ä»¬éœ€è¦ä½¿ç”¨goæ¥å®ç°åç«¯ï¼Œç„¶åä½¿ç”¨ç¼–å†™çš„protoæ¥å®ç°æ•°æ®çš„ä¼ è¾“ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±éœ€è¦ç»™protoæ–‡ä»¶åŠ ä¸Šä¸¤è¡Œå£°æ˜ï¼š\nç¬¬ä¸€è¡Œï¼šå‘Šè¯‰protocç¼–è¯‘å™¨ï¼Œè¿™ä¸ªprotoæ–‡ä»¶ç¼–è¯‘æˆgoæ–‡ä»¶ä¹‹åï¼Œå°†è¦å±äºå“ªä¸ªåŒ…ï¼š package proto ç¬¬äºŒè¡Œï¼šå‘Šè¯‰protocç¼–è¯‘å™¨ï¼Œè¿™ä¸ªprotoæ–‡ä»¶å½“å‰çš„ä½ç½®ï¼š option go_package=\u0026quot;learnProto/proto\u0026quot; protoæ–‡ä»¶æ”¹æˆäº†ï¼š\nsyntax = \u0026#34;proto3\u0026#34;; package proto; option go_package=\u0026#34;learnProto/proto\u0026#34;; // ... çœç•¥ ç›®å‰ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ç»“æ„æ˜¯é•¿è¿™æ ·çš„ï¼š\nlearnProto/ proto/ media.proto go.mod æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨protocè¿›è¡Œç¼–è¯‘ï¼š\nprotoc --proto_path=. --go_out=. --go_opt=paths=source_relative proto/media.proto å‘½ä»¤è¿è¡Œä¹‹åï¼Œå°†ä¼šåœ¨ proto æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä¸ª media.pb.go çš„æ–‡ä»¶ï¼Œè¿™ä¸ªï¼Œå°±æ˜¯æˆ‘ä»¬é€šè¿‡ protoc å°† protoæ–‡ä»¶ç¼–è¯‘æˆçš„goæ–‡ä»¶ã€‚\nä½¿ç”¨protobuf ç¼–å†™goæœåŠ¡ç«¯ // learnProto/server/server_main.go package main import ( bf \u0026#34;google.golang.org/protobuf/proto\u0026#34; \u0026#34;learnProto/proto\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net\u0026#34; ) func main() { l, _ := net.Listen(\u0026#34;tcp\u0026#34;, \u0026#34;:8099\u0026#34;) for { conn, _ := l.Accept() log.Println(\u0026#34;Received on connection.\u0026#34;) // read all from connection _data := make([]byte, 1024) if n, err := conn.Read(_data); err != nil { log.Fatalf(\u0026#34;Read error: %s\u0026#34;, err) } else { log.Printf(\u0026#34;%d bytes read\\n\u0026#34;, n) } message := \u0026amp;proto.Picture{} bf.Unmarshal(_data, message) log.Printf(\u0026#34;data: %v\u0026#34;, message) } } æœåŠ¡ç«¯çš„ä»£ç ç®€å•ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªTCPæœåŠ¡ç«¯ï¼Œç›‘å¬8099ç«¯å£ï¼Œä»é‡Œé¢è·å–æ•°æ®ï¼Œé€šè¿‡protoå°†å…¶è½¬åŒ–æˆä¸ºå¯¹åº”çš„ç»“æ„ä½“ã€‚\nç”±äºæ˜¯ç®€å•çš„ä½¿ç”¨protoï¼Œæˆ‘ä»¬æš‚æ—¶ä¸è€ƒè™‘é‡Œé¢ä¼ è¾“çš„æ•°æ®é•¿åº¦ï¼Œç›´æ¥æ„å»ºä¸€ä¸ª1024é•¿åº¦çš„byteåˆ‡ç‰‡ï¼Œä»è¿æ¥é‡Œé¢è¯»å–æ•°æ®ã€‚ç„¶åä½¿ç”¨ bf.Unmarshal å°†é‡Œé¢çš„å­—èŠ‚ç æ•°æ®ååºåˆ—åŒ–ä¸º proto.Pictureç»“æ„ä½“\nåç»­å¯ä»¥ä¼˜åŒ–è¿™å—ï¼Œæ¯”å¦‚çº¦å®šå¼€å§‹ä¼ é€çš„æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º HEADER_SIZE çš„æ•°æ®ï¼Œé‡Œé¢å£°æ˜äº†æˆ‘ä»¬æœ¬æ¬¡ä¼ è¾“çš„å†…å®¹æ˜¯å›¾ç‰‡è¿˜æ˜¯è§†é¢‘ï¼Œç„¶åæ¥ä¸‹æ¥çš„æ•°æ®æœ‰å¤šå¤§ï¼Œç­‰ã€‚\nç¼–å†™goå®¢æˆ·ç«¯ // learnProto/client/client_main.go package main import ( bf \u0026#34;google.golang.org/protobuf/proto\u0026#34; \u0026#34;learnProto/proto\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net\u0026#34; \u0026#34;time\u0026#34; ) func main() { conn, _ := net.Dial(\u0026#34;tcp\u0026#34;, \u0026#34;localhost:8099\u0026#34;) message := \u0026amp;proto.Picture{ Name: \u0026#34;pandas\u0026#34;, Type: proto.Picture_JPG, Data: []byte{1, 2, 3, 4, 5, 6, 7}, } msg, _ := bf.Marshal(message) n, err := conn.Write(msg) if err != nil { log.Fatalf(\u0026#34;Error write to connectin: %s\u0026#34;, err) } log.Printf(\u0026#34;%d bytes wrote.\u0026#34;, n) time.Sleep(time.Second) } å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ net.Dial å‘æœåŠ¡ç«¯å‘èµ·è¿æ¥ï¼Œç„¶åæ„é€ ä¸€ä¸ªå‡çš„ Pictureæ¶ˆæ¯ï¼Œå›¾ç‰‡çš„åç§°ä¸º pandasï¼Œå›¾ç‰‡çš„ç±»å‹æ˜¯ JPGï¼Œç„¶åå†…å®¹æ˜¯éšä¾¿ç»™å‡ ä¸ªå­—èŠ‚ã€‚\nç„¶åï¼Œä½¿ç”¨ bf.Marshalï¼Œå°†ç»“æ„ä½“æ•°æ®åºåˆ—åŒ–æˆä¸ºå­—èŠ‚ []byte,é€šè¿‡tcpè¿æ¥å‘é€åˆ°å®¢æˆ·ç«¯ã€‚\néšåä¼‘çœ ä¸€ç§’ï¼Œé˜²æ­¢è¿æ¥æå‰ç»ˆç«¯è€Œå¯¼è‡´æœåŠ¡ç«¯æ•°æ®è¯»å–å¤±è´¥ã€‚\nè¿è¡Œ è¿è¡Œä¸Šè¿°ä»£ç \nå®¢æˆ·ç«¯è¾“å‡ºï¼š\n2022/04/14 23:42:00 19 bytes wrote. æœåŠ¡ç«¯è¾“å‡ºï¼š\n2022/04/14 23:42:00 Received on connection. 2022/04/14 23:42:00 19 bytes read 2022/04/14 23:42:00 data: name:\u0026#34;pandas\u0026#34; type:JPG data:\u0026#34;\\x01\\x02\\x03\\x04\\x05\\x06\\x07\u0026#34; å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘é€çš„messageï¼Œå¹¶ä¸”æ­£ç¡®åœ°å°†å…¶åºåˆ—åŒ–æˆä¸ºäº† proto.Pictureå¯¹è±¡ã€‚\næ”¹è¿› æœåŠ¡ç«¯å¯åšæ”¹è¿›ï¼š è€ƒè™‘æ–°å¢æ¶ˆæ¯ç±»å‹çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨çº¦å®š HEADER çš„æ–¹å¼ï¼Œæ¥ç¡®å®šæ¥ä¸‹æ¥å‘é€çš„æ¶ˆæ¯å±äºä»€ä¹ˆç±»å‹ï¼Œä»¥åŠæ¶ˆæ¯çš„é•¿åº¦ç­‰ã€‚\næ¥æ”¶åˆ°åª’ä½“ä¿¡æ¯çš„æ—¶å€™ï¼Œå°†æ•°æ®ä¿å­˜èµ·æ¥ã€‚\nä½¿ç”¨ goroutineæ”¹é€ ï¼Œæ”¯æŒå¹¶å‘å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚\nå®¢æˆ·ç«¯å¯åšæ”¹è¿›ï¼š å›¾ç‰‡çš„æ•°æ®å¯ä»¥ç›´æ¥ä»æ–‡ä»¶æˆ–è€…æ•°æ®åº“è¯»å–\nè‡ªåŠ¨è§£æå›¾ç‰‡çš„åç§°ã€æ ¼å¼ç­‰\n","permalink":"https://zihuanling.github.io/posts/go-proto/","summary":"\u003ch1 id=\"google-protocol-buffers\"\u003eGoogle protocol buffers\u003c/h1\u003e\n\u003cp\u003eç®€ç§°\u003ccode\u003eprotobuf\u003c/code\u003eï¼Œå®ƒæ˜¯è°·æ­Œæä¾›çš„è·¨è¯­è¨€ï¼Œè·¨å¹³å°çš„ï¼Œå¯æ‰©å±•çš„ç”¨æ¥å°†ç»“æ„åŒ–çš„æ•°æ®è¿›è¡Œåºåˆ—åŒ–çš„ä¸€ç§æœºåˆ¶ã€‚å°±åƒ\u003cstrong\u003eXML\u003c/strong\u003eï¼Œä½†æ˜¯æ›´åŠ ç²¾ç®€ã€å¿«é€Ÿå’Œç®€å•ã€‚æˆ‘ä»¬å¯ä»¥å…ˆé¢„å…ˆå®šä¹‰æˆ‘ä»¬çš„åè®®ï¼ˆå†™åˆ°ä¸€ä¸ª \u003ccode\u003e.proto\u003c/code\u003e æ–‡ä»¶é‡Œé¢ï¼‰ï¼Œé‡Œé¢å£°æ˜äº†æˆ‘ä»¬éœ€è¦æ€ä¹ˆå»å°†æ•°æ®ç»“æ„åŒ–ï¼Œç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä»½protoï¼Œå»ç”Ÿæˆæˆ‘ä»¬æŒ‡å®šçš„è¯­è¨€æºä»£ç æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå¾ˆæ–¹ä¾¿åœ°ä»å„ç§æ•°æ®æµä¸­è¯»å–ç»“æ„åŒ–æ•°æ®ï¼Œæˆ–è€…æ˜¯å†™å…¥ç»“æ„åŒ–æ•°æ®ã€‚å¹¶ä¸”æ˜¯è·¨è¯­è¨€çš„ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eProtocol buffers are Google\u0026rsquo;s language-neutral, platform-neutral, extensible mechanism for serializing structured data â€“ think XML, but smaller, faster, and simpler. You define how you want your data to be structured once, then you can use special generated source code to easily write and read your structured data to and from a variety of data streams and using a variety of languages.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 id=\"å®‰è£…protocç¼–è¯‘å™¨\"\u003eå®‰è£…protocç¼–è¯‘å™¨\u003c/h1\u003e\n\u003cp\u003e\u003ccode\u003e.proto\u003c/code\u003eæ–‡ä»¶åªæ˜¯æˆ‘ä»¬å®šä¹‰çš„åè®®æ–‡ä»¶ï¼Œä¸€èˆ¬æ¥è®²ï¼Œç¼–ç¨‹è¯­è¨€æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™ä»½æ–‡ä»¶çš„ï¼ˆé™¤éæ˜¯è‡ªå·±é’ˆå¯¹protoå†™ä¸€ä¸ªè‡ªå®šä¹‰çš„è§£æé€»è¾‘ï¼Œä½†æ˜¯æ²¡äººä¼šè¿™ä¹ˆé—²ï¼‰ï¼Œæˆ‘ä»¬æƒ³è¦çš„ï¼Œåº”è¯¥æ˜¯ç®€å•é«˜æ•ˆçš„å¼€å‘ï¼Œå¯ä»¥å³å†™å³ç”¨é‚£ç§ã€‚\u003c/p\u003e\n\u003cp\u003eå› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ç‰¹å®šçš„ç¼–ç¨‹è¯­è¨€ç¼–å†™æœåŠ¡æ—¶ï¼Œéœ€è¦å°†æˆ‘ä»¬å®šä¹‰çš„ \u003ccode\u003e.proto\u003c/code\u003e æ–‡ä»¶ç¿»è¯‘ï¼ˆç¼–è¯‘ï¼‰æˆä¸ºå¯¹åº”çš„è¯­è¨€æ–‡ä»¶ï¼Œè¿™æ—¶ï¼Œgoogle ç»™æˆ‘ä»¬æä¾›äº† protocã€‚\u003c/p\u003e","title":"go å’Œ protobuf"},{"content":"å®‰è£… mkdir go-mongo go mod init go-mongo go get go.mongodb.org/mongo-driver/mongo ä½¿ç”¨ æ•°æ®åº“é‡Œé¢æœ‰ä¸€æ¡è¿™æ ·çš„æ•°æ®ï¼š\n{ \u0026#34;_id\u0026#34;: { \u0026#34;$oid\u0026#34;: \u0026#34;6252912ec4495f97bccf41aa\u0026#34; }, \u0026#34;title\u0026#34;: \u0026#34;My Mongo Post\u0026#34;, \u0026#34;create_time\u0026#34;: { \u0026#34;$date\u0026#34;: \u0026#34;2022-04-10T10:33:45.149Z\u0026#34; }, \u0026#34;viewer\u0026#34;: 201 } è¿æ¥æ•°æ®åº“ // å…³é”®ä»£ç  const MONGO_URI = \u0026#34;mongodb://localhost:27017/test\u0026#34; client, err := mongo.Connect(context.TODO(), options.Client().ApplyURI(MONGO_URI)) // ä¼˜é›…å…³é—­è¿æ¥ defer client.Disconnect(context.TODO()) æ•°æ®æŸ¥è¯¢ é¦–å…ˆè·å–åˆ°å¯¹åº”çš„databaseä»¥åŠcollection\ncoll := client.Database(\u0026#34;test\u0026#34;).Collection(\u0026#34;post\u0026#34;) ç„¶åæŸ¥è¯¢ï¼š\ncoll := client.Database(\u0026#34;test\u0026#34;).Collection(\u0026#34;post\u0026#34;) var result bson.M\t// éœ€è¦ä¸€ä¸ªbson.M å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨æŸ¥è¯¢å›æ¥çš„æ•°æ® // FindOne æ¥å—2ä¸ªå‚æ•°ï¼Œä¸€ä¸ªcontextï¼Œä¸€ä¸ªfilterï¼Œfilter ä¸º bson.Dç±»å‹ err = coll.FindOne(context.TODO(), bson.D{}).Decode(\u0026amp;result) if err == mongo.ErrNoDocuments { fmt.Printf(\u0026#34;No document found.\\n\u0026#34;) return } else if err != nil { panic(err) } fmt.Printf(\u0026#34;Found document result: %s\\n\u0026#34;, result) æ•°æ®æŸ¥è¯¢æ³¨æ„ç‚¹ï¼š\néœ€è¦ä¸€ä¸ª bson.M å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨è¿”å›çš„æ•°æ® Collection.FindOne æ¥å—3ä¸ªå‚æ•°ï¼Œctxã€filterå’Œoptsï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª SingleResult å¯¹è±¡ ctxå¯ä»¥ä¸ºnilï¼Œå¦‚æœä¸ºnilçš„è¯ï¼Œé»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ª context.Backgroudçš„context filterä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œä¸º bson.D ç±»å‹ï¼Œä¸Šé¢ä»£ç é»˜è®¤ä¸ºç©ºï¼Œæ„å‘³ç€æŸ¥è¯¢ä»»æ„ä¸€æ¡æ•°æ®ã€‚ä¹Ÿå¯ä»¥æŒ‡å®šç‰¹å®šçš„æ¡ä»¶ï¼Œå¦‚ bson.d{{\u0026quot;title\u0026quot;, \u0026quot;first post\u0026quot;}}ï¼Œæ„å‘³ç€æŸ¥è¯¢ tile ä¸º first post çš„æ–‡æ¡£ã€‚ optsï¼šç±»å‹ä¸º options.FindOneOptions ç±»å‹ï¼ŒæŸ¥è¯¢çš„é¢å¤–æ¡ä»¶ï¼Œæ¯”å¦‚é™å®šè¿”å›çš„å…·ä½“å­—æ®µï¼š\u0026amp;options.FindOneOptions{Projection: map[string]int{\u0026quot;_id\u0026quot;: 0}}ï¼Œè¿™ä¸ªoptionsç¦æ­¢è¿”å›_idå­—æ®µã€‚ ä½¿ç”¨ SingleResult.Decodeæ–¹æ³•å°†è¿”å›çš„SingleResultååºåˆ—åŒ–ä¸º bson.M å¯¹è±¡ï¼ŒSingleResult.Decode(\u0026amp;result) ä¸Šè¿°æŸ¥è¯¢è¾“å‡ºï¼š\nFound document result: map[_id:ObjectID(\u0026#34;6252912ec4495f97bccf41aa\u0026#34;) create_time:%!s(primitive.DateTime=1649548800000) title:My Mongo Post viewer:%!s(int32=201)] bsonæ•°æ®è½¬struct é€šè¿‡ SingleResult.Decode è½¬åŒ–è€Œæ¥çš„æ˜¯ä¸€ä¸ªbson.Må¯¹è±¡ï¼Œå®é™…çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œè¿™ç§æ ¼å¼çš„å¯¹è±¡æ˜¯å¾ˆéš¾ç”¨çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶Unmarshalä¸€ä¸‹ï¼Œååºåˆ—åŒ–æˆä¸ºä¸€ä¸ªç»“æ„ä½“ã€‚\næˆ‘ä»¬çš„postæœ‰å‡ ä¸ªå­—æ®µï¼štitleã€viewerã€create_timeï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª Postç»“æ„ä½“ï¼Œå°†è¿™äº›å­—æ®µæ˜ å°„åˆ°ç»“æ„ä½“é‡Œé¢ï¼š\ntype Post struct { Title string `bson:\u0026#34;title\u0026#34;` Viewer int32 `bson:\u0026#34;viewer\u0026#34;` CreateTime time.Time `bson:\u0026#34;create_Time\u0026#34;` } func (p Post) String() string { return fmt.Sprintf(\u0026#34;Title: %s\\nCreated at: %s\\nViewers: %d\\n\u0026#34;, p.Title, p.CreateTime, p.Viewer) } åŒæ—¶ï¼Œæˆ‘ä»¬ç»™è¿™ä¸ªç»“æ„ä½“å®ç°äº† Stringer æ¥å£ï¼Œæ‰“å°å‡ºç‰¹å®šçš„æ•°æ®æ ¼å¼ã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å‰é¢æ­¥éª¤å–å›çš„ result è½¬åŒ–æˆä¸º Post ç»“æ„ä½“ï¼š\ndoc, err := bson.Marshal(result) if err != nil { fmt.Printf(\u0026#34;bson.Marshal error: %s\u0026#34;, err) return } err = bson.Unmarshal(doc, \u0026amp;post) if err != nil { fmt.Printf(\u0026#34;bson.Unmarshal error: %s\u0026#34;, err) return } fmt.Println(post) ä¸€å…±æ˜¯ä¸¤ä¸ªæ­¥éª¤ï¼š\nå°†bson.Må¯¹è±¡ä½¿ç”¨bson.Marshalåºåˆ—åŒ–æˆä¸ºä¸€ä¸ªbsonå­—ç¬¦ä¸² ä½¿ç”¨ bson.Unmarshal è½¬åŒ–æˆstructç»“æ„ä½“å¯¹è±¡ é‡æ–°è¿è¡Œä¸Šè¿°ä»£ç ï¼Œè¾“å‡ºï¼š\nTitle: My Mongo Post Created at: 2022-04-10 10:33:45.149 +0000 UTC Viewers: 201 å¯ä»¥çœ‹åˆ°ï¼Œæ­£å¸¸è¾“å‡ºäº†å†…å®¹ï¼Œä½†æ˜¯ Datetime å­—æ®µæœ‰äº›å¼‚å¸¸ï¼Œprimitive.Datetime æ²¡èƒ½å¾ˆå¥½åœ°è½¬åŒ–æˆä¸º Time å¯¹è±¡ã€‚æˆ‘ä»¬åç»­å†ç ”ç©¶ä¸‹ã€‚\næ•°æ®æ’å…¥ æ•°æ®æ’å…¥å¯ä»¥æ”¯æŒç›´æ¥çš„ç»“æ„ä½“æ’å…¥ï¼š\nfunc insert(coll *mongo.Collection) { rand.Seed(time.Now().Unix()) num := rand.Uint32() post := Post{ Title: \u0026#34;New post - \u0026#34; + strconv.Itoa(int(num)), Viewer: num, CreateTime: time.Now(), } r, err := coll.InsertOne(nil, \u0026amp;post) if err != nil { fmt.Printf(\u0026#34;Insert post errorï¼š %s\\n\u0026#34;, err) return } fmt.Printf(\u0026#34;Data inserted: %sï¼Œ \\n%s\u0026#34;, r.InsertedID, post) } è¿è¡Œåï¼Œæ•°æ®åº“ä¸­å¤šäº†ä¸€æ¡æ•°æ®ï¼š\n{ \u0026#34;_id\u0026#34;: { \u0026#34;$oid\u0026#34;: \u0026#34;6252b289dfed1f0d342af950\u0026#34; }, \u0026#34;title\u0026#34;: \u0026#34;New post - 2596996162\u0026#34;, \u0026#34;viewer\u0026#34;: 2596996162, \u0026#34;create_Time\u0026#34;: { \u0026#34;$date\u0026#34;: \u0026#34;2022-04-10T10:33:45.149Z\u0026#34; } } å¯ä»¥çœ‹åˆ°æ•°æ®æ˜¯æˆåŠŸæ’å…¥äº†çš„ï¼Œä½†æ˜¯æ—¶é—´ create_time æœ‰ç‚¹é—®é¢˜ï¼Œè·Ÿå®é™…æ—¶é—´ä¸ç¬¦ï¼Œåº”è¯¥æ˜¯æ—¶åŒºçš„è®¾ç½®é—®é¢˜ã€‚\næ•°æ®åˆ é™¤ func delete(coll *mongo.Collection) { r, err := coll.DeleteOne(nil, bson.D{{\u0026#34;viewer\u0026#34;, 1170169558}}) if err != nil { fmt.Printf(\u0026#34;Delete error: %s\\n\u0026#34;, err) return } fmt.Printf(\u0026#34;Delete result: %d deleted\u0026#34;, r.DeletedCount) } æ•°æ®ä¿®æ”¹ func update(coll *mongo.Collection) { r, err := coll.UpdateOne( nil, bson.D{{\u0026#34;title\u0026#34;, \u0026#34;New post - 2596996162\u0026#34;}}, bson.D{{\u0026#34;$set\u0026#34;, bson.D{{\u0026#34;updated\u0026#34;, true}}}}, ) if err != nil { fmt.Printf(\u0026#34;update error: %s\\n\u0026#34;, err) return } fmt.Printf(\u0026#34;Update result: %d updated.\\n\u0026#34;, r.ModifiedCount) } ","permalink":"https://zihuanling.github.io/posts/go-mongo/","summary":"\u003ch1 id=\"å®‰è£…\"\u003eå®‰è£…\u003c/h1\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir go-mongo\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ego mod init go-mongo\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ego get go.mongodb.org/mongo-driver/mongo\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch1 id=\"ä½¿ç”¨\"\u003eä½¿ç”¨\u003c/h1\u003e\n\u003cp\u003eæ•°æ®åº“é‡Œé¢æœ‰ä¸€æ¡è¿™æ ·çš„æ•°æ®ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;_id\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;$oid\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;6252912ec4495f97bccf41aa\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;My Mongo Post\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;create_time\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;$date\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;2022-04-10T10:33:45.149Z\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;viewer\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e201\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"è¿æ¥æ•°æ®åº“\"\u003eè¿æ¥æ•°æ®åº“\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å…³é”®ä»£ç \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eMONGO_URI\u003c/span\u003e = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mongodb://localhost:27017/test\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eclient\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emongo\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eConnect\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003econtext\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eTODO\u003c/span\u003e(), \u003cspan style=\"color:#a6e22e\"\u003eoptions\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eClient\u003c/span\u003e().\u003cspan style=\"color:#a6e22e\"\u003eApplyURI\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eMONGO_URI\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ä¼˜é›…å…³é—­è¿æ¥\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclient\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eDisconnect\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003econtext\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eTODO\u003c/span\u003e())\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"æ•°æ®æŸ¥è¯¢\"\u003eæ•°æ®æŸ¥è¯¢\u003c/h2\u003e\n\u003cp\u003eé¦–å…ˆè·å–åˆ°å¯¹åº”çš„\u003ccode\u003edatabase\u003c/code\u003eä»¥åŠ\u003ccode\u003ecollection\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ecoll\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclient\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eDatabase\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;test\u0026#34;\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003eCollection\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;post\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åæŸ¥è¯¢ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ecoll\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclient\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eDatabase\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;test\u0026#34;\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003eCollection\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;post\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ebson\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eM\u003c/span\u003e\t\u003cspan style=\"color:#75715e\"\u003e// éœ€è¦ä¸€ä¸ªbson.M å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨æŸ¥è¯¢å›æ¥çš„æ•°æ®\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// FindOne æ¥å—2ä¸ªå‚æ•°ï¼Œä¸€ä¸ªcontextï¼Œä¸€ä¸ªfilterï¼Œfilter ä¸º bson.Dç±»å‹\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e = \u003cspan style=\"color:#a6e22e\"\u003ecoll\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eFindOne\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003econtext\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eTODO\u003c/span\u003e(), \u003cspan style=\"color:#a6e22e\"\u003ebson\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eD\u003c/span\u003e{}).\u003cspan style=\"color:#a6e22e\"\u003eDecode\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emongo\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eErrNoDocuments\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;No document found.\\n\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e} \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    panic(\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Found document result: %s\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ•°æ®æŸ¥è¯¢æ³¨æ„ç‚¹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eéœ€è¦ä¸€ä¸ª \u003ccode\u003ebson.M\u003c/code\u003e å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨è¿”å›çš„æ•°æ®\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eCollection.FindOne\u003c/code\u003e æ¥å—3ä¸ªå‚æ•°ï¼Œctxã€filterå’Œoptsï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª \u003ccode\u003eSingleResult\u003c/code\u003e å¯¹è±¡\n\u003cul\u003e\n\u003cli\u003ectxå¯ä»¥ä¸ºnilï¼Œå¦‚æœä¸ºnilçš„è¯ï¼Œé»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ª \u003ccode\u003econtext.Backgroud\u003c/code\u003eçš„context\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003efilter\u003c/code\u003eä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œä¸º \u003ccode\u003ebson.D\u003c/code\u003e ç±»å‹ï¼Œä¸Šé¢ä»£ç é»˜è®¤ä¸ºç©ºï¼Œæ„å‘³ç€æŸ¥è¯¢ä»»æ„ä¸€æ¡æ•°æ®ã€‚ä¹Ÿå¯ä»¥æŒ‡å®šç‰¹å®šçš„æ¡ä»¶ï¼Œå¦‚ \u003ccode\u003ebson.d{{\u0026quot;title\u0026quot;, \u0026quot;first post\u0026quot;}}\u003c/code\u003eï¼Œæ„å‘³ç€æŸ¥è¯¢ tile ä¸º first post çš„æ–‡æ¡£ã€‚\u003c/li\u003e\n\u003cli\u003eoptsï¼šç±»å‹ä¸º \u003ccode\u003eoptions.FindOneOptions\u003c/code\u003e ç±»å‹ï¼ŒæŸ¥è¯¢çš„é¢å¤–æ¡ä»¶ï¼Œæ¯”å¦‚é™å®šè¿”å›çš„å…·ä½“å­—æ®µï¼š\u003ccode\u003e\u0026amp;options.FindOneOptions{Projection: map[string]int{\u0026quot;_id\u0026quot;: 0}}\u003c/code\u003eï¼Œè¿™ä¸ªoptionsç¦æ­¢è¿”å›\u003ccode\u003e_id\u003c/code\u003eå­—æ®µã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eä½¿ç”¨ \u003ccode\u003eSingleResult.Decode\u003c/code\u003eæ–¹æ³•å°†è¿”å›çš„\u003ccode\u003eSingleResult\u003c/code\u003eååºåˆ—åŒ–ä¸º \u003ccode\u003ebson.M\u003c/code\u003e å¯¹è±¡ï¼Œ\u003ccode\u003eSingleResult.Decode(\u0026amp;result)\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä¸Šè¿°æŸ¥è¯¢è¾“å‡ºï¼š\u003c/p\u003e","title":"Go ä½¿ç”¨mongodb"},{"content":"go æ˜¯å¤©ç”Ÿæ”¯æŒå¹¶å‘çš„ï¼Œæˆ‘ä»¬åªè¦ ä½¿ç”¨ go func() å°±å¯ä»¥å¿«é€Ÿå®ç°å¹¶å‘ã€‚åœ¨ç½‘ç»œæœåŠ¡çš„å¤„ç†ä¸­ï¼Œå®ç°å¹¶å‘å¯ä»¥å¤§å¤§æé«˜æœåŠ¡çš„ååé‡ï¼Œæˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹ã€‚\nç®€å•çš„TCPæœåŠ¡å™¨ æˆ‘ä»¬å…ˆæ¥å®ç°ä¸€ä¸ªç®€å•çš„tcpæœåŠ¡ï¼Œç›‘å¬8989ç«¯å£ï¼Œä»è¿æ¥ä¸­è¯»å–ä¸€æ®µæ•°æ®ï¼Œè¿™æ®µæ•°æ®è¡¨ç¤ºçš„æ˜¯å½“å‰è¯·æ±‚çš„idï¼Œç„¶åè¿”å›ä¸€æ®µè¯ã€‚\næœåŠ¡å™¨ server/main.go\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net\u0026#34; ) func main() { // å¯åŠ¨tcpè¿æ¥ï¼Œç›‘å¬8989ç«¯å£ l, err := net.Listen(\u0026#34;tcp\u0026#34;, \u0026#34;:8989\u0026#34;) if err != nil { log.Fatalf(\u0026#34;Server listening error: %s\\n\u0026#34;, err) } for { conn, err := l.Accept() if err != nil { log.Printf(\u0026#34;Accept error: %s\\n\u0026#34;, err) continue } // æ¥æ”¶è¿æ¥,è°ƒç”¨handleConnå¤„ç†å½“å‰è¿æ¥ handleConn(conn) } } func handleConn(conn net.Conn) { defer conn.Close()\t// ä¼˜é›…å…³é—­è¿æ¥ data := make([]byte, 4) conn.Read(data) log.Printf(\u0026#34;Recieved connection from %s, ID[%s]\\n\u0026#34;, conn.RemoteAddr(), data) // å‘å®¢æˆ·ç«¯è¿”å›ä¸€å¥ Hello World if n, err := conn.Write([]byte(fmt.Sprintf(\u0026#34;Hello world! -\u0026gt; ID[%s]\u0026#34;, data))); err != nil { log.Printf(\u0026#34;Write error: %s | %s\\n\u0026#34;, err, conn.RemoteAddr()) } else { log.Printf(\u0026#34;%d bytes wrote for ID[%s]\u0026#34;, n, data) } } æœåŠ¡å™¨ç®€å•ï¼Œç›´æ¥å¯åŠ¨ä¸€ä¸ªtcpæœåŠ¡ï¼Œç›‘å¬8989ç«¯å£ï¼Œç„¶åæ¥æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥çš„æ—¶å€™ï¼Œä»è¿æ¥ä¸­è·å–å½“å‰è¯·æ±‚çš„IDï¼Œç„¶åå‘å½“å‰å®¢æˆ·ç«¯è¿”å›ä¸€å¥ Hello World\nå®¢æˆ·ç«¯ client/main.go\nfunc main() { reqTCP(2) } func reqTCP(id int) { conn, err := net.Dial(\u0026#34;tcp\u0026#34;, \u0026#34;localhost:8989\u0026#34;) if err != nil { log.Printf(\u0026#34;Dial tcp error: %s\\n\u0026#34;, err) return } // å†™å…¥å½“å‰è¯·æ±‚ID if _, err := conn.Write([]byte(strconv.Itoa(id))); err != nil { log.Printf(\u0026#34;Conn write error: %s\\n\u0026#34;, err) return } data := make([]byte, 100) // è¿”å›çš„å†…å®¹åº”è¯¥ä¸ä¼šè¶…è¿‡100å­—èŠ‚ if _, err := conn.Read(data); err != nil { log.Printf(\u0026#34;Conn read error: %s\\n\u0026#34;, err) return } log.Printf(\u0026#34;Recieved from server: %s\\n\u0026#34;, data) } å®¢æˆ·ç«¯è¦åšçš„äº‹æƒ…ï¼Œå°±æ˜¯å‘æœåŠ¡ç«¯æ‹¨å·ï¼Œç„¶åå‘é€ä¸€ä¸ªè¯·æ±‚IDï¼Œæœ€åä»æœåŠ¡ç«¯è·å–è¿”å›çš„æ•°æ®ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚\nè¿è¡Œ è¿è¡Œ server/main.go\ngo run server/main.go è¿è¡Œ client/main.go\ngo run client/main.go å®¢æˆ·ç«¯è¾“å‡ºï¼š\n2022/04/06 21:13:50 Recieved from server: Hello world! -\u0026gt; ID[2] æœåŠ¡ç«¯è¾“å‡ºï¼š\n2022/04/06 21:13:50 Recieved connection from [::1]:64088, ID[2] 2022/04/06 21:13:50 24 bytes wrote for ID[2] å®¢æˆ·çœ‹åˆ°ï¼Œä¸€ä¸ªç®€å•çš„TCPæœåŠ¡å™¨å°±å®ç°äº†ã€‚\nå¹¶å‘çš„è¯·æ±‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å¹¶ä¸ä¼šä»…å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œè€Œæ˜¯å¤šä¸ªè¯·æ±‚ä¸€èµ·å¤„ç†ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬çš„æœåŠ¡å™¨æœ‰å¾ˆå¥½çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚\næ”¹åŠ¨ client/main.goï¼Œè®©å…¶è¿›è¡Œå¹¶å‘è¯·æ±‚ï¼š\nfunc main() { nReq := 10 // 10ä¸ªå¹¶å‘è¯·æ±‚ var wg sync.WaitGroup wg.Add(nReq) for i := 0; i \u0026lt; nReq; i++ { go func(n int) { defer wg.Done() reqTCP(n) }(i) } wg.Wait() } // çœç•¥å…¶ä»–ä»£ç ... æ­¤æ—¶ç›´æ¥è¿è¡Œçš„è¯ï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡ºï¼š\nå®¢æˆ·ç«¯è¾“å‡ºï¼š ---- 2022/04/06 21:30:10 Recieved from server: Hello world! -\u0026gt; ID[7] 2022/04/06 21:30:10 Recieved from server: Hello world! -\u0026gt; ID[8] 2022/04/06 21:30:10 Recieved from server: Hello world! -\u0026gt; ID[9] 2022/04/06 21:30:10 Recieved from server: Hello world! -\u0026gt; ID[6] 2022/04/06 21:30:10 Recieved from server: Hello world! -\u0026gt; ID[5] 2022/04/06 21:30:10 Recieved from server: Hello world! -\u0026gt; ID[2] 2022/04/06 21:30:10 Recieved from server: Hello world! -\u0026gt; ID[0] 2022/04/06 21:30:10 Recieved from server: Hello world! -\u0026gt; ID[3] 2022/04/06 21:30:10 Recieved from server: Hello world! -\u0026gt; ID[1] 2022/04/06 21:30:10 Recieved from server: Hello world! -\u0026gt; ID[4] æœåŠ¡ç«¯è¾“å‡ºï¼š ---- 2022/04/06 21:30:10 Recieved connection from [::1]:56405, ID[7] 2022/04/06 21:30:10 24 bytes wrote for ID[7] 2022/04/06 21:30:10 Recieved connection from [::1]:56406, ID[8] 2022/04/06 21:30:10 24 bytes wrote for ID[8] 2022/04/06 21:30:10 Recieved connection from [::1]:56408, ID[9] 2022/04/06 21:30:10 24 bytes wrote for ID[9] 2022/04/06 21:30:10 Recieved connection from [::1]:56409, ID[6] 2022/04/06 21:30:10 24 bytes wrote for ID[6] 2022/04/06 21:30:10 Recieved connection from [::1]:56407, ID[5] 2022/04/06 21:30:10 24 bytes wrote for ID[5] 2022/04/06 21:30:10 Recieved connection from [::1]:56404, ID[2] 2022/04/06 21:30:10 24 bytes wrote for ID[2] 2022/04/06 21:30:10 Recieved connection from [::1]:56412, ID[0] 2022/04/06 21:30:10 24 bytes wrote for ID[0] 2022/04/06 21:30:10 Recieved connection from [::1]:56411, ID[3] 2022/04/06 21:30:10 24 bytes wrote for ID[3] 2022/04/06 21:30:10 Recieved connection from [::1]:56410, ID[1] 2022/04/06 21:30:10 24 bytes wrote for ID[1] 2022/04/06 21:30:10 Recieved connection from [::1]:56413, ID[4] 2022/04/06 21:30:10 24 bytes wrote for ID[4] ä»è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¹¶å‘å‘èµ·äº†10ä¸ªè¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚çš„æ—¶é—´é—´éš”å¯èƒ½å¾ˆå°å¾ˆå°ï¼Œå¯ä»¥çœ‹åšæ˜¯åŒæ—¶å‘èµ·çš„ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚å’Œè¿”å›æ•°æ®çš„é¡ºåºå’Œå®¢æˆ·ç«¯æ‰“å°çš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚ä½†æ˜¯ç”±äºç¨‹åºå¤„ç†å¤ªå¿«ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½åœ¨ä¸€ç¬é—´å¤„ç†å®Œæˆäº†ï¼Œä¸èƒ½ä½“ç°å‡ºæŸäº›è¾ƒè€—æ—¶çš„æ“ä½œæƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯çš„ç­‰å¾…æƒ…å†µã€‚\næ”¹é€ æœåŠ¡ç«¯ï¼Œè®©å…¶è¿”å›æ•°æ®å‰ Sleep ä¸€ç§’\nserver/main.go\nfunc handleConn(conn net.Conn) { defer conn.Close() // ä¼˜é›…å…³é—­è¿æ¥ data := make([]byte, 4) conn.Read(data) log.Printf(\u0026#34;Recieved connection from %s, ID[%s]\\n\u0026#34;, conn.RemoteAddr(), data) time.Sleep(time.Second)\t// è¿”å›å‰ Sleep 1ç§’ // å‘å®¢æˆ·ç«¯è¿”å›ä¸€å¥ Hello World if n, err := conn.Write([]byte(fmt.Sprintf(\u0026#34;Hello world! -\u0026gt; ID[%s]\u0026#34;, data))); err != nil { log.Printf(\u0026#34;Write error: %s | %s\\n\u0026#34;, err, conn.RemoteAddr()) } else { log.Printf(\u0026#34;%d bytes wrote for ID[%s]\u0026#34;, n, data) } } é‡æ–°è¿è¡Œï¼Œå®¢æˆ·ç«¯è¾“å‡ºï¼š\n2022/04/06 21:36:21 Recieved from server: Hello world! -\u0026gt; ID[9] 2022/04/06 21:36:22 Recieved from server: Hello world! -\u0026gt; ID[2] 2022/04/06 21:36:23 Recieved from server: Hello world! -\u0026gt; ID[4] 2022/04/06 21:36:24 Recieved from server: Hello world! -\u0026gt; ID[5] 2022/04/06 21:36:25 Recieved from server: Hello world! -\u0026gt; ID[7] 2022/04/06 21:36:27 Recieved from server: Hello world! -\u0026gt; ID[8] 2022/04/06 21:36:28 Recieved from server: Hello world! -\u0026gt; ID[6] 2022/04/06 21:36:29 Recieved from server: Hello world! -\u0026gt; ID[0] 2022/04/06 21:36:30 Recieved from server: Hello world! -\u0026gt; ID[1] 2022/04/06 21:36:31 Recieved from server: Hello world! -\u0026gt; ID[3] å¯ä»¥çœ‹åˆ°ï¼Œå®¢æˆ·ç«¯æ˜¯æ¯é—´éš”1ç§’æ‰“å°ä¸€æ¡è®°å½•ï¼Œè¯´æ˜æ­¤æ—¶æœåŠ¡ç«¯å¯¹è¯·æ±‚çš„å¤„ç†æ˜¯ä¸²è¡Œçš„ï¼Œä¸€æ¬¡åªå¤„ç†ä¸€ä¸ªè¿æ¥ã€‚\nå¹¶å‘çš„æœåŠ¡ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯¹æœåŠ¡å™¨è¿›è¡Œæ”¹é€ ï¼Œè®©å…¶å®ç°ä¸€æ¬¡æ€§å¤„ç†å¤šä¸ªè¿æ¥\nserver/main.go\nfunc main() { // å¯åŠ¨tcpè¿æ¥ï¼Œç›‘å¬8989ç«¯å£ l, err := net.Listen(\u0026#34;tcp\u0026#34;, \u0026#34;:8989\u0026#34;) if err != nil { log.Fatalf(\u0026#34;Server listening error: %s\\n\u0026#34;, err) } for { conn, err := l.Accept() if err != nil { log.Printf(\u0026#34;Accept error: %s\\n\u0026#34;, err) continue } // æ¥æ”¶è¿æ¥,è°ƒç”¨handleConnå¤„ç†å½“å‰è¿æ¥ // ä½¿ç”¨goå…³é”®å­—ï¼Œç›´æ¥å¹¶å‘å¤„ç† go handleConn(conn) } } // çœç•¥å…¶ä»–... æœåŠ¡ç«¯çš„å¹¶å‘éå¸¸ç®€å•ï¼ç›´æ¥ä½¿ç”¨ go handleConn(conn) å³å¯è®©ç¨‹åºå¯¹å½“å‰è¿æ¥çš„å¤„ç†è¿›å…¥å¹¶å‘ã€‚\né‡æ–°è¿è¡ŒæœåŠ¡ç«¯ã€å®¢æˆ·ç«¯\nå®¢æˆ·ç«¯è¾“å‡ºï¼š\n2022/04/06 21:42:38 Recieved from server: Hello world! -\u0026gt; ID[6] 2022/04/06 21:42:38 Recieved from server: Hello world! -\u0026gt; ID[5] 2022/04/06 21:42:38 Recieved from server: Hello world! -\u0026gt; ID[1] 2022/04/06 21:42:38 Recieved from server: Hello world! -\u0026gt; ID[3] 2022/04/06 21:42:38 Recieved from server: Hello world! -\u0026gt; ID[9] 2022/04/06 21:42:38 Recieved from server: Hello world! -\u0026gt; ID[7] 2022/04/06 21:42:38 Recieved from server: Hello world! -\u0026gt; ID[2] 2022/04/06 21:42:38 Recieved from server: Hello world! -\u0026gt; ID[4] 2022/04/06 21:42:38 Recieved from server: Hello world! -\u0026gt; ID[0] 2022/04/06 21:42:38 Recieved from server: Hello world! -\u0026gt; ID[8] æœåŠ¡ç«¯è¾“å‡ºï¼š\n2022/04/06 21:42:37 Recieved connection from [::1]:56841, ID[3] 2022/04/06 21:42:37 Recieved connection from [::1]:56839, ID[7] 2022/04/06 21:42:37 Recieved connection from [::1]:56844, ID[1] 2022/04/06 21:42:37 Recieved connection from [::1]:56843, ID[9] 2022/04/06 21:42:37 Recieved connection from [::1]:56840, ID[4] 2022/04/06 21:42:37 Recieved connection from [::1]:56842, ID[2] 2022/04/06 21:42:37 Recieved connection from [::1]:56847, ID[5] 2022/04/06 21:42:37 Recieved connection from [::1]:56845, ID[0] 2022/04/06 21:42:37 Recieved connection from [::1]:56846, ID[8] 2022/04/06 21:42:37 Recieved connection from [::1]:56848, ID[6] 2022/04/06 21:42:38 24 bytes wrote for ID[1] 2022/04/06 21:42:38 24 bytes wrote for ID[6] 2022/04/06 21:42:38 24 bytes wrote for ID[0] 2022/04/06 21:42:38 24 bytes wrote for ID[7] 2022/04/06 21:42:38 24 bytes wrote for ID[2] 2022/04/06 21:42:38 24 bytes wrote for ID[4] 2022/04/06 21:42:38 24 bytes wrote for ID[9] 2022/04/06 21:42:38 24 bytes wrote for ID[5] 2022/04/06 21:42:38 24 bytes wrote for ID[3] 2022/04/06 21:42:38 24 bytes wrote for ID[8] å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡ç«¯æ˜¯åœ¨åŒä¸€æ—¶é—´æ¥æ”¶åˆ°äº†æ‰€æœ‰è¯·æ±‚ï¼Œè€Œä¸”ä¹Ÿåœ¨åŒä¸€æ—¶é—´è¿›å…¥åˆ°äº† handleConnå‡½æ•°ï¼Œè¿›è¡Œå¤„ç†ï¼Œåœ¨1ç§’åï¼Œæ‰€æœ‰è¿æ¥éƒ½è¿”å›äº†å¯¹åº”çš„å†…å®¹ã€‚éå¸¸ç®€å•çš„å®ç°äº†å¹¶å‘ï¼\nå¹¶å‘çš„HTTP server/main.go\nfunc main() { // å¯åŠ¨tcpè¿æ¥ï¼Œç›‘å¬8989ç«¯å£ l, err := net.Listen(\u0026#34;tcp\u0026#34;, \u0026#34;:8989\u0026#34;) if err != nil { log.Fatalf(\u0026#34;Server listening error: %s\\n\u0026#34;, err) } http.HandleFunc(\u0026#34;/hello\u0026#34;, httpHandler) http.Serve(l, nil) } func httpHandler(resp http.ResponseWriter, req *http.Request) { id := req.URL.Query().Get(\u0026#34;id\u0026#34;) log.Printf(\u0026#34;Request from %s, method[%s], ID[%s]\\n\u0026#34;, req.RemoteAddr, req.Method, id) time.Sleep(time.Second) fmt.Fprintf(resp, fmt.Sprintf(\u0026#34;Hello http -\u0026gt; ID[%s]\u0026#34;, id)) log.Printf(\u0026#34;Done ID[%s]\u0026#34;, id) } client/main.go\nfunc main() { nReq := 10 // 10ä¸ªå¹¶å‘è¯·æ±‚ var wg sync.WaitGroup wg.Add(nReq) for i := 0; i \u0026lt; nReq; i++ { go func(n int) { defer wg.Done() reqHTTP(n) }(i) } wg.Wait() } func reqHTTP(id int) { // ç®€å•çš„http Get resp, err := http.Get(\u0026#34;http://localhost:8989/hello?id=\u0026#34; + strconv.Itoa(id)) if err != nil { log.Printf(\u0026#34;Http request error: %s\\n\u0026#34;, err) return } data := make([]byte, resp.ContentLength) resp.Body.Read(data) log.Printf(\u0026#34;Http response: %s\\n\u0026#34;, data) } è¿è¡Œ æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼Œè¾“å‡ºï¼š\nå®¢æˆ·ç«¯ï¼š ---- 2022/04/06 22:12:45 Http response: Hello http -\u0026gt; ID[4] 2022/04/06 22:12:45 Http response: Hello http -\u0026gt; ID[2] 2022/04/06 22:12:45 Http response: Hello http -\u0026gt; ID[3] 2022/04/06 22:12:45 Http response: Hello http -\u0026gt; ID[1] 2022/04/06 22:12:45 Http response: Hello http -\u0026gt; ID[5] 2022/04/06 22:12:45 Http response: Hello http -\u0026gt; ID[0] 2022/04/06 22:12:45 Http response: Hello http -\u0026gt; ID[9] 2022/04/06 22:12:45 Http response: Hello http -\u0026gt; ID[8] 2022/04/06 22:12:45 Http response: Hello http -\u0026gt; ID[6] 2022/04/06 22:12:45 Http response: Hello http -\u0026gt; ID[7] æœåŠ¡ç«¯ï¼š ---- 2022/04/06 22:12:44 Request from [::1]:59686, method[GET], ID[9] 2022/04/06 22:12:44 Request from [::1]:59684, method[GET], ID[1] 2022/04/06 22:12:44 Request from [::1]:59685, method[GET], ID[8] 2022/04/06 22:12:44 Request from [::1]:59680, method[GET], ID[6] 2022/04/06 22:12:44 Request from [::1]:59688, method[GET], ID[4] 2022/04/06 22:12:44 Request from [::1]:59683, method[GET], ID[2] 2022/04/06 22:12:44 Request from [::1]:59687, method[GET], ID[3] 2022/04/06 22:12:44 Request from [::1]:59681, method[GET], ID[0] 2022/04/06 22:12:44 Request from [::1]:59682, method[GET], ID[5] 2022/04/06 22:12:44 Request from [::1]:59689, method[GET], ID[7] 2022/04/06 22:12:45 Done ID[4] 2022/04/06 22:12:45 Done ID[2] 2022/04/06 22:12:45 Done ID[3] 2022/04/06 22:12:45 Done ID[1] 2022/04/06 22:12:45 Done ID[5] 2022/04/06 22:12:45 Done ID[0] 2022/04/06 22:12:45 Done ID[9] 2022/04/06 22:12:45 Done ID[8] 2022/04/06 22:12:45 Done ID[6] 2022/04/06 22:12:45 Done ID[7] å¯ä»¥çœ‹åˆ°ï¼Œgo httpæ˜¯å¤©ç„¶å¹¶å‘çš„ã€‚\n","permalink":"https://zihuanling.github.io/posts/go-concurrent-server/","summary":"\u003cp\u003ego æ˜¯å¤©ç”Ÿæ”¯æŒå¹¶å‘çš„ï¼Œæˆ‘ä»¬åªè¦ ä½¿ç”¨ \u003ccode\u003ego func()\u003c/code\u003e å°±å¯ä»¥å¿«é€Ÿå®ç°å¹¶å‘ã€‚åœ¨ç½‘ç»œæœåŠ¡çš„å¤„ç†ä¸­ï¼Œå®ç°å¹¶å‘å¯ä»¥å¤§å¤§æé«˜æœåŠ¡çš„ååé‡ï¼Œæˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹ã€‚\u003c/p\u003e\n\u003ch2 id=\"ç®€å•çš„tcpæœåŠ¡å™¨\"\u003eç®€å•çš„TCPæœåŠ¡å™¨\u003c/h2\u003e\n\u003cp\u003eæˆ‘ä»¬å…ˆæ¥å®ç°ä¸€ä¸ªç®€å•çš„tcpæœåŠ¡ï¼Œç›‘å¬8989ç«¯å£ï¼Œä»è¿æ¥ä¸­è¯»å–ä¸€æ®µæ•°æ®ï¼Œè¿™æ®µæ•°æ®è¡¨ç¤ºçš„æ˜¯å½“å‰è¯·æ±‚çš„idï¼Œç„¶åè¿”å›ä¸€æ®µè¯ã€‚\u003c/p\u003e\n\u003ch3 id=\"æœåŠ¡å™¨\"\u003eæœåŠ¡å™¨\u003c/h3\u003e\n\u003cp\u003eserver/main.go\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003epackage\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;fmt\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;log\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;net\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// å¯åŠ¨tcpè¿æ¥ï¼Œç›‘å¬8989ç«¯å£\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a6e22e\"\u003el\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enet\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eListen\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;tcp\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;:8989\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eFatalf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Server listening error: %s\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003econn\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003el\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eAccept\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Accept error: %s\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#66d9ef\"\u003econtinue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e// æ¥æ”¶è¿æ¥,è°ƒç”¨handleConnå¤„ç†å½“å‰è¿æ¥\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003ehandleConn\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003econn\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehandleConn\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003econn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enet\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eConn\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003econn\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eClose\u003c/span\u003e()\t\t\u003cspan style=\"color:#75715e\"\u003e// ä¼˜é›…å…³é—­è¿æ¥\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e make([]\u003cspan style=\"color:#66d9ef\"\u003ebyte\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econn\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eRead\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Recieved connection from %s, ID[%s]\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003econn\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eRemoteAddr\u003c/span\u003e(), \u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// å‘å®¢æˆ·ç«¯è¿”å›ä¸€å¥ Hello World\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003en\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003econn\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eWrite\u003c/span\u003e([]byte(\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Hello world! -\u0026gt; ID[%s]\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e))); \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Write error: %s | %s\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003econn\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eRemoteAddr\u003c/span\u003e())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%d bytes wrote for ID[%s]\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003en\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœåŠ¡å™¨ç®€å•ï¼Œç›´æ¥å¯åŠ¨ä¸€ä¸ªtcpæœåŠ¡ï¼Œç›‘å¬8989ç«¯å£ï¼Œç„¶åæ¥æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥çš„æ—¶å€™ï¼Œä»è¿æ¥ä¸­è·å–å½“å‰è¯·æ±‚çš„IDï¼Œç„¶åå‘å½“å‰å®¢æˆ·ç«¯è¿”å›ä¸€å¥ \u003ccode\u003eHello World\u003c/code\u003e\u003c/p\u003e","title":"goï¼šç®€ç®€å•å•çš„å¹¶å‘ç½‘ç»œè¿æ¥"},{"content":"RPC RPC - Remote Procedure Call ç§°ä¸ºè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸åŒèŠ‚ç‚¹è°ƒç”¨çš„æ–¹å¼ï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰ï¼Œå±äº C/S æ¨¡å¼ã€‚ç”±å®¢æˆ·ç«¯å‘èµ·ï¼Œè°ƒç”¨æœåŠ¡ç«¯çš„æ–¹æ³•è¿›è¡Œé€šä¿¡ï¼ŒæœåŠ¡ç«¯å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚\nRPCçš„ä¸¤ä¸ªæ ¸å¿ƒï¼š\né€šä¿¡åè®® åºåˆ—åŒ– åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯ä¸€ç§æŠŠä¼ è¾“å†…å®¹ç¼–ç å’Œè§£ç çš„æ–¹å¼ï¼Œå¸¸è§çš„ç¼–è§£ç æ–¹å¼æœ‰ JSONã€Protobuf ç­‰ã€‚\nå¤§å¤šæ•° RPC æ¶æ„ä¸­ï¼Œéƒ½æœ‰ Clientã€Client Stubã€Serverã€Server Stubè¿™å››ä¸ªç»„ä»¶ï¼ŒClient å’Œ Server é€šè¿‡ Socket è¿›è¡Œé€šä¿¡ã€‚\nflowchart LR subgraph æœåŠ¡ç«¯è¿›ç¨‹ s(Server) ss(Server Stub) s --è°ƒç”¨--\u0026gt; ss ss --è¿”å›--\u0026gt; s end subgraph å®¢æˆ·ç«¯è¿›ç¨‹ c(Client) cs(Client Stub) c --è°ƒç”¨--\u0026gt; cs cs --è¿”å›--\u0026gt; c end å®¢æˆ·ç«¯è¿›ç¨‹ ==ç½‘ç»œæ¶ˆæ¯==\u0026gt; æœåŠ¡ç«¯è¿›ç¨‹ æœåŠ¡ç«¯è¿›ç¨‹ ==\u0026gt; å®¢æˆ·ç«¯è¿›ç¨‹ è°ƒç”¨æµç¨‹ï¼š\nclient è°ƒç”¨ client stubï¼ŒåŒæ—¶æŠŠå‚æ•°ä¼ ç»™ client stub client stubå°†å‚æ•°æ‰“åŒ…ç¼–ç ï¼Œç„¶åé€šè¿‡ç³»ç»Ÿè°ƒç”¨å‘é€åˆ°æœåŠ¡ç«¯è¿›ç¨‹ å®¢æˆ·ç«¯æœ¬åœ°ç³»ç»Ÿå‘é€ä¿¡æ¯åˆ°æœåŠ¡å™¨ æœåŠ¡å™¨ç³»ç»Ÿå°†ä¿¡æ¯å‘é€åˆ° server stub server stub å°†ä¿¡æ¯è§£ç  server stub è°ƒç”¨çœŸæ­£çš„æœåŠ¡ç«¯ç¨‹åº server server å¤„ç†åï¼Œé€šè¿‡åŒæ ·çš„æ–¹å¼ï¼Œå°†ç»“æœè¿”å›åˆ° client go å®ç°ç®€å•çš„RPCæœåŠ¡ goå†…ç½®äº† net/rpc åŒ…å¸®åŠ©æˆ‘ä»¬å®ç°rpcæœåŠ¡ã€‚\næ¥ä¸‹æ¥å®ç°ä¸€ä¸ªç®€å•çš„ Greet rpc æœåŠ¡ï¼š\nå®šä¹‰æœåŠ¡ rpc/server/greet_service.go\npackage server type GreetService struct {} type GreetServiceArgs struct { Name string } func (g *GreetService) Greet(args GreetServiceArgs, reply *string) error { log.Printf(\u0026#34;Greeting to [%s]\u0026#34;, args.Name) s := fmt.Sprintf(\u0026#34;Hello, %s, you are using go rpc, have a good day!\u0026#34;, args.Name) *reply = s return nil } ä¸Šè¿°ä»£ç åšäº†ä»¥ä¸‹å‡ ä»¶äº‹ï¼š\nå®šä¹‰ GreetServiceï¼Œè¡¨ç¤ºè¿œç¨‹æœåŠ¡å¯¹è±¡ GreetServiceArgsè¡¨ç¤ºå‚æ•°ï¼Œé‡Œé¢æœ‰ä¸ª Nameæˆå‘˜ Greetæ–¹æ³•å®ç°äº†å‘æœåŠ¡è°ƒç”¨è€…æ‰“æ‹›å‘¼çš„åŠŸèƒ½ æ³¨å†ŒæœåŠ¡ ç›´æ¥é€šè¿‡ RegisterName æ–¹æ³•æ³¨å†Œ\nrpc/server_main.go\npackage main import ( \u0026#34;let_go/rpc/server\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net\u0026#34; \u0026#34;net/rpc\u0026#34; ) func main() { if err := rpc.RegisterName(\u0026#34;GreetService\u0026#34;, new(server.GreetService)); err != nil { log.Fatalf(\u0026#34;Register rpc service error: %s\u0026#34;, err) } l, e := net.Listen(\u0026#34;tcp\u0026#34;, \u0026#34;:1234\u0026#34;) if e != nil { log.Fatalf(\u0026#34;Server error: %s\u0026#34;, e) } rpc.Accept(l) } ç›´æ¥é€šè¿‡ rpc.RegisterName æ³¨å†Œäº†ä¸€ä¸ªæœåŠ¡å¯¹è±¡ GreetService é€šè¿‡ net.Listen å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œç›‘å¬ 1234 ç«¯å£ ç„¶åé€šè¿‡ rcp.Acceptå‡½æ•°ï¼Œåœ¨è¯¥tcpè¿æ¥çš„åŸºç¡€ä¸Šæä¾›rcpæœåŠ¡ è§„åˆ™ æƒ³è¦æŠŠä¸€ä¸ªå¯¹è±¡æ³¨å†Œä¸ºRPCæœåŠ¡ï¼Œå¯ä»¥è®©å®¢æˆ·ç«¯è¿œç¨‹è®¿é—®ï¼Œåˆ™è¯¥å¯¹è±¡çš„æ–¹æ³•éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š\næ–¹æ³•çš„ç±»å‹æ˜¯å¯å¯¼å‡ºçš„ï¼ˆå…¬å¼€çš„ï¼‰ æ–¹æ³•æœ¬èº«ä¹Ÿæ˜¯å¯ä»¥å¯¼å‡ºçš„ æ–¹æ³•å¿…é¡»æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸”å‚æ•°ç±»å‹æ˜¯å¯å¯¼å‡ºæˆ–è€…å†…å»ºçš„ æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ª error ç±»å‹ è¯¥æ–¹æ³•çš„æ ¼å¼ï¼š\nfunc (t *T) MethodName(argType T1, replyType *T2) error è¿™é‡Œçš„ T1ã€T2 éƒ½æ˜¯å¯ä»¥è¢« encoding/gobåºåˆ—åŒ–çš„\nç¬¬ä¸€ä¸ªå‚æ•° argType æ˜¯è°ƒç”¨è€…ï¼ˆå®¢æˆ·ç«¯ï¼‰æä¾›çš„ ç¬¬äºŒä¸ªå‚æ•° replyType æ˜¯è¿”å›ç»™è°ƒç”¨è€…ç»“æœï¼Œå¿…é¡»æ˜¯æŒ‡é’ˆç±»å‹ å®¢æˆ·ç«¯è°ƒç”¨ rpc/client_main.go\npackage main import ( \u0026#34;let_go/rpc/server\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/rpc\u0026#34; ) func main(){ client, err := rpc.Dial(\u0026#34;tcp\u0026#34;, \u0026#34;localhost:1234\u0026#34;) if err != nil { log.Fatalf(\u0026#34;RPC dial error: %s\u0026#34;, err) } args := server.GreetServiceArgs{Name: \u0026#34;Mike\u0026#34;} var reply string err = client.Call(\u0026#34;GreetService.Greet\u0026#34;, args, \u0026amp;reply) if err != nil { log.Fatalf(\u0026#34;RPC call error: %s\u0026#34;, err) } log.Printf(\u0026#34;RPC reply: [%s]\u0026#34;, reply) } é€šè¿‡ rpc.Dial å»ºç«‹è·Ÿ rpc æœåŠ¡ç«¯çš„è¿æ¥ï¼Œå¡«å†™æ­£ç¡®çš„IPå’Œç«¯å£ æ„é€ å‚æ•° args å’Œè¿”å›å€¼ reply ä½¿ç”¨ rpc.Call è°ƒç”¨è¿œç¨‹rpcæ–¹æ³•ï¼Œä¼ å…¥3ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æœåŠ¡çš„æ–¹æ³•ï¼Œæ–°å¼ä¸º ServiceName.Methodï¼Œæˆ‘ä»¬åœ¨å‰é¢æ³¨å†Œäº†ä¸€ä¸ª GreetServiceï¼Œè¿™ä¸ªserviceæœ‰ä¸€ä¸ªæ–¹æ³• Greetï¼Œå› æ­¤æˆ‘ä»¬é€šè¿‡å®¢æˆ·ç«¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ˜¯ GreetService.Greetï¼Œåé¢ä¸¤ä¸ªå‚æ•°åˆ†åˆ«ä¸ºæ–¹æ³•çš„å‚æ•°å€¼å’Œè¿”å›å€¼ã€‚ è¿”å›å€¼å¿…é¡»æ˜¯ä¸€ä¸ªæŒ‡é’ˆ è¿è¡ŒæœåŠ¡ç«¯ï¼Œç„¶åè¿è¡Œå®¢æˆ·ç«¯ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š\næœåŠ¡ç«¯ï¼š\n2022/03/30 14:43:17 Greeting to [Mike] å®¢æˆ·ç«¯ï¼š\n2022/03/30 14:43:17 RPC reply: [Hello, Mike, you are using go rpc, have a good day!] åŸºäº HTTP çš„RPC go rpc å·²ç»æ”¯æŒäº†httpåè®®è¿›è¡Œè°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•å¯¹ä¹‹å‰çš„ä»£ç è¿›è¡Œä¿®æ”¹ï¼š\nrpc/server_main.go\nfunc main() { if err := rpc.RegisterName(\u0026#34;GreetService\u0026#34;, new(server.GreetService)); err != nil { log.Fatalf(\u0026#34;Register rpc service error: %s\u0026#34;, err) } rpc.HandleHTTP()\t// æ–°å¢ä¸€è¡Œ l, e := net.Listen(\u0026#34;tcp\u0026#34;, \u0026#34;:1234\u0026#34;) if e != nil { log.Fatalf(\u0026#34;Server error: %s\u0026#34;, e) } //rpc.Accept(l) http.Serve(l, nil)\t// ä¿®æ”¹ä¸º http æœåŠ¡ } å®¢æˆ·ç«¯çš„è°ƒç”¨æ›´åŠ ç®€å•ï¼Œç›´æ¥å°† rpc.Dail æ”¹ä¸º rpc.DailHTTP å³å¯\nrpc/client_main.go\nfunc main(){ //client, err := rpc.Dial(\u0026#34;tcp\u0026#34;, \u0026#34;localhost:1234\u0026#34;) client, err := rpc.DialHTTP(\u0026#34;tcp\u0026#34;, \u0026#34;localhost:1234\u0026#34;) // ... } é‡æ–°è¿è¡Œä»£ç ï¼Œè¾“å‡ºç»“æœæ˜¯ä¸€æ ·çš„ã€‚\nä½¿ç”¨åŸºäºhttpçš„rpcä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥è¿æ¥ http://localhost:1234/debug/rpc å³å¯æŸ¥çœ‹æˆ‘ä»¬å®šä¹‰çš„rpcæœåŠ¡\nè¿”å›æ³¨å†Œçš„RPCæœåŠ¡ã€æ–¹æ³•ç­¾åã€è¢«è°ƒç”¨æ¬¡æ•°ç­‰ä¿¡æ¯\nJSON RPCè·¨å¹³å°é€šä¿¡ ä¸Šè¿°å®ç°çš„rpcæ˜¯é€šè¿‡ encoding/gob æ–¹æ³•ç¼–è§£ç çš„ï¼Œè€Œåœ¨è·¨å¹³å°è°ƒç”¨çš„æ—¶å€™ï¼Œå…¶ä»–è¯­è¨€å¯¹å…¶è¿›è¡Œè§£ç ä¼šæ¯”è¾ƒå›°éš¾ã€‚\nåŸºäºTCPçš„ JSON RPC é€‰æ‹©é€šç”¨çš„ç¼–ç æ˜¯å®ç°è·¨è¯­è¨€RPCæœåŠ¡çš„æ ¸å¿ƒï¼Œæ¯”å¦‚JSONç¼–ç ï¼Œgoè¯­è¨€ä¸ºæˆ‘ä»¬æä¾›äº†æ”¯æŒjsonçš„rpcåŒ…ï¼šnet/rpc/jsonrpc\nå¯¹å‰é¢çš„æœåŠ¡ç«¯ä»£ç è¿›è¡Œæ”¹é€ ï¼š\nrpc/server_main.go\nfunc main() { if err := rpc.RegisterName(\u0026#34;GreetService\u0026#34;, new(server.GreetService)); err != nil { log.Fatalf(\u0026#34;Register rpc service error: %s\u0026#34;, err) } l, e := net.Listen(\u0026#34;tcp\u0026#34;, \u0026#34;:1234\u0026#34;) if e != nil { log.Fatalf(\u0026#34;Server error: %s\u0026#34;, e) } for { conn, err := l.Accept() if err != nil { log.Fatalf(\u0026#34;Tcp accept error: %s\u0026#34;, err) return } go jsonrpc.ServeConn(conn) } } åªæ˜¯ç®€å•çš„é€šè¿‡ l.Accept è·å–å½“å‰è¿æ¥ï¼Œç„¶åå°†è¿æ¥äº¤ç»™ jsonrpc.ServeConn è¿›è¡Œå¤„ç†\nå®¢æˆ·ç«¯è°ƒç”¨ï¼š\nfunc main(){ // rpc.Dial --\u0026gt; jsonrpc.Dial client, err := jsonrpc.Dial(\u0026#34;tcp\u0026#34;, \u0026#34;localhost:1234\u0026#34;)\t// ... } ç›´æ¥ä½¿ç”¨ jsonrpc.Dial æ›¿æ¢ rpc.Dialå³å¯\nåŸºäºHTTPçš„JSON RPC æœåŠ¡ç«¯æ”¹é€ \nrpc/server_main.go\nfunc main() { if err := rpc.RegisterName(\u0026#34;GreetService\u0026#34;, new(server.GreetService)); err != nil { log.Fatalf(\u0026#34;Register rpc service error: %s\u0026#34;, err) } // å®ç°æ ¸å¿ƒï¼Œä½¿ç”¨ http.HandleFunc æ³¨å†Œä¸€ä¸ªå¤„ç†rpcçš„handler http.HandleFunc(rpc.DefaultRPCPath, func(rw http.ResponseWriter, r *http.Request){ conn, _, err := rw.(http.Hijacker).Hijack() if err != nil { log.Printf(\u0026#34;Error hijack from addr[%s], err: %s\u0026#34;, r.RemoteAddr, err) return } fmt.Fprintf(conn, \u0026#34;HTTP/1.0 200 Connected to JSON RPC\\n\\n\u0026#34;) jsonrpc.ServeConn(conn) }) l, e := net.Listen(\u0026#34;tcp\u0026#34;, \u0026#34;:1234\u0026#34;) if e != nil { log.Fatalf(\u0026#34;Server error: %s\u0026#34;, e) } http.Serve(l, nil) } æœåŠ¡å™¨ä»£ç ï¼Œé€šè¿‡ http.HandleFuncæ³¨å†Œä¸€ä¸ªrpcçš„è·¯å¾„å¤„ç†å‡½æ•°ï¼Œç„¶åé€šè¿‡ http.Hijacker.Hijack()åŠ«æŒè¿æ¥ï¼Œå†äº¤ç»™ jsonrpcå¤„ç†ï¼Œå¦‚åŒåŸºäºtcpçš„jsonrpcå®ç°ä¸€èˆ¬ã€‚\nå®¢æˆ·ç«¯ä»£ç è°ƒæ•´\nrpc/client_main.go\nfunc main(){ client, err := DialHTTP(\u0026#34;tcp\u0026#34;, \u0026#34;localhost:1234\u0026#34;) if err != nil { log.Fatalf(\u0026#34;RPC dial error: %s\u0026#34;, err) } args := server.GreetServiceArgs{Name: \u0026#34;Mike\u0026#34;} var reply string err = client.Call(\u0026#34;GreetService.Greet\u0026#34;, args, \u0026amp;reply) if err != nil { log.Fatalf(\u0026#34;RPC call error: %s\u0026#34;, err) } log.Printf(\u0026#34;RPC reply: [%s]\u0026#34;, reply) } func DialHTTP(network, address string) (*rpc.Client, error) { return DialHTTPPath(network, address, rpc.DefaultRPCPath) } // ä» rpc.DialHTTPPath æ”¹é€ è€Œæ¥ func DialHTTPPath(network, address, path string) (*rpc.Client, error) { var err error // å»ºç«‹TCPè¿æ¥ conn, err := net.Dial(network, address) if err != nil { return nil, err } // å†™å…¥è¯·æ±‚å¤´ fmt.Fprintf(conn, \u0026#34;GET %s HTTP/1.0\\n\\n\u0026#34;, path) // è¯»å–httpå“åº”ä½“ resp, err := http.ReadResponse(bufio.NewReader(conn), \u0026amp;http.Request{Method: \u0026#34;GET\u0026#34;}) if err == nil{ // å¦‚æœæœåŠ¡ç«¯è¿”å›äº† \u0026#34;200 Connected to JSON RPC\u0026#34; è¯´æ˜è¿æ¥æˆåŠŸ if resp.Status == \u0026#34;200 Connected to JSON RPC\u0026#34; { // ç›´æ¥ä»å½“å‰è¿æ¥åˆ›å»º jsonRpcClient å³å¯ return jsonrpc.NewClient(conn), nil } return nil, errors.New(\u0026#34;Http response error, status=\u0026#34; + resp.Status) } conn.Close() return nil, \u0026amp;net.OpError{ Op: \u0026#34;dial-http\u0026#34;, Net: network + \u0026#34; \u0026#34; + address, Addr: nil, Err: err, } } è¯´æ˜¯åŸºäº http çš„ rpcè°ƒç”¨ï¼Œå®é™…ä¸Šå¯ä»¥ç§°ä½œæ˜¯æŠ«ç€httpå¤–çš®åŸç”Ÿjsonrpcè°ƒç”¨ï¼Œæ‰€ç”¨åˆ°httpçš„åœ°æ–¹ï¼Œä¸è¿‡æ˜¯è¯·æ±‚äº†ä¸€ä¸ªhttpåœ°å€ï¼Œè·å–æ­£ç¡®çš„è¿æ¥ï¼Œç„¶åå°±æ˜¯æ­£å¸¸çš„jsonrpcè°ƒç”¨çš„é€šä¿¡æµç¨‹ã€‚\nä¸Šè¿°æ”¹åŠ¨ï¼Œé€šè¿‡ä¿®æ”¹ rpc.DialHTTPPathæ–¹æ³•ï¼Œè¯·æ±‚æœåŠ¡ç«¯åœ°å€ï¼Œè·å–ä¸€ä¸ªrpcè¿æ¥ï¼Œç„¶åå®ç°jsonrpcé€šä¿¡ã€‚\nè·¨å¹³å°ï¼Œä½¿ç”¨pythonè°ƒç”¨åŸºäºhttpçš„jsonrpcæœåŠ¡ åªè¦ç¬¦åˆjsonrpcé€šä¿¡è§„èŒƒï¼Œå…¶ä»–è¯­è¨€å¯ä»¥è°ƒç”¨goçš„rpcæœåŠ¡ï¼Œä»¥pythonä¸ºä¾‹ï¼Œè°ƒç”¨ä¸Šè¿°åŸºäºhttpçš„jsonrpcæœåŠ¡ï¼Œä¸Šä»£ç ï¼š\ntest_go_jsonrpc.py\nimport json, socket # å»ºç«‹tcpè¿æ¥ s = socket.create_connection((\u0026#34;localhost\u0026#34;, 1234)) # å‘é€httpè¯·æ±‚ï¼ŒæˆåŠŸåæ‰èƒ½å‘èµ·jsonrpcé€šä¿¡ req_body = \u0026#39;\u0026#39;\u0026#39;GET /_goRPC_ HTTP/1.0\\n\\n\u0026#39;\u0026#39;\u0026#39; s.sendall(req_body.encode()) print((s.recv(4096)).decode()) # rpcè°ƒç”¨å‚æ•°ï¼Œidç”¨ä»¥åŒºåˆ†è¿”å›å†…å®¹ï¼Œå¦å¤–åŒ…å«ï¼š # methodå‚æ•°ï¼šéœ€è¦è°ƒç”¨çš„æ–¹æ³•åç§° # paramså‚æ•°ï¼šå‚æ•°åˆ—è¡¨ï¼ŒæœåŠ¡ç«¯å®šä¹‰çš„æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œè¿™é‡Œéœ€è¦æ˜¯ä¸€ä¸ªå¯ä»¥è®©go unmarshalä¸ºå¯¹åº”çš„å‚æ•°ç»“æ„ä½“çš„jsonå¯¹è±¡ rpc_params = dict( id=2, method=\u0026#34;GreetService.Greet\u0026#34;, params=[{\u0026#34;Name\u0026#34;: \u0026#34;python\u0026#34;}], ) s.sendall(json.dumps(rpc_params).encode()) print((s.recv(4096)).decode()) è¿è¡Œä¸Šè¿°pythonä»£ç ï¼Œå¯ä»¥çœ‹åˆ°è¿”å›ï¼š\n\u0026gt;python test_go_jsonrpc.py HTTP/1.0 200 Connected to JSON RPC {\u0026#34;id\u0026#34;:2,\u0026#34;result\u0026#34;:\u0026#34;Hello, python, you are using go rpc, have a good day!\u0026#34;,\u0026#34;error\u0026#34;:null} é¦–å…ˆæ˜¯httpè¯·æ±‚ï¼Œè¿”å›äº†æ­£ç¡®çš„headerï¼š HTTP/1.0 200 Connected to JSON RPCï¼Œè¯´æ˜æ¥ä¸‹æ¥å¯ä»¥è¿›è¡Œjsonrpcé€šä¿¡äº†\nç„¶åæ˜¯jsonrpcé€šä¿¡çš„è¿”å›ç»“æœï¼Œä½¿ç”¨jsonè§£ç åï¼Œå¾—åˆ°ä¸€ä¸ªjsonå­—ç¬¦ä¸²ï¼Œå…¶ä¸­æœ‰ä¸‰ä¸ªå­—æ®µï¼š\nidï¼š æˆ‘ä»¬å‘èµ·è¯·æ±‚å‚æ•°é‡Œé¢çš„id resultï¼šrpcè°ƒç”¨çš„è¿”å›ç»“æœ errorï¼šè°ƒç”¨rpcäº§ç”Ÿçš„é”™è¯¯ ","permalink":"https://zihuanling.github.io/posts/go-rpc-server/","summary":"\u003ch2 id=\"rpc\"\u003eRPC\u003c/h2\u003e\n\u003cp\u003eRPC  - Remote Procedure Call  ç§°ä¸ºè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸åŒèŠ‚ç‚¹è°ƒç”¨çš„æ–¹å¼ï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰ï¼Œå±äº C/S æ¨¡å¼ã€‚ç”±å®¢æˆ·ç«¯å‘èµ·ï¼Œè°ƒç”¨æœåŠ¡ç«¯çš„æ–¹æ³•è¿›è¡Œé€šä¿¡ï¼ŒæœåŠ¡ç«¯å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚\u003c/p\u003e\n\u003cp\u003eRPCçš„ä¸¤ä¸ªæ ¸å¿ƒï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eé€šä¿¡åè®®\u003c/li\u003e\n\u003cli\u003eåºåˆ—åŒ–\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eåºåˆ—åŒ–\u003c/strong\u003eå’Œ\u003cstrong\u003eååºåˆ—åŒ–\u003c/strong\u003eæ˜¯ä¸€ç§æŠŠä¼ è¾“å†…å®¹ç¼–ç å’Œè§£ç çš„æ–¹å¼ï¼Œå¸¸è§çš„ç¼–è§£ç æ–¹å¼æœ‰ JSONã€Protobuf ç­‰ã€‚\u003c/p\u003e\n\u003cp\u003eå¤§å¤šæ•° RPC æ¶æ„ä¸­ï¼Œéƒ½æœ‰ \u003cstrong\u003eClientã€Client Stubã€Serverã€Server Stub\u003c/strong\u003eè¿™å››ä¸ªç»„ä»¶ï¼ŒClient å’Œ Server é€šè¿‡ \u003cstrong\u003eSocket\u003c/strong\u003e è¿›è¡Œé€šä¿¡ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-mermaid\" data-lang=\"mermaid\"\u003eflowchart LR\nsubgraph æœåŠ¡ç«¯è¿›ç¨‹\ns(Server)\nss(Server Stub)\ns --è°ƒç”¨--\u0026gt; ss\nss --è¿”å›--\u0026gt; s\nend\nsubgraph å®¢æˆ·ç«¯è¿›ç¨‹\nc(Client)\ncs(Client Stub)\nc --è°ƒç”¨--\u0026gt; cs\ncs --è¿”å›--\u0026gt; c\nend\nå®¢æˆ·ç«¯è¿›ç¨‹ ==ç½‘ç»œæ¶ˆæ¯==\u0026gt; æœåŠ¡ç«¯è¿›ç¨‹\næœåŠ¡ç«¯è¿›ç¨‹ ==\u0026gt; å®¢æˆ·ç«¯è¿›ç¨‹\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eè°ƒç”¨æµç¨‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eclient è°ƒç”¨ client stubï¼ŒåŒæ—¶æŠŠå‚æ•°ä¼ ç»™ client stub\u003c/li\u003e\n\u003cli\u003eclient stubå°†å‚æ•°æ‰“åŒ…ç¼–ç ï¼Œç„¶åé€šè¿‡ç³»ç»Ÿè°ƒç”¨å‘é€åˆ°æœåŠ¡ç«¯è¿›ç¨‹\u003c/li\u003e\n\u003cli\u003eå®¢æˆ·ç«¯æœ¬åœ°ç³»ç»Ÿå‘é€ä¿¡æ¯åˆ°æœåŠ¡å™¨\u003c/li\u003e\n\u003cli\u003eæœåŠ¡å™¨ç³»ç»Ÿå°†ä¿¡æ¯å‘é€åˆ° server stub\u003c/li\u003e\n\u003cli\u003eserver stub å°†ä¿¡æ¯è§£ç \u003c/li\u003e\n\u003cli\u003eserver stub è°ƒç”¨çœŸæ­£çš„æœåŠ¡ç«¯ç¨‹åº server\u003c/li\u003e\n\u003cli\u003eserver å¤„ç†åï¼Œé€šè¿‡åŒæ ·çš„æ–¹å¼ï¼Œå°†ç»“æœè¿”å›åˆ° client\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"go-å®ç°ç®€å•çš„rpcæœåŠ¡\"\u003ego å®ç°ç®€å•çš„RPCæœåŠ¡\u003c/h2\u003e\n\u003cp\u003egoå†…ç½®äº† \u003ccode\u003enet/rpc\u003c/code\u003e åŒ…å¸®åŠ©æˆ‘ä»¬å®ç°rpcæœåŠ¡ã€‚\u003c/p\u003e","title":"Goï¼šç®€å•çš„è·¨å¹³å°rpcæœåŠ¡"},{"content":"ç®€æ˜“ http æœåŠ¡ ä½¿ç”¨ go è‡ªå¸¦çš„ http æ¨¡å—å®ç°ä¸€ä¸ªç®€å•çš„ http æœåŠ¡å™¨ï¼Œå¯¹è¯·æ±‚è€…è¯´ä¸€å¥ Hello, go http!\nfunc main(){ http.HandleFunc(\u0026#34;/hello\u0026#34;, sayHello) http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil) } func sayHello(resp http.ResponseWriter, req *http.Request) { log.Println(\u0026#34;In say hello\u0026#34;) resp.WriteHeader(http.StatusOK) resp.Write([]byte(\u0026#34;Hello, go http!\u0026#34;)) } è¿è¡Œä¸Šè¿°ä»£ç ï¼Œåœ¨ç»ˆç«¯ä½¿ç”¨ curl è®¿é—®è¯¥åœ°å€ï¼Œè¿”å›æ­£å¸¸ï¼š\n\u0026gt;curl http://localhost:8080/hello Hello, go http! ä¸”ç¨‹åºä½¿ç”¨ log æ‰“å°äº†ä¸€å¥ï¼š 2022/03/27 15:32:48 In say hello\nä½†æ˜¯ï¼Œæˆ‘ä»¬çš„httpæ–¹æ³•æœ‰å¾ˆå¤šï¼Œ GET/POST/PUT/PATCH/DELETE ç­‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»»æ„ä¸€ä¸ªæ–¹æ³•ï¼Œè®¿é—®ä¸Šè¿°åœ°å€ï¼Œéƒ½èƒ½å¾—åˆ° Hello, go http! è¿™å¥è¿”å›ï¼Œå¦‚ POST:\n\u0026gt;curl -X POST http://localhost:8080/hello Hello, go http! http.Request è¿™ä¸ªç»“æ„ä½“ä¸­ï¼ŒåŒ…å«äº†ä¸€ä¸ª Method å­—æ®µï¼Œè®©æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒçš„æ–¹æ³•ï¼Œå†³å®šä¸åŒçš„å¤„ç†æ–¹å¼ï¼Œæˆ‘ä»¬å°† sayHello æ–¹æ³•æ”¹é€ å¦‚ä¸‹ï¼š\nfunc sayHello(resp http.ResponseWriter, req *http.Request) { log.Println(\u0026#34;In say hello\u0026#34;) switch req.Method { case \u0026#34;GET\u0026#34;: fmt.Fprintln(resp, \u0026#34;GET: Hello, go http!\u0026#34;) case \u0026#34;POST\u0026#34;: fmt.Fprintln(resp, \u0026#34;POST: Hello, go http!\u0026#34;) default: resp.WriteHeader(http.StatusNotFound) fmt.Fprintln(resp, \u0026#34;Not found\u0026#34;) } } è¯·æ±‚è¾“å‡ºï¼š\n\u0026gt;curl http://localhost:8080/hello GET: Hello, go http! \u0026gt;curl -X POST http://localhost:8080/hello POST: Hello, go http! \u0026gt;curl -X PUT http://localhost:8080/hello Not found åŸºäº gin æ¡†æ¶çš„ RESTFUL API æœåŠ¡ è™½ç„¶goè‡ªå¸¦çš„net/httpåŒ…å¯ä»¥æ–¹ä¾¿çš„åˆ›å»ºHTTPæœåŠ¡ï¼Œä½†æ˜¯å…¶åŒ…å«ä»¥ä¸‹ä¸è¶³ï¼š\nä¸èƒ½å•ç‹¬åœ°å¯¹è¯·æ±‚æ–¹æ³•ï¼ˆPOST/GETç­‰ï¼‰æ³¨å†Œç‰¹å®šçš„å¤„ç†å‡½æ•° ä¸æ”¯æŒ path å˜é‡å‚æ•° ä¸èƒ½è‡ªåŠ¨å¯¹ path è¿›è¡Œæ ¡å‡† æ€§èƒ½ä¸€èˆ¬ æ‰©å±•æ€§ä¸è¶³ ã€‚ã€‚ã€‚ ginæ˜¯ github ä¸Šå¼€æºçš„ä¸€ä¸ª go web æ¡†æ¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒ…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ go.mod è¿›è¡Œå¼•å…¥\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ginæ¡†æ¶å®ç°ä¸€ä¸ªç®€å•çš„ç”¨æˆ·æŸ¥è¯¢ç³»ç»Ÿ\nå¼•å…¥ ginæ¡†æ¶ å®‰è£…å‘½ä»¤ï¼š\ngo get github.com/gin-gonic/gin å¼•å…¥ï¼š\nimport \u0026#34;github.com/gin-gonic/gin\u0026#34; ä½¿ç”¨ginæ¡†æ¶ ä½¿ç”¨ginæ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„è¿™æ ·å†™ï¼š\nfunc main(){ engine := gin.Default() engine.Run(\u0026#34;:8080\u0026#34;) } gin.Default()æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª gin Engine å®ä¾‹ï¼Œæˆ‘ä»¬è°ƒç”¨è¿™ä¸ª å®ä¾‹çš„ Runæ–¹æ³•ï¼Œä¼ å…¥ç›‘å¬çš„åœ°å€ï¼Œå°±å¯ä»¥å®ç°ä¸€ä¸ªç®€å•çš„ginæœåŠ¡ã€‚\nå¤„ç†å…·ä½“è·¯å¾„çš„è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ engine.Handleæ–¹æ³•\nå®šä¹‰ User ç»“æ„ä½“ï¼š type User struct { ID uint\t`json:\u0026#34;id\u0026#34;` Age uint\t`json:\u0026#34;age\u0026#34;` Name string\t`json:\u0026#34;name\u0026#34;` } // åˆå§‹ç”¨æˆ·åˆ—è¡¨ var userList []User = []User{ {1, 19, \u0026#34;Mike\u0026#34;}, {2, 20, \u0026#34;Jack\u0026#34;} } ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·Userçš„åŸºæœ¬æ¥å£ï¼ŒåŒ…å«å­—æ®µ ID, Age, Nameï¼Œ ç„¶åå®šä¹‰äº† json struct tagï¼Œè®©ginè¿”å›çš„jsonå­—æ®µå°å†™ã€‚\nè·å–ç”¨æˆ·åˆ—è¡¨ æˆ‘ä»¬æ¥ä¸‹æ¥å®ç°ä¸€ä¸ª GET æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¯·æ±‚è·¯å¾„ /usersï¼Œè¿”å›æ‰€æœ‰çš„ç”¨æˆ·åˆ—è¡¨ï¼š\n// è·å–ç”¨æˆ·åˆ—è¡¨ func getAllUsers(c *gin.Context) { log.Println(\u0026#34;Getting user list\u0026#34;) c.JSON(http.StatusOK, userList) } éå¸¸ç®€å•ï¼ŒgetAllUsers æ˜¯ä¸€ä¸ªHandlerï¼Œ æ¥æ”¶ä¸€ä¸ª *gin.Contestç±»å‹çš„å‚æ•°ï¼Œåœ¨è¿™ä¸ªHandleré‡Œé¢ï¼Œæˆ‘ä»¬ç›´æ¥å°†ç”¨æˆ·åˆ—è¡¨userListè¿”å›ï¼Œä½¿ç”¨ c.JSONæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š\nç¬¬ä¸€ä¸ªæ˜¯ httpçŠ¶æ€ç  ç¬¬äºŒä¸ªæ˜¯è¦è¿”å›çš„å¯¹è±¡ è¿™ä¸ªæ–¹æ³•ä¼šè‡ªåŠ¨å°†è¿”å›å¯¹è±¡åºåˆ—åŒ–æˆä¸ºJsonå­—ç¬¦ä¸²\nå®Œæˆäº†ä¸€ä¸ªHandlerï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥åœ¨ginä¸­æ³¨å†Œè¿™ä¸ªHandler\nmain.go\nfunc main(){ engine := gin.Default() engine.Handle(http.MethodGet, \u0026#34;/users\u0026#34;, getAllUsers) engine.Run(\u0026#34;:8080\u0026#34;) } è¿è¡Œä¸Šè¿°ç¨‹åºï¼Œç„¶ååœ¨ç»ˆç«¯æµ‹è¯•ï¼š\n\u0026gt;curl http://localhost:8080/users [{\u0026#34;id\u0026#34;:1,\u0026#34;age\u0026#34;:19,\u0026#34;name\u0026#34;:\u0026#34;Mike\u0026#34;},{\u0026#34;id\u0026#34;:2,\u0026#34;age\u0026#34;:20,\u0026#34;name\u0026#34;:\u0026#34;Jack\u0026#34;}] å¯ä»¥çœ‹åˆ°ï¼Œæ­£å¸¸è¿”å›äº†ç”¨æˆ·åˆ—è¡¨\næŸ¥è¯¢å…·ä½“ç”¨æˆ· // æŸ¥è¯¢ç”¨æˆ· func queryUser(c *gin.Context) { id := c.Param(\u0026#34;id\u0026#34;) log.Printf(\u0026#34;Querying user with id = %s\u0026#34;, id) for _, u := range userList { if strings.EqualFold(id, strconv.Itoa(int(u.ID))) { log.Printf(\u0026#34;Found user: %v\u0026#34;, u) c.JSON(http.StatusOK, u) return } } log.Printf(\u0026#34;User %s not found\u0026#34;, id) c.JSON(http.StatusNotFound, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;user not found.\u0026#34;, }) } æˆ‘ä»¬å®ç°äº†ä¸€ä¸ª queryUser handlerï¼Œè¿™ä¸ªhandlerå¤„ç†çš„æ–¹æ³•æ˜¯ GETï¼Œè¯·æ±‚çš„apiæ˜¯ /users/:id é‡Œé¢çš„ id æ˜¯è·¯å¾„å‚æ•°ï¼Œåœ¨ginä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ c.Param() æ–¹æ³•ï¼Œè·å–è·¯å¾„å‚æ•°ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª stringç±»å‹çš„å˜é‡ï¼Œæˆ‘ä»¬ç”¨å®šä¹‰çš„ IDå­—æ®µæ˜¯ uint ç±»å‹çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ strconv.Itoa å¯¹å…¶è¿›è¡Œä¸€ä¸ªè½¬æ¢ï¼Œç„¶åé€šè¿‡å¯¹æ¯”æŸ¥æ‰¾å¯¹åº”çš„ç”¨æˆ·ã€‚\næ‰¾åˆ°å¯¹åº”çš„ç”¨æˆ·ä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡ c.JSON è¿”å›ç”¨æˆ·ï¼Œå¦åˆ™ï¼Œæˆ‘ä»¬è¿”å›ä¸€ä¸ª 404 Not Found\né‡Œé¢ç”¨åˆ°çš„ gin.H æœ¬è´¨æ˜¯ä¸€ä¸ª map[string]interface{} ç±»å‹ï¼Œç”¨æ¥æ–¹ä¾¿è¿”å›ä¸€äº›ä¿¡æ¯\nåœ¨ mainä¸­æ³¨å†Œæ–°çš„Handlerï¼š\nfunc main(){ //... engine.Handle(http.MethodGet, \u0026#34;/users/:id\u0026#34;, queryUser) //... } è¿è¡Œç¨‹åºåï¼Œæµ‹è¯•ï¼š\n\u0026gt;curl http://localhost:8080/users/1 {\u0026#34;id\u0026#34;:1,\u0026#34;age\u0026#34;:19,\u0026#34;name\u0026#34;:\u0026#34;Mike\u0026#34;}\t# æŸ¥è¯¢åˆ°idä¸º1çš„ç”¨æˆ· \u0026gt;curl http://localhost:8080/users/3\t# idä¸º3çš„ç”¨æˆ·ä¸å­˜åœ¨ {\u0026#34;message\u0026#34;:\u0026#34;user not found.\u0026#34;} å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç”¨æˆ·å­˜åœ¨æˆ–ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œéƒ½å¯ä»¥æ­£å¸¸è¿”å›\nåˆ›å»ºæ–°ç”¨æˆ· // åˆ›å»ºç”¨æˆ· func createUser(c *gin.Context) { var name string var age uint if name_, ok := c.GetPostForm(\u0026#34;name\u0026#34;); !ok { msg := \u0026#34;[name] field missed.\u0026#34; log.Println(msg) c.JSON(http.StatusBadRequest, gin.H{\u0026#34;message\u0026#34;: msg}) return } else { name = name_ } if age_, ok := c.GetPostForm(\u0026#34;age\u0026#34;); !ok { msg := \u0026#34;[age] field missed.\u0026#34; log.Println(msg) c.JSON(http.StatusBadRequest, gin.H{\u0026#34;message\u0026#34;: msg}) return } else { _age, err := strconv.Atoi(age_) if err != nil { c.JSON(http.StatusBadRequest, gin.H{\u0026#34;message\u0026#34;: \u0026#34;Invalid age: \u0026#34; + age_}) return } age = uint(_age) } // find last ID var lastID uint = userList[len(userList) - 1].ID // create user newUser := User{ID: lastID+1, Age: age, Name: name} userList = append(userList, newUser) c.JSON(http.StatusOK, gin.H{\u0026#34;message\u0026#34;: \u0026#34;ok, new user id : \u0026#34; + strconv.Itoa(int(newUser.ID))}) log.Printf(\u0026#34;New user created, id = %d\u0026#34;, newUser.ID) } åˆ›å»ºç”¨æˆ·ï¼Œæˆ‘ä»¬é€šè¿‡ POSTæ–¹æ³•ï¼Œè¯·æ±‚ /users ï¼Œä¼ å…¥çš„å‚æ•°æœ‰ä¸¤ä¸ªå­—æ®µï¼š nameï¼Œageã€‚\nginæ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ c.GetPostForm æ–¹æ³•ï¼Œè·å–POSTæ–¹æ³•é‡Œé¢çš„å†…å®¹ï¼Œè¿”å› string, boolï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿”å›çš„flagï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¼ äº†å¯¹åº”çš„å€¼ï¼Œä»¥å®ç°ç‰¹å®šçš„é€»è¾‘ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ c.DefaultPostForm, åœ¨è·å–ä¸åˆ°æŒ‡å®šå€¼çš„æƒ…å†µä¸‹ï¼Œè¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚\nç„¶åé€šè¿‡å–åˆ°æœ€åä¸€ä¸ªç”¨æˆ·çš„IDï¼Œç”Ÿæˆä¸‹ä¸€ä¸ªç”¨æˆ·çš„IDï¼Œå®ç°è‡ªå¢ã€‚ï¼ˆå…¶å®è¿™æ ·æœ‰å¾ˆå¤§çš„ç¼ºé™·ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ é™¤äº†æœ€åä¸€ä¸ªç”¨æˆ·ä¹‹åï¼Œæ–°å»ºçš„ç”¨æˆ·IDå¯èƒ½ä¼šè·Ÿåˆšåˆšåˆ é™¤çš„ç”¨æˆ·IDä¸€æ ·ï¼Œå¯¼è‡´å†²çªã€‚ï¼‰\næ³¨å†ŒHandlerï¼š\nfunc main(){ //... engine.Handle(http.MethodPost, \u0026#34;/users\u0026#34;, createUser) //... } è¿è¡Œã€æµ‹è¯•ï¼š\n\u0026gt;curl -X POST http://localhost:8080/users {\u0026#34;message\u0026#34;:\u0026#34;[name] field missed.\u0026#34;}\t# é”™è¯¯ï¼šä¸å¸¦nameå‚æ•° \u0026gt;curl -X POST http://localhost:8080/users -d \u0026#34;name=Jack\u0026#34; {\u0026#34;message\u0026#34;:\u0026#34;[age] field missed.\u0026#34;}\t# é”™è¯¯ï¼šä¸å¸¦ageå‚æ•° \u0026gt;curl -X POST http://localhost:8080/users -d \u0026#34;name=Jack\u0026#34; -d \u0026#34;age=aa\u0026#34; {\u0026#34;message\u0026#34;:\u0026#34;Invalid age: aa\u0026#34;}\t# é”™è¯¯çš„ age å‚æ•° \u0026gt;curl -X POST http://localhost:8080/users -d \u0026#34;name=Jack\u0026#34; -d \u0026#34;age=29\u0026#34; {\u0026#34;message\u0026#34;:\u0026#34;ok, new user id : 3\u0026#34;}\t# åˆ›å»ºæˆåŠŸï¼Œæ–°ç”¨æˆ·ID ä¸º 3 \u0026gt;curl http://localhost:8080/users\t# æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ï¼Œæ–°ç”¨æˆ·æˆåŠŸåˆ›å»º [{\u0026#34;id\u0026#34;:1,\u0026#34;age\u0026#34;:19,\u0026#34;name\u0026#34;:\u0026#34;Mike\u0026#34;},{\u0026#34;id\u0026#34;:2,\u0026#34;age\u0026#34;:20,\u0026#34;name\u0026#34;:\u0026#34;Jack\u0026#34;},{\u0026#34;id\u0026#34;:3,\u0026#34;age\u0026#34;:29,\u0026#34;name\u0026#34;:\u0026#34;Jack\u0026#34;}] ä¿®æ”¹ç”¨æˆ· // ä¿®æ”¹ç”¨æˆ· func modifyUser(c *gin.Context) { id := c.Param(\u0026#34;id\u0026#34;) var age int name := c.DefaultPostForm(\u0026#34;name\u0026#34;, \u0026#34;\u0026#34;) _age := c.DefaultPostForm(\u0026#34;age\u0026#34;, \u0026#34;\u0026#34;) // ä¸¤ä¸ªå¿…ä¼ å‚æ•° if name == \u0026#34;\u0026#34; || _age == \u0026#34;\u0026#34; { c.JSON(http.StatusBadRequest, gin.H{\u0026#34;message\u0026#34;: \u0026#34;[name] and [age] is required.\u0026#34;}) return } // string to int age, err := strconv.Atoi(_age) if err != nil { c.JSON(http.StatusBadRequest, gin.H{\u0026#34;message\u0026#34;: \u0026#34;Invalid age: \u0026#34; + _age}) return } log.Printf(\u0026#34;Modify user with id = %s\u0026#34;, id) // æŸ¥æ‰¾ç”¨æˆ·è¿›è¡Œä¿®æ”¹ for idx, u := range userList { if strings.EqualFold(id, strconv.Itoa(int(u.ID))) { log.Printf(\u0026#34;Found user: %v\u0026#34;, u) u.Name = name u.Age = uint(age) userList[idx] = u log.Printf(\u0026#34;User modified to: %v\u0026#34;, u) c.JSON(http.StatusOK, gin.H{\u0026#34;message\u0026#34;: \u0026#34;ok\u0026#34;}) return } } log.Printf(\u0026#34;User %s not found\u0026#34;, id) c.JSON(http.StatusNotFound, gin.H{\u0026#34;message\u0026#34;: \u0026#34;user not found.\u0026#34;}) } é€»è¾‘ç®€å•ï¼Œç›´æ¥ä»postæ–¹æ³•ä¼ è¿‡æ¥çš„æ•°æ®ä¸­ï¼Œè·å–nameå’Œageå­—æ®µï¼Œç„¶åæŸ¥æ‰¾å¯¹åº”çš„ç”¨æˆ·ï¼Œå¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œå½“ç”¨æˆ·ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œè¿”å› 404 Not Found\næ³¨å†Œ Handlerï¼š\nfunc main(){ //... engine.Handle(http.MethodPut, \u0026#34;/users/:id\u0026#34;, modifyUser) //... } è¿è¡Œï¼Œæµ‹è¯•ï¼š\n\u0026gt;curl http://localhost:8080/users\t# å½“å‰çš„ç”¨æˆ·åˆ—è¡¨ [{\u0026#34;id\u0026#34;:1,\u0026#34;age\u0026#34;:19,\u0026#34;name\u0026#34;:\u0026#34;Mike\u0026#34;},{\u0026#34;id\u0026#34;:2,\u0026#34;age\u0026#34;:20,\u0026#34;name\u0026#34;:\u0026#34;Jack\u0026#34;}] \u0026gt;curl -X PUT http://localhost:8080/users/4 -d \u0026#34;name=Amy\u0026#34;\t# å‚æ•°ç¼ºå¤± {\u0026#34;message\u0026#34;:\u0026#34;[name] and [age] is required.\u0026#34;} \u0026gt;curl -X PUT http://localhost:8080/users/4 -d \u0026#34;name=Amy\u0026#34; -d \u0026#34;age=10\u0026#34;\t# id=4çš„ç”¨æˆ·ä¸å­˜åœ¨ {\u0026#34;message\u0026#34;:\u0026#34;user not found.\u0026#34;} \u0026gt;curl -X PUT http://localhost:8080/users/2 -d \u0026#34;name=Amy\u0026#34; -d \u0026#34;age=10\u0026#34;\t# ä¿®æ”¹æˆåŠŸ {\u0026#34;message\u0026#34;:\u0026#34;ok\u0026#34;} \u0026gt;curl http://localhost:8080/users [{\u0026#34;id\u0026#34;:1,\u0026#34;age\u0026#34;:19,\u0026#34;name\u0026#34;:\u0026#34;Mike\u0026#34;},{\u0026#34;id\u0026#34;:2,\u0026#34;age\u0026#34;:10,\u0026#34;name\u0026#34;:\u0026#34;Amy\u0026#34;}]\t# ä¿®æ”¹æˆåŠŸåçš„ç”¨æˆ·åˆ—è¡¨ å¯ä»¥çœ‹åˆ°ï¼Œè¡¨ç°ç¬¦åˆé¢„æœŸã€‚\nåˆ é™¤ç”¨æˆ· // åˆ é™¤ç”¨æˆ· func deleteUser(c *gin.Context) { id := c.Param(\u0026#34;id\u0026#34;) log.Printf(\u0026#34;Querying user with id = %s\u0026#34;, id) for idx, u := range userList { if strings.EqualFold(id, strconv.Itoa(int(u.ID))) { log.Printf(\u0026#34;Deleting user: %v\u0026#34;, u) for ; idx \u0026lt; len(userList) - 1; idx++ { userList[idx] = userList[idx+1] } userList = userList[:len(userList) - 1] c.JSON(http.StatusOK, gin.H{\u0026#34;message\u0026#34;: \u0026#34;ok\u0026#34;}) return } } log.Printf(\u0026#34;User %s not found\u0026#34;, id) c.JSON(http.StatusNotFound, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;user not found.\u0026#34;, }) } è¿™é‡Œåˆ é™¤ç”¨æˆ·çš„é€»è¾‘ä¹Ÿæ˜¯å¾ˆç®€å•çš„ï¼šä»ä¼ å…¥çš„ç”¨æˆ·idé‡Œé¢æ‰¾åˆ°å½“å‰ç”¨æˆ·çš„ä½ç½®ï¼Œç„¶åä»æ•°ç»„é‡Œé¢å°†è¯¥ç”¨æˆ·åˆ é™¤æ‰å³å¯ã€‚\nè¿™é‡Œä½¿ç”¨çš„æ˜¯æ•°æ®è¦†ç›–ï¼Œå®é™…ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Mongoã€MySQLç­‰æ•°æ®å¼•æ“ï¼Œå®ç°CRUDæ“ä½œã€‚\nfunc main(){ //... engine.Handle(http.MethodDelete, \u0026#34;/users/:id\u0026#34;, deleteUser) //... } è¿è¡Œã€è°ƒè¯•ï¼š\n\u0026gt;curl http://localhost:8080/users [{\u0026#34;id\u0026#34;:1,\u0026#34;age\u0026#34;:19,\u0026#34;name\u0026#34;:\u0026#34;Mike\u0026#34;},{\u0026#34;id\u0026#34;:2,\u0026#34;age\u0026#34;:20,\u0026#34;name\u0026#34;:\u0026#34;Jack\u0026#34;}]\t# å½“å‰çš„æ‰€æœ‰ç”¨æˆ· \u0026gt;curl -X DELETE http://localhost:8080/users/2\t# åˆ é™¤ç¬¬äºŒä¸ªç”¨æˆ· {\u0026#34;message\u0026#34;:\u0026#34;ok\u0026#34;} \u0026gt;curl http://localhost:8080/users [{\u0026#34;id\u0026#34;:1,\u0026#34;age\u0026#34;:19,\u0026#34;name\u0026#34;:\u0026#34;Mike\u0026#34;}]\t# å‰©ä¸‹ä¸€ä¸ªç”¨æˆ· é™„ä»£ç ï¼š\npackage main import ( \u0026#34;github.com/gin-gonic/gin\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;strconv\u0026#34; \u0026#34;strings\u0026#34; ) func main(){ engine := gin.Default() engine.Handle(http.MethodGet, \u0026#34;/users\u0026#34;, getAllUsers) engine.Handle(http.MethodPost, \u0026#34;/users\u0026#34;, createUser) engine.Handle(http.MethodGet, \u0026#34;/users/:id\u0026#34;, queryUser) engine.Handle(http.MethodPut, \u0026#34;/users/:id\u0026#34;, modifyUser) engine.Handle(http.MethodDelete, \u0026#34;/users/:id\u0026#34;, deleteUser) engine.Run(\u0026#34;:8080\u0026#34;) } type User struct { ID uint\t`json:\u0026#34;id\u0026#34;` Age uint\t`json:\u0026#34;age\u0026#34;` Name string\t`json:\u0026#34;name\u0026#34;` } // åˆå§‹ç”¨æˆ·åˆ—è¡¨ var userList []User = []User{ {1, 19, \u0026#34;Mike\u0026#34;}, {2, 20, \u0026#34;Jack\u0026#34;} } // è·å–ç”¨æˆ·åˆ—è¡¨ func getAllUsers(c *gin.Context) { log.Println(\u0026#34;Getting user list\u0026#34;) c.JSON(http.StatusOK, userList) } // æŸ¥è¯¢ç”¨æˆ· func queryUser(c *gin.Context) { id := c.Param(\u0026#34;id\u0026#34;) log.Printf(\u0026#34;Querying user with id = %s\u0026#34;, id) for _, u := range userList { if strings.EqualFold(id, strconv.Itoa(int(u.ID))) { log.Printf(\u0026#34;Found user: %v\u0026#34;, u) c.JSON(http.StatusOK, u) return } } log.Printf(\u0026#34;User %s not found\u0026#34;, id) c.JSON(http.StatusNotFound, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;user not found.\u0026#34;, }) } // åˆ›å»ºç”¨æˆ· func createUser(c *gin.Context) { var name string var age uint if name_, ok := c.GetPostForm(\u0026#34;name\u0026#34;); !ok { msg := \u0026#34;[name] field missed.\u0026#34; log.Println(msg) c.JSON(http.StatusBadRequest, gin.H{\u0026#34;message\u0026#34;: msg}) return } else { name = name_ } if age_, ok := c.GetPostForm(\u0026#34;age\u0026#34;); !ok { msg := \u0026#34;[age] field missed.\u0026#34; log.Println(msg) c.JSON(http.StatusBadRequest, gin.H{\u0026#34;message\u0026#34;: msg}) return } else { _age, err := strconv.Atoi(age_) if err != nil { c.JSON(http.StatusBadRequest, gin.H{\u0026#34;message\u0026#34;: \u0026#34;Invalid age: \u0026#34; + age_}) return } age = uint(_age) } // find last ID var lastID uint = userList[len(userList) - 1].ID // create user newUser := User{ID: lastID+1, Age: age, Name: name} userList = append(userList, newUser) c.JSON(http.StatusOK, gin.H{\u0026#34;message\u0026#34;: \u0026#34;ok, new user id : \u0026#34; + strconv.Itoa(int(newUser.ID))}) log.Printf(\u0026#34;New user created, id = %d\u0026#34;, newUser.ID) } // ä¿®æ”¹ç”¨æˆ· func modifyUser(c *gin.Context) { id := c.Param(\u0026#34;id\u0026#34;) var age int name := c.DefaultPostForm(\u0026#34;name\u0026#34;, \u0026#34;\u0026#34;) _age := c.DefaultPostForm(\u0026#34;age\u0026#34;, \u0026#34;\u0026#34;) if name == \u0026#34;\u0026#34; || _age == \u0026#34;\u0026#34; { c.JSON(http.StatusBadRequest, gin.H{\u0026#34;message\u0026#34;: \u0026#34;[name] and [age] is required.\u0026#34;}) return } // string to int age, err := strconv.Atoi(_age) if err != nil { c.JSON(http.StatusBadRequest, gin.H{\u0026#34;message\u0026#34;: \u0026#34;Invalid age: \u0026#34; + _age}) return } log.Printf(\u0026#34;Modify user with id = %s\u0026#34;, id) for idx, u := range userList { if strings.EqualFold(id, strconv.Itoa(int(u.ID))) { log.Printf(\u0026#34;Found user: %v\u0026#34;, u) u.Name = name u.Age = uint(age) userList[idx] = u log.Printf(\u0026#34;User modified to: %v\u0026#34;, u) c.JSON(http.StatusOK, gin.H{\u0026#34;message\u0026#34;: \u0026#34;ok\u0026#34;}) return } } log.Printf(\u0026#34;User %s not found\u0026#34;, id) c.JSON(http.StatusNotFound, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;user not found.\u0026#34;, }) } // åˆ é™¤ç”¨æˆ· func deleteUser(c *gin.Context) { id := c.Param(\u0026#34;id\u0026#34;) log.Printf(\u0026#34;Querying user with id = %s\u0026#34;, id) for idx, u := range userList { if strings.EqualFold(id, strconv.Itoa(int(u.ID))) { log.Printf(\u0026#34;Deleting user: %v\u0026#34;, u) for ; idx \u0026lt; len(userList) - 1; idx++ { userList[idx] = userList[idx+1] } userList = userList[:len(userList) - 1] c.JSON(http.StatusOK, gin.H{\u0026#34;message\u0026#34;: \u0026#34;ok\u0026#34;}) return } } log.Printf(\u0026#34;User %s not found\u0026#34;, id) c.JSON(http.StatusNotFound, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;user not found.\u0026#34;, }) } ","permalink":"https://zihuanling.github.io/posts/go-http-server/","summary":"\u003ch2 id=\"ç®€æ˜“-http-æœåŠ¡\"\u003eç®€æ˜“ http æœåŠ¡\u003c/h2\u003e\n\u003cp\u003eä½¿ç”¨ go è‡ªå¸¦çš„ http æ¨¡å—å®ç°ä¸€ä¸ªç®€å•çš„ http æœåŠ¡å™¨ï¼Œå¯¹è¯·æ±‚è€…è¯´ä¸€å¥ \u003ccode\u003eHello, go http!\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ehttp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eHandleFunc\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/hello\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003esayHello\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ehttp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eListenAndServe\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;:8080\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esayHello\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehttp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eResponseWriter\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ehttp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eRequest\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;In say hello\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eWriteHeader\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ehttp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eStatusOK\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eWrite\u003c/span\u003e([]byte(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Hello, go http!\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿è¡Œä¸Šè¿°ä»£ç ï¼Œåœ¨ç»ˆç«¯ä½¿ç”¨ curl è®¿é—®è¯¥åœ°å€ï¼Œè¿”å›æ­£å¸¸ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e\u0026gt;curl http://localhost:8080/hello\nHello, go http!\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¸”ç¨‹åºä½¿ç”¨ \u003ccode\u003elog\u003c/code\u003e æ‰“å°äº†ä¸€å¥ï¼š \u003ccode\u003e2022/03/27 15:32:48 In say hello\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯ï¼Œæˆ‘ä»¬çš„httpæ–¹æ³•æœ‰å¾ˆå¤šï¼Œ GET/POST/PUT/PATCH/DELETE ç­‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»»æ„ä¸€ä¸ªæ–¹æ³•ï¼Œè®¿é—®ä¸Šè¿°åœ°å€ï¼Œéƒ½èƒ½å¾—åˆ° \u003ccode\u003eHello, go http!\u003c/code\u003e è¿™å¥è¿”å›ï¼Œå¦‚ \u003ccode\u003ePOST\u003c/code\u003e:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e\u0026gt;curl -X POST http://localhost:8080/hello\nHello, go http!\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003ehttp.Request\u003c/code\u003e è¿™ä¸ªç»“æ„ä½“ä¸­ï¼ŒåŒ…å«äº†ä¸€ä¸ª \u003ccode\u003eMethod\u003c/code\u003e å­—æ®µï¼Œè®©æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒçš„æ–¹æ³•ï¼Œå†³å®šä¸åŒçš„å¤„ç†æ–¹å¼ï¼Œæˆ‘ä»¬å°† \u003ccode\u003esayHello\u003c/code\u003e æ–¹æ³•æ”¹é€ å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esayHello\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehttp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eResponseWriter\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ehttp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eRequest\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;In say hello\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eswitch\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eMethod\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;GET\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eFprintln\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;GET: Hello, go http!\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;POST\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eFprintln\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;POST: Hello, go http!\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003edefault\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eWriteHeader\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ehttp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eStatusNotFound\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eFprintln\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Not found\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¯·æ±‚è¾“å‡ºï¼š\u003c/p\u003e","title":"Goï¼šç®€å•çš„httpæœåŠ¡ä»¥åŠRestful Api"},{"content":"å¯¹æˆ‘ä»¬çš„ä»£ç è¿›è¡Œæ£€æŸ¥ï¼Œæœ‰åŠ©äºæé«˜ä»£ç è´¨é‡ï¼Œç¡®ä¿ä»£ç æ›´åŠ ç¬¦åˆè§„èŒƒã€‚\nä½¿ç”¨ golangci-lint è¿›è¡Œä»£ç æ£€æŸ¥ goè¯­è¨€ä»£ç åˆ†æçš„å·¥å…·æœ‰å¾ˆå¤šï¼Œå¦‚ golintã€gofmtã€misspellç­‰ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ é›†æˆå·¥å…· golangci-lintï¼Œè€Œä¸æ˜¯å•ç‹¬ä½¿ç”¨ä»–ä»¬ã€‚\nå®‰è£… go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.32.2 æŸ¥çœ‹ç‰ˆæœ¬ golangci-lint version è¾“å‡ºï¼š\ngolangci-lint has version v1.32.2 ... è¿è¡Œæ£€æŸ¥ï¼š golangci-lint run quality/ è¿™é‡Œçš„ qualityæ˜¯ä¸€ä¸ªåŒ…ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª main.go æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nquality/main.go\npackage main import \u0026#34;os\u0026#34; func main(){ os.Mkdir(\u0026#34;/tmp\u0026#34;, 0666) } è¿è¡Œæ£€æŸ¥åï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š\nquality\\main.go:6:10: Error return value of `os.Mkdir` is not checked (errcheck) os.Mkdir(\u0026#34;/tmp\u0026#34;, 0666) å› ä¸º os.Mkdir è¿”å›ä¸€ä¸ª errorï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰å¤„ç†è¿™ä¸ª errorï¼Œå› æ­¤æç¤ºäº†è¿™ä¸ªé”™è¯¯ã€‚\ngolangci-lint é…ç½® golangci-lintæ˜¯ä¸€ä¸ªé›†æˆå·¥å…·ï¼Œé‡Œé¢æœ‰å¾ˆå¤šlintersï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ golangci-lint linters æŸ¥çœ‹æœ‰å“ªäº›lintersï¼Œä»¥åŠä»–ä»¬çš„ä½œç”¨ã€å¯ç”¨æƒ…å†µï¼Œé»˜è®¤å¯ç”¨çš„linterså¦‚ä¸‹ï¼š\ndeadcode - æ­»ä»£ç æ£€æŸ¥ errcheck - è¿”å›é”™è¯¯æ˜¯å¦ä½¿ç”¨æ£€æŸ¥ gosimple - æ£€æŸ¥ä»£ç æ˜¯å¦å¯ä»¥ç®€åŒ– govet - ä»£ç å¯ç–‘æ£€æŸ¥ï¼Œæ¯”å¦‚æ ¼å¼åŒ–å­—ç¬¦ä¸²å’Œç±»å‹ä¸ä¸€è‡´ ineffassign - æ£€æŸ¥æ˜¯å¦æœ‰æœªä½¿ç”¨çš„ä»£ç  staticcheck - é™æ€åˆ†ææ£€æŸ¥ structcheck - æŸ¥æ‰¾æœªä½¿ç”¨çš„ç»“æ„ä½“å­—æ®µ typecheck - ç±»å‹æ£€æŸ¥ unused - æœªä½¿ç”¨ä»£ç æ£€æŸ¥ varcheck - æœªä½¿ç”¨çš„å…¨å±€å˜é‡å’Œå¸¸é‡æ£€æŸ¥ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ª .golangci.yml æ¥å¯¹ golangci-lint è¿›è¡Œè‡ªå®šä¹‰çš„é…ç½®ï¼š\n.golangci.yml\n# å‡è®¾æˆ‘ä»¬çš„ä»£ç æ£€æŸ¥ä»…å¯ç”¨ unused linters: disable-all: true enable: - unused é…ç½® golangci-lint ä½¿ç”¨å›ºå®šç‰ˆæœ¬ï¼Œåœ¨ .golangci.yml é‡Œé¢æ·»åŠ ï¼š\nservice: golangci-lint-version: 1.32.2 # ä½¿ç”¨å›ºå®šç‰ˆæœ¬çš„golangci-lint é’ˆå¯¹æ¯ä¸ªå¯ç”¨çš„ linter ä½¿ç”¨å•ç‹¬çš„é…ç½®ï¼Œå¦‚è®¾ç½®æ‹¼å†™æ£€æµ‹è¯­è¨€ä¸ºUSï¼š\nlinters-settings: misspell: locale: US æ›´å¤šé…ç½®å‚è€ƒï¼š å®˜æ–¹æ–‡æ¡£\næ€§èƒ½ä¼˜åŒ– å†™æ­£ç¡®çš„ä»£ç æ˜¯æ€§èƒ½ä¼˜åŒ–çš„å‰æ\næ€§èƒ½ä¼˜åŒ–çš„ç›®çš„æ˜¯è®©ç¨‹åºæ›´å¥½ã€æ›´å¿«åœ°è¿è¡Œï¼Œä½†è¿™ä¸æ˜¯å¿…è¦çš„ã€‚\nå †åˆ†é…è¿˜æ˜¯æ ˆ goè¯­è¨€çš„å†…å­˜ç©ºé—´åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šæ ˆå†…å­˜å’Œå †å†…å­˜\næ ˆå†…å­˜ï¼šç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾ï¼Œå¼€å‘è€…æ— æ³•æ§åˆ¶ã€‚ä¸€èˆ¬å­˜å‚¨å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ã€å‚æ•°ç­‰ï¼Œå‡½æ•°åˆ›å»ºçš„æ—¶å€™ï¼Œè¿™äº›å†…å­˜ä¼šè¢«è‡ªåŠ¨åˆ›å»ºï¼›å‡½æ•°è¿”å›çš„æ—¶å€™ï¼Œè¿™äº›å†…å­˜ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ã€‚ æ ˆå†…å­˜ï¼šç”Ÿå‘½å‘¨æœŸæ¯”æ ˆå†…å­˜è¦é•¿ï¼Œå¦‚æœå‡½æ•°è¿”å›çš„å€¼è¿˜ä¼šåœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°±ä¼šè¢«ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…åˆ°å †ä¸Šã€‚ç›¸æ¯”æ ˆå†…å­˜æ¥è¯´ï¼Œä¸èƒ½è‡ªåŠ¨è¢«ç¼–è¯‘å™¨é‡Šæ”¾ï¼Œåªèƒ½é€šè¿‡åƒåœ¾å›æ”¶å™¨æ‰èƒ½é‡Šæ”¾ï¼Œæ‰€ä»¥æ•ˆç‡ç›¸å¯¹ä½ã€‚ é€ƒé€¸åˆ†æ åœ¨ main.go å†™å…¥ä»¥ä¸‹ä»£ç ï¼š\nfunc newString() *string { s := new(string) *s = \u0026#34;mike\u0026#34; return s } æŸ¥çœ‹é€ƒé€¸åˆ†æï¼š\ngo build -gcflags=\u0026#34;-m -l\u0026#34; ./quality/main.go # -m æ‰“å°å‡ºé€ƒé€¸åˆ†æä¿¡æ¯ # -l ç¦æ­¢å†…è”ï¼Œæ–¹ä¾¿æ›´å¥½è§‚å¯Ÿé€ƒé€¸ è¾“å‡ºï¼š\nquality\\main.go:4:10: new(string) escapes to heap ä¸Šè¿°ç»“æœè¯´æ˜ï¼šæŒ‡é’ˆä½œä¸ºå‡½æ•°è¿”å›å€¼çš„æ—¶å€™ï¼Œä¸€å®šä¼šå‘ç”Ÿé€ƒé€¸\nä¿®æ”¹å‡½æ•°ï¼Œè®©å…¶è¿”å› string è€Œä¸æ˜¯ *string\nfunc newString() string { s := new(string) *s = \u0026#34;Mike\u0026#34; return *s } å†æ¬¡è¿è¡Œé€ƒé€¸åˆ†æï¼Œè¾“å‡ºï¼š\nquality\\main.go:4:10: new(string) does not escape å¯ä»¥çœ‹åˆ°æ²¡æœ‰å‘ç”Ÿé€ƒé€¸äº†ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰åœ¨å‡½æ•°ä¸­è¿”å›æŒ‡é’ˆã€‚\nå¹¶ä¸æ˜¯è¯´ä¸ä½¿ç”¨æŒ‡é’ˆä½œä¸ºå‡½æ•°è¿”å›å°±ä¸ä¼šå‘ç”Ÿé€ƒé€¸ï¼Œè¢«å·²ç»é€ƒé€¸çš„æŒ‡é’ˆå˜é‡å¼•ç”¨çš„å˜é‡ï¼Œä¹Ÿä¼šå‘ç”Ÿé€ƒé€¸\nå¦‚ï¼š\nfmt.Println(\u0026#34;Hello world.\u0026#34;) \u0026gt;go build -gcflags=\u0026#34;-m -l\u0026#34; ./quality/main.go # let_go/quality quality\\main.go:6:13: ... argument does not escape quality\\main.go:6:14: \u0026#34;Hello world.\u0026#34; escapes to heap å¼•ç”¨ä»£ç å¦‚ä¸‹ï¼š\nfunc (p *pp) printArg(arg interface{}, verb rune) { p.arg = arg //çœç•¥å…¶ä»–æ— å…³ä»£ç  } è¢« sliceã€mapã€chan ä¸‰ç§ç±»å‹å¼•ç”¨çš„æŒ‡é’ˆä¹Ÿä¼šå‘ç”Ÿé€ƒé€¸ï¼š\nm := map[int]*string{} s := \u0026#34;Mike\u0026#34; m[0] = \u0026amp;s é€ƒé€¸åˆ†æç»“æœï¼š\nquality\\main.go:5:2: moved to heap: s quality\\main.go:4:22: map[int]*string{} does not escape å¯ä»¥çœ‹åˆ°è¢«å˜é‡ m å¼•ç”¨çš„ å˜é‡s é€ƒé€¸åˆ°äº† å †ä¸Šã€‚\nä¼˜åŒ–æŠ€å·§ å°½å¯èƒ½é¿å…é€ƒé€¸ï¼Œå› ä¸ºæ ˆå†…å­˜æ•ˆç‡æ›´é«˜ï¼Œå°å¯¹è±¡ä¼ å‚æ—¶ï¼Œarrayæ¯”sliceæ•ˆæœè¦æ›´å¥½ å¯¹äºé¢‘ç¹çš„å†…å­˜ç”³è¯·æ“ä½œï¼Œæˆ‘ä»¬åº”è¯¥å­¦ä¼šé‡ç”¨å†…å­˜ï¼Œæ¯”å¦‚ sync.Pool é€‰ç”¨åˆé€‚çš„ç®—æ³•è¾¾åˆ°é«˜æ€§èƒ½çš„ç›®çš„ï¼Œå¦‚ ç©ºé—´æ¢æ—¶é—´ å…¶ä»–ï¼š\nå°½å¯èƒ½é¿å…ä½¿ç”¨é”ã€å¹¶å‘åŠ é”çš„èŒƒå›´è¦å°½å¯èƒ½å°ã€ä½¿ç”¨ StringBuilderåšstringå’Œ []byte ä¹‹é—´çš„è½¬æ¢ã€deferåµŒå¥—ä¸è¦å¤ªå¤šï¼Œç­‰ã€‚\ngo æ€§èƒ½å‰–æå·¥å…·ï¼š pprof ","permalink":"https://zihuanling.github.io/posts/go-17-quarlity-and-optimization/","summary":"\u003cp\u003eå¯¹æˆ‘ä»¬çš„ä»£ç è¿›è¡Œæ£€æŸ¥ï¼Œæœ‰åŠ©äºæé«˜ä»£ç è´¨é‡ï¼Œç¡®ä¿ä»£ç æ›´åŠ ç¬¦åˆè§„èŒƒã€‚\u003c/p\u003e\n\u003ch2 id=\"ä½¿ç”¨-golangci-lint-è¿›è¡Œä»£ç æ£€æŸ¥\"\u003eä½¿ç”¨ golangci-lint è¿›è¡Œä»£ç æ£€æŸ¥\u003c/h2\u003e\n\u003cp\u003egoè¯­è¨€ä»£ç åˆ†æçš„å·¥å…·æœ‰å¾ˆå¤šï¼Œå¦‚ \u003ccode\u003egolintã€gofmtã€misspell\u003c/code\u003eç­‰ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ \u003cstrong\u003eé›†æˆå·¥å…·\u003c/strong\u003e \u003ccode\u003egolangci-lint\u003c/code\u003eï¼Œè€Œä¸æ˜¯å•ç‹¬ä½¿ç”¨ä»–ä»¬ã€‚\u003c/p\u003e\n\u003ch3 id=\"å®‰è£…\"\u003eå®‰è£…\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ego install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.32.2\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"æŸ¥çœ‹ç‰ˆæœ¬\"\u003eæŸ¥çœ‹ç‰ˆæœ¬\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egolangci-lint version\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¾“å‡ºï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003egolangci-lint has version v1.32.2 ...\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"è¿è¡Œæ£€æŸ¥\"\u003eè¿è¡Œæ£€æŸ¥ï¼š\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egolangci-lint run quality/\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™é‡Œçš„ \u003ccode\u003equality\u003c/code\u003eæ˜¯ä¸€ä¸ªåŒ…ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª \u003ccode\u003emain.go\u003c/code\u003e æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003equality/main.go\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003epackage\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;os\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eos\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eMkdir\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/tmp\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0666\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿è¡Œæ£€æŸ¥åï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003equality\\main.go:6:10: Error return value of `os.Mkdir` is not checked (errcheck)\n        os.Mkdir(\u0026#34;/tmp\u0026#34;, 0666)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eå› ä¸º \u003ccode\u003eos.Mkdir\u003c/code\u003e è¿”å›ä¸€ä¸ª errorï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰å¤„ç†è¿™ä¸ª errorï¼Œå› æ­¤æç¤ºäº†è¿™ä¸ªé”™è¯¯ã€‚\u003c/p\u003e\n\u003ch3 id=\"golangci-lint-é…ç½®\"\u003egolangci-lint é…ç½®\u003c/h3\u003e\n\u003cp\u003egolangci-lintæ˜¯ä¸€ä¸ªé›†æˆå·¥å…·ï¼Œé‡Œé¢æœ‰å¾ˆå¤šlintersï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ \u003ccode\u003egolangci-lint linters\u003c/code\u003e æŸ¥çœ‹æœ‰å“ªäº›lintersï¼Œä»¥åŠä»–ä»¬çš„ä½œç”¨ã€å¯ç”¨æƒ…å†µï¼Œé»˜è®¤å¯ç”¨çš„linterså¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edeadcode - æ­»ä»£ç æ£€æŸ¥\nerrcheck - è¿”å›é”™è¯¯æ˜¯å¦ä½¿ç”¨æ£€æŸ¥\ngosimple - æ£€æŸ¥ä»£ç æ˜¯å¦å¯ä»¥ç®€åŒ–\ngovet - ä»£ç å¯ç–‘æ£€æŸ¥ï¼Œæ¯”å¦‚æ ¼å¼åŒ–å­—ç¬¦ä¸²å’Œç±»å‹ä¸ä¸€è‡´\nineffassign - æ£€æŸ¥æ˜¯å¦æœ‰æœªä½¿ç”¨çš„ä»£ç \nstaticcheck - é™æ€åˆ†ææ£€æŸ¥\nstructcheck - æŸ¥æ‰¾æœªä½¿ç”¨çš„ç»“æ„ä½“å­—æ®µ\ntypecheck - ç±»å‹æ£€æŸ¥\nunused - æœªä½¿ç”¨ä»£ç æ£€æŸ¥\nvarcheck - æœªä½¿ç”¨çš„å…¨å±€å˜é‡å’Œå¸¸é‡æ£€æŸ¥\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ª \u003ccode\u003e.golangci.yml\u003c/code\u003e æ¥å¯¹ golangci-lint è¿›è¡Œè‡ªå®šä¹‰çš„é…ç½®ï¼š\u003c/p\u003e","title":"17.go: ä»£ç æ£€æŸ¥å’Œæ€§èƒ½ä¼˜åŒ–"},{"content":"å•å…ƒæµ‹è¯• å•å…ƒæµ‹è¯•å°±æ˜¯å¯¹å•å…ƒè¿›è¡Œæµ‹è¯•ï¼ˆå¬èµ·æ¥æ˜¯ä¸€å¥åºŸè¯ï¼‰ï¼Œå•å…ƒå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ã€ä¸€ä¸ªæ¨¡å—ç­‰ï¼Œæˆ‘ä»¬æœ€å°çš„å•å…ƒæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚\nä»¥æ–æ³¢é‚£å¥‘æ•°åˆ—ä¸ºä¾‹ï¼Œå®ç°ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹\ntest/main.go\npackage main // æ–æ³¢é‚£å¥‘æ•°åˆ— func Fibonacci(n int) int { if n \u0026lt;= 0 { return 0 } else if n == 1 { return 1 } return Fibonacci(n-1) + Fibonacci(n-2) } æˆ‘ä»¬åœ¨ main.go é‡Œé¢å†™äº†ä¸€ä¸ª Fibonacciå‡½æ•°ï¼Œç”¨äºè®¡ç®—å¯¹åº”çš„æ–æ³¢é‚£å¥‘å€¼ã€‚\næˆ‘ä»¬æ¥ä¸‹æ¥å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•çš„æ–‡ä»¶ååº”è¯¥æ˜¯ä»¥ _test.go ç»“å°¾çš„ï¼Œå‰é¢çš„åç§°æœ€å¥½æ˜¯éœ€è¦æµ‹è¯•çš„æ–‡ä»¶åç§°ï¼Œæ¯”å¦‚è¦æµ‹è¯• main.goï¼Œåˆ™æµ‹è¯•æ–‡ä»¶å‘½åä¸º main_test.goï¼Œè€Œåœ¨ æµ‹è¯•æ–‡ä»¶é‡Œé¢ï¼Œéœ€è¦ä¸€ä¸ªä»¥ Testå¼€å¤´çš„å‡½æ•°ï¼Œåé¢æ¥éœ€è¦æµ‹è¯•çš„å‡½æ•°åç§°ï¼Œå¦‚ TestFibonacciï¼Œè¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ª *Testing.TæŒ‡é’ˆï¼Œä¸”ä¸è¿”å›ä»»ä½•å€¼\ntest/main_test.go\nfunc TestFibonacci(t *testing.T) { result := map[int]int{ 1: 1, 2: 1, 3: 2, 4: 3, 5: 5, 6: 8, 7: 13, 8: 21, } for n, expect := range result { got := Fibonacci(n) if expect != got{ t.Fatalf(\u0026#34;Test Fibonacci failed: expect %d, got %d\u0026#34;, expect, got) } else { fmt.Printf(\u0026#34;ok, Fibonacci(%d) = %d\\n\u0026#34;, n, got) } } } åœ¨ä»£ç æ‰€åœ¨ç›®å½•ä¸‹ï¼Œè¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼ˆæ‰€æœ‰ï¼‰\ngo test -v . è¾“å‡ºï¼š\n=== RUN TestFibonacci ok, Fibonacci(5) = 5 ok, Fibonacci(6) = 8 ok, Fibonacci(7) = 13 ok, Fibonacci(8) = 21 ok, Fibonacci(1) = 1 ok, Fibonacci(2) = 1 ok, Fibonacci(3) = 2 ok, Fibonacci(4) = 3 --- PASS: TestFibonacci (0.00s) PASS ok let_go/test 1.434s å•å…ƒæµ‹è¯•è¦†ç›–ç‡ é€šè¿‡ä¸€ä¸ª flag --coverprofile æ¥è·å¾—ä¸€ä¸ªå•å…ƒæµ‹è¯•è¦†ç›–ç‡æ–‡ä»¶ï¼š\ngo test -v --coverprofile=test.cover . è¾“å‡ºæœ€åçš„å†…å®¹æ˜¯ï¼š\nPASS coverage: 100.0% of statements ok let_go/test 18.222s coverage: 100.0% of statements å¯ä»¥çœ‹åˆ°ï¼Œè¾“å‡ºäº†è¦†ç›–ç‡æ•°æ®ï¼Œæˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹çš„è¦†ç›–ç‡æ˜¯ 100%ã€‚\nå½“å‰è·¯å¾„ä¸‹ï¼Œç”Ÿæˆäº†ä¸€ä¸ª test.coveræ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ go tool ä»å…¶ä¸­å¾—åˆ°ä¸€ä¸ªhtmlçš„è¦†ç›–ç‡æµ‹è¯•æŠ¥å‘Šï¼š\ngo tool cover -html=test.cover -o=test-cover.html æ‰“å¼€ç”Ÿæˆçš„ test-cover.htmlæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°å¯¹åº”çš„è¦†ç›–ç‡æƒ…å†µã€‚\nåŸºå‡†æµ‹è¯• åŸºå‡†æµ‹è¯•ç”¨äºè¯„ä¼°ä»£ç çš„æ€§èƒ½ã€‚\næµ‹è¯•æ–‡ä»¶çš„å‘½åè·Ÿå•å…ƒæµ‹è¯•æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ _test.goç»“å°¾ï¼Œä¸åŒçš„æ˜¯åŸºå‡†æµ‹è¯•çš„å‡½æ•°åæ˜¯ Benchmarkå¼€å¤´ï¼Œåæ¥è¢«æµ‹è¯•å‡½æ•°åï¼Œå¦‚ BenchmarkFibonacciï¼ŒåŒæ—¶æ¥æ”¶ä¸€ä¸ª *testing.BæŒ‡é’ˆå‚æ•°ã€‚\nmain_test.go\nfunc BenchmarkFibonacci(b *testing.B) { for i := 0; i \u0026lt; b.N; i++ { Fibonacci(10) } } b.Næ˜¯æ¡†æ¶æä¾›çš„ï¼Œè¡¨ç¤ºå¾ªç¯è¿è¡Œæ¬¡æ•°ã€‚\nè¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼ŒåŒæ ·æ˜¯ä½¿ç”¨ go testï¼Œä¸è¿‡è¦åŠ ä¸Š -benchå‚æ•°ï¼Œåæ¥ . è¡¨ç¤ºæ‰€æœ‰ï¼Œä¹Ÿå¯ä»¥æ¥å…·ä½“çš„å‡½æ•°åç§°ã€‚\ngo test -bench=. . # go test -bench=Fibonacci . è¾“å‡ºï¼š\ngoos: windows goarch: amd64 pkg: let_go/test cpu: Intel(R) Core(TM) i5-10210U CPU @ 1.60GHz BenchmarkFibonacci-8 3076749 354.4 ns/op PASS ok let_go/test 2.838s BenchmarkFibonacci-8ï¼šè¿™é‡Œçš„ -8 è¡¨ç¤ºè¿è¡ŒåŸºå‡†æµ‹è¯•å¯¹åº”çš„ GOMAXPROCS çš„å€¼ã€‚\n3076749ï¼šè¡¨ç¤ºä¸€å…±forå¾ªç¯äº† 3076749æ¬¡\n354.4 ns/opï¼šè¡¨ç¤ºæ¯æ¬¡å¾ªç¯è€—æ—¶ 354.4 ns\nåŸºå‡†æµ‹è¯•é»˜è®¤æ˜¯ 1ç§’ï¼Œå› æ­¤ä¸Šè¿°ç»“æœæ˜¯1ç§’å†…è¿è¡Œäº†3076749æ¬¡ï¼Œæ¯æ¬¡è€—æ—¶354.4 nsã€‚æˆ‘ä»¬åŒæ ·å¯ä»¥æŒ‡å®šè¿è¡Œæ—¶é•¿ï¼Œä½¿ç”¨ -benchtime å‚æ•°ï¼š\ngo test -bench=. -benchtime=3s . è®¡æ—¶æ–¹æ³• åŸºå‡†æµ‹è¯•ä¹‹å‰ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å‡†å¤‡æ•°æ®ï¼Œæˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•åº”è¯¥æŠŠè¿™éƒ¨åˆ†æ—¶é—´æ’é™¤åœ¨å¤–ï¼Œè¿™æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ResetTimeræ–¹æ³•ï¼š\nfunc BenchmarkFibonacci(b *testing.B) { n := 10\t// å‰æœŸå‡†å¤‡ b.ResetTimer() for i := 0; i \u0026lt; b.N; i++ { Fibonacci(n) } } æ­¤å¤–ï¼Œè¿˜æœ‰ StartTimerå’Œ StopTimerï¼Œå¯ä»¥çµæ´»æ§åˆ¶è®¡æ—¶æ—¶é—´ã€‚\nå†…å­˜ç»Ÿè®¡ é€šè¿‡ ReportAllocs æ–¹æ³•å¼€å¯å†…å­˜ç»Ÿè®¡ï¼š\nfunc BenchmarkFibonacci(b *testing.B) { n := 10 b.ReportAllocs()\t// æŠ¥å‘Šå†…å­˜ç»Ÿè®¡ b.ResetTimer()\t// é‡ç½®è®¡æ—¶å™¨ for i := 0; i \u0026lt; b.N; i++ { Fibonacci(n) } } è¾“å‡ºï¼š\nBenchmarkFibonacci-8 3320989 374.9 ns/op 0 B/op 0 allocs/op PASS ok let_go/test 21.393s å‘ç°å¤šäº† 0 B/op 0 allocs/op è¿™æ®µè¾“å‡ºï¼Œå‰è€…è¡¨ç¤ºæ¯æ¬¡åˆ†é…äº†å¤šå°‘å­—èŠ‚çš„å†…å­˜ï¼Œåè€…è¡¨ç¤ºæ¯æ¬¡æ“ä½œåˆ†é…å†…å­˜çš„æ¬¡æ•°ã€‚\né™¤äº† b.ReportAllocså¤–ï¼Œè¿˜å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ -benchmemå‚æ•°ï¼Œå¯ä»¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚\nå¹¶å‘åŸºå‡†æµ‹è¯• ä¸»è¦ç”¨ä»¥æµ‹è¯• åœ¨å¤šä¸ªgoroutine ä¸‹çš„ä»£ç æ€§èƒ½ï¼Œä½¿ç”¨ runParallel æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼š\nfunc BenchmarkFibonacci(b *testing.B) { n := 10 b.RunParallel(func(pb *testing.PB){ for pb.Next() { Fibonacci(n) } }) } è¿è¡Œï¼š\ngo test -bench=. . è¾“å‡ºï¼š\nBenchmarkFibonacci-8 13952709 114.2 ns/op å¯ä»¥çœ‹åˆ°ï¼Œå¹¶è¡Œæµ‹è¯•çš„æƒ…å†µä¸‹ï¼Œå‡½æ•°è¢«è¿è¡Œäº† 13952709 æ¬¡ã€‚\nä¼˜åŒ– å¯ä»¥çœ‹åˆ°ä¸Šè¿°åŸºå‡†æµ‹è¯•çš„å†…å­˜ç»Ÿè®¡ä¸­ï¼Œå¹¶æ²¡æœ‰å‘ç”Ÿå†…å­˜ç”³è¯·ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå†…å­˜å¹¶ä¸æ˜¯å½±å“å‡½æ•°æ€§èƒ½çš„åŸå› ã€‚\nä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ç¼“å­˜æ¥ä¼˜åŒ– Fibonacciå‡½æ•°\nmain.go\n// æ–æ³¢é‚£å¥‘æ•°åˆ— func Fibonacci(n int) int { if n \u0026lt;= 0 { return 0 } else if n == 1 { return 1 } v, ok := cache[n] if !ok { v = Fibonacci(n-1) + Fibonacci(n-2) cache[n] = v } return v } å†æ¬¡è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼Œè¾“å‡ºï¼š\nBenchmarkFibonacci-8 261475790 4.585 ns/op å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡å¾ªç¯çš„æ—¶é—´ä» 114.2 ns -\u0026gt; 4.585 nsï¼Œæ€§èƒ½æé«˜äº†çº¦25å€ã€‚\n","permalink":"https://zihuanling.github.io/posts/go-16-test-1/","summary":"\u003ch1 id=\"å•å…ƒæµ‹è¯•\"\u003eå•å…ƒæµ‹è¯•\u003c/h1\u003e\n\u003cp\u003eå•å…ƒæµ‹è¯•å°±æ˜¯å¯¹å•å…ƒè¿›è¡Œæµ‹è¯•ï¼ˆå¬èµ·æ¥æ˜¯ä¸€å¥åºŸè¯ï¼‰ï¼Œå•å…ƒå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ã€ä¸€ä¸ªæ¨¡å—ç­‰ï¼Œæˆ‘ä»¬æœ€å°çš„å•å…ƒæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥\u003cstrong\u003eæ–æ³¢é‚£å¥‘æ•°åˆ—\u003c/strong\u003eä¸ºä¾‹ï¼Œå®ç°ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹\u003c/p\u003e\n\u003cp\u003etest/main.go\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003epackage\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// æ–æ³¢é‚£å¥‘æ•°åˆ—\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eFibonacci\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003en\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003en\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003en\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eFibonacci\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003en\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eFibonacci\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003en\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬åœ¨ main.go é‡Œé¢å†™äº†ä¸€ä¸ª \u003cstrong\u003eFibonacci\u003c/strong\u003eå‡½æ•°ï¼Œç”¨äºè®¡ç®—å¯¹åº”çš„æ–æ³¢é‚£å¥‘å€¼ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬æ¥ä¸‹æ¥å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•çš„æ–‡ä»¶ååº”è¯¥æ˜¯ä»¥ \u003ccode\u003e_test.go\u003c/code\u003e ç»“å°¾çš„ï¼Œå‰é¢çš„åç§°æœ€å¥½æ˜¯éœ€è¦æµ‹è¯•çš„æ–‡ä»¶åç§°ï¼Œæ¯”å¦‚è¦æµ‹è¯• \u003ccode\u003emain.go\u003c/code\u003eï¼Œåˆ™æµ‹è¯•æ–‡ä»¶å‘½åä¸º \u003ccode\u003emain_test.go\u003c/code\u003eï¼Œè€Œåœ¨ æµ‹è¯•æ–‡ä»¶é‡Œé¢ï¼Œéœ€è¦ä¸€ä¸ªä»¥ \u003ccode\u003eTest\u003c/code\u003eå¼€å¤´çš„å‡½æ•°ï¼Œåé¢æ¥éœ€è¦æµ‹è¯•çš„å‡½æ•°åç§°ï¼Œå¦‚ \u003ccode\u003eTestFibonacci\u003c/code\u003eï¼Œè¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ª \u003ccode\u003e*Testing.T\u003c/code\u003eæŒ‡é’ˆï¼Œä¸”ä¸è¿”å›ä»»ä½•å€¼\u003c/p\u003e\n\u003cp\u003etest/main_test.go\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eTestFibonacci\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003et\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003etesting\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eT\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003emap\u003c/span\u003e[\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e]\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e13\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e21\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003en\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eexpect\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003egot\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eFibonacci\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003en\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eexpect\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egot\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a6e22e\"\u003et\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eFatalf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Test Fibonacci failed: expect %d, got %d\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eexpect\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003egot\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t} \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ok, Fibonacci(%d) = %d\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003en\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003egot\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåœ¨ä»£ç æ‰€åœ¨ç›®å½•ä¸‹ï¼Œè¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼ˆæ‰€æœ‰ï¼‰\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ego test -v .\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¾“å‡ºï¼š\u003c/p\u003e","title":"16.go: å•å…ƒæµ‹è¯•å’ŒåŸºå‡†æµ‹è¯•"},{"content":"æ•°ç»„ æ•°ç»„ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šæ•°ç»„çš„å¤§å°å’Œæ•°ç»„å†…éƒ¨çš„å…ƒç´ ç±»å‹ã€‚\n// ä¼ªä»£ç è¡¨ç¤º array { len item type } çœ‹ä»¥ä¸‹ä¸¤ä¸ªæ•°ç»„çš„å®šä¹‰ï¼š\na1 := [1]string{\u0026#34;mike\u0026#34;} a2 := [2]string{\u0026#34;mike\u0026#34;} ä¸Šè¿°å®šä¹‰çš„ä¸¤ä¸ªå˜é‡ï¼Œa1çš„ç±»å‹ä¸º [1]stringï¼Œa2çš„ç±»å‹ä¸º [2]stringï¼Œæ‰€ä»¥è¯´ï¼Œæ•°ç»„çš„å¤§å°ä¹Ÿå±äºæ•°ç»„ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚\næ•°ç»„çš„ä¸¤ä¸ªé™åˆ¶ **ä¸€æ—¦ä¸€ä¸ªæ•°ç»„è¢«å£°æ˜ï¼Œå®ƒçš„å¤§å°å’Œå†…éƒ¨çš„ç±»å‹å°±ä¸èƒ½æ”¹å˜ï¼Œ**æˆ‘ä»¬å°†ä¸èƒ½éšæ„å‘å…¶ä¸­è¿½åŠ ä»»æ„å¤šçš„å…ƒç´ ã€‚\nå¦å¤–ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨æ•°ç»„å­˜å‚¨å¤§é‡æ•°æ®ï¼Œç„¶åå°†æ•°ç»„ä½œä¸ºå‡½æ•°çš„å‚æ•°è¿›è¡Œä¼ å€¼æ—¶ï¼Œç”±äºå‡½æ•°ä¹‹é—´æ˜¯å€¼ä¼ é€’çš„ï¼Œå› æ­¤ï¼Œæ•°ç»„çš„æ‹·è´å°†ä¼šè€—è´¹å·¨å¤§çš„å†…å­˜ã€‚\nslice åˆ‡ç‰‡ æˆ‘ä»¬å¯ä»¥å°†åˆ‡ç‰‡ç†è§£ä¸ºåŠ¨æ€çš„æ•°ç»„ã€‚\nåˆ‡ç‰‡æ˜¯å¯¹æ•°ç»„çš„å°è£…ï¼Œå®ƒçš„åº•å±‚æ˜¯ä¸€ä¸ªæ•°ç»„å­˜å‚¨äº†æ‰€æœ‰çš„å…ƒç´ ï¼Œä½†æ˜¯å®ƒå¯ä»¥åŠ¨æ€åœ°æ·»åŠ å…ƒç´ ï¼Œå®¹é‡ä¸è¶³æ—¶å¯ä»¥è‡ªåŠ¨æ‰©å®¹ã€‚\nåŠ¨æ€æ‰©å®¹ ä½¿ç”¨å†…ç½®çš„appendæ–¹æ³•ï¼Œå‘åˆ‡ç‰‡ä¸­è¿½åŠ å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„åˆ‡ç‰‡ã€‚\nåŒæ—¶ï¼Œå½“å®¹é‡ä¸è¶³çš„æ—¶å€™ï¼Œappendä¼šè‡ªåŠ¨å¯¹åˆ‡ç‰‡è¿›è¡Œæ‰©å®¹ã€‚\nfunc main(){ ss := []string{\u0026#34;mike\u0026#34;} // å®šä¹‰åˆ‡ç‰‡ss fmt.Printf(\u0026#34;slice before append: %s, length=%d, cap=%d\\n\u0026#34;, ss, len(ss), cap(ss)) ss = append(ss, \u0026#34;lucy\u0026#34;, \u0026#34;john\u0026#34;) // append è¿½åŠ å…ƒç´  fmt.Printf(\u0026#34;slice after append: %s, length=%d, cap=%d\\n\u0026#34;, ss, len(ss), cap(ss)) } è¾“å‡ºï¼š\nslice before append: [mike], length=1, cap=1 slice after append: [mike lucy john], length=3, cap=3 æ•°æ®ç»“æ„ åˆ‡ç‰‡åœ¨goè¯­è¨€ä¸­æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼š\ntype SliceHeader struct { Data uintptr\t// æŒ‡å‘å­˜å‚¨åˆ‡ç‰‡å…ƒç´ çš„æ•°ç»„ Len int\t// åˆ‡ç‰‡é•¿åº¦ Cap int\t// åˆ‡ç‰‡å®¹é‡ } ç¤ºä¾‹è¯æ˜ï¼š\nfunc main(){ arr := [4]string{\u0026#34;mike\u0026#34;, \u0026#34;lucy\u0026#34;, \u0026#34;john\u0026#34;, \u0026#34;trump\u0026#34;} s1 := arr[0:1] s2 := arr[:] s3 := arr[1:] s4 := s2[1:] s5 := append(s1, \u0026#34;amy\u0026#34;) fmt.Println((*reflect.SliceHeader)(unsafe.Pointer(\u0026amp;s1)).Data) fmt.Println((*reflect.SliceHeader)(unsafe.Pointer(\u0026amp;s2)).Data) fmt.Println((*reflect.SliceHeader)(unsafe.Pointer(\u0026amp;s3)).Data) fmt.Println((*reflect.SliceHeader)(unsafe.Pointer(\u0026amp;s4)).Data) fmt.Println((*reflect.SliceHeader)(unsafe.Pointer(\u0026amp;s5)).Data) fmt.Println( unsafe.Sizeof(arr), unsafe.Sizeof(s1), unsafe.Sizeof(s2), unsafe.Sizeof(s3), unsafe.Sizeof(s4), unsafe.Sizeof(s5), ) } è¾“å‡ºï¼š\n824634801872 824634801872 824634801888 824634801888 824634801872 64 24 24 24 24 24 ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ•°ç»„arrï¼Œç„¶åç”¨ä¸åŒçš„æ–¹æ³•åˆ›å»ºäº†5ä¸ªæ•°ç»„åˆ‡ç‰‡ s1~s5ï¼Œæˆ‘ä»¬ç”¨ unsafe.Pointer è·å–åˆ° SliceHeaderåˆ‡ç‰‡é‡Œé¢æŒ‡å‘çš„Dataï¼Œå¯ä»¥å‘ç°ï¼š\ns1 å’Œ s2 DataæŒ‡å‘çš„å†…å­˜æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºä»–ä»¬éƒ½æ˜¯ä» arråˆ‡ç‰‡ä¸‹æ¥çš„ï¼Œä¸”éƒ½æ˜¯ä»å¤´éƒ¨å¼€å§‹åˆ‡ s2 å’Œ s3 DataæŒ‡å‘çš„å†…å­˜æ˜¯ä¸ä¸€æ ·çš„ï¼Œå› ä¸º s3æ˜¯ä»arrç¬¬2ä¸ªå…ƒç´ å¼€å§‹åˆ‡çš„ï¼Œå®ƒçš„ Dataçš„åˆå§‹ä½ç½®æ˜¯arrçš„ç¬¬äºŒä¸ªå…ƒç´  s4 çš„DataæŒ‡å‘ï¼Œå’Œs3çš„æ˜¯ç›¸åŒçš„ï¼Œè™½ç„¶s4æ˜¯ä»s2ç¬¬1ä¸ªå…ƒç´ åˆ‡å‡ºæ¥çš„ï¼Œä½†æ˜¯s2çš„Dataå¼€å§‹åœ°å€è·Ÿarrä¸€è‡´ï¼Œå› æ­¤æ•ˆæœç­‰åŒäºä»arrçš„ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹åˆ‡ï¼Œå› æ­¤DataæŒ‡å‘è·Ÿs3ä¸€è‡´ s5 æ˜¯ä½¿ç”¨append(s1, \u0026quot;amy\u0026quot;)å¾—åˆ°ï¼Œä½†æ˜¯è¿”å›äº†æ–°çš„åˆ‡ç‰‡ä¹‹åï¼Œå…¶DataæŒ‡å‘çš„åœ°å€ä»ç„¶å’Œs1æ˜¯ç›¸åŒçš„ æœ€åï¼Œæ‰“å°å‡ºarrå’Œå„ä¸ªsliceçš„Sizeï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ•°ç»„å ç”¨çš„Sizeæ˜¯è¾ƒå¤§çš„ï¼Œè€Œæ— è®ºsliceé‡Œé¢çš„æ•°æ®æœ‰å¤šå°‘ï¼Œå…¶éƒ½åªå ç”¨ 24å­—èŠ‚ å¤§å°çš„å†…å­˜ï¼Œç¬¦åˆå…¶ SliceHeader çš„å®šä¹‰ é«˜æ•ˆçš„åŸå›  ä¸€æ–¹é¢ï¼Œä»é›†åˆç±»å‹çš„æ–¹é¢è€ƒè™‘ï¼Œæ•°ç»„ã€åˆ‡ç‰‡å’Œmapéƒ½æ˜¯é›†åˆç±»å‹ï¼Œä»–ä»¬éƒ½å¯ä»¥å­˜æ”¾å…ƒç´ ï¼Œä½†æ˜¯æ•°ç»„å’Œåˆ‡ç‰‡æ˜¯è¿ç»­çš„å†…å­˜æ“ä½œï¼Œé€šè¿‡ç´¢å¼•å°±å¯ä»¥å¿«é€Ÿåœ°æ‰¾åˆ°å…ƒç´ å­˜å‚¨çš„åœ°å€ï¼Œå› æ­¤å–å€¼å’Œèµ‹å€¼è¦æ›´åŠ é«˜æ•ˆã€‚\nå¦ä¸€æ–¹é¢ï¼Œä½¿ç”¨åˆ‡ç‰‡ä¹‹æ‰€ä»¥é«˜æ•ˆï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨å‡½æ•°ä¸­è¿›è¡Œå‚æ•°ä¼ é€’çš„æ—¶å€™ï¼Œä¼ é€’çš„åªæ˜¯ä¸€ä»½24ä¸ªå­—èŠ‚çš„SliceHeaderæ•°æ®ï¼Œå®é™…è®¿é—®æ•°æ®æ—¶ï¼Œä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªåº•å±‚æ•°ç»„ï¼Œå› æ­¤é¿å…äº†è€—è´¹å¤§é‡å†…å­˜å»æ‹·è´æ•°æ®ï¼Œæé«˜äº†æ•ˆç‡ã€‚\néœ€è¦æ³¨æ„çš„ ä½¿ç”¨åˆ‡ç‰‡ä½œä¸ºå‡½æ•°ä¼ å€¼è™½ç„¶é«˜æ•ˆï¼Œä½†ç”±äºä½¿ç”¨çš„åº•å±‚æ•°æ®æ˜¯ç›¸åŒçš„ï¼Œä¿®æ”¹åˆ‡ç‰‡é‡Œé¢çš„æ•°æ®æ—¶ï¼Œå…¶ä»–åˆ‡ç‰‡çš„æ•°æ®ä¹Ÿå¯èƒ½ä¼šè¢«ä¿®æ”¹ï¼Œä¸€ä¸ªä¾‹å­ï¼š\n// æ‰“å°åˆ‡ç‰‡ä¿¡æ¯ func info(s []string) { head := (*reflect.SliceHeader)(unsafe.Pointer(\u0026amp;s)) addr := (*string)(unsafe.Pointer(head.Data)) fmt.Printf(\u0026#34;data: %v, address: %v, len: %d, cap: %d \\n\u0026#34;, head.Data, addr, len(s), cap(s)) for i, _ := range s { fmt.Printf(\u0026#34;%p %v\\n\u0026#34;, \u0026amp;s[i], s[i]) } fmt.Println(\u0026#34;======\u0026#34;) } func main(){ arr := [2]string{\u0026#34;mike\u0026#34;, \u0026#34;lucy\u0026#34;} s1 := arr[0:1] s2 := append(s1, \u0026#34;amy\u0026#34;) // å¾€åˆ‡ç‰‡s1è¿½åŠ å…ƒç´ ï¼Œè¿”å›æ–°åˆ‡ç‰‡ç»™s2 s1[0] = \u0026#34;Lisa\u0026#34;\t// ä¿®æ”¹åˆ‡ç‰‡s1ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º Lisa info(s1) info(s2) info(arr[:]) } è¾“å‡ºï¼š\ndata: 824634229888, address: 0xc00007c480, len: 1, cap: 3 0xc00007c480 Lisa ====== data: 824634229888, address: 0xc00007c480, len: 2, cap: 3 0xc00007c480 Lisa 0xc00007c490 amy ====== data: 824634229888, address: 0xc00007c480, len: 3, cap: 3 0xc00007c480 Lisa 0xc00007c490 amy 0xc00007c4a0 trump ====== ä»ä¸Šé¢çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä»åŸå§‹æ•°ç»„arråˆ‡å‡ºäº†ä¸€ä¸ªåˆ‡ç‰‡s1ï¼Œs1é‡Œé¢åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œä½†æ˜¯ï¼Œåœ¨æ‰“å°ä¿¡æ¯çš„æ—¶å€™ï¼Œæ˜¾ç¤ºå®ƒçš„å®¹é‡ cap=3ï¼Œç­‰äºåŸå§‹æ•°ç»„çš„é•¿åº¦ã€‚\næˆ‘ä»¬å¾€s1é‡Œé¢è¿½åŠ äº†ä¸€ä¸ªå…ƒç´  amyï¼Œè¿”å›ä¸€ä¸ªæ–°çš„åˆ‡ç‰‡s2ï¼Œç„¶åï¼Œå°†s1çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ”¹æˆLisaï¼Œéšåçš„è¾“å‡ºç»“æœå¯ä»¥çœ‹åˆ°ï¼ŒåŸå§‹æ•°ç»„arrã€åˆ‡ç‰‡s1ã€s2çš„ç¬¬ä¸€ä¸ªå…ƒç´ éƒ½å˜æˆäº†Lisaï¼Œè€Œæˆ‘ä»¬å¾€s1è¿½åŠ å…ƒç´ çš„æ—¶å€™ï¼Œä¿®æ”¹çš„æ˜¯åŸæ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œ lucy -\u0026gt; amyã€‚ä¸”ä¸‰è€…çš„å„ä¸ªæ•°æ®çš„åœ°å€éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¯´æ˜åˆ‡ç‰‡å’ŒåŸå§‹æ•°ç»„å…±ç”¨ä¸€ä¸ªåº•å±‚æ•°ç»„ã€‚\nä½†æ˜¯ï¼Œæœ‰æ„æ€çš„æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨appendå¾€åˆ‡ç‰‡ä¸­è¿½åŠ å…ƒç´ ï¼Œå½“è¿½åŠ çš„å…ƒç´ è¶…è¿‡äº†å½“å‰çš„sliceçš„å®¹é‡æ—¶ï¼Œè¿”å›çš„åˆ‡ç‰‡æŒ‡å‘çš„å°±æ˜¯åº•å±‚æ•°ç»„å°±æ˜¯ä¸€å—æ–°çš„å†…å­˜äº†ã€‚\næˆ‘ä»¬å°†ä¸Šè¿°ä»£ç ä¸­çš„ append è¯­å¥æ”¹æˆï¼š\ns2 := append(s1, \u0026#34;amy\u0026#34;, \u0026#34;panda\u0026#34;, \u0026#34;python\u0026#34;, \u0026#34;java\u0026#34;) // å¾€åˆ‡ç‰‡s1è¿½åŠ å…ƒç´ ï¼Œè¿”å›æ–°åˆ‡ç‰‡ç»™s2 è¾“å‡ºï¼š\ndata: 824634229888, address: 0xc00007c480, len: 1, cap: 3 0xc00007c480 Lisa ====== data: 824634048608, address: 0xc000050060, len: 5, cap: 6 0xc000050060 mike 0xc000050070 amy 0xc000050080 panda 0xc000050090 python 0xc0000500a0 java ====== data: 824634229888, address: 0xc00007c480, len: 3, cap: 3 0xc00007c480 Lisa 0xc00007c490 lucy 0xc00007c4a0 trump ====== å¯ä»¥çœ‹åˆ°æœ‰4ä¸ªå˜åŒ–ï¼š\ns2çš„å®¹é‡ cap è·Ÿå…¶ä»–ä¸¤ä¸ªä¸åŒäº†ï¼Œè‡ªåŠ¨æ‰©å®¹åˆ°äº† 5 s1å’Œarrçš„å¯¹åº”å…ƒç´ åœ°å€æ˜¯ä¸€æ ·çš„ï¼Œè¯´æ˜ä¸¤è€…ç”¨çš„åº•å±‚ç›¸åŒï¼Œs2çš„å…ƒç´ åœ°å€è·Ÿå…¶ä»–ä¸¤ä¸ªä¸åŒï¼Œè¯´æ˜æ–°ç”³è¯·äº†ä¸€å—å†…å­˜ç©ºé—´æ¥å­˜å‚¨s2åˆ‡ç‰‡å†…å®¹ ä¿®æ”¹s1çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ²¡æœ‰å½±å“åˆ°s2çš„æ•°æ® å¾€s1ä¸­è¿½åŠ å¤šä¸ªå…ƒç´ ï¼Œæ²¡æœ‰å½±å“åˆ°åŸå§‹æ•°ç»„arrçš„æ•°æ® **æ‰€ä»¥ï¼Œå¤šä¸ªåˆ‡ç‰‡ä½¿ç”¨åˆ°åŒä¸€ä¸ªåº•å±‚æ•°ç»„çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥è€ƒè™‘åˆ°æ•°æ®ä¹‹é—´çš„å†²çªé—®é¢˜ã€‚**goæä¾›ä¸€ä¸ª copy å†…éƒ¨å‡½æ•°ï¼Œè®©æˆ‘ä»¬å¯ä»¥å®ç°åˆ‡ç‰‡æ‹·è´ï¼Œä¿®æ”¹æ‹·è´æ•°æ®ï¼Œä¸ä¼šå½±å“åˆ°åŸå§‹æ•°æ®ã€‚\n[]byteå’Œstring è½¬æ¢ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å­—ç¬¦ä¸²stringå’Œ[]byteå¯ä»¥è¿™æ ·è½¬æ¢ï¼š\nvar s string = \u0026#34;Hello world.\u0026#34; // string -\u0026gt; []byte b := []byte(s) // []byte -\u0026gt; string bs := string(b) sliceç±»å‹æœ‰SliceHeaderï¼Œ åŒæ ·çš„ï¼Œstringç±»å‹ä¹Ÿæœ‰ StringHeaderï¼Œå®ƒçš„ç»“æ„ä½“å¦‚ä¸‹ï¼š\ntype StringHeader struct { Data uintptr Len int } ä½†æ˜¯è·Ÿ SliceHeader çš„åŒºåˆ«æ˜¯ï¼ŒStringHeaderå°‘äº†ä¸€ä¸ªCapå­—æ®µç”¨ä»¥å­˜å‚¨å®¹é‡ã€‚\nå›åˆ°string å’Œ []byte è½¬æ¢çš„ä¾‹å­ï¼Œgoè¯­è¨€æ˜¯é€šè¿‡åˆ†é…å†…å­˜ç„¶ååœ¨å¤åˆ¶å†…å®¹çš„æ–¹å¼ï¼Œå»å®ç°[]byteå’Œstringçš„äº’ç›¸è½¬æ¢çš„ã€‚æˆ‘ä»¬ç”¨ SliceHeaderã€StringHeaderçœ‹ä¸‹è½¬æ¢åçš„ DataæŒ‡å‘åœ°å€\nfunc main(){ var s string = \u0026#34;Hello world.\u0026#34; // string -\u0026gt; []byte b := []byte(s) // []byte -\u0026gt; string bs := string(b) fmt.Printf(\u0026#34;addr of s: %v\\n\u0026#34;, (*reflect.StringHeader)(unsafe.Pointer(\u0026amp;s)).Data) fmt.Printf(\u0026#34;addr of b: %v\\n\u0026#34;, (*reflect.SliceHeader)(unsafe.Pointer(\u0026amp;b)).Data) fmt.Printf(\u0026#34;addr of bs: %v\\n\u0026#34;, (*reflect.StringHeader)(unsafe.Pointer(\u0026amp;bs)).Data) } è¾“å‡ºï¼š\naddr of s: 10646786 addr of b: 824634580712 addr of bs: 824634580680 ç”±æ­¤å¯è§ï¼Œç›´æ¥çš„ string \u0026lt;-\u0026gt; []byteäº’è½¬æ˜¯é€šè¿‡æ‹·è´åŸå§‹å€¼æ¥å®ç°çš„ã€‚\nè½¬æ¢ä¼˜åŒ– StringHeader æ¯” SliceHeader å°‘äº†ä¸€ä¸ªCapå­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ unsafe.Pointer å°† SliceHeader ç›´æ¥è½¬æ¢æˆ StringHeaderï¼Œä½†æ˜¯è¿”å›æ¥å´æ˜¯è¡Œä¸é€šçš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ‰‹åŠ¨è¡¥å……ä¸Šä¸€ä¸ª Capå­—æ®µã€‚\nä¸ºäº†åœ¨string å’Œ []byte äº’è½¬çš„æ—¶å€™èŠ‚çœå†…å­˜ï¼Œå®ç°é›¶å€¼æ‹·è´ï¼Œæˆ‘ä»¬åœ¨è½¬æ¢çš„æ—¶å€™ï¼Œä½¿ç”¨å¯¹åº”çš„Headerç»“æ„ä½“ + unsafe.Pointerè¿›è¡Œè½¬æ¢ã€‚\nå°†ä¸Šè¿°ä¾‹å­æ”¹å˜å¦‚ä¸‹ï¼š\nfunc main(){ var s string = \u0026#34;Hello world.\u0026#34; // string -\u0026gt; []byte sliceHeader := (*reflect.SliceHeader)(unsafe.Pointer(\u0026amp;s)) sliceHeader.Cap = sliceHeader.Len b := *(*[]byte)(unsafe.Pointer(sliceHeader)) // []byte -\u0026gt; string stringHeader := (*reflect.StringHeader)(unsafe.Pointer(\u0026amp;b)) bs := *(*string)(unsafe.Pointer(stringHeader)) fmt.Printf(\u0026#34;%s, addr of s: %v\\n\u0026#34;, s, (*reflect.StringHeader)(unsafe.Pointer(\u0026amp;s)).Data) fmt.Printf(\u0026#34;%s, addr of b: %v\\n\u0026#34;, b, (*reflect.SliceHeader)(unsafe.Pointer(\u0026amp;b)).Data) fmt.Printf(\u0026#34;%s, addr of bs: %v\\n\u0026#34;, bs, (*reflect.StringHeader)(unsafe.Pointer(\u0026amp;bs)).Data) } è¾“å‡ºï¼š\nHello world., addr of s: 9860354 Hello world., addr of b: 9860354 Hello world., addr of bs: 9860354 å¯ä»¥çœ‹åˆ°ï¼Œä¿®æ”¹ä¹‹åï¼Œå¯¹åº”çš„Headerä¸­DataæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªåœ°å€ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé€šè¿‡ unsafe.Pointerå°†stirngè½¬æ¢ä¸º []byteçš„æ—¶å€™ï¼Œä¸å¯ä»¥é€šè¿‡ç´¢å¼•å¯¹ []byteä¿®æ”¹ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œå› ä¸ºgoè¯­è¨€ä¸­ï¼Œstringå†…å­˜æ˜¯åªè¯»çš„ã€‚\ngoè¯­è¨€æ ‡å‡†åº“ä¸­ï¼Œ strings.Builder ä¹Ÿä½¿ç”¨äº†é›¶å€¼æ‹·è´æå‡æ–°èƒ½ï¼š\n// String returns the accumulated string. func (b *Builder) String() string { return *(*string)(unsafe.Pointer(\u0026amp;b.buf)) } ","permalink":"https://zihuanling.github.io/posts/go-15-depth-slice-header/","summary":"\u003ch2 id=\"æ•°ç»„\"\u003eæ•°ç»„\u003c/h2\u003e\n\u003cp\u003eæ•°ç»„ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š\u003cstrong\u003eæ•°ç»„çš„å¤§å°å’Œæ•°ç»„å†…éƒ¨çš„å…ƒç´ ç±»å‹\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ä¼ªä»£ç è¡¨ç¤º\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003earray\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003elen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eitem\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etype\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹ä»¥ä¸‹ä¸¤ä¸ªæ•°ç»„çš„å®šä¹‰ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ea1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e [\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e{\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mike\u0026#34;\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ea2\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e [\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e]\u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e{\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mike\u0026#34;\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šè¿°å®šä¹‰çš„ä¸¤ä¸ªå˜é‡ï¼Œa1çš„ç±»å‹ä¸º \u003ccode\u003e[1]string\u003c/code\u003eï¼Œa2çš„ç±»å‹ä¸º \u003ccode\u003e[2]string\u003c/code\u003eï¼Œæ‰€ä»¥è¯´ï¼Œæ•°ç»„çš„å¤§å°ä¹Ÿå±äºæ•°ç»„ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚\u003c/p\u003e\n\u003ch3 id=\"æ•°ç»„çš„ä¸¤ä¸ªé™åˆ¶\"\u003eæ•°ç»„çš„ä¸¤ä¸ªé™åˆ¶\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e**ä¸€æ—¦ä¸€ä¸ªæ•°ç»„è¢«å£°æ˜ï¼Œå®ƒçš„å¤§å°å’Œå†…éƒ¨çš„ç±»å‹å°±ä¸èƒ½æ”¹å˜ï¼Œ**æˆ‘ä»¬å°†ä¸èƒ½éšæ„å‘å…¶ä¸­è¿½åŠ ä»»æ„å¤šçš„å…ƒç´ ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå¦å¤–ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨æ•°ç»„å­˜å‚¨å¤§é‡æ•°æ®ï¼Œç„¶åå°†æ•°ç»„ä½œä¸ºå‡½æ•°çš„å‚æ•°è¿›è¡Œä¼ å€¼æ—¶ï¼Œç”±äºå‡½æ•°ä¹‹é—´æ˜¯\u003cstrong\u003eå€¼ä¼ é€’\u003c/strong\u003eçš„ï¼Œå› æ­¤ï¼Œæ•°ç»„çš„æ‹·è´å°†ä¼š\u003cstrong\u003eè€—è´¹å·¨å¤§çš„å†…å­˜\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"slice-åˆ‡ç‰‡\"\u003eslice åˆ‡ç‰‡\u003c/h2\u003e\n\u003cp\u003eæˆ‘ä»¬å¯ä»¥å°†åˆ‡ç‰‡ç†è§£ä¸º\u003cstrong\u003eåŠ¨æ€çš„æ•°ç»„\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eåˆ‡ç‰‡æ˜¯å¯¹æ•°ç»„çš„å°è£…ï¼Œå®ƒçš„åº•å±‚æ˜¯ä¸€ä¸ªæ•°ç»„å­˜å‚¨äº†æ‰€æœ‰çš„å…ƒç´ ï¼Œä½†æ˜¯å®ƒå¯ä»¥åŠ¨æ€åœ°æ·»åŠ å…ƒç´ ï¼Œå®¹é‡ä¸è¶³æ—¶å¯ä»¥è‡ªåŠ¨æ‰©å®¹ã€‚\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 id=\"åŠ¨æ€æ‰©å®¹\"\u003eåŠ¨æ€æ‰©å®¹\u003c/h3\u003e\n\u003cp\u003eä½¿ç”¨å†…ç½®çš„\u003ccode\u003eappend\u003c/code\u003eæ–¹æ³•ï¼Œå‘åˆ‡ç‰‡ä¸­è¿½åŠ å…ƒç´ ï¼Œ\u003cstrong\u003eè¿”å›ä¸€ä¸ªæ–°çš„åˆ‡ç‰‡\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eåŒæ—¶ï¼Œå½“å®¹é‡ä¸è¶³çš„æ—¶å€™ï¼Œ\u003ccode\u003eappend\u003c/code\u003e\u003cstrong\u003eä¼šè‡ªåŠ¨å¯¹åˆ‡ç‰‡è¿›è¡Œæ‰©å®¹ã€‚\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ess\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e []\u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e{\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mike\u0026#34;\u003c/span\u003e} \u003cspan style=\"color:#75715e\"\u003e// å®šä¹‰åˆ‡ç‰‡ss\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;slice before append: %s, length=%d, cap=%d\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ess\u003c/span\u003e, len(\u003cspan style=\"color:#a6e22e\"\u003ess\u003c/span\u003e), cap(\u003cspan style=\"color:#a6e22e\"\u003ess\u003c/span\u003e))    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ess\u003c/span\u003e = append(\u003cspan style=\"color:#a6e22e\"\u003ess\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;lucy\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;john\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#75715e\"\u003e// append è¿½åŠ å…ƒç´ \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;slice after append: %s, length=%d, cap=%d\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ess\u003c/span\u003e, len(\u003cspan style=\"color:#a6e22e\"\u003ess\u003c/span\u003e), cap(\u003cspan style=\"color:#a6e22e\"\u003ess\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¾“å‡ºï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eslice before append: [mike], length=1, cap=1\nslice after append: [mike lucy john], length=3, cap=3\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"æ•°æ®ç»“æ„\"\u003eæ•°æ®ç»“æ„\u003c/h3\u003e\n\u003cp\u003eåˆ‡ç‰‡åœ¨goè¯­è¨€ä¸­æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eSliceHeader\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eData\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003euintptr\u003c/span\u003e\t\u003cspan style=\"color:#75715e\"\u003e// æŒ‡å‘å­˜å‚¨åˆ‡ç‰‡å…ƒç´ çš„æ•°ç»„\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eLen\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e\t\t\t\u003cspan style=\"color:#75715e\"\u003e// åˆ‡ç‰‡é•¿åº¦\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eCap\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e\t\t\t\u003cspan style=\"color:#75715e\"\u003e// åˆ‡ç‰‡å®¹é‡\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¤ºä¾‹è¯æ˜ï¼š\u003c/p\u003e","title":"15.goæ·±å…¥ï¼šSliceHeaderï¼Œé«˜æ•ˆçš„slice"},{"content":"unsafeæ˜¯ä¸å®‰å…¨çš„ï¼Œå¯ä»¥ç»•è¿‡goçš„å®‰å…¨æ£€æŸ¥æœºåˆ¶ï¼Œç›´æ¥å¯¹å†…å­˜è¿›è¡Œè¯»å†™ï¼Œéå¿…è¦ä¸ä½¿ç”¨ã€‚\næŒ‡é’ˆç±»å‹è½¬æ¢ goæ˜¯ä¸€é—¨å¼ºç±»å‹çš„é™æ€è¯­è¨€ï¼Œæ„å‘³ç€ä¸€æ—¦å®šä¹‰äº†ï¼Œç±»å‹å°±ä¸èƒ½æ”¹å˜ï¼Œä¸”ç±»å‹æ£€æŸ¥åœ¨è¿è¡Œå‰å·²ç»å®Œæˆã€‚\nå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œgoä¸å…è®¸ä¸¤ä¸ªæŒ‡é’ˆç±»å‹è¿›è¡Œè½¬æ¢ï¼Œæ¯”å¦‚ *int ä¸èƒ½è½¬æ¢æˆ *floatã€‚\ni := 10 ip := \u0026amp;i var fp *float64 = (*float64)(ip)\t// å°è¯•å°† *int è½¬æ¢æˆ *float64 åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šæŠ¥é”™ï¼š cannot convert ip (type * int) to type * float64ï¼Œæç¤ºä¸å¯è½¬æ¢\nunsafe.Pointer unsafe.Pointerè¡¨ç¤ºä»»æ„ç±»å‹çš„æŒ‡é’ˆï¼Œä¸Šè¿°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ unsafe.Pointerè¿›è¡Œä¸­è½¬ï¼Œå®ç°æŒ‡é’ˆç±»å‹è½¬æ¢\ni := 10 ip := \u0026amp;i var fp *float64 = (*float64)(unsafe.Pointer(ip))\t// å°è¯•å°† *int è½¬æ¢æˆ *float64 *fp = *fp * 3 fmt.Println(i,*fp, ip, fp) è¾“å‡ºï¼š\n30 1.5e-322 0xc0000aa058 0xc0000aa058 å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡è½¬åŒ–åçš„æŒ‡é’ˆä¿®æ”¹æŒ‡å‘å†…å­˜çš„å€¼ï¼ŒåŸå§‹å€¼iä¹Ÿå˜æˆäº†30ï¼Œipå’ŒfpæŒ‡å‘çš„æ˜¯åŒä¸€å—å†…å­˜åœ°å€ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯•å›¾é€šè¿‡ *fp æ‰“å°å‡ºåŸæ¥å†…å­˜çš„æ•°æ®æ—¶ï¼Œå´å‡ºç°äº†ä¸€ä¸ªå¼‚å¸¸å€¼ï¼Œè¯´æ˜æŒ‡é’ˆå¯ä»¥é€šè¿‡ unsafe.Pointer è¿›è¡Œè½¬åŒ–ï¼Œä½†è½¬åŒ–åçš„æŒ‡é’ˆä¸ä¸€å®šå¯ä»¥è®¿é—®åˆ°åŸå§‹å†…å­˜çš„å€¼ã€‚\nunsafe.Pointeræºç å®šä¹‰ï¼š\n// ArbitraryType is here for the purposes of documentation // only and is not actually part of the unsafe package. // It represents the type of an arbitrary Go expression. type ArbitraryType int type Pointer *ArbitraryType ArbitraryTypeå¯ä»¥è¡¨ç¤ºä»»æ„ç±»å‹ï¼Œåœ¨æºç ä¸­åªæ˜¯æ–‡æ¡£éœ€è¦ã€‚unsafe.Pointeræ˜¯ *ArbitraryTypeï¼Œè¡¨ç¤ºé€šç”¨å‹æŒ‡é’ˆï¼Œå¯ä»¥è¡¨ç¤ºä»»ä½•å†…å­˜åœ°å€ã€‚\nuintptr æŒ‡é’ˆç±»å‹ å› ä¸º unsafe.Pointer ä¸èƒ½è¿›è¡Œè¿è¡Œï¼Œå¦‚ + è¿è¡Œæ“ä½œï¼Œå› æ­¤æœ‰ uintptrï¼Œå®ƒè¶³å¤Ÿå¤§ï¼Œå¯ä»¥è¡¨ç¤ºä»»ä½•æŒ‡é’ˆï¼Œä¹Ÿå¯ä»¥å¯¹æŒ‡é’ˆè¿›è¡Œåç§»è®¡ç®—ï¼Œè®¿é—®ç‰¹å®šçš„å†…å­˜ï¼Œå®ç°çœŸæ­£çš„å†…å­˜çº§æ“ä½œã€‚\nuintptrå®šä¹‰ï¼š\n// uintptr is an integer type that is large enough // to hold the bit pattern of any pointer. type uintptr uintptr ä½¿ç”¨ uintpträ¿®æ”¹ç»“æ„ä½“å†…éƒ¨å­—æ®µä¾‹å­ï¼š\nfunc main() { p := new(person) // p.Nameæ˜¯ç¬¬ä¸€ä¸ªå­—æ®µï¼Œå› æ­¤ä¸éœ€è¦åç§» pName := (*string)(unsafe.Pointer(p)) *pName = \u0026#34;Mike\u0026#34; // p.Ageä¸æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µï¼Œéœ€è¦ä½¿ç”¨ uintptr å’Œ unsafe.Offsetof è¿›è¡Œåç§»è®¡ç®— u := uintptr(unsafe.Pointer(p)) + unsafe.Offsetof(p.Age) // è®¡ç®—è¿‡åç§»çš„ uintptr éœ€è¦é€šè¿‡ unsafe.Pointer å†æ¬¡è½¬åŒ–æˆ *intï¼ˆæˆ–è€…*uintï¼‰ pAge := (*int)(unsafe.Pointer(u)) fmt.Println(\u0026#34;address of uintptr of age is : \u0026#34;, u, pAge, \u0026amp;p.Age) *pAge = 20 fmt.Println(*p) } è¾“å‡ºï¼š\naddress of uintptr of age is : 824633737352 0xc000004088 0xc000004088 {Mike 20} å¯ä»¥çœ‹åˆ°ï¼Œè®¡ç®—åç§»åï¼Œ PAge å’Œ p.Age æŒ‡å‘çš„åœ°å€æ˜¯ä¸€æ ·çš„ï¼Œå¯¹åº”çš„å€¼ä¹Ÿä¿®æ”¹æˆåŠŸäº†ã€‚\nä¸Šè¿°æ“ä½œæ­¥éª¤ï¼š\nå…ˆä½¿ç”¨ new å‡½æ•°å£°æ˜ä¸€ä¸ª *person ç±»å‹çš„æŒ‡é’ˆå˜é‡ pã€‚ ç„¶åæŠŠ *person ç±»å‹çš„æŒ‡é’ˆå˜é‡ p é€šè¿‡ unsafe.Pointerï¼Œè½¬æ¢ä¸º *string ç±»å‹çš„æŒ‡é’ˆå˜é‡ pNameã€‚ å› ä¸º person è¿™ä¸ªç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªå­—æ®µå°±æ˜¯ string ç±»å‹çš„ Nameï¼Œæ‰€ä»¥ pName è¿™ä¸ªæŒ‡é’ˆå°±æŒ‡å‘ Name å­—æ®µï¼ˆåç§»ä¸º 0ï¼‰ï¼Œå¯¹ pName è¿›è¡Œä¿®æ”¹å…¶å®å°±æ˜¯ä¿®æ”¹å­—æ®µ Name çš„å€¼ã€‚ å› ä¸º Age å­—æ®µä¸æ˜¯ person çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼Œè¦ä¿®æ”¹å®ƒå¿…é¡»è¦è¿›è¡ŒæŒ‡é’ˆåç§»è¿ç®—ã€‚æ‰€ä»¥éœ€è¦å…ˆæŠŠæŒ‡é’ˆå˜é‡ p é€šè¿‡ unsafe.Pointer è½¬æ¢ä¸º uintptrï¼Œè¿™æ ·æ‰èƒ½è¿›è¡Œåœ°å€è¿ç®—ã€‚æ—¢ç„¶è¦è¿›è¡ŒæŒ‡é’ˆåç§»ï¼Œé‚£ä¹ˆè¦åç§»å¤šå°‘å‘¢ï¼Ÿè¿™ä¸ªåç§»é‡å¯ä»¥é€šè¿‡å‡½æ•° unsafe.Offsetof è®¡ç®—å‡ºæ¥ï¼Œè¯¥å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª uintptr ç±»å‹çš„åç§»é‡ï¼Œæœ‰äº†è¿™ä¸ªåç§»é‡å°±å¯ä»¥é€šè¿‡ + å·è¿ç®—ç¬¦è·å¾—æ­£ç¡®çš„ Age å­—æ®µçš„å†…å­˜åœ°å€äº†ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ unsafe.Pointer è½¬æ¢åçš„ *int ç±»å‹çš„æŒ‡é’ˆå˜é‡ pAgeã€‚ ç„¶åéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¦è¿›è¡ŒæŒ‡é’ˆè¿ç®—ï¼Œè¦å…ˆé€šè¿‡ unsafe.Pointer è½¬æ¢ä¸º uintptr ç±»å‹çš„æŒ‡é’ˆã€‚æŒ‡é’ˆè¿ç®—å®Œæ¯•åï¼Œè¿˜è¦é€šè¿‡ unsafe.Pointer è½¬æ¢ä¸ºçœŸå®çš„æŒ‡é’ˆç±»å‹ï¼ˆæ¯”å¦‚ç¤ºä¾‹ä¸­çš„ *int ç±»å‹ï¼‰ï¼Œè¿™æ ·å¯ä»¥å¯¹è¿™å—å†…å­˜è¿›è¡Œèµ‹å€¼æˆ–å–å€¼æ“ä½œã€‚ æœ‰äº†æŒ‡å‘å­—æ®µ Age çš„æŒ‡é’ˆå˜é‡ pAgeï¼Œå°±å¯ä»¥å¯¹å…¶è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œä¿®æ”¹å­—æ®µ Age çš„å€¼äº†ã€‚ ä¸Šè¿°ä»£ç æ•ˆæœç­‰ä»·äºï¼š\nfunc main() { p := new(person) p.Name = \u0026#34;Mike\u0026#34; p.Age = 20 } æŒ‡é’ˆè½¬æ¢è§„åˆ™ flowchart LR *T \u0026lt;--è½¬æ¢--\u0026gt; unsafe.Pointer \u0026lt;--è½¬æ¢--\u0026gt; uintptr unsafe.Pointerä¸»è¦ç”¨äºæŒ‡é’ˆç±»å‹çš„è½¬æ¢ï¼Œuintpträ¸»è¦ç”¨äºåç§»é‡å®šä½ä¸åŒçš„å†…å­˜ä½ç½®ã€‚\næ€»ç»“ unsafeåŒ…é‡Œçš„åŠŸèƒ½è™½ç„¶ä¸å®‰å…¨ï¼Œä½†å¾ˆå®ç”¨ï¼Œå¦‚æŒ‡é’ˆè¿ç®—ã€ç±»å‹è½¬æ¢ç­‰ï¼Œæœ‰åŠ©äºæˆ‘ä»¬æé«˜æ€§èƒ½ã€‚\n","permalink":"https://zihuanling.github.io/posts/go-14-depth-unsafe/","summary":"\u003cp\u003e\u003ccode\u003eunsafe\u003c/code\u003eæ˜¯ä¸å®‰å…¨çš„ï¼Œå¯ä»¥ç»•è¿‡goçš„å®‰å…¨æ£€æŸ¥æœºåˆ¶ï¼Œç›´æ¥å¯¹å†…å­˜è¿›è¡Œè¯»å†™ï¼Œéå¿…è¦ä¸ä½¿ç”¨ã€‚\u003c/p\u003e\n\u003ch2 id=\"æŒ‡é’ˆç±»å‹è½¬æ¢\"\u003eæŒ‡é’ˆç±»å‹è½¬æ¢\u003c/h2\u003e\n\u003cp\u003egoæ˜¯ä¸€é—¨\u003cstrong\u003eå¼ºç±»å‹çš„é™æ€è¯­è¨€\u003c/strong\u003eï¼Œæ„å‘³ç€ä¸€æ—¦å®šä¹‰äº†ï¼Œç±»å‹å°±ä¸èƒ½æ”¹å˜ï¼Œä¸”ç±»å‹æ£€æŸ¥åœ¨è¿è¡Œå‰å·²ç»å®Œæˆã€‚\u003c/p\u003e\n\u003cp\u003eå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œgoä¸å…è®¸ä¸¤ä¸ªæŒ‡é’ˆç±»å‹è¿›è¡Œè½¬æ¢ï¼Œæ¯”å¦‚ \u003ccode\u003e*int\u003c/code\u003e ä¸èƒ½è½¬æ¢æˆ \u003ccode\u003e*float\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eip\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efp\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efloat64\u003c/span\u003e = (\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efloat64\u003c/span\u003e)(\u003cspan style=\"color:#a6e22e\"\u003eip\u003c/span\u003e)\t\u003cspan style=\"color:#75715e\"\u003e// å°è¯•å°† *int è½¬æ¢æˆ *float64\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šæŠ¥é”™ï¼š \u003ccode\u003ecannot convert ip (type * int) to type * float64\u003c/code\u003eï¼Œæç¤ºä¸å¯è½¬æ¢\u003c/p\u003e\n\u003ch3 id=\"unsafepointer\"\u003eunsafe.Pointer\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eunsafe.Pointer\u003c/code\u003eè¡¨ç¤º\u003cstrong\u003eä»»æ„ç±»å‹çš„æŒ‡é’ˆ\u003c/strong\u003eï¼Œä¸Šè¿°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ \u003ccode\u003eunsafe.Pointer\u003c/code\u003eè¿›è¡Œä¸­è½¬ï¼Œå®ç°æŒ‡é’ˆç±»å‹è½¬æ¢\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eip\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efp\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efloat64\u003c/span\u003e = (\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efloat64\u003c/span\u003e)(\u003cspan style=\"color:#a6e22e\"\u003eunsafe\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePointer\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eip\u003c/span\u003e))\t\u003cspan style=\"color:#75715e\"\u003e// å°è¯•å°† *int è½¬æ¢æˆ *float64\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003efp\u003c/span\u003e = \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003efp\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e,\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003efp\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eip\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003efp\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¾“å‡ºï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e30 1.5e-322 0xc0000aa058 0xc0000aa058\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eå¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡è½¬åŒ–åçš„æŒ‡é’ˆä¿®æ”¹æŒ‡å‘å†…å­˜çš„å€¼ï¼ŒåŸå§‹å€¼\u003cstrong\u003ei\u003c/strong\u003eä¹Ÿå˜æˆäº†30ï¼Œipå’ŒfpæŒ‡å‘çš„æ˜¯åŒä¸€å—å†…å­˜åœ°å€ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯•å›¾é€šè¿‡ \u003ccode\u003e*fp\u003c/code\u003e æ‰“å°å‡ºåŸæ¥å†…å­˜çš„æ•°æ®æ—¶ï¼Œå´å‡ºç°äº†ä¸€ä¸ª\u003cstrong\u003eå¼‚å¸¸å€¼\u003c/strong\u003eï¼Œè¯´æ˜\u003cstrong\u003eæŒ‡é’ˆå¯ä»¥é€šè¿‡ \u003ccode\u003eunsafe.Pointer\u003c/code\u003e è¿›è¡Œè½¬åŒ–ï¼Œä½†è½¬åŒ–åçš„æŒ‡é’ˆä¸ä¸€å®šå¯ä»¥è®¿é—®åˆ°åŸå§‹å†…å­˜çš„å€¼\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eunsafe.Pointer\u003c/code\u003eæºç å®šä¹‰ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ArbitraryType is here for the purposes of documentation\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// only and is not actually part of the unsafe package. \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// It represents the type of an arbitrary Go expression.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eArbitraryType\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ePointer\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eArbitraryType\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003eArbitraryType\u003c/code\u003eå¯ä»¥è¡¨ç¤ºä»»æ„ç±»å‹ï¼Œåœ¨æºç ä¸­åªæ˜¯æ–‡æ¡£éœ€è¦ã€‚\u003ccode\u003eunsafe.Pointer\u003c/code\u003eæ˜¯ \u003ccode\u003e*ArbitraryType\u003c/code\u003eï¼Œè¡¨ç¤º\u003cstrong\u003eé€šç”¨å‹æŒ‡é’ˆ\u003c/strong\u003eï¼Œå¯ä»¥è¡¨ç¤ºä»»ä½•å†…å­˜åœ°å€ã€‚\u003c/p\u003e","title":"14.goæ·±å…¥ï¼šéç±»å‹å®‰å…¨unsafe"},{"content":"å•¥æ˜¯åå°„ goè¯­è¨€ä¸­ï¼Œåå°„ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§å¯ä»¥åœ¨è¿è¡Œæ—¶æ“ä½œä»»æ„ç±»å‹å¯¹è±¡çš„èƒ½åŠ›ï¼Œæ¯”å¦‚ï¼ŒæŸ¥çœ‹ä¸€ä¸ªæ¥å£å˜é‡çš„å…·ä½“ç±»å‹ã€çœ‹ä¸€ä¸ªç»“æ„ä½“æœ‰å¤šå°‘å­—æ®µã€ä¿®æ”¹æŸä¸ªå­—æ®µçš„å€¼ç­‰ã€‚\næ¯”å¦‚ fmt.Printlnï¼š\nfunc Println(a ...interface{}) (n int, err error) { return Fprintln(os.Stdout, a...) } å‡½æ•°å®šä¹‰ä¸­æœ‰ä¸€ä¸ªå¯å˜å‚æ•° a ...interface{}ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œå¯ä»¥ä¼ 1ä¸ªåˆ°å¤šä¸ªå‚æ•°è¿›å»ã€‚\nreflect.Value å’Œ reflect.Type goè¯­è¨€çš„åå°„å®šä¹‰ä¸­ï¼Œä»»ä½•æ¥å£éƒ½æœ‰ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼šæ¥å£çš„å…·ä½“ç±»å‹ï¼Œä»¥åŠå…·ä½“ç±»å‹å¯¹åº”çš„å€¼ã€‚å¦‚ var i in = 3ï¼Œç”±äº interface{}å¯ä»¥è¡¨ç¤ºä»»ä½•ç±»å‹ï¼Œå› æ­¤iå¯ä»¥è½¬åŒ–ä¸º interface{}ï¼Œå°†å…¶å½“åšä¸€ä¸ªæ¥å£ï¼Œæ­¤æ—¶å®ƒåœ¨goåå°„ä¸­å°±è¡¨ç¤ºæˆ \u0026lt;Value, Type\u0026gt;ï¼Œå…¶ä¸­Valueä¸º3ï¼ŒTypeä¸ºintã€‚\ngoåå°„ä¸­ï¼Œæ ‡å‡†åº“ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§ç±»å‹ reflect.Valueå’Œ reflect.Typeåˆ†åˆ«è¡¨ç¤ºå˜é‡çš„å€¼å’Œç±»å‹ï¼Œå¹¶ä¸”å¯ä»¥ç”¨å‡½æ•° reflect.ValueOfå’Œ reflect.TypeOfåˆ†åˆ«è·å–ä»»æ„å¯¹è±¡ Valueå’ŒTypeã€‚\nfunc main(){ var i int = 3 iv := reflect.ValueOf(i) it := reflect.TypeOf(i) fmt.Println(iv, it) } reflect.Value ç»“æ„ä½“å®šä¹‰ reflect.Value å¯ä»¥é€šè¿‡ reflect.ValueOfè·å¾—ï¼Œå…¶ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹\ntype Value struct { typ *rtype ptr unsafe.Pointer flag } å…¶é‡Œé¢çš„å˜é‡éƒ½æ˜¯ç§æœ‰çš„ï¼Œæ„å‘³ç€æˆ‘ä»¬åªèƒ½ä½¿ç”¨å®ƒçš„æ–¹æ³•ï¼Œå®ƒçš„å¸¸ç”¨æ–¹æ³•æœ‰ï¼š\n//é’ˆå¯¹å…·ä½“ç±»å‹çš„ç³»åˆ—æ–¹æ³• //ä»¥ä¸‹æ˜¯ç”¨äºè·å–å¯¹åº”çš„å€¼ Bool Bytes Complex Float Int String Uint CanSet //æ˜¯å¦å¯ä»¥ä¿®æ”¹å¯¹åº”çš„å€¼ // ä»¥ä¸‹æ˜¯ç”¨äºä¿®æ”¹å¯¹åº”çš„å€¼ Set SetBool SetBytes SetComplex SetFloat SetInt SetString Elem //è·å–æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œä¸€èˆ¬ç”¨äºä¿®æ”¹å¯¹åº”çš„å€¼ //ä»¥ä¸‹Fieldç³»åˆ—æ–¹æ³•ç”¨äºè·å–structç±»å‹ä¸­çš„å­—æ®µ Field FieldByIndex FieldByName FieldByNameFunc Interface //è·å–å¯¹åº”çš„åŸå§‹ç±»å‹ IsNil //å€¼æ˜¯å¦ä¸ºnil IsZero //å€¼æ˜¯å¦æ˜¯é›¶å€¼ Kind //è·å–å¯¹åº”çš„ç±»å‹ç±»åˆ«ï¼Œæ¯”å¦‚Arrayã€Sliceã€Mapç­‰ //è·å–å¯¹åº”çš„æ–¹æ³• Method MethodByName NumField //è·å–structç±»å‹ä¸­å­—æ®µçš„æ•°é‡ NumMethod//ç±»å‹ä¸Šæ–¹æ³•é›†çš„æ•°é‡ Type//è·å–å¯¹åº”çš„reflect.Type å¯ä»¥æ€»ç»“ä¸º3ç±»ï¼š\nç”¨æˆ·è·å–å’Œä¿®æ”¹å¯¹åº”çš„å€¼\nå’Œstructç±»å‹çš„å­—æ®µæœ‰å…³\nå’Œç±»å‹ä¸Šçš„æ–¹æ³•é›†æœ‰å…³ï¼Œç”¨äºè·å–å¯¹åº”çš„æ–¹æ³•\nè·å–åŸå§‹ç±»å‹ æˆ‘ä»¬ä½¿ç”¨ reflect.ValueOf å°†ä»»æ„ç±»å‹çš„å¯¹è±¡è½¬ä¸º reflect.Valueï¼Œä¹Ÿå¯ä»¥é€šè¿‡ reflect.Interfaceè¿›è¡Œé€†è½¬æ¢\nfunc main(){ var i int = 3 // int to reflect.Value iv := reflect.ValueOf(i) // reflect.Value to int i1 := iv.Interface().(int) fmt.Println(iv, i1) } ä¿®æ”¹å¯¹åº”çš„å€¼ å·²ç»å®šä¹‰çš„å˜é‡å¯ä»¥é€šè¿‡åå°„ï¼Œåœ¨è¿è¡Œæ—¶ä¿®æ”¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nfunc main() { i := 3 ipv := reflect.ValueOf(\u0026amp;i) ipv.Elem().SetInt(4) fmt.Println(i) } éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ reflect.ValueOf è¿”å›çš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬æƒ³è¦ä¿®æ”¹åŸå§‹å€¼ï¼Œå°±éœ€è¦ä¼ å…¥æŒ‡é’ˆå˜é‡ã€‚\nå› ä¸ºä¼ å…¥çš„æ˜¯æŒ‡é’ˆå˜é‡ï¼Œæ‰€ä»¥éœ€è¦è°ƒç”¨ Elem()æ–¹æ³•ï¼Œæ‰¾åˆ°è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œç„¶åæ‰èƒ½è°ƒç”¨ Set... æ–¹æ³•è¿›è¡Œä¿®æ”¹ã€‚\næ‰€ä»¥ï¼Œä½¿ç”¨è¿è¡Œæ—¶ä¿®æ”¹å˜é‡å€¼çš„å…³é”®ç‚¹åœ¨äºï¼š\nä¼ é€’æŒ‡é’ˆï¼ˆå¯å¯»å€ï¼‰ï¼Œé€šè¿‡ Elemæ–¹æ³•è·å–æŒ‡å‘çš„å€¼ï¼Œæ‰å¯ä»¥ä¿è¯å€¼å¯ä»¥è¢«ä¿®æ”¹ã€‚reflect.Valueä¸ºæˆ‘ä»¬æä¾›äº† CanSetæ–¹æ³•ï¼Œåˆ¤æ–­æ˜¯å¦å¯ä¿®æ”¹è¯¥å˜é‡ã€‚\nä¿®æ”¹structç»“æ„ä½“ä¸­çš„å€¼ï¼Œä¹Ÿæ˜¯åŒç†ï¼š\nä¼ é€’strcutç»“æ„ä½“æŒ‡é’ˆï¼Œè·å– reflect.ValueOf é€šè¿‡ Elemæ–¹æ³•è·å–æŒ‡é’ˆæŒ‡å‘çš„å€¼ é€šè¿‡ Fieldæ–¹æ³•è·å–éœ€è¦ä¿®æ”¹çš„å­—æ®µ é€šè¿‡ Setç³»åˆ—æ–¹æ³•ï¼Œä¿®æ”¹æˆå¯¹åº”çš„å€¼ type person struct { Name string Age uint } func main(){ p := person{Name: \u0026#34;mike\u0026#34;, Age: 10} fmt.Println(\u0026#34;Original person is : \u0026#34;, p) ppv := reflect.ValueOf(\u0026amp;p) ppv.Elem().FieldByName(\u0026#34;Age\u0026#34;).SetUint(20)\t// set age to 20 // ppv.Elem().Field(1).SetUint(20)\t// ä¹Ÿå¯ fmt.Println(\u0026#34;person changed: \u0026#34;, p) } è¾“å‡ºï¼š\nOriginal person is : {mike 10} person changed: {mike 20} å°æ€»ç»“ï¼Œé€šè¿‡åå°„ä¿®æ”¹ä¸€ä¸ªå€¼çš„è§„åˆ™ï¼š\nå¯è¢«å¯»å€ï¼Œå³éœ€è¦å‘ reflect.ValueOf ä¼ é€’ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºå‚æ•° å¦‚æœæƒ³ä¿®æ”¹structç»“æ„ä½“çš„å­—æ®µå€¼ï¼Œåˆ™å¯¹åº”çš„å­—æ®µå¿…é¡»æ˜¯å¯å¯¼å‡ºçš„ï¼Œå³è¯¥å­—æ®µçš„é¦–å­—æ¯æ˜¯å¤§å†™çš„ éœ€è¦ä½¿ç”¨ Elem æ–¹æ³•è·å¾—æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œæ‰èƒ½é€šè¿‡ Set ç³»åˆ—æ–¹æ³•è¿›è¡Œä¿®æ”¹ è·å–å¯¹åº”çš„åº•å±‚ç±»å‹ å¯ä»¥ä½¿ç”¨ Kind æ–¹æ³•è·å–å¯¹åº”çš„åº•å±‚ç±»å‹ï¼š\nfunc main(){ p := person{\u0026#34;Mike\u0026#34;, 20} ppv := reflect.ValueOf(\u0026amp;p) pv := reflect.ValueOf(p) fmt.Println(ppv.Kind(), pv.Kind())\t// ptr, struct } Kindè¿”å›çš„å€¼å¯ä»¥ä¸ºï¼š\ntype Kind uint const ( Invalid Kind = iota Bool Int Int8 Int16 Int32 Int64 Uint Uint8 Uint16 Uint32 Uint64 Uintptr Float32 Float64 Complex64 Complex128 Array Chan Func Interface Map Ptr Slice String Struct UnsafePointer ) reflect.Type æˆ‘ä»¬ä½¿ç”¨ reflect.TypeOf è·å–ä¸€ä¸ª reflect.Typeã€‚\nreflect.Value ç”¨äºäºå€¼æœ‰å…³çš„æ“ä½œä¸­ï¼Œè€Œå¦‚æœæ˜¯å’Œå˜é‡ç±»å‹æœ¬èº«æœ‰å…³çš„æ“ä½œï¼Œåˆ™æœ€å¥½ä½¿ç”¨reflectTypeï¼Œå¦‚ï¼šè·å–ç»“æ„ä½“å¯¹åº”çš„å­—æ®µåç§°æˆ–æ–¹æ³•ã€‚\næ¥å£å®šä¹‰ reflect.Valueæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œè€Œ reflect.Typeæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¤§éƒ¨åˆ†å¸¸ç”¨æ–¹æ³•åŒ reflect.Valueæ˜¯ç›¸åŒçš„ï¼Œå¦‚ä¸‹ï¼š\ntype Type interface { Implements(u Type) bool AssignableTo(u Type) bool ConvertibleTo(u Type) bool Comparable() bool // åŒ reflect.ValueåŠŸèƒ½ç›¸åŒ Kind() Kind Method(int) Method MethodByName(string) (Method, bool) NumMethod() int Elem() Type Field(i int) StructField FieldByIndex(index []int) StructField FieldByName(name string) (StructField, bool) FieldByNameFunc(match func(string) bool) (StructField, bool) NumField() int } ç‰¹æœ‰çš„æ–¹æ³•ï¼š\nImplementsï¼šç”¨äºåˆ¤æ–­æ˜¯å¦å®ç°äº†è¯¥æ¥å£ AssignableToï¼šç”¨äºåˆ¤æ–­æ˜¯å¦å¯ä»¥èµ‹å€¼ç»™ç±»å‹uï¼Œå³ä½¿ç”¨=è¿›è¡Œèµ‹å€¼ ConvertibleToï¼šç”¨äºåˆ¤æ–­æ˜¯å¦å¯ä»¥è½¬æ¢ä¸ºç±»å‹u Comparableï¼šç”¨äºåˆ¤æ–­è¯¥ç±»å‹æ˜¯å¦å¯æ¯”è¾ƒï¼Œä½¿ç”¨å…³ç³»è¿ç®—ç¬¦è¿›è¡Œæ¯”è¾ƒ éå†ç»“æ„ä½“çš„å­—æ®µå’Œæ–¹æ³• // å®ç°Stringæ–¹æ³• func (p person) String() string { return fmt.Sprintf(\u0026#34;This person name is %s, age = %d\u0026#34;, p.Name, p.Age) } func main(){ p := person{\u0026#34;Mike\u0026#34;, 20} pt := reflect.TypeOf(p) // éå†å­—æ®µ for i := 0; i \u0026lt; pt.NumField(); i++ { fmt.Printf(\u0026#34;Field %d: %s\\n\u0026#34;, i+1, pt.Field(i).Name) } // éå†æ–¹æ³• for i := 0; i \u0026lt; pt.NumMethod(); i++ { fmt.Printf(\u0026#34;Method %d: %s\\n\u0026#34;, i+1, pt.Method(i).Name) } } è¾“å‡ºï¼š\nField 1: Name Field 2: Age Method 1: String æ˜¯å¦å®ç°æŸæ¥å£ ä¸‹é¢æ£€æŸ¥personæ˜¯å¦å®ç° fmt.Stringer å’Œ io.Writer æ¥å£ï¼š\nfunc main(){ p := person{\u0026#34;Mike\u0026#34;, 20} pt := reflect.TypeOf(p) stringerType := reflect.TypeOf((*fmt.Stringer)(nil)).Elem() writerType := reflect.TypeOf((*io.Writer)(nil)).Elem() fmt.Println(\u0026#34;person implement stringer: \u0026#34;, pt.Implements(stringerType)) fmt.Println(\u0026#34;person implement writer: \u0026#34;, pt.Implements(writerType)) } è¾“å‡ºï¼š\nperson implement stringer: true person implement writer: false ç”±äº fmt.Stringer æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè€Œä¼ å…¥ reflect.TypeOf é‡Œé¢çš„å¿…é¡»æ˜¯ä¸€ä¸ªå€¼ï¼Œå› æ­¤éœ€è¦è½¬åŒ–ä¸€ä¸‹ï¼Œä¼ å…¥ä¸€ä¸ªç©ºæ¥å£æŒ‡é’ˆ (*fmt.Stringer)(nil)ï¼Œç„¶åå–å…¶å¯¹åº”çš„ Elem è¿›è¡Œåˆ¤æ–­ã€‚\nè¿™æ ·çš„åšæ³•å¾ˆå°‘ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨æ–­è¨€è¿›è¡Œåˆ¤æ–­ï¼Œè€Œä¸æ˜¯åå°„ï¼Œä»¥ä¸‹å†™æ³•æ›´ç®€å•ï¼š\nfunc main(){ p := person{\u0026#34;Mike\u0026#34;, 20} pt := reflect.TypeOf(p) _, ok := pt.(fmt.Stringer) fmt.Println(\u0026#34;Stringer implemented by person: \u0026#34;, ok) } é€šè¿‡åå°„è°ƒç”¨æ–¹æ³• type person struct { Name string `json:\u0026#34;name\u0026#34;` Age uint\t`json:\u0026#34;age\u0026#34;` } func (p person) Greet(who string) { fmt.Printf(\u0026#34;Hello! %s is greeting to %s.\\n\u0026#34;, who, p.Name) } func main() { p := person{Name: \u0026#34;Mike\u0026#34;, Age: 10} pv := reflect.ValueOf(p) method := pv.MethodByName(\u0026#34;Greet\u0026#34;) // call method args := []reflect.Value{ reflect.ValueOf(\u0026#34;Amy\u0026#34;), } // ç›¸å½“äº p.Greet(\u0026#34;Amy\u0026#34;) method.Call(args) /* // åŒæ ·å¯ä»¥è¿™æ ·å†™ pt := reflect.TypeOf(p) method, ok := pt.MethodByName(\u0026#34;Greet\u0026#34;) if !ok { fmt.Println(\u0026#34;Method [Greet] not exist\u0026#34;) } else { // call method args := []reflect.Value{ reflect.ValueOf(p), reflect.ValueOf(\u0026#34;Amy\u0026#34;), } // ç›¸å½“äº Greet(p, \u0026#34;Amy\u0026#34;) method.Func.Call(args) } */ } è¾“å‡ºï¼š\nHello! Amy is greeting to Mike. å­—ç¬¦ä¸²å’Œç»“æ„ä½“äº’æ¢ å­—ç¬¦ä¸²å’Œç»“æ„ä½“äº’è½¬ï¼Œæœ€å¤šæ˜¯Jsonå’ŒStructäº’ç›¸è½¬æ¢ï¼Œè¿™æ ·çš„è½¬æ¢ç›¸å½“äºpythoné‡Œé¢å°†å­—å…¸åºåˆ—åŒ–æˆä¸ºjsonå­—ç¬¦ä¸²æˆ–è€…ååºåˆ—åŒ–ã€‚\nJsonå’ŒStructäº’è½¬ goè¯­è¨€æä¾›äº†ä¸€ä¸ªjsonåŒ…ï¼Œå¯ä»¥è®©æˆ‘ä»¬å®ç°jsonå­—ç¬¦ä¸²å’Œstructç»“æ„ä½“çš„äº’è½¬ï¼š\nfunc main() { p := person{Name: \u0026#34;Mike\u0026#34;, Age: 10} // struct è½¬æ¢æˆå­—ç¬¦ä¸² pJson, err := json.Marshal(p) if err == nil { fmt.Printf(\u0026#34;pJson string : %s\\n\u0026#34;, pJson) } // Json å­—ç¬¦ä¸²è½¬åŒ–ä¸ºstructç»“æ„ä½“ jsonString := \u0026#34;{\\\u0026#34;Name\\\u0026#34;: \\\u0026#34;Jack\\\u0026#34;, \\\u0026#34;Age\\\u0026#34;: 20}\u0026#34; if err := json.Unmarshal([]byte(jsonString), \u0026amp;p); err == nil { fmt.Printf(\u0026#34;Unmarshaled struct: %s\\n\u0026#34;, p) } else { fmt.Printf(\u0026#34;Error unmarshal: %e\\n\u0026#34;, err) } } è¾“å‡ºï¼š\npJson string : {\u0026#34;Name\u0026#34;:\u0026#34;Mike\u0026#34;,\u0026#34;Age\u0026#34;:10} Unmarshaled struct: This person name is Jack, age = 20 é€šè¿‡ json.Marshal å°†structè½¬åŒ–æˆ å­—ç¬¦ä¸²ï¼ˆè¿”å›çš„æ˜¯ []byteï¼‰ é€šè¿‡ json.Unmarshal å°†jsonå­—ç¬¦ä¸²ï¼ˆ[]byteï¼‰è½¬åŒ–æˆ strcutç»“æ„ä½“ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœ person çš„å®šä¹‰ä¸­ï¼Œå«æœ‰ç§æœ‰æˆå‘˜å˜é‡ï¼ˆå°å†™å¼€å¤´ï¼‰ï¼Œé‚£ä¹ˆåœ¨jsonåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå°†ä¸ä¼šè§£æ/èµ‹å€¼è¯¥å­—æ®µã€‚\nStruct Tag Struct Tagæ˜¯structç»“æ„ä½“å­—æ®µçš„æ ‡ç­¾ï¼Œç”¨å…¶è¾…åŠ©å®Œæˆä¸€äº›é¢å¤–çš„æ“ä½œï¼Œå¦‚æœ jsonå’Œstruct äº’è½¬ï¼Œä½¿ç”¨tagè®©jsonåŒ–çš„å­—æ®µå˜æˆå°å†™ï¼š\ntype person struct { Name string `json:\u0026#34;name\u0026#34;` Age uint\t`json:\u0026#34;age\u0026#34;` } func main() { p := person{Name: \u0026#34;Mike\u0026#34;, Age: 10} // struct è½¬æ¢æˆå­—ç¬¦ä¸² pJson, err := json.Marshal(p) if err == nil { fmt.Printf(\u0026#34;pJson string : %s\\n\u0026#34;, pJson) } // Json å­—ç¬¦ä¸²è½¬åŒ–ä¸ºstructç»“æ„ä½“ jsonString := \u0026#34;{\\\u0026#34;name\\\u0026#34;: \\\u0026#34;Jack\\\u0026#34;, \\\u0026#34;age\\\u0026#34;: 20}\u0026#34; if err := json.Unmarshal([]byte(jsonString), \u0026amp;p); err == nil { fmt.Printf(\u0026#34;Unmarshaled struct: %s\\n\u0026#34;, p) } } è¾“å‡ºï¼š\npJson string : {\u0026#34;name\u0026#34;:\u0026#34;Mike\u0026#34;,\u0026#34;age\u0026#34;:10} Unmarshaled struct: This person name is Jack, age = 20 éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œjson.Unmarshalä¼ å…¥çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœå­˜åœ¨ \u0026quot;{\\\u0026quot;age\\\u0026quot;: 10, \\\u0026quot;Age\\\u0026quot;: 20}\u0026quot; ä¸¤ä¸ªå­—æ®µï¼Œé‚£ä¹ˆåœ¨ååºåˆ—åŒ–ä¹‹åï¼Œå¾—åˆ°çš„ç»“æ„ä½“å¯¹åº”çš„å€¼æ˜¯æœ€åä¸€ä¸ªï¼Œå³20ã€‚\næˆ‘ä»¬é€šè¿‡åå°„è·å–ç»“æ„ä½“çš„tagï¼Œé€šè¿‡ Fieldæ–¹æ³•è¿”å›ä¸€ä¸ªStructFieldï¼Œç„¶åå–Tag.Get è·å–å¯¹åº”çš„tag\nfunc main() { p := person{Name: \u0026#34;Mike\u0026#34;, Age: 10} pt := reflect.TypeOf(p) for i := 0; i \u0026lt; pt.NumField(); i++ { f := pt.Field(i) fmt.Println(f.Tag.Get(\u0026#34;json\u0026#34;)) } } åŒä¸€ä¸ªç»“æ„ä½“å¯ä»¥å®šä¹‰å¤šä¸ªtagï¼š\ntype person struct { Name string `json:\u0026#34;name\u0026#34; bson:\u0026#34;b_name\u0026#34;` Age uint `json:\u0026#34;age\u0026#34; bson:\u0026#34;b_age\u0026#34;` } å®ç°Structè½¬Json func StructToJson(i interface{}) string { builder := strings.Builder{} builder.WriteString(\u0026#34;{\u0026#34;) iv := reflect.ValueOf(i) it := reflect.TypeOf(i) numFields := it.NumField() for i := 0; i \u0026lt; numFields; i++ { f := it.Field(i) jTag := f.Tag.Get(\u0026#34;json\u0026#34;) builder.WriteString(\u0026#34;\\\u0026#34;\u0026#34; + jTag + \u0026#34;\\\u0026#34;:\u0026#34;) builder.WriteString(fmt.Sprintf(\u0026#34;\\\u0026#34;%v\\\u0026#34;\u0026#34;, iv.Field(i))) if i \u0026lt; numFields - 1 { builder.WriteString(\u0026#34;,\u0026#34;) } } builder.WriteString(\u0026#34;}\u0026#34;) return fmt.Sprintf(\u0026#34;%s\u0026#34;, builder.String()) } func main() { p := person{Name: \u0026#34;Mike\u0026#34;, Age: 10} s := StructToJson(p) fmt.Println(s) } è¾“å‡ºï¼š\n{\u0026#34;name\u0026#34;:Mike,\u0026#34;age\u0026#34;:10} åå°„å®šå¾‹ åå°„æ˜¯è®¡ç®—æœºè¯­è¨€ä¸­ç¨‹åºæ£€è§†è‡ªèº«ç»“æ„çš„ä¸€ç§æ–¹æ³•ï¼Œçµæ´»ã€å¼ºå¤§ï¼Œå¯ä»¥ç»•è¿‡ç¼–è¯‘å™¨çš„å¾ˆå¤šé™æ€æ£€æŸ¥ï¼Œè¿‡å¤šä½¿ç”¨ä¼šé€ æˆæ··ä¹±ã€‚\nä»»ä½•æ¥å£å€¼ interface{}éƒ½å¯ä»¥åå°„å‡ºåå°„å¯¹è±¡ï¼Œå³ reflect.Valueå’Œreflect.Typeï¼Œé€šè¿‡å‡½æ•° reflect.ValueOfå’Œreflect.TypeOfè·å¾— åå°„å¯¹è±¡ä¹Ÿå¯ä»¥è¿˜åŸä¸º interface{}å˜é‡ï¼Œå³å®šå¾‹1 çš„å¯é€†æ€§ï¼Œé€šè¿‡ reflect.Valueçš„ Interfaceæ–¹æ³•è·å¾— è¦ä¿®æ”¹åå°„çš„å¯¹è±¡ï¼Œè¯¥å€¼å¿…é¡»å¯è®¾ç½®ï¼ˆä¼ å…¥æŒ‡é’ˆï¼‰ æ€»ç»“ åœ¨åå°„ä¸­ï¼Œè·å–å˜é‡çš„å€¼ã€ä¿®æ”¹å˜é‡çš„å€¼ç­‰ï¼Œä¼˜å…ˆä½¿ç”¨ reflect.Valueï¼›è·å–ç»“æ„ä½“å†…çš„å­—æ®µã€ç±»å‹æ‹¥æœ‰çš„æ–¹æ³•é›†ç­‰ï¼Œä¼˜å…ˆä½¿ç”¨ reflect.Type\n","permalink":"https://zihuanling.github.io/posts/go-13-depth-reflect/","summary":"\u003ch2 id=\"å•¥æ˜¯åå°„\"\u003eå•¥æ˜¯åå°„\u003c/h2\u003e\n\u003cp\u003egoè¯­è¨€ä¸­ï¼Œåå°„ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§å¯ä»¥åœ¨è¿è¡Œæ—¶æ“ä½œä»»æ„ç±»å‹å¯¹è±¡çš„èƒ½åŠ›ï¼Œæ¯”å¦‚ï¼ŒæŸ¥çœ‹ä¸€ä¸ªæ¥å£å˜é‡çš„å…·ä½“ç±»å‹ã€çœ‹ä¸€ä¸ªç»“æ„ä½“æœ‰å¤šå°‘å­—æ®µã€ä¿®æ”¹æŸä¸ªå­—æ®µçš„å€¼ç­‰ã€‚\u003c/p\u003e\n\u003cp\u003eæ¯”å¦‚ \u003ccode\u003efmt.Println\u003c/code\u003eï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e...\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003einterface\u003c/span\u003e{}) (\u003cspan style=\"color:#a6e22e\"\u003en\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eerror\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eFprintln\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eos\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eStdout\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e...\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå‡½æ•°å®šä¹‰ä¸­æœ‰ä¸€ä¸ªå¯å˜å‚æ•° \u003ccode\u003ea ...interface{}\u003c/code\u003eï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œå¯ä»¥ä¼ 1ä¸ªåˆ°å¤šä¸ªå‚æ•°è¿›å»ã€‚\u003c/p\u003e\n\u003ch2 id=\"reflectvalue-å’Œ-reflecttype\"\u003ereflect.Value å’Œ reflect.Type\u003c/h2\u003e\n\u003cp\u003egoè¯­è¨€çš„åå°„å®šä¹‰ä¸­ï¼Œä»»ä½•æ¥å£éƒ½æœ‰ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼š\u003cstrong\u003eæ¥å£çš„å…·ä½“ç±»å‹ï¼Œä»¥åŠå…·ä½“ç±»å‹å¯¹åº”çš„å€¼\u003c/strong\u003eã€‚å¦‚ \u003ccode\u003evar i in = 3\u003c/code\u003eï¼Œç”±äº \u003ccode\u003einterface{}\u003c/code\u003eå¯ä»¥è¡¨ç¤ºä»»ä½•ç±»å‹ï¼Œå› æ­¤\u003cstrong\u003ei\u003c/strong\u003eå¯ä»¥è½¬åŒ–ä¸º \u003ccode\u003einterface{}\u003c/code\u003eï¼Œå°†å…¶å½“åšä¸€ä¸ªæ¥å£ï¼Œæ­¤æ—¶å®ƒåœ¨goåå°„ä¸­å°±è¡¨ç¤ºæˆ \u003ccode\u003e\u0026lt;Value, Type\u0026gt;\u003c/code\u003eï¼Œå…¶ä¸­Valueä¸º3ï¼ŒTypeä¸ºintã€‚\u003c/p\u003e\n\u003cp\u003egoåå°„ä¸­ï¼Œæ ‡å‡†åº“ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§ç±»å‹ \u003ccode\u003ereflect.Value\u003c/code\u003eå’Œ \u003ccode\u003ereflect.Type\u003c/code\u003eåˆ†åˆ«è¡¨ç¤ºå˜é‡çš„å€¼å’Œç±»å‹ï¼Œå¹¶ä¸”å¯ä»¥ç”¨å‡½æ•° \u003ccode\u003ereflect.ValueOf\u003c/code\u003eå’Œ \u003ccode\u003ereflect.TypeOf\u003c/code\u003eåˆ†åˆ«è·å–\u003cstrong\u003eä»»æ„å¯¹è±¡\u003c/strong\u003e Valueå’ŒTypeã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e = \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eiv\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereflect\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eValueOf\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eit\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereflect\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eTypeOf\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eiv\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eit\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"reflectvalue\"\u003ereflect.Value\u003c/h3\u003e\n\u003ch4 id=\"ç»“æ„ä½“å®šä¹‰\"\u003eç»“æ„ä½“å®šä¹‰\u003c/h4\u003e\n\u003cp\u003ereflect.Value å¯ä»¥é€šè¿‡ \u003ccode\u003ereflect.ValueOf\u003c/code\u003eè·å¾—ï¼Œå…¶ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eValue\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003etyp\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ertype\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eptr\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eunsafe\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePointer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eflag\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå…¶é‡Œé¢çš„å˜é‡éƒ½æ˜¯ç§æœ‰çš„ï¼Œæ„å‘³ç€æˆ‘ä»¬åªèƒ½ä½¿ç”¨å®ƒçš„æ–¹æ³•ï¼Œå®ƒçš„å¸¸ç”¨æ–¹æ³•æœ‰ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e//é’ˆå¯¹å…·ä½“ç±»å‹çš„ç³»åˆ—æ–¹æ³•\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e//ä»¥ä¸‹æ˜¯ç”¨äºè·å–å¯¹åº”çš„å€¼\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eBool\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eBytes\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eComplex\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eFloat\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eInt\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eString\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eUint\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eCanSet\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e//æ˜¯å¦å¯ä»¥ä¿®æ”¹å¯¹åº”çš„å€¼\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ä»¥ä¸‹æ˜¯ç”¨äºä¿®æ”¹å¯¹åº”çš„å€¼\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eSet\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eSetBool\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eSetBytes\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eSetComplex\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eSetFloat\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eSetInt\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eSetString\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eElem\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e//è·å–æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œä¸€èˆ¬ç”¨äºä¿®æ”¹å¯¹åº”çš„å€¼\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e//ä»¥ä¸‹Fieldç³»åˆ—æ–¹æ³•ç”¨äºè·å–structç±»å‹ä¸­çš„å­—æ®µ\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eField\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eFieldByIndex\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eFieldByName\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eFieldByNameFunc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eInterface\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e//è·å–å¯¹åº”çš„åŸå§‹ç±»å‹\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eIsNil\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e//å€¼æ˜¯å¦ä¸ºnil\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eIsZero\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e//å€¼æ˜¯å¦æ˜¯é›¶å€¼\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eKind\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e//è·å–å¯¹åº”çš„ç±»å‹ç±»åˆ«ï¼Œæ¯”å¦‚Arrayã€Sliceã€Mapç­‰\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e//è·å–å¯¹åº”çš„æ–¹æ³•\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eMethod\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eMethodByName\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eNumField\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e//è·å–structç±»å‹ä¸­å­—æ®µçš„æ•°é‡\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eNumMethod\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e//ç±»å‹ä¸Šæ–¹æ³•é›†çš„æ•°é‡\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eType\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e//è·å–å¯¹åº”çš„reflect.Type\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¯ä»¥æ€»ç»“ä¸º3ç±»ï¼š\u003c/p\u003e","title":"13.goæ·±å…¥ï¼šreflect è¿è¡Œæ—¶åå°„"},{"content":"Goè¯­è¨€ç¨‹åºæ‰€ç®¡ç†çš„è™šæ‹Ÿå†…å­˜ç©ºé—´ä¼šè¢«åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šå †å†…å­˜å’Œæ ˆå†…å­˜ã€‚æ ˆå†…å­˜ä¸»è¦ç”±Goè¯­è¨€æ¥ç®¡ç†ï¼Œå¼€å‘è€…æ— æ³•å¹²æ¶‰å¤ªå¤šï¼Œå †å†…å­˜åˆ™æœ‰å¼€å‘è€…è¿›è¡Œåˆ†é…ã€‚\nå˜é‡ ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œåœ¨å£°æ˜ä¹‹åï¼Œä¼šè¢«èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œå˜é‡å­˜å‚¨äº†ç¨‹åºæ‰€éœ€çš„æ•°æ®ã€‚\nå˜é‡çš„å£°æ˜ å•çº¯çš„å£°æ˜å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨varå…³é”®å­—ï¼Œå¦‚ï¼š\nvar s string\t// å£°æ˜ä¸€ä¸ª[å­—ç¬¦ä¸²]å˜é‡ï¼Œåˆå§‹å€¼ä¸ºé›¶å€¼\u0026#34;\u0026#34; var sp *string\t// å£°æ˜ä¸€ä¸ª[å­—ç¬¦ä¸²æŒ‡é’ˆ]å˜é‡ï¼Œåˆå§‹å€¼ä¸º nil å˜é‡çš„åˆå§‹åŒ– æœ‰3ç§æ–¹æ³•\nå£°æ˜çš„æ—¶å€™ç›´æ¥åˆå§‹åŒ–ï¼š var name string = \u0026quot;mike\u0026quot; å£°æ˜ä¹‹åå†è¿›è¡Œèµ‹å€¼åˆå§‹åŒ–ï¼š name = \u0026quot;mike\u0026quot;,æ­¤å‰ name å˜é‡å·²ç»å£°æ˜ ç›´æ¥ä½¿ç”¨ := è¿›è¡Œåˆå§‹åŒ–ï¼š name := \u0026quot;mike\u0026quot; å€¼å˜é‡å’ŒæŒ‡é’ˆå˜é‡åˆå§‹åŒ–çš„åŒºåˆ« æˆ‘ä»¬ä½¿ç”¨å€¼åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå¯ä»¥ç®€å•çš„è¿™æ ·å†™ï¼š\nvar name string name = \u0026#34;mike\u0026#34; ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨æŒ‡é’ˆåˆå§‹åŒ–çš„æ—¶å€™ï¼š\nvar nameP *string // å£°æ˜ä¸€ä¸ªå­—ç¬¦ä¸²æŒ‡é’ˆ *nameP = \u0026#34;mike\u0026#34;\t// ç»™namePæŒ‡å‘çš„åœ°å€èµ‹å€¼åˆå§‹åŒ– è¿™æ—¶å€™ï¼Œç”±äº nameP æŒ‡å‘çš„æ˜¯ä¸€ä¸ªç©ºåœ°å€ nilï¼Œæˆ‘ä»¬å¯¹è¿™ä¸ªç©ºåœ°å€è¿›è¡Œèµ‹å€¼åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šæŠ¥ä»¥ä¸‹é”™è¯¯ï¼š\npanic: runtime error: invalid memory address or nil pointer dereference æ˜¾è€Œæ˜“è§ï¼Œæˆ‘ä»¬æ— æ³•å¯¹ä¸€ä¸ªç©ºåœ°å€èµ‹å€¼ã€‚\nå› æ­¤ï¼Œ**å¦‚æœè¦å¯¹ä¸€ä¸ªå˜é‡èµ‹å€¼ï¼Œè¿™ä¸ªå˜é‡å¿…é¡»æœ‰å¯¹åº”çš„åˆ†é…å¥½çš„å†…å­˜ï¼Œè¿™æ ·æ‰å¯ä»¥å¯¹è¿™å—å†…å­˜æ“ä½œï¼Œå®Œæˆèµ‹å€¼çš„ç›®çš„ã€‚**ä¸æ­¢æ˜¯èµ‹å€¼æ“ä½œï¼Œé’ˆå¯¹æŒ‡é’ˆå˜é‡ï¼Œå¦‚æœæ²¡æœ‰åˆ†é…å†…å­˜ï¼Œå¯¹å…¶è¿›è¡Œå–å€¼æ—¶ä¸€æ ·ä¼šæŠ¥ nilå¼‚å¸¸ï¼Œå› ä¸ºæ²¡æœ‰å¯ä»¥æ“ä½œçš„å†…å­˜ã€‚\nnewå‡½æ•° å£°æ˜æŒ‡é’ˆå˜é‡çš„æ—¶å€™ï¼Œæ˜¯é»˜è®¤æ²¡æœ‰åˆ†é…å†…å­˜çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ new å‡½æ•°æ¥è¿›è¡Œå†…å­˜çš„åˆ†é…ï¼š\nvar nameP *string nameP = new(string) // åˆ†é…ä¸€å—stringç±»å‹çš„å†…å­˜ *nameP := \u0026#34;mike\u0026#34; fmt.Println(*nameP) è¿™æ ·ï¼Œæˆ‘ä»¬çš„namePå˜é‡æŒ‡å‘çš„å°±ä¸æ˜¯ä¸€ä¸ª nil ç©ºåœ°å€äº†ï¼Œè€Œæ˜¯æŒ‡å‘äº†ä¸€å—å…·ä½“çš„å­—ç¬¦ä¸²çš„å†…å­˜ã€‚å› æ­¤å¯ä»¥å¯¹å…¶è¿›è¡Œèµ‹å€¼æ“ä½œã€‚\nnewå‡½æ•°æºç  // The new built-in function allocates memory. The first argument is a type, // not a value, and the value returned is a pointer to a newly // allocated zero value of that type. func new(Type) *Type æ‰€ä»¥ newå°±æ˜¯æ ¹æ®ä¼ å…¥çš„ç±»å‹ï¼Œç”³è¯·ä¸€å—å†…å­˜ï¼Œç„¶åè¿”å›æŒ‡å‘è¿™å—å†…å­˜çš„æŒ‡é’ˆï¼Œè¯¥å—å†…å­˜åˆå§‹åŒ–çš„æ•°æ®å°±æ˜¯è¯¥ç±»å‹çš„é›¶å€¼ã€‚\nmakeå‡½æ•° makeå‡½æ•°æ˜¯mapã€sliceã€chançš„å·¥å‚å‡½æ•°ï¼Œå¯ä»¥åŒæ—¶ç”¨äºä¸‰ç§ç±»å‹çš„åˆå§‹åŒ–ã€‚\næ€»ç»“ newå‡½æ•°åªç”¨äºåˆ†é…å†…å­˜ï¼Œå¹¶ä¸”æŠŠå†…å­˜æ¸…é›¶ï¼Œä¹Ÿå°±æ˜¯è¿”å›ä¸€ä¸ªæŒ‡å‘å¯¹åº”ç±»å‹çš„é›¶å€¼çš„æŒ‡é’ˆã€‚newå‡½æ•°ä¸€èˆ¬ç”¨äºéœ€è¦æ˜¾å¼åœ°è¿”å›æŒ‡é’ˆçš„æƒ…å†µï¼Œä¸å¸¸ç”¨ã€‚\nmakeå‡½æ•°åªç”¨äºsliceã€chanã€mapä¸‰ç§å†…ç½®ç±»å‹çš„åˆ›å»ºå’Œåˆå§‹åŒ–ï¼Œå› ä¸ºè¿™ä¸‰ç§ç±»å‹çš„ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œå¦‚ slice è¦æå‰åˆå§‹åŒ–å¥½å†…éƒ¨å…ƒç´ çš„ç±»å‹ï¼Œsliceçš„é•¿åº¦å’Œå®¹é‡ç­‰ï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½åœ°ä½¿ç”¨å®ƒä»¬ã€‚\n","permalink":"https://zihuanling.github.io/posts/go-12-depth-new-and-make/","summary":"\u003cp\u003eGoè¯­è¨€ç¨‹åºæ‰€ç®¡ç†çš„è™šæ‹Ÿå†…å­˜ç©ºé—´ä¼šè¢«åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šå †å†…å­˜å’Œæ ˆå†…å­˜ã€‚æ ˆå†…å­˜ä¸»è¦ç”±Goè¯­è¨€æ¥ç®¡ç†ï¼Œå¼€å‘è€…æ— æ³•å¹²æ¶‰å¤ªå¤šï¼Œå †å†…å­˜åˆ™æœ‰å¼€å‘è€…è¿›è¡Œåˆ†é…ã€‚\u003c/p\u003e\n\u003ch2 id=\"å˜é‡\"\u003eå˜é‡\u003c/h2\u003e\n\u003cp\u003eä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œåœ¨å£°æ˜ä¹‹åï¼Œä¼šè¢«èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œå˜é‡å­˜å‚¨äº†ç¨‹åºæ‰€éœ€çš„æ•°æ®ã€‚\u003c/p\u003e\n\u003ch3 id=\"å˜é‡çš„å£°æ˜\"\u003eå˜é‡çš„å£°æ˜\u003c/h3\u003e\n\u003cp\u003eå•çº¯çš„å£°æ˜å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨\u003ccode\u003evar\u003c/code\u003eå…³é”®å­—ï¼Œå¦‚ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003es\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e// å£°æ˜ä¸€ä¸ª[å­—ç¬¦ä¸²]å˜é‡ï¼Œåˆå§‹å€¼ä¸ºé›¶å€¼\u0026#34;\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esp\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e// å£°æ˜ä¸€ä¸ª[å­—ç¬¦ä¸²æŒ‡é’ˆ]å˜é‡ï¼Œåˆå§‹å€¼ä¸º nil\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"å˜é‡çš„åˆå§‹åŒ–\"\u003eå˜é‡çš„åˆå§‹åŒ–\u003c/h3\u003e\n\u003cp\u003eæœ‰3ç§æ–¹æ³•\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå£°æ˜çš„æ—¶å€™ç›´æ¥åˆå§‹åŒ–ï¼š \u003ccode\u003evar name string = \u0026quot;mike\u0026quot;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eå£°æ˜ä¹‹åå†è¿›è¡Œèµ‹å€¼åˆå§‹åŒ–ï¼š \u003ccode\u003ename = \u0026quot;mike\u0026quot;\u003c/code\u003e,æ­¤å‰ \u003ccode\u003ename\u003c/code\u003e å˜é‡å·²ç»å£°æ˜\u003c/li\u003e\n\u003cli\u003eç›´æ¥ä½¿ç”¨ \u003ccode\u003e:=\u003c/code\u003e è¿›è¡Œåˆå§‹åŒ–ï¼š \u003ccode\u003ename := \u0026quot;mike\u0026quot;\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"å€¼å˜é‡å’ŒæŒ‡é’ˆå˜é‡åˆå§‹åŒ–çš„åŒºåˆ«\"\u003eå€¼å˜é‡å’ŒæŒ‡é’ˆå˜é‡åˆå§‹åŒ–çš„åŒºåˆ«\u003c/h3\u003e\n\u003cp\u003eæˆ‘ä»¬ä½¿ç”¨å€¼åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå¯ä»¥ç®€å•çš„è¿™æ ·å†™ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mike\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä½†æ˜¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨æŒ‡é’ˆåˆå§‹åŒ–çš„æ—¶å€™ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enameP\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e   \u003cspan style=\"color:#75715e\"\u003e// å£°æ˜ä¸€ä¸ªå­—ç¬¦ä¸²æŒ‡é’ˆ\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003enameP\u003c/span\u003e = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mike\u0026#34;\u003c/span\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e// ç»™namePæŒ‡å‘çš„åœ°å€èµ‹å€¼åˆå§‹åŒ–\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ—¶å€™ï¼Œç”±äº \u003ccode\u003enameP\u003c/code\u003e æŒ‡å‘çš„æ˜¯ä¸€ä¸ªç©ºåœ°å€ \u003ccode\u003enil\u003c/code\u003eï¼Œæˆ‘ä»¬å¯¹è¿™ä¸ªç©ºåœ°å€è¿›è¡Œèµ‹å€¼åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šæŠ¥ä»¥ä¸‹é”™è¯¯ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003epanic: runtime error: invalid memory address or nil pointer dereference\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæ˜¾è€Œæ˜“è§ï¼Œæˆ‘ä»¬æ— æ³•å¯¹ä¸€ä¸ªç©ºåœ°å€èµ‹å€¼ã€‚\u003c/p\u003e\n\u003cp\u003eå› æ­¤ï¼Œ**å¦‚æœè¦å¯¹ä¸€ä¸ªå˜é‡èµ‹å€¼ï¼Œè¿™ä¸ªå˜é‡å¿…é¡»æœ‰å¯¹åº”çš„åˆ†é…å¥½çš„å†…å­˜ï¼Œè¿™æ ·æ‰å¯ä»¥å¯¹è¿™å—å†…å­˜æ“ä½œï¼Œå®Œæˆèµ‹å€¼çš„ç›®çš„ã€‚**ä¸æ­¢æ˜¯èµ‹å€¼æ“ä½œï¼Œé’ˆå¯¹æŒ‡é’ˆå˜é‡ï¼Œå¦‚æœæ²¡æœ‰åˆ†é…å†…å­˜ï¼Œå¯¹å…¶è¿›è¡Œå–å€¼æ—¶ä¸€æ ·ä¼šæŠ¥ \u003ccode\u003enilå¼‚å¸¸\u003c/code\u003eï¼Œå› ä¸ºæ²¡æœ‰å¯ä»¥æ“ä½œçš„å†…å­˜ã€‚\u003c/p\u003e\n\u003ch2 id=\"newå‡½æ•°\"\u003enewå‡½æ•°\u003c/h2\u003e\n\u003cp\u003eå£°æ˜æŒ‡é’ˆå˜é‡çš„æ—¶å€™ï¼Œæ˜¯é»˜è®¤æ²¡æœ‰åˆ†é…å†…å­˜çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ \u003ccode\u003enew\u003c/code\u003e å‡½æ•°æ¥è¿›è¡Œå†…å­˜çš„åˆ†é…ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enameP\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003enameP\u003c/span\u003e = new(\u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e) \t\u003cspan style=\"color:#75715e\"\u003e// åˆ†é…ä¸€å—stringç±»å‹çš„å†…å­˜\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003enameP\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mike\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003enameP\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·ï¼Œæˆ‘ä»¬çš„namePå˜é‡æŒ‡å‘çš„å°±ä¸æ˜¯ä¸€ä¸ª \u003ccode\u003enil\u003c/code\u003e ç©ºåœ°å€äº†ï¼Œè€Œæ˜¯æŒ‡å‘äº†ä¸€å—å…·ä½“çš„å­—ç¬¦ä¸²çš„å†…å­˜ã€‚å› æ­¤å¯ä»¥å¯¹å…¶è¿›è¡Œèµ‹å€¼æ“ä½œã€‚\u003c/p\u003e","title":"12.goæ·±å…¥ï¼šnewã€makeå’Œå†…å­˜åˆ†é…"},{"content":"å€¼ç±»å‹ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿™æ ·çš„ç»“æ„ä½“ï¼š\ntype person struct { name string age uint } ç„¶åæˆ‘ä»¬è¯•å›¾å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä¿®æ”¹è¿™ä¸ªç»“æ„ä½“å®ä¾‹çš„å€¼ï¼š\nfunc modify(argP person){ argP.name = \u0026#34;Nobody\u0026#34; argP.age = 10 } // æˆ‘ä»¬å®é™…è¿è¡Œä¸€ä¸‹è¿™ä¸ªå‡½æ•° func main(){ p := person{name: \u0026#34;mike\u0026#34;, age: 19} fmt.Println(p) modify(p) fmt.Println(p) } ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æœŸæœ›åœ¨ç»è¿‡äº†modifyå‡½æ•°ä¿®æ”¹åï¼Œæ‰“å°å‡ºæ¥çš„ç»“æœæ˜¯ {Nobody, 10}ï¼Œç„¶è€Œå®é™…ä¸Šï¼Œè¾“å‡ºçš„ä»ç„¶æ˜¯åˆå§‹åŒ–çš„å€¼ï¼š {mike, 19}\nä¸ºå•¥ä¼šè¿™æ ·å‘¢ï¼Œå› ä¸ºä¸Šé¢å®šä¹‰çš„å˜é‡ p æ˜¯å€¼ç±»å‹ï¼Œè€Œé€šè¿‡modifyå‡½æ•°ä¼ å…¥çš„å˜é‡å€¼argPåªæ˜¯åŸå§‹å€¼å˜é‡pçš„ä¸€ä»½å€¼æ‹·è´ï¼Œè€Œä¸æ˜¯åŸæ¥çš„æ•°æ®æœ¬èº«ã€‚\nå…¶å®ï¼Œæˆ‘ä»¬åªè¦åœ¨modifyå‡½æ•°å†…éƒ¨å’Œå¤–éƒ¨æ‰“å°å‡ºå˜é‡på’ŒargPçš„åœ°å€ï¼Œå°±å¯ä»¥å‘ç°ä»–ä»¬çš„ä¸åŒä¹‹å¤„ã€‚\nfunc modify(argP person){ fmt.Printf(\u0026#34;address of arg p: %p\\n\u0026#34;, \u0026amp;argP) // ... } func main(){ // ... fmt.Printf(\u0026#34;address of p: %p\\n\u0026#34;, \u0026amp;p) modify(p) // ... } è¾“å‡ºä¸ºï¼š\naddress of p: 0xc0002905a0 address of arg p: 0xc0000d01b0 å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å‡½æ•°å†…éƒ¨å’Œå¤–éƒ¨ï¼Œå˜é‡çš„åœ°å€æ˜¯ä¸ä¸€æ ·çš„ã€‚\nå®é™…ä¸Šï¼Œåœ¨goè¯­è¨€ä¸­ï¼Œå‡½æ•°çš„ä¼ å‚éƒ½æ˜¯å€¼ä¼ é€’ï¼Œä¹Ÿå°±æ˜¯åŸæ¥æ•°æ®çš„ä¸€ä»½æ‹·è´ï¼Œè€Œä¸æ˜¯æ•°æ®æœ¬èº«ã€‚ä»¥ä¸Šè¿°çš„modifyå‡½æ•°æ¥è¯´ï¼Œå‚æ•°argPå°±æ˜¯åŸå§‹å˜é‡pçš„ä¸€ä»½å€¼æ‹·è´ã€‚é™¤äº†structä¹‹å¤–ï¼Œè¿˜æœ‰æµ®ç‚¹å‹ã€æ•´å½¢ã€å­—ç¬¦ä¸²ã€å¸ƒå°”ã€æ•°ç»„ç­‰ï¼Œè¿™äº›éƒ½æ˜¯å€¼ç±»å‹\næŒ‡é’ˆç±»å‹ å›åˆ°æœ€åˆçš„æœŸæœ›ï¼Œæˆ‘ä»¬æƒ³è¦ä¿®æ”¹ person çš„å€¼ï¼Œåªéœ€è¦ä¿®æ”¹modifyå‡½æ•°çš„å‚æ•°ä¸ºæŒ‡é’ˆç±»å‹ï¼ˆ*personï¼‰ï¼Œç„¶ååœ¨å¯¹åº”çš„å‡½æ•°ä½“ä¸­ä¿®æ”¹åŸå§‹æ•°æ®çš„å€¼ï¼š\nfunc modify(argP *person) { fmt.Printf(\u0026#34;address of arg p: %p\\n\u0026#34;, argP) argP.name = \u0026#34;Nobody\u0026#34; argP.age = 10 } è¿™æ ·ï¼Œå°±Okäº†ã€‚\nçœ‹åˆ°è¾“å‡ºï¼š\naddress of p: 0xc000290450 {Mike 19} address of arg p: 0xc000290450 {Nobody 10} å¼•ç”¨ç±»å‹ å¼•ç”¨ç±»å‹ï¼ŒåŒ…æ‹¬ map è·Ÿ chan\nmap åŒæ ·æ˜¯ä¸Šè¿°çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¸è¯•ç”¨è‡ªå®šä¹‰ç»“æ„ä½“ personï¼Œè€Œæ˜¯ä½¿ç”¨mapæ¥è¾¾åˆ°ä¿®æ”¹çš„ç›®çš„ï¼š\nfunc main(){ m := make(map[string]int) m[\u0026#34;age\u0026#34;] = 19 fmt.println(m) modify(m) fmt.Println(m) } func modify(p map[string]int){ p[\u0026#34;age\u0026#34;] = 10 } å¯ä»¥çœ‹åˆ°è¾“å‡ºå¦‚ä¸‹ï¼š\nmap[age:19] map[age:10] åŒæ ·è¾¾åˆ°äº†æˆ‘ä»¬ä¿®æ”¹å€¼è¿™ä¸ªæœŸæœ›ï¼Œå› ä¸º map æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œåœ¨goè¯­è¨€ä¸­ï¼Œæ— è®ºæ˜¯é€šè¿‡å­—é¢é‡è¿˜æ˜¯makeå‡½æ•°åˆ›å»ºçš„mapï¼Œgoè¯­è¨€ç¼–è¯‘å™¨éƒ½ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è½¬åŒ–æˆä¸ºå¯¹ runtime.makemap çš„è°ƒç”¨ï¼Œrumtime.makemapçš„å®šä¹‰å¦‚ä¸‹ï¼š\n// makemap implements Go map creation for make(map[k]v, hint). func makemap(t *maptype, hint int, h *hmap) *hmap{ //çœç•¥æ— å…³ä»£ç  } å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªå‡½æ•°æœ€ç»ˆè¿”å›çš„æ˜¯ *hmap ç±»å‹ï¼Œè€Œä»–æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ‰å¯ä»¥é€šè¿‡åœ¨å‡½æ•°å†…ä¿®æ”¹mapçš„å€¼ï¼Œè¾¾åˆ°ä¿®æ”¹åŸå§‹æ•°æ®çš„ç›®çš„ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œmapåœ¨è¿™é‡Œè¢«ç†è§£ä¸ºå¼•ç”¨ç±»å‹ï¼Œä½†æ˜¯å®ƒçš„æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚\nchan ä½œä¸ºgoroutineä¸­çš„é€šä¿¡æ¡¥æ¢ï¼Œchannelä¹Ÿæ˜¯å¯ä»¥è¢«ç†è§£ä¸ºå¼•ç”¨ç±»å‹ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡é’ˆ\nåŒmapä¸€æ ·ï¼Œgoè¯­è¨€ä¹Ÿä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨è°ƒç”¨ runtime.makechanå‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªchannalï¼š\nfunc makechan(t *chantype, size int64) *hchan { //çœç•¥æ— å…³ä»£ç  } å¯ä»¥çœ‹åˆ°ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª *hchanï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒåŒmapä¸€æ ·ã€‚\nä¸¥æ ¼æ¥è¯´ï¼ŒGOè¯­è¨€æ²¡æœ‰å¼•ç”¨ç±»å‹ï¼Œå°†mapã€chanæˆä¸ºå¼•ç”¨ç±»å‹æ˜¯ä¸ºäº†ä¾¿äºç†è§£ã€‚æ­¤å¤–ï¼Œgoè¯­è¨€ä¸­çš„å‡½æ•°ã€æ¥å£ã€sliceåˆ‡ç‰‡ã€æŒ‡é’ˆç±»å‹ç­‰ï¼Œä¹Ÿå¯ä»¥æˆä¸ºå¼•ç”¨ç±»å‹ã€‚\nç±»å‹çš„é›¶å€¼ åœ¨goä¸­ï¼Œå®šä¹‰å˜é‡è¦ä¹ˆé€šè¿‡å£°æ˜ï¼Œè¦ä¹ˆé€šè¿‡makeå’Œnewå‡½æ•°ï¼Œä¸ä¸€æ ·çš„æ˜¯makeå’Œnewå‡½æ•°å±äºæ˜¾å¼å£°æ˜å¹¶åˆå§‹åŒ–ï¼Œå¦‚æœæˆ‘ä»¬å£°æ˜çš„å˜é‡æ²¡æœ‰æ˜¾å¼å£°æ˜åˆå§‹åŒ–ï¼Œåˆ™è¯¥å˜é‡çš„é»˜è®¤å€¼å°±æ˜¯å¯¹åº”ç±»å‹çš„é›¶å€¼ï¼š\nç±»å‹ é›¶å€¼ æ•°å€¼ç±»å‹ï¼ˆintã€floatç­‰ï¼‰ 0 bool false string \u0026ldquo;\u0026quot;ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ struct å†…éƒ¨å­—æ®µçš„é›¶å€¼ sliceã€mapã€æŒ‡é’ˆã€å‡½æ•°ã€chanã€interface nil æ€»ç»“ åœ¨goè¯­è¨€ä¸­ï¼Œå‡½æ•°çš„å‚æ•°ä¼ é€’åªæœ‰å€¼ä¼ é€’ï¼Œè€Œä¸”ä¼ é€’çš„å®å‚éƒ½æ˜¯åŸå§‹æ•°æ®çš„ä¸€ä»½æ‹·è´ã€‚\nå¦‚æœæ‹·è´çš„å†…å®¹éƒ½æ˜¯å€¼ç±»å‹çš„ï¼Œé‚£ä¹ˆåœ¨å‡½æ•°ä¸­å°±æ— æ³•ä¿®æ”¹åŸå§‹æ•°æ® å¦‚æœæ‹·è´å†…å®¹æ˜¯æŒ‡é’ˆï¼Œåˆ™å¯ä»¥åœ¨å‡½æ•°ä¸­ä¿®æ”¹åŸå§‹æ•°æ® ","permalink":"https://zihuanling.github.io/posts/go-11-depth/","summary":"\u003ch2 id=\"å€¼ç±»å‹\"\u003eå€¼ç±»å‹\u003c/h2\u003e\n\u003cp\u003eå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿™æ ·çš„ç»“æ„ä½“ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eperson\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eage\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003euint\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åæˆ‘ä»¬è¯•å›¾å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä¿®æ”¹è¿™ä¸ªç»“æ„ä½“å®ä¾‹çš„å€¼ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emodify\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eargP\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eperson\u003c/span\u003e){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eargP\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Nobody\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eargP\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eage\u003c/span\u003e = \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// æˆ‘ä»¬å®é™…è¿è¡Œä¸€ä¸‹è¿™ä¸ªå‡½æ•°\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ep\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eperson\u003c/span\u003e{\u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mike\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e19\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ep\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003emodify\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ep\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ep\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æœŸæœ›åœ¨ç»è¿‡äº†\u003ccode\u003emodify\u003c/code\u003eå‡½æ•°ä¿®æ”¹åï¼Œæ‰“å°å‡ºæ¥çš„ç»“æœæ˜¯ \u003ccode\u003e{Nobody, 10}\u003c/code\u003eï¼Œç„¶è€Œå®é™…ä¸Šï¼Œè¾“å‡ºçš„ä»ç„¶æ˜¯åˆå§‹åŒ–çš„å€¼ï¼š \u003ccode\u003e{mike, 19}\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eä¸ºå•¥ä¼šè¿™æ ·å‘¢ï¼Œå› ä¸ºä¸Šé¢å®šä¹‰çš„å˜é‡ \u003ccode\u003ep\u003c/code\u003e æ˜¯\u003cstrong\u003eå€¼ç±»å‹\u003c/strong\u003eï¼Œè€Œé€šè¿‡\u003ccode\u003emodify\u003c/code\u003eå‡½æ•°ä¼ å…¥çš„å˜é‡å€¼\u003ccode\u003eargP\u003c/code\u003eåªæ˜¯\u003cstrong\u003eåŸå§‹å€¼å˜é‡pçš„ä¸€ä»½å€¼æ‹·è´\u003c/strong\u003eï¼Œè€Œä¸æ˜¯åŸæ¥çš„æ•°æ®æœ¬èº«ã€‚\u003c/p\u003e\n\u003cp\u003eå…¶å®ï¼Œæˆ‘ä»¬åªè¦åœ¨\u003ccode\u003emodify\u003c/code\u003eå‡½æ•°å†…éƒ¨å’Œå¤–éƒ¨æ‰“å°å‡ºå˜é‡på’ŒargPçš„åœ°å€ï¼Œå°±å¯ä»¥å‘ç°ä»–ä»¬çš„ä¸åŒä¹‹å¤„ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emodify\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eargP\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eperson\u003c/span\u003e){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;address of arg p: %p\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eargP\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// ... \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;address of p: %p\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ep\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003emodify\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ep\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¾“å‡ºä¸ºï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eaddress of p: 0xc0002905a0\naddress of arg p: 0xc0000d01b0\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eå¯ä»¥çœ‹åˆ°ï¼Œåœ¨å‡½æ•°å†…éƒ¨å’Œå¤–éƒ¨ï¼Œå˜é‡çš„åœ°å€æ˜¯ä¸ä¸€æ ·çš„ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eå®é™…ä¸Šï¼Œåœ¨goè¯­è¨€ä¸­ï¼Œå‡½æ•°çš„ä¼ å‚éƒ½æ˜¯å€¼ä¼ é€’ï¼Œä¹Ÿå°±æ˜¯åŸæ¥æ•°æ®çš„ä¸€ä»½æ‹·è´ï¼Œè€Œä¸æ˜¯æ•°æ®æœ¬èº«ã€‚ä»¥ä¸Šè¿°çš„\u003ccode\u003emodify\u003c/code\u003eå‡½æ•°æ¥è¯´ï¼Œå‚æ•°\u003ccode\u003eargP\u003c/code\u003eå°±æ˜¯åŸå§‹å˜é‡\u003ccode\u003ep\u003c/code\u003eçš„ä¸€ä»½å€¼æ‹·è´ã€‚é™¤äº†structä¹‹å¤–ï¼Œè¿˜æœ‰æµ®ç‚¹å‹ã€æ•´å½¢ã€å­—ç¬¦ä¸²ã€å¸ƒå°”ã€æ•°ç»„ç­‰ï¼Œè¿™äº›éƒ½æ˜¯å€¼ç±»å‹\u003c/strong\u003e\u003c/p\u003e\n\u003ch2 id=\"æŒ‡é’ˆç±»å‹\"\u003eæŒ‡é’ˆç±»å‹\u003c/h2\u003e\n\u003cp\u003eå›åˆ°æœ€åˆçš„æœŸæœ›ï¼Œæˆ‘ä»¬æƒ³è¦ä¿®æ”¹ person çš„å€¼ï¼Œåªéœ€è¦ä¿®æ”¹\u003ccode\u003emodify\u003c/code\u003eå‡½æ•°çš„å‚æ•°ä¸ºæŒ‡é’ˆç±»å‹ï¼ˆ*personï¼‰ï¼Œç„¶ååœ¨å¯¹åº”çš„å‡½æ•°ä½“ä¸­ä¿®æ”¹åŸå§‹æ•°æ®çš„å€¼ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emodify\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eargP\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eperson\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;address of arg p: %p\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eargP\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eargP\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Nobody\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eargP\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eage\u003c/span\u003e = \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·ï¼Œå°±Okäº†ã€‚\u003c/p\u003e","title":"11. goæ·±å…¥ï¼šå€¼ã€æŒ‡é’ˆä»¥åŠå¼•ç”¨ç±»å‹"},{"content":"ç”±äºæˆ‘çš„åšå®¢æ–‡ç« é‡Œé¢ç”¨åˆ°äº†mermaidç»˜åˆ¶æµç¨‹å›¾ï¼Œä»Jekyllè¿ç§»åˆ°Hugoä¹‹åï¼Œä½¿ç”¨çš„PaperModä¸»é¢˜æ˜¯é»˜è®¤ä¸æ”¯æŒmermaidæ¸²æŸ“çš„ï¼Œæœäº†å¾ˆå¤šå¸–å­ï¼Œçœ‹åˆ°æœ‰å¾ˆå¤šè§£å†³åŠæ³•ã€‚\næ¯”å¦‚æœ‰å®šä¹‰ /layouts/shortcodes/mermaid.html çš„ï¼Œç„¶ååœ¨ä»£ç é‡Œé¢ï¼Œéœ€è¦ç”¨åˆ°mermaidçš„åœ°æ–¹ï¼ˆæ–‡ç« é‡Œé¢ï¼‰è¿™æ ·å†™ï¼š\n{{ \u0026lt;mermaid\u0026gt; }} ... è¿™é‡Œå†™mermaidå†…å®¹ {{ \u0026lt;/mermaid\u0026gt; }} ä½†æ˜¯è¿™æ ·çš„å†™æ³•ä¸æ˜¯æˆ‘æƒ³è¦çš„ï¼Œæˆ‘æƒ³è¦çš„æ˜¯ä¿ç•™åŸæ¥çš„å†™æ³•ï¼Œèƒ½å¤Ÿåœ¨æ¸²æŸ“æˆhtmlçš„æ—¶å€™ï¼ŒåŠ¨æ€æ¸²æŸ“ .language-mermaid è¿™ä¸ªç±»çš„å…ƒç´ ä¸º mermaidä»£ç å—ã€‚\næŸ¥äº†ä¸€ä¸‹PaperModè¿™ä¸ªä¸»é¢˜çš„ä»£ç ï¼Œå‘ç°é¢„ç•™äº† extend_head.html è¿™ä¸ªæ‰©å±•htmlå¤´ï¼Œå¤ªæ£’äº†ï¼æˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸æ”¹å˜åŸæœ‰ä¸»é¢˜ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¢æ·»è‡ªå·±çš„headå†…å®¹ï¼\né¦–å…ˆï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼š layouts/partials/extend_head.htmlï¼Œç„¶ååœ¨é‡Œé¢å†™ä¸Šmermaidçš„åˆå§‹åŒ–ä»£ç ï¼š\n\u0026lt;!-- ä½¿ç”¨cdnåŠ è½½æ–‡ä»¶ --\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; // è‡ªå®šä¹‰mermaidé…ç½® const config = { startOnLoad:true, theme: \u0026#39;forest\u0026#39;, themeVariables: { lineColor: \u0026#34;#fafafa\u0026#34; // ç”±äºpaperModçš„ä»£ç å—èƒŒæ™¯æ˜¯é»‘è‰²çš„ï¼Œè¿™é‡Œå°†çº¿æ¡è®¾ç½®ä¸ºç™½è‰² }, flowchart: { useMaxWidth:false, htmlLabels:true } }; mermaid.initialize(config); // éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦å°†åˆå§‹åŒ–ä»£ç æ”¾åˆ° window.onload å›è°ƒå‡½æ•°é‡Œé¢æ‰æœ‰ç”¨ // å¦åˆ™ä¼šå› ä¸ºåœ¨htmlå…ƒç´ åŠ è½½å‰è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰¾ä¸åˆ°å…ƒç´ è€Œå¤±æ•ˆ window.onload = () =\u0026gt; { window.mermaid.init(undefined, document.querySelectorAll(\u0026#39;.language-mermaid\u0026#39;)); } \u0026lt;/script\u0026gt; Okï¼ç°åœ¨ï¼Œæˆ‘çš„æ–‡ç« å°±å¯ä»¥æ”¯æŒä½¿ç”¨mermaidç”»å›¾äº†ï¼\ngraph LR Hello --\u0026gt; Mermaid --\u0026gt; Yes ","permalink":"https://zihuanling.github.io/posts/hugo-papermod-mermaid/","summary":"\u003cp\u003eç”±äºæˆ‘çš„åšå®¢æ–‡ç« é‡Œé¢ç”¨åˆ°äº†mermaidç»˜åˆ¶æµç¨‹å›¾ï¼Œä»Jekyllè¿ç§»åˆ°Hugoä¹‹åï¼Œä½¿ç”¨çš„\u003cstrong\u003ePaperMod\u003c/strong\u003eä¸»é¢˜æ˜¯é»˜è®¤ä¸æ”¯æŒmermaidæ¸²æŸ“çš„ï¼Œæœäº†å¾ˆå¤šå¸–å­ï¼Œçœ‹åˆ°æœ‰å¾ˆå¤šè§£å†³åŠæ³•ã€‚\u003c/p\u003e\n\u003cp\u003eæ¯”å¦‚æœ‰å®šä¹‰ \u003ccode\u003e/layouts/shortcodes/mermaid.html\u003c/code\u003e çš„ï¼Œç„¶ååœ¨ä»£ç é‡Œé¢ï¼Œéœ€è¦ç”¨åˆ°mermaidçš„åœ°æ–¹ï¼ˆæ–‡ç« é‡Œé¢ï¼‰è¿™æ ·å†™ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-markdown\" data-lang=\"markdown\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{{ \u0026lt;\u003cspan style=\"color:#f92672\"\u003emermaid\u003c/span\u003e\u0026gt; }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e... è¿™é‡Œå†™mermaidå†…å®¹\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{{ \u0026lt;/\u003cspan style=\"color:#f92672\"\u003emermaid\u003c/span\u003e\u0026gt; }}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä½†æ˜¯è¿™æ ·çš„å†™æ³•ä¸æ˜¯æˆ‘æƒ³è¦çš„ï¼Œæˆ‘æƒ³è¦çš„æ˜¯ä¿ç•™åŸæ¥çš„å†™æ³•ï¼Œèƒ½å¤Ÿåœ¨æ¸²æŸ“æˆhtmlçš„æ—¶å€™ï¼ŒåŠ¨æ€æ¸²æŸ“ .language-mermaid è¿™ä¸ªç±»çš„å…ƒç´ ä¸º mermaidä»£ç å—ã€‚\u003c/p\u003e\n\u003cp\u003eæŸ¥äº†ä¸€ä¸‹PaperModè¿™ä¸ªä¸»é¢˜çš„ä»£ç ï¼Œå‘ç°é¢„ç•™äº† \u003ccode\u003eextend_head.html\u003c/code\u003e è¿™ä¸ªæ‰©å±•htmlå¤´ï¼Œå¤ªæ£’äº†ï¼æˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸æ”¹å˜åŸæœ‰ä¸»é¢˜ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¢æ·»è‡ªå·±çš„\u003ccode\u003ehead\u003c/code\u003eå†…å®¹ï¼\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼š \u003ccode\u003elayouts/partials/extend_head.html\u003c/code\u003eï¼Œç„¶ååœ¨é‡Œé¢å†™ä¸Šmermaidçš„åˆå§‹åŒ–ä»£ç ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-html\" data-lang=\"html\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- ä½¿ç”¨cdnåŠ è½½æ–‡ä»¶ --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esrc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// è‡ªå®šä¹‰mermaidé…ç½®\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003econfig\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003estartOnLoad\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003etheme\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;forest\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ethemeVariables\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003elineColor\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;#fafafa\u0026#34;\u003c/span\u003e    \u003cspan style=\"color:#75715e\"\u003e// ç”±äºpaperModçš„ä»£ç å—èƒŒæ™¯æ˜¯é»‘è‰²çš„ï¼Œè¿™é‡Œå°†çº¿æ¡è®¾ç½®ä¸ºç™½è‰²\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eflowchart\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003euseMaxWidth\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003ehtmlLabels\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e};\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emermaid\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003einitialize\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003econfig\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦å°†åˆå§‹åŒ–ä»£ç æ”¾åˆ° window.onload å›è°ƒå‡½æ•°é‡Œé¢æ‰æœ‰ç”¨\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å¦åˆ™ä¼šå› ä¸ºåœ¨htmlå…ƒç´ åŠ è½½å‰è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰¾ä¸åˆ°å…ƒç´ è€Œå¤±æ•ˆ\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003ewindow.\u003cspan style=\"color:#a6e22e\"\u003eonload\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e () =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    window.\u003cspan style=\"color:#a6e22e\"\u003emermaid\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003einit\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eundefined\u003c/span\u003e, document.\u003cspan style=\"color:#a6e22e\"\u003equerySelectorAll\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;.language-mermaid\u0026#39;\u003c/span\u003e));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOkï¼ç°åœ¨ï¼Œæˆ‘çš„æ–‡ç« å°±å¯ä»¥æ”¯æŒä½¿ç”¨mermaidç”»å›¾äº†ï¼\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-mermaid\" data-lang=\"mermaid\"\u003egraph LR\nHello --\u0026gt; Mermaid --\u0026gt; Yes\n\u003c/code\u003e\u003c/pre\u003e","title":"è®©Hugo Papermodä¸»é¢˜æ”¯æŒ Mermaid"},{"content":"åœ¨ Jinja2 æ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯å¦å­˜åœ¨ï¼Œé‡Œé¢çš„å€¼æ˜¯å¦ä¸ºç©ºç­‰ç­‰ã€‚\næ£€æŸ¥å˜é‡æ˜¯å¦å­˜åœ¨ï¼Œæˆ–è€…æ˜¯å¦è¢«å®šä¹‰ {% if variable is defined %} variable is defined {% else %} variable is not defined {% endif %} æ£€æŸ¥æ•°æ®çš„é•¿åº¦æ˜¯å¦ä¸ºç©º å¯¹äºåˆ—è¡¨ç±»å‹çš„å˜é‡ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦çŸ¥é“è¿™ä¸ªåˆ—è¡¨æ˜¯å¦ä¸ºç©ºçš„\n{% if variable | length %} variable is not empty {% else %} variable is empty {% endif %} éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¿™ä¸ªå˜é‡ä¸ºéåˆ—è¡¨ç±»å‹ï¼Œæ¨¡æ¿æ¸²æŸ“çš„æ—¶å€™ä¼šæŠ¥é”™\næ£€æŸ¥å˜é‡å€¼æ˜¯å¦ä¸ºTrue {% if variable is sameas true %} variable is true {% else %} variable is not true {% endif %} åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å…³é”®å­—andæ¥å®ç°å¤šä¸ªåˆ¤æ–­ åˆ¤æ–­å˜é‡å­˜åœ¨ä¸”ä¸ä¸ºç©ºï¼ˆåˆ—è¡¨å‹å˜é‡ï¼‰ {% if variable is defined and variable | length %} variable is defined and is not empty {% else %} variable is not defined or empty {% endif %} åˆ¤æ–­å˜é‡å­˜åœ¨ä¸”ä¸ºtrueï¼ˆå¸ƒå°”å‹å˜é‡ï¼‰ {% if variable is defined and is sameas true %} variable is defined and is true {% else %} variable is not defined or not true {% endif %} ","permalink":"https://zihuanling.github.io/posts/2022-03-09-jinja-templates-variable-judgement/","summary":"\u003cp\u003eåœ¨ Jinja2 æ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯å¦å­˜åœ¨ï¼Œé‡Œé¢çš„å€¼æ˜¯å¦ä¸ºç©ºç­‰ç­‰ã€‚\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003ch3 id=\"æ£€æŸ¥å˜é‡æ˜¯å¦å­˜åœ¨æˆ–è€…æ˜¯å¦è¢«å®šä¹‰\"\u003eæ£€æŸ¥å˜é‡æ˜¯å¦å­˜åœ¨ï¼Œæˆ–è€…æ˜¯å¦è¢«å®šä¹‰\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-jinja\" data-lang=\"jinja\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e{%\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e variable \u003cspan style=\"color:#66d9ef\"\u003eis\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edefined\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e%}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    variable is defined\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e{%\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e%}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    variable is not defined\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e{%\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eendif\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e%}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"æ£€æŸ¥æ•°æ®çš„é•¿åº¦æ˜¯å¦ä¸ºç©º\"\u003eæ£€æŸ¥æ•°æ®çš„é•¿åº¦æ˜¯å¦ä¸ºç©º\u003c/h3\u003e\n\u003cp\u003eå¯¹äºåˆ—è¡¨ç±»å‹çš„å˜é‡ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦çŸ¥é“è¿™ä¸ªåˆ—è¡¨æ˜¯å¦ä¸ºç©ºçš„\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-jinja\" data-lang=\"jinja\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e{%\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e variable \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elength\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e%}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    variable is not empty\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e{%\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e%}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    variable is empty\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e{%\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eendif\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e%}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¿™ä¸ªå˜é‡ä¸ºéåˆ—è¡¨ç±»å‹ï¼Œæ¨¡æ¿æ¸²æŸ“çš„æ—¶å€™ä¼šæŠ¥é”™\u003c/p\u003e\n\u003ch3 id=\"æ£€æŸ¥å˜é‡å€¼æ˜¯å¦ä¸ºtrue\"\u003eæ£€æŸ¥å˜é‡å€¼æ˜¯å¦ä¸ºTrue\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-jinja\" data-lang=\"jinja\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e{%\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e variable \u003cspan style=\"color:#66d9ef\"\u003eis\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esameas\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e%}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    variable is true\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e{%\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e%}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    variable is not true\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e{%\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eendif\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e%}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"åŒæ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å…³é”®å­—andæ¥å®ç°å¤šä¸ªåˆ¤æ–­\"\u003eåŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å…³é”®å­—\u003ccode\u003eand\u003c/code\u003eæ¥å®ç°å¤šä¸ªåˆ¤æ–­\u003c/h3\u003e\n\u003ch4 id=\"åˆ¤æ–­å˜é‡å­˜åœ¨ä¸”ä¸ä¸ºç©ºåˆ—è¡¨å‹å˜é‡\"\u003eåˆ¤æ–­å˜é‡å­˜åœ¨ä¸”ä¸ä¸ºç©ºï¼ˆåˆ—è¡¨å‹å˜é‡ï¼‰\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-jinja\" data-lang=\"jinja\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e{%\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e variable \u003cspan style=\"color:#66d9ef\"\u003eis\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edefined\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eand\u003c/span\u003e variable \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elength\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e%}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    variable is defined and is not empty\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e{%\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e%}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    variable is not defined or empty\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e{%\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eendif\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e%}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"åˆ¤æ–­å˜é‡å­˜åœ¨ä¸”ä¸ºtrueå¸ƒå°”å‹å˜é‡\"\u003eåˆ¤æ–­å˜é‡å­˜åœ¨ä¸”ä¸ºtrueï¼ˆå¸ƒå°”å‹å˜é‡ï¼‰\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-jinja\" data-lang=\"jinja\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e{%\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e variable \u003cspan style=\"color:#66d9ef\"\u003eis\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edefined\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eand\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eis\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esameas\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e%}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    variable is defined and is true\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e{%\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e%}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    variable is not defined or not true\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e{%\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eendif\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e%}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Jinja2: åˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºç©ºã€å­˜åœ¨ç­‰"},{"content":"ä»€ä¹ˆæ˜¯æŒ‡é’ˆ å¯ä»¥ç®€å•å°†æŒ‡é’ˆç†è§£ä¸ºå†…å­˜åœ°å€ã€‚\næŒ‡é’ˆæ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œç”¨æ¥å­˜å‚¨ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œè¯¥åœ°å€æŒ‡å‘å­˜å‚¨åœ¨è¯¥å†…å­˜ä¸­çš„å¯¹è±¡ï¼Œå¯ä»¥æ˜¯æ•´å‹ã€å­—ç¬¦ä¸²ã€æˆ–è€…æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ä»»æ„ç»“æ„ä½“ç±»å‹ã€‚\nä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼šæŒ‡é’ˆå°±æ˜¯ä¸€æœ¬ä¹¦ä¸Šçš„ç›®å½•ä¸Šé¢çš„é¡µç ï¼Œè¿™ä¸ªé¡µç æŒ‡å‘å…·ä½“çš„å†…å®¹ã€‚\næŒ‡é’ˆçš„å£°æ˜å’Œå®šä¹‰ ä»¥å­—ç¬¦ä¸²æŒ‡é’ˆä¸ºä¾‹\n// å£°æ˜ä¸€ä¸ªå­—ç¬¦ä¸²æŒ‡é’ˆå˜é‡ var sp *string // ç›´æ¥é€šè¿‡ \u0026amp; æ“ä½œç¬¦è·å–ä¸€ä¸ªå­—ç¬¦ä¸²çš„åœ°å€ s := \u0026#34;Hello world.\u0026#34; sp := \u0026amp;s // è¿˜å¯ä»¥ä½¿ç”¨ new å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªç±»å‹ä½œä¸ºå‚æ•°ï¼Œç”¨ä»¥è¿”å›è¯¥ç±»å‹çš„æŒ‡é’ˆ sp := new(string) æŒ‡é’ˆçš„æ“ä½œ é’ˆå¯¹æŒ‡é’ˆçš„æ“ä½œï¼Œæœ‰ä¸¤ç§ï¼šè·å–æˆ–è€…ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å€¼\nè·å–æŒ‡é’ˆæŒ‡å‘çš„å€¼ ä½¿ç”¨ *æŒ‡é’ˆå˜é‡ è·å–æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œå¦‚ *sp è·å–spæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åœ°å€çš„å€¼ã€‚\nä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å€¼ ä¿®æ”¹è·Ÿè·å–å€¼ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä½¿ç”¨ *æŒ‡é’ˆå˜é‡ = å€¼ æ¥ä¿®æ”¹ï¼Œå¦‚ *sp = \u0026quot;new value\u0026quot;ï¼Œè¿™æ ·ï¼Œå°±æŠŠ spæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åœ°å€å€¼ä¿®æ”¹ä¸ºäº† new value\næ³¨æ„ å¦å¤–ï¼Œé€šè¿‡ var sp *string å®šä¹‰çš„spæŒ‡é’ˆï¼Œåˆå§‹å€¼æ˜¯nilï¼Œè¡¨ç¤ºå®ƒæ²¡æœ‰æŒ‡å‘ä»»ä½•ä¸€å—å†…å­˜åœ°å€ï¼Œæˆ‘ä»¬ä¸èƒ½å¤Ÿå¯¹å®ƒè¿›è¡Œå–å€¼å’Œèµ‹å€¼æ“ä½œï¼Œå¦åˆ™ï¼Œä¼šæç¤ºï¼š\ninvalid memory address or nil pointer dereference\nè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªéœ€è¦ä½¿ç”¨ new å‡½æ•°ç»™è¯¥åœ°å€åˆ†é…ä¸€å—å†…å­˜å³å¯ï¼š\nvar sp *string = new(string)\nè¿˜æœ‰å°±æ˜¯ï¼Œä¸èƒ½è·å–å¸¸é‡çš„æŒ‡é’ˆã€‚\næŒ‡é’ˆå‚æ•° å½“æˆ‘ä»¬éœ€è¦åœ¨å‡½æ•°ä¸­é€šè¿‡å½¢å‚æ”¹å˜å®å‚çš„å€¼æ˜¯ï¼Œéœ€è¦ä½¿ç”¨æŒ‡é’ˆç±»å‹çš„å‚æ•°\nä¸¾ä¸ªæ —å­ï¼Œæˆ‘ä»¬æœ‰ä¸ª increase å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è®©ä¼ å…¥çš„å‚æ•°åŠ ä¸€\næ— æ•ˆå†™æ³•ï¼š\nfunc increase(num int){ num++ } ä¸Šè¿°ä¿®æ”¹çš„åªæ˜¯å½¢å‚ä¼ å…¥çš„å€¼ï¼Œå¤–éƒ¨çš„å®å‚æ²¡æœ‰å˜åŒ–\næœ‰æ•ˆå†™æ³•ï¼š\nfunc increase(num *int){ *num++ } æŒ‡é’ˆæ¥æ”¶è€… ä¸€ç‚¹å¤ä¹ \nå¦‚æœæ¥æ”¶è€…ç±»å‹æ˜¯ mapã€sliceã€channel è¿™ç±»å¼•ç”¨ç±»å‹ï¼Œä¸ä½¿ç”¨æŒ‡é’ˆ å¦‚æœéœ€è¦ä¿®æ”¹æ¥æ”¶è€…ï¼Œéœ€è¦ä½¿ç”¨æŒ‡é’ˆ å¦‚æœæ¥æ”¶è€…æ˜¯æ¯”è¾ƒå¤§çš„ç±»å‹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æŒ‡é’ˆï¼Œå› ä¸ºå†…å­˜æ‹·è´å»‰ä»·ï¼Œæ‰€ä»¥æ•ˆç‡æ›´é«˜ã€‚ æŒ‡é’ˆçš„ä¸¤å¤§å¥½å¤„ å¯ä»¥ä¿®æ”¹æŒ‡å‘æ•°æ®çš„å€¼ åœ¨å˜é‡èµ‹å€¼ã€å‚æ•°ä¼ å€¼çš„æ—¶å€™å¯ä»¥èŠ‚çœå†…å­˜ ä½¿ç”¨å»ºè®® ä¸è¦å¤šmapã€sliceã€channelè¿™ç±»å¼•ç”¨ç±»å‹ä½¿ç”¨æŒ‡é’ˆ å¦‚æœéœ€è¦ä¿®æ”¹æ–¹æ³•æ¥æ”¶è€…å†…éƒ¨çš„æ•°æ®æˆ–è€…çŠ¶æ€æ—¶ï¼Œéœ€è¦ä½¿ç”¨æŒ‡é’ˆ å¦‚æœéœ€è¦ä¿®æ”¹å‚æ•°çš„å€¼æˆ–è€…å†…éƒ¨æ•°æ®æ—¶ï¼Œä¹Ÿéœ€è¦ä½¿ç”¨æŒ‡é’ˆç±»å‹çš„å‚æ•° å¦‚æœæ˜¯æ¯”è¾ƒå¤§çš„ç»“æ„ä½“ï¼Œæ¯æ¬¡å‚æ•°ä¼ é€’æˆ–è€…è°ƒç”¨æ–¹æ³•éƒ½è¦å†…å­˜æ‹·è´ï¼Œå†…å­˜å ç”¨å¤šï¼Œè¿™æ—¶å€™å¯ä»¥è€ƒè™‘ä½¿ç”¨æŒ‡é’ˆ åƒintã€boolè¿™æ ·çš„å°æ•°æ®ç±»å‹æ²¡æœ‰å¿…è¦ä½¿ç”¨æŒ‡é’ˆ å¦‚æœéœ€è¦å¹¶å‘å®‰å…¨ï¼Œåˆ™å°½å¯èƒ½åœ°ä¸è¦ä½¿ç”¨æŒ‡é’ˆï¼Œä½¿ç”¨æŒ‡é’ˆä¸€å®šè¦ä¿è¯å¹¶å‘å®‰å…¨ï¼Œæ¯”å¦‚åŠ é”ä¹‹ç±»çš„ æŒ‡é’ˆæœ€å¥½ä¸è¦åµŒå¥—ï¼Œä¹Ÿå°±æ˜¯ä¸è¦ä½¿ç”¨ä¸€ä¸ªæŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆï¼Œè¿™ä¼šè®©ä»£ç å˜å¾—å¤æ‚ã€‚ æŒ‡å‘æ¥å£çš„æŒ‡é’ˆæ˜¯å¦å®ç°äº†è¯¥æ¥å£ï¼Ÿ ç­”æ¡ˆæ˜¯ï¼šæ²¡æœ‰\nçœ‹ä¸ªä¾‹å­ï¼š\n// å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ addressï¼Œå…¶å®ç°äº† fmt.Stringer æ¥å£ type address stuct { city string province string } func (addr address) String() string { return fmt.Sprintf(\u0026#34;Address is %s/%s\u0026#34;, addr.province, addr.city) } // ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè°ƒç”¨ Stringer çš„æ‰“å°å‡½æ•° func printer(s fmt.Stringer) { fmt.Println(\u0026#34;string value is : \u0026#34;, s.String()) } ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå€¼æ¥æ”¶è€…å®ç°äº†Stringeræ¥å£ï¼Œé‚£ä¹ˆå®ƒçš„å€¼ç±»å‹å’ŒæŒ‡é’ˆç±»å‹ä¹Ÿå®ç°äº†è¯¥æ¥å£ã€‚\nå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è°ƒç”¨ï¼š\nfunc main(){ addr := address{city: \u0026#34;Shenzhen\u0026#34;, province: \u0026#34;GuangDong\u0026#34;} // éªŒè¯å€¼ç±»å‹æ¥æ”¶è€… printer(addr) // éªŒè¯æŒ‡é’ˆç±»å‹æ¥æ”¶è€… printer(\u0026amp;addr) } è¿™äº›éƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥éªŒè¯ä¸‹æŒ‡å‘æ¥å£çš„æŒ‡é’ˆæ˜¯å¦å®ç°äº†è¯¥æ¥å£\nfunc main(){ // å£°æ˜ä¸€ä¸ª Stringer æ¥å£ siï¼Œå› ä¸º addresså®ç°äº† Stringeræ¥å£ï¼Œå› æ­¤å¯ä»¥ç›´æ¥èµ‹å€¼ç»™si var si fmt.Stringer := address{city: \u0026#34;Shenzhen\u0026#34;, province: \u0026#34;GuangDong\u0026#34;} // è°ƒç”¨ printer æ‰“å° siï¼Œæ²¡æœ‰é—®é¢˜ printer(si) // æ¥ä¸€ä¸ªæŒ‡å‘siçš„æŒ‡é’ˆsipï¼ˆæŒ‡å‘æ¥å£çš„æŒ‡é’ˆï¼‰ sip := \u0026amp;si // çœ‹çœ‹sipæ˜¯å¦å®ç°äº†Stringeræ¥å£ printer(sip) } æœ€åï¼Œprinter(sip) è¿™å¥ä¼šç¼–è¯‘ä¸é€šè¿‡ï¼Œæç¤º Cannot use '\u0026amp;si' (type *fmt.Stringer) as type fmt.Stringer\næ‰€ä»¥ç»“è®ºæ˜¯ï¼šè™½ç„¶æŒ‡å‘å…·ä½“ç±»å‹çš„æŒ‡é’ˆå¯ä»¥å®ç°ä¸€ä¸ªæ¥å£ï¼Œä½†æ˜¯æŒ‡å‘æ¥å£çš„æŒ‡é’ˆæ°¸è¿œä¸å¯èƒ½å®ç°è¯¥æ¥å£\n","permalink":"https://zihuanling.github.io/posts/2022-03-06-go-10-depth/","summary":"\u003ch2 id=\"ä»€ä¹ˆæ˜¯æŒ‡é’ˆ\"\u003eä»€ä¹ˆæ˜¯æŒ‡é’ˆ\u003c/h2\u003e\n\u003cp\u003eå¯ä»¥ç®€å•å°†æŒ‡é’ˆç†è§£ä¸ºå†…å­˜åœ°å€ã€‚\u003c/p\u003e\n\u003cp\u003eæŒ‡é’ˆæ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œç”¨æ¥å­˜å‚¨ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œè¯¥åœ°å€\u003cstrong\u003eæŒ‡å‘\u003c/strong\u003eå­˜å‚¨åœ¨è¯¥å†…å­˜ä¸­çš„å¯¹è±¡ï¼Œå¯ä»¥æ˜¯æ•´å‹ã€å­—ç¬¦ä¸²ã€æˆ–è€…æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ä»»æ„ç»“æ„ä½“ç±»å‹ã€‚\u003c/p\u003e\n\u003cp\u003eä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼šæŒ‡é’ˆå°±æ˜¯ä¸€æœ¬ä¹¦ä¸Šçš„ç›®å½•ä¸Šé¢çš„é¡µç ï¼Œè¿™ä¸ªé¡µç æŒ‡å‘å…·ä½“çš„å†…å®¹ã€‚\u003c/p\u003e\n\u003ch2 id=\"æŒ‡é’ˆçš„å£°æ˜å’Œå®šä¹‰\"\u003eæŒ‡é’ˆçš„å£°æ˜å’Œå®šä¹‰\u003c/h2\u003e\n\u003cp\u003eä»¥å­—ç¬¦ä¸²æŒ‡é’ˆä¸ºä¾‹\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e// å£°æ˜ä¸€ä¸ªå­—ç¬¦ä¸²æŒ‡é’ˆå˜é‡\nvar sp *string\n// ç›´æ¥é€šè¿‡ \u0026amp; æ“ä½œç¬¦è·å–ä¸€ä¸ªå­—ç¬¦ä¸²çš„åœ°å€\ns := \u0026#34;Hello world.\u0026#34;\nsp := \u0026amp;s\n// è¿˜å¯ä»¥ä½¿ç”¨ new å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªç±»å‹ä½œä¸ºå‚æ•°ï¼Œç”¨ä»¥è¿”å›è¯¥ç±»å‹çš„æŒ‡é’ˆ\nsp := new(string)\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"æŒ‡é’ˆçš„æ“ä½œ\"\u003eæŒ‡é’ˆçš„æ“ä½œ\u003c/h2\u003e\n\u003cp\u003eé’ˆå¯¹æŒ‡é’ˆçš„æ“ä½œï¼Œæœ‰ä¸¤ç§ï¼šè·å–æˆ–è€…ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å€¼\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eè·å–æŒ‡é’ˆæŒ‡å‘çš„å€¼\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eä½¿ç”¨ \u003ccode\u003e*æŒ‡é’ˆå˜é‡\u003c/code\u003e è·å–æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œå¦‚ \u003ccode\u003e*sp\u003c/code\u003e è·å–spæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åœ°å€çš„å€¼ã€‚\u003c/p\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å€¼\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eä¿®æ”¹è·Ÿè·å–å€¼ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä½¿ç”¨ \u003ccode\u003e*æŒ‡é’ˆå˜é‡ = å€¼\u003c/code\u003e æ¥ä¿®æ”¹ï¼Œå¦‚ \u003ccode\u003e*sp = \u0026quot;new value\u0026quot;\u003c/code\u003eï¼Œè¿™æ ·ï¼Œå°±æŠŠ spæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åœ°å€å€¼ä¿®æ”¹ä¸ºäº† \u003cstrong\u003enew value\u003c/strong\u003e\u003c/p\u003e\n\u003ch4 id=\"æ³¨æ„\"\u003eæ³¨æ„\u003c/h4\u003e\n\u003cp\u003eå¦å¤–ï¼Œé€šè¿‡ \u003ccode\u003evar sp *string\u003c/code\u003e å®šä¹‰çš„spæŒ‡é’ˆï¼Œåˆå§‹å€¼æ˜¯nilï¼Œè¡¨ç¤ºå®ƒæ²¡æœ‰æŒ‡å‘ä»»ä½•ä¸€å—å†…å­˜åœ°å€ï¼Œæˆ‘ä»¬ä¸èƒ½å¤Ÿå¯¹å®ƒè¿›è¡Œå–å€¼å’Œèµ‹å€¼æ“ä½œï¼Œå¦åˆ™ï¼Œä¼šæç¤ºï¼š\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003einvalid memory address or nil pointer dereference\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªéœ€è¦ä½¿ç”¨ \u003cstrong\u003enew\u003c/strong\u003e å‡½æ•°ç»™è¯¥åœ°å€åˆ†é…ä¸€å—å†…å­˜å³å¯ï¼š\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003evar sp *string = new(string)\u003c/code\u003e\u003c/p\u003e","title":"10. goæ·±å…¥ï¼šGo ä¸­çš„æŒ‡é’ˆ"},{"content":"for select æ¨¡å¼ è¿™æ˜¯ä¸€ç§å¸¸è§çš„å¹¶å‘æ¨¡å¼ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ for {} æ­»å¾ªç¯ï¼Œç„¶åé‡Œé¢åŠ selecté…åˆchannelï¼Œè·å–åç¨‹çš„ç»ˆæ­¢ä¿¡å·ï¼Œæ¥æ§åˆ¶åç¨‹çš„é€€å‡º\nfor { select { case \u0026lt;- done: // received stop signal, stopping. return default: // processing ... } } ç±»ä¼¼çš„è¿˜æœ‰ for range selectæ¨¡å¼ï¼Œä¸»è¦å°±æ˜¯ä½¿ç”¨ for ... range éå†æŸä¸ªæ•°æ®æ•°ç»„ï¼Œå°†æ•°æ®å‘é€åˆ°channelé‡Œé¢ï¼š\nfor _, value := range []int{} { select { case \u0026lt;- done: // æ¥å—åˆ°ç»ˆæ­¢ä¿¡å· return case resultCh \u0026lt;- value: // do nothing but put value to rsult channel } } select timeout æ¨¡å¼ select timeoutæ¨¡å¼ï¼Œæ ¸å¿ƒåœ¨äºä½¿ç”¨ time.After(t time.Duration) è¿”å›ä¸€ä¸ªå®šæ—¶çš„channelï¼Œä½¿ç”¨selecté…åˆè¿™ä¸ªchannelæ§åˆ¶åç¨‹çš„é€€å‡ºã€‚\næ¥çœ‹ä¸€ä¸ªç½‘ç»œè®¿é—®è¶…æ—¶çš„demoï¼š\nfunc main(){ result := make(chan string) go func(){ // simulate internet visiting... time.Sleep(5 * time.Second) result \u0026lt;- \u0026#34;Done, internet visited.\u0026#34; }() select { case v := \u0026lt;-result: fmt.Println(\u0026#34;result from internet: \u0026#34;, v) case \u0026lt;- time.After(3 * time.Second): fmt.Println(\u0026#34;Timeout!\u0026#34;) } } pipeline æ¨¡å¼ pipelineæµæ°´çº¿æ¨¡å¼ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ•´ä¸€ä¸ªç”Ÿäº§æµç¨‹ä¸­æœ‰å¤šä¸ªå·¥åºï¼Œåé¢çš„å·¥åºä¾èµ–å‰é¢ä¸€é“å·¥åºçš„ç»“æœã€‚\næˆ–è€…è¯´ï¼Œå‰é¢å·¥åºçš„è¾“å‡ºï¼Œå°±æ˜¯åé¢å·¥åºçš„è¾“å…¥ã€‚\ngraph LR ç”Ÿäº§:::point --\u0026gt; å·¥åº1 --\u0026gt; å·¥åº2 --\u0026gt; å·¥åº3 --\u0026gt; æˆå“:::point classDef point fill:#f88; æˆ‘ä»¬ä»¥é…’å¸­çš„ä¸Šèœæµç¨‹æ¥çœ‹ï¼Œæˆ‘ä»¬å°†å…¶ä½œä¸ºä¸€ä¸ªæµæ°´çº¿ï¼Œç®€åŒ–ä¸º3ä¸ªæ­¥éª¤ï¼š\næ´—èœ ç‚’èœ ç«¯èœä¸Šæ¡Œ æ´—èœ:\n// nè¡¨ç¤ºéœ€è¦å¤„ç†çš„èœå“æ•°é‡ // è¿”å›ä¸€ä¸ªchannelï¼Œç”¨æˆ·ä¼ é€’æ´—å¥½çš„èœ func wash(n int) \u0026lt;-chan string { washedCh := make(chan string) go func(){ defer close(washedCh) for i := 1; i \u0026lt;= n; i++ { washedCh \u0026lt;- fmt.Sprintf(\u0026#34;æ´—å¥½çš„èœ%d\u0026#34;, i) } }() return washedCh } ç‚’èœï¼š\n// ç‚’èœï¼Œä¼ å…¥channelï¼Œé‡Œé¢æ˜¯æ´—å¥½çš„èœ // è¿”å›ä¸€ä¸ªchannelï¼Œé‡Œé¢æ˜¯ç‚’å¥½çš„èœ func fire(washed \u0026lt;-chan string) \u0026lt;-chan string { firedCh := make(chan string) go func() { defer close(firedCh) for w := range washed { firedCh \u0026lt;- fmt.Sprintf(\u0026#34;ç‚’å¥½çš„ã€%sã€‘\u0026#34;, w) } }() return firedCh } ä¸Šèœï¼š\n// ä¼ èœï¼Œä¼ å…¥channelï¼Œé‡Œé¢æ˜¯ç‚’å¥½çš„èœï¼Œæˆ‘ä»¬è´Ÿè´£å°†èœç«¯åˆ°å„æ¡Œ func deliver(fired \u0026lt;-chan string) { for food := range fired { fmt.Printf(\u0026#34;å·²ä¸Šæ¡Œï¼š %s\\n\u0026#34;, food) } } å®Œæ•´çš„é…’å¸­æµç¨‹ï¼š\nä¸‰ä¸ªå·¥åºï¼ˆæ­¥éª¤ï¼‰æˆ‘ä»¬å·²ç»å®šä¹‰å¥½äº†ï¼Œæ¥ä¸‹æ¥å°†å…¶ç»„è£…æˆä¸ºä¸€ä¸ªå®Œæ•´çš„æµç¨‹ï¼š\nfunc main() { washed := wash(10) fired := fire(washed) deliver(fired) } æµç¨‹è¾“å‡ºè®°å½•å¦‚ä¸‹ï¼š\nå·²ä¸Šæ¡Œï¼š ç‚’å¥½çš„ã€æ´—å¥½çš„èœ1ã€‘ å·²ä¸Šæ¡Œï¼š ç‚’å¥½çš„ã€æ´—å¥½çš„èœ2ã€‘ å·²ä¸Šæ¡Œï¼š ç‚’å¥½çš„ã€æ´—å¥½çš„èœ3ã€‘ å·²ä¸Šæ¡Œï¼š ç‚’å¥½çš„ã€æ´—å¥½çš„èœ4ã€‘ å·²ä¸Šæ¡Œï¼š ç‚’å¥½çš„ã€æ´—å¥½çš„èœ5ã€‘ å·²ä¸Šæ¡Œï¼š ç‚’å¥½çš„ã€æ´—å¥½çš„èœ6ã€‘ å·²ä¸Šæ¡Œï¼š ç‚’å¥½çš„ã€æ´—å¥½çš„èœ7ã€‘ å·²ä¸Šæ¡Œï¼š ç‚’å¥½çš„ã€æ´—å¥½çš„èœ8ã€‘ å·²ä¸Šæ¡Œï¼š ç‚’å¥½çš„ã€æ´—å¥½çš„èœ9ã€‘ å·²ä¸Šæ¡Œï¼š ç‚’å¥½çš„ã€æ´—å¥½çš„èœ10ã€‘ æ‰‡å‡ºæ‰‡å…¥æ¨¡å¼ åŸæ¥çš„æ¨¡å¼æ˜¯è¿™æ ·çš„ï¼š\ngraph LR æ´—èœ --\u0026gt; å¨å¸ˆç‚’èœ --\u0026gt; ç«¯èœä¸Šæ¡Œ æ¯é“æ­¥éª¤éƒ½åªæœ‰ä¸€ä¸ªäººï¼Œä½†æ˜¯ï¼Œæ´—èœæ˜¯æ¯”è¾ƒå¿«çš„ï¼ˆå‡è®¾ä¸æ˜¯å¾ˆéº»çƒ¦çš„èœï¼Œéšä¾¿æ´—æ´—é‚£ç§ï¼‰ï¼Œç‚’èœå´éœ€è¦è¾ƒé•¿çš„æ—¶é—´ï¼Œå¨å¸ˆéœ€è¦é…èœã€æŒæ§ç«å€™ã€è°ƒå‘³è£…ç›˜ç­‰ã€‚\næ‰€ä»¥ï¼Œä¸Šè¿°æµç¨‹çš„æ€§èƒ½ç“¶é¢ˆä¾¿æ˜¯ç‚’èœ\nåœ¨å¨å¸ˆç‚’èœçš„è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å‘˜éœ€è¦ç­‰å¾…èœç‚’å¥½äº†æ‰èƒ½ç«¯èœï¼Œè¿™æ®µæ—¶é—´ä¾¿ä¼šç©ºé—²ä¸‹æ¥ï¼Œæ²¡æœ‰å……è¶³çš„åˆ©ç”¨åˆ°èµ„æºï¼Œé€ æˆäº†æµªè´¹ã€‚\næˆ‘ä»¬ä½¿ç”¨æ‰‡å‡ºæ‰‡å…¥æ¨¡å¼å¯¹ä¸Šè¿°æµç¨‹è¿›è¡Œæ”¹é€ ï¼š\ngraph LR subgraph æ‰‡å‡º æ´—èœ end æ´—èœ --chan--\u0026gt; å¨å¸ˆ1ç‚’èœ --chan--\u0026gt; åˆå¹¶ æ´—èœ --chan--\u0026gt; å¨å¸ˆ2ç‚’èœ --chan--\u0026gt; åˆå¹¶ æ´—èœ --chan--\u0026gt; å¨å¸ˆ3ç‚’èœ --chan--\u0026gt; åˆå¹¶ subgraph æ‰‡å…¥ åˆå¹¶ end åˆå¹¶ --chan--\u0026gt; ç«¯èœä¸Šæ¡Œ ä¸»è¦æ”¹é€ å†…å®¹å°±æ˜¯ï¼šè°ƒç”¨å¤šä¸ªå¨å¸ˆæ¥ç‚’èœï¼Œç„¶åå°†ç‚’å¥½çš„èœæ±‡åˆåœ¨ä¸€èµ·ï¼ŒæœåŠ¡å‘˜è¿›è¡Œç«¯èœã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬å¯¹ç‚’èœå‡½æ•°è¿›è¡Œæ”¹é€ ï¼Œä¸»è¦æ˜¯åŠ å…¥ä¸€ä¸ªå‚æ•°cookerï¼Œç”¨äºåŒºåˆ†å½“å‰èœå“æ˜¯å“ªä¸ªå¨å¸ˆç‚’çš„ï¼š\n// ç‚’èœï¼Œä¼ å…¥channelï¼Œé‡Œé¢æ˜¯æ´—å¥½çš„èœ, cooker è¡¨ç¤ºå¨å¸ˆçš„åå­— // è¿”å›ä¸€ä¸ªchannelï¼Œé‡Œé¢æ˜¯ç‚’å¥½çš„èœ func fire(washed \u0026lt;-chan string, cooker string) \u0026lt;-chan string { firedCh := make(chan string) go func() { defer close(firedCh) for w := range washed { firedCh \u0026lt;- fmt.Sprintf(\u0026#34;%sç‚’å¥½çš„ã€%sã€‘\u0026#34;, cooker, w) } }() return firedCh } ç„¶åå®ç°èœå“æ±‡åˆéƒ¨åˆ†çš„ä»£ç ï¼š\n// å°†ç‚’å¥½çš„èœæ±‡åˆåœ¨ä¸€èµ·ï¼Œæä¾›ç»™æœåŠ¡å‘˜ç«¯èœ func merge(fireds ...\u0026lt;-chan string) \u0026lt;-chan string { // æ‰€æœ‰çš„èœå“éƒ½å°†æ±‡åˆåˆ° merged channel é‡Œé¢ merged := make(chan string) var wg sync.WaitGroup go func() { wg.Add(len(fireds)) defer close(merged) for _, fired := range fireds { go func(foods \u0026lt;-chan string) { defer wg.Done() for food := range foods { merged \u0026lt;- food } }(fired) } wg.Wait() }() return merged } æœ€åï¼æˆ‘ä»¬æ”¹é€ ä¸‹mainå‡½æ•°ï¼Œè®©å¤šä¸ªå¨å¸ˆç‚’èœï¼Œç„¶åå®ç° èœå“æ±‡åˆ -\u0026gt; ç«¯èœ\nfunc main() { washed := wash(10) // 3ä¸ªå¨å¸ˆç‚’èœ fired1 := fire(washed, \u0026#34;cooker1\u0026#34;) fired2 := fire(washed, \u0026#34;cooker2\u0026#34;) fired3 := fire(washed, \u0026#34;cooker3\u0026#34;) // æ±‡åˆèœå“ merged := merge(fired1, fired2, fired3) // ç«¯èœ deliver(merged) } æµç¨‹è¾“å‡ºè®°å½•ï¼š\nå·²ä¸Šæ¡Œï¼š cooker3ç‚’å¥½çš„ã€æ´—å¥½çš„èœ3ã€‘ å·²ä¸Šæ¡Œï¼š cooker3ç‚’å¥½çš„ã€æ´—å¥½çš„èœ4ã€‘ å·²ä¸Šæ¡Œï¼š cooker1ç‚’å¥½çš„ã€æ´—å¥½çš„èœ1ã€‘ å·²ä¸Šæ¡Œï¼š cooker1ç‚’å¥½çš„ã€æ´—å¥½çš„èœ7ã€‘ å·²ä¸Šæ¡Œï¼š cooker3ç‚’å¥½çš„ã€æ´—å¥½çš„èœ5ã€‘ å·²ä¸Šæ¡Œï¼š cooker1ç‚’å¥½çš„ã€æ´—å¥½çš„èœ8ã€‘ å·²ä¸Šæ¡Œï¼š cooker3ç‚’å¥½çš„ã€æ´—å¥½çš„èœ10ã€‘ å·²ä¸Šæ¡Œï¼š cooker1ç‚’å¥½çš„ã€æ´—å¥½çš„èœ9ã€‘ å·²ä¸Šæ¡Œï¼š cooker2ç‚’å¥½çš„ã€æ´—å¥½çš„èœ2ã€‘ å·²ä¸Šæ¡Œï¼š cooker2ç‚’å¥½çš„ã€æ´—å¥½çš„èœ6ã€‘ å¯ä»¥çœ‹åˆ°ï¼Œå„ä¸ªèœå“çš„ä¸Šèœæ—¶é—´æ˜¯æ— åºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå“ªé“èœå…ˆåšå¥½å°±å…ˆä¸Šï¼Œå¤§å¤§æé«˜äº†ä¸Šèœæ•ˆç‡ï¼Œä¸ä¼šè®©å®¢äººä¹…ç­‰äº†ï¼\nFutures æ¨¡å¼ æµæ°´çº¿ Pipelineæ¨¡å¼ä¸­çš„å„ä¸ªæ­¥éª¤éƒ½æ˜¯ç›¸äº’ä¾èµ–çš„ï¼Œåªæœ‰ä¸Šä¸€ä¸ªå·¥åºå®Œæˆï¼Œä¸‹ä¸€ä¸ªå·¥åºæ‰èƒ½å¼€å§‹ã€‚\nFuturesæ¨¡å¼ï¼šå®é™…éœ€æ±‚ä¸­ï¼Œå¾ˆå¤šä»»åŠ¡æ˜¯ç‹¬ç«‹çš„ï¼Œæ¯”å¦‚è¯´ç…²æ±¤ã€ç…®é¥­å’Œç‚’èœï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶ç…²æ±¤ã€ç…®é¥­ï¼Œä¸éœ€è¦ç«‹åˆ»è·å–åˆ°ç…®å¥½çš„æ±¤å’Œé¥­ï¼Œå¯ä»¥å…ˆå»åšå…¶ä»–çš„äº‹æƒ…ï¼Œæ¯”å¦‚ç‚’èœï¼Œç„¶ååœ¨æœªæ¥çš„æŸä¸ªæ—¶å€™ï¼Œå»è·å–ç…²æ±¤å’Œç…®é¥­çš„ç»“æœï¼Œè¿™å°±æ˜¯æœªæ¥æ¨¡å¼ï¼ˆFutruesæ¨¡å¼ï¼‰\nä»¥ä¸Šè¿°çš„ç…²æ±¤ã€ç…®é¥­ã€ç‚’èœä¸ºä¾‹ï¼Œä»£ç å®ç°ä¸€ä¸‹ï¼š\nfunc main() { fmt.Println(\u0026#34;å¼€å§‹åšé¥­\u0026#34;) riceCh := rice() soupCh := soup() fmt.Println(\u0026#34;å»åšå…¶ä»–äº‹æƒ…ã€‚ã€‚ã€‚\u0026#34;) fmt.Println(\u0026#34;å¼€å§‹ç‚’èœå§ã€‚ã€‚ã€‚\u0026#34;) time.Sleep(2 * time.Second) fmt.Println(\u0026#34;èœç‚’å¥½äº†ï¼\u0026#34;) r := \u0026lt;-riceCh s := \u0026lt;-soupCh fmt.Printf(\u0026#34;åƒé¥­ï¼ èœã€%sã€å– %s\\n\u0026#34;, r, s) } // ç…®é¥­ func rice() \u0026lt;-chan string { fmt.Println(\u0026#34;å¼€å§‹ç…®é¥­å•¦\u0026#34;) ch := make(chan string) go func() { time.Sleep(3 * time.Second)\t// ç…®é¥­è€—æ—¶ ch \u0026lt;- \u0026#34;ç…®å¥½çš„é¥­\u0026#34; fmt.Println(\u0026#34;é¥­ç…®å¥½äº†ï¼\u0026#34;) }() return ch } // ç…²æ±¤ func soup() \u0026lt;-chan string { fmt.Println(\u0026#34;å¼€å§‹ç…²æ±¤å•¦ï¼\u0026#34;) ch := make(chan string) go func() { time.Sleep(4 * time.Second)\t// ç…²æ±¤è€—æ—¶ ch \u0026lt;- \u0026#34;ç…²å¥½çš„æ±¤\u0026#34; fmt.Println(\u0026#34;æ±¤ç…²å¥½äº†\u0026#34;) }() return ch } Futures æ¨¡å¼ä¸‹çš„åç¨‹å’Œæ™®é€šåç¨‹æœ€å¤§çš„åŒºåˆ«æ˜¯å¯ä»¥è¿”å›ç»“æœï¼Œè€Œè¿™ä¸ªç»“æœä¼šåœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´ç‚¹ä½¿ç”¨ã€‚æ‰€ä»¥åœ¨æœªæ¥è·å–è¿™ä¸ªç»“æœçš„æ“ä½œå¿…é¡»æ˜¯ä¸€ä¸ªé˜»å¡çš„æ“ä½œï¼Œè¦ä¸€ç›´ç­‰åˆ°è·å–ç»“æœä¸ºæ­¢ã€‚\nå¦‚æœå¤§ä»»åŠ¡å¯ä»¥æ‹†è§£ä¸ºä¸€ä¸ªä¸ªç‹¬ç«‹å¹¶å‘æ‰§è¡Œçš„å°ä»»åŠ¡ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è¿™äº›å°ä»»åŠ¡çš„ç»“æœå¾—å‡ºæœ€ç»ˆå¤§ä»»åŠ¡çš„ç»“æœï¼Œå°±å¯ä»¥ä½¿ç”¨ Futures æ¨¡å¼\næœ€å å¹¶å‘æ¨¡å¼å’Œè®¾è®¡æ¨¡å¼å¾ˆç›¸ä¼¼ï¼Œéƒ½æ˜¯å¯¹ç°å®åœºæ™¯çš„æŠ½è±¡å°è£…ï¼Œä»¥ä¾¿æä¾›ä¸€ä¸ªç»Ÿä¸€çš„è§£å†³æ–¹æ¡ˆã€‚ä½†å’Œè®¾è®¡æ¨¡å¼ä¸åŒçš„æ˜¯ï¼Œå¹¶å‘æ¨¡å¼æ›´ä¸“æ³¨äºå¼‚æ­¥å’Œå¹¶å‘ã€‚\n","permalink":"https://zihuanling.github.io/posts/2022-03-04-go-9-concurrency/","summary":"\u003ch2 id=\"for-select-æ¨¡å¼\"\u003efor select æ¨¡å¼\u003c/h2\u003e\n\u003cp\u003eè¿™æ˜¯ä¸€ç§å¸¸è§çš„å¹¶å‘æ¨¡å¼ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ \u003ccode\u003efor {} \u003c/code\u003e æ­»å¾ªç¯ï¼Œç„¶åé‡Œé¢åŠ \u003ccode\u003eselect\u003c/code\u003eé…åˆ\u003ccode\u003echannel\u003c/code\u003eï¼Œè·å–åç¨‹çš„ç»ˆæ­¢ä¿¡å·ï¼Œæ¥æ§åˆ¶åç¨‹çš„é€€å‡º\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eselect\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edone\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// received stop signal, stopping.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edefault\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t    \u003cspan style=\"color:#75715e\"\u003e// processing ... \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç±»ä¼¼çš„è¿˜æœ‰ \u003ccode\u003efor range select\u003c/code\u003eæ¨¡å¼ï¼Œä¸»è¦å°±æ˜¯ä½¿ç”¨ \u003ccode\u003efor ... range\u003c/code\u003e éå†æŸä¸ªæ•°æ®æ•°ç»„ï¼Œå°†æ•°æ®å‘é€åˆ°channelé‡Œé¢ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003evalue\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003erange\u003c/span\u003e []\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e{} {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eselect\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edone\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// æ¥å—åˆ°ç»ˆæ­¢ä¿¡å·\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresultCh\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003evalue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// do nothing but put value to rsult channel\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"select-timeout-æ¨¡å¼\"\u003eselect timeout æ¨¡å¼\u003c/h2\u003e\n\u003cp\u003eselect timeoutæ¨¡å¼ï¼Œæ ¸å¿ƒåœ¨äºä½¿ç”¨ \u003ccode\u003etime.After(t time.Duration)\u003c/code\u003e è¿”å›ä¸€ä¸ªå®šæ—¶çš„channelï¼Œä½¿ç”¨selecté…åˆè¿™ä¸ªchannelæ§åˆ¶åç¨‹çš„é€€å‡ºã€‚\u003c/p\u003e\n\u003cp\u003eæ¥çœ‹ä¸€ä¸ªç½‘ç»œè®¿é—®è¶…æ—¶çš„demoï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e make(\u003cspan style=\"color:#66d9ef\"\u003echan\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// simulate internet visiting...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e        \u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Done, internet visited.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eselect\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \t    \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;result from internet: \u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eAfter\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSecond\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t        \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Timeout!\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"pipeline-æ¨¡å¼\"\u003epipeline æ¨¡å¼\u003c/h2\u003e\n\u003cp\u003epipelineæµæ°´çº¿æ¨¡å¼ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ•´ä¸€ä¸ªç”Ÿäº§æµç¨‹ä¸­æœ‰å¤šä¸ªå·¥åºï¼Œåé¢çš„å·¥åºä¾èµ–å‰é¢ä¸€é“å·¥åºçš„ç»“æœã€‚\u003c/p\u003e","title":"9. goå¹¶å‘ï¼šGo ä¸­çš„å¹¶å‘æ¨¡å¼"},{"content":"ç›®å‰ï¼Œgithub page ä¼šå°† markdowné‡Œé¢çš„ mermaid å—æ¸²æŸ“æˆä¸ºä¸€ä¸ª div.language-mermaid çš„ html ä»£ç å—ï¼Œä½†æ˜¯ï¼Œmermaid-jsä»…æ”¯æŒæ¸²æŸ“ div.mermaid çš„htmlä»£ç å—ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€ç‚¹å¤„ç†ã€‚\næˆ‘ä»¬åªéœ€è¦åœ¨æ–‡ç« æ¨¡æ¿çš„æœ«å°¾ï¼Œæ·»åŠ å¦‚ä¸‹è½¬åŒ–ä»£ç å³å¯ï¼š\næ–‡ä»¶ï¼š_layouts/post.html {%- if content contains \u0026#39;mermaid\u0026#39; -%} \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; const config = { startOnLoad:true, theme: \u0026#39;forest\u0026#39;, flowchart: { useMaxWidth:false, htmlLabels:true } }; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll(\u0026#39;.language-mermaid\u0026#39;)); \u0026lt;/script\u0026gt; {% endif %} ä¸Šè¿°ä»£ç æ‰‹åŠ¨å°† div.language-mermaid æ·»åŠ åˆ° mermaidå¼•æ“çš„æ¸²æŸ“ä¸­ã€‚\nå¼•ç”¨ åœ¨æ–‡ç« é‡Œé¢æŒ‡å®šæ–‡ç« layoutï¼Œå³å¯å¼•ç”¨ï¼Œå¹¶ä¸”æ¸²æŸ“mermaidï¼\n--- layout: post --- å…¶ä»–æ–¹æ³• å½“ç„¶ä¹Ÿå¯ä»¥åœ¨ _config.yml é…ç½®kramdown, è®©å…¶å¯ä»¥å°† mermaid å—æ¸²æŸ“æˆ div.mermaid è¿™æ ·çš„htmlçš„ä»£ç å—ï¼Œä½†æ˜¯å®ç°èµ·æ¥æœ‰ç‚¹å¤æ‚ã€‚\nå‚è€ƒï¼š Issue https://github.com/gettalong/kramdown/issues/637\n","permalink":"https://zihuanling.github.io/posts/2022-03-04-support-mermaid-on-github-page/","summary":"\u003cp\u003eç›®å‰ï¼Œgithub page ä¼šå°† markdowné‡Œé¢çš„ \u003ccode\u003emermaid\u003c/code\u003e å—æ¸²æŸ“æˆä¸ºä¸€ä¸ª \u003ccode\u003ediv.language-mermaid\u003c/code\u003e çš„ html ä»£ç å—ï¼Œä½†æ˜¯ï¼Œmermaid-jsä»…æ”¯æŒæ¸²æŸ“ \u003ccode\u003ediv.mermaid\u003c/code\u003e çš„htmlä»£ç å—ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€ç‚¹å¤„ç†ã€‚\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003cp\u003eæˆ‘ä»¬åªéœ€è¦åœ¨æ–‡ç« æ¨¡æ¿çš„æœ«å°¾ï¼Œæ·»åŠ å¦‚ä¸‹è½¬åŒ–ä»£ç å³å¯ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-markdown\" data-lang=\"markdown\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eæ–‡ä»¶ï¼š_layouts/post.html\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{%- if content contains \u0026#39;mermaid\u0026#39; -%}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esrc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003econfig\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003estartOnLoad\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003etheme\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;forest\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eflowchart\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003euseMaxWidth\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003ehtmlLabels\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e};\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emermaid\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003einitialize\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003econfig\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ewindow.\u003cspan style=\"color:#a6e22e\"\u003emermaid\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003einit\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eundefined\u003c/span\u003e, document.\u003cspan style=\"color:#a6e22e\"\u003equerySelectorAll\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;.language-mermaid\u0026#39;\u003c/span\u003e));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{% endif %}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šè¿°ä»£ç æ‰‹åŠ¨å°† \u003ccode\u003ediv.language-mermaid\u003c/code\u003e æ·»åŠ åˆ° mermaidå¼•æ“çš„æ¸²æŸ“ä¸­ã€‚\u003c/p\u003e\n\u003ch4 id=\"å¼•ç”¨\"\u003eå¼•ç”¨\u003c/h4\u003e\n\u003cp\u003eåœ¨æ–‡ç« é‡Œé¢æŒ‡å®šæ–‡ç« layoutï¼Œå³å¯å¼•ç”¨ï¼Œå¹¶ä¸”æ¸²æŸ“mermaidï¼\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-markdown\" data-lang=\"markdown\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e---\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003elayout: post\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e---\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"å…¶ä»–æ–¹æ³•\"\u003eå…¶ä»–æ–¹æ³•\u003c/h4\u003e\n\u003cp\u003eå½“ç„¶ä¹Ÿå¯ä»¥åœ¨ \u003ccode\u003e_config.yml\u003c/code\u003e é…ç½®kramdown, è®©å…¶å¯ä»¥å°† \u003ccode\u003emermaid\u003c/code\u003e å—æ¸²æŸ“æˆ \u003ccode\u003ediv.mermaid\u003c/code\u003e è¿™æ ·çš„htmlçš„ä»£ç å—ï¼Œä½†æ˜¯å®ç°èµ·æ¥æœ‰ç‚¹å¤æ‚ã€‚\u003c/p\u003e\n\u003cp\u003eå‚è€ƒï¼š \u003ca href=\"https://github.com/gettalong/kramdown/issues/637\"\u003eIssue https://github.com/gettalong/kramdown/issues/637\u003c/a\u003e\u003c/p\u003e","title":"è®©github pageæ”¯æŒmermaidè¯­æ³•"},{"content":"åç¨‹å¦‚ä½•é€€å‡º ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬æ‰§è¡Œåç¨‹ï¼Œéœ€è¦ç­‰åˆ°åç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œæ‰èƒ½å¤Ÿé€€å‡ºã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬æƒ³è¦è®©åç¨‹æå‰é€€å‡ºï¼Œå°±éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œå»æ§åˆ¶åç¨‹çš„é€€å‡ºã€‚\nä»¥ä¸‹ä¾‹å­ä½¿ç”¨select + channelçš„æ–¹å¼ï¼Œæ§åˆ¶åç¨‹çš„é€€å‡º\nfunc main() { ch := make(chan bool) var wg sync.WaitGroup go func() { defer wg.Done() // å¼€å¯looperåç¨‹ looper(ch) }() wg.Add(1) // 5ç§’åå‘é€ä¸­æ–­ä¿¡å· time.Sleep(time.Second * 5) fmt.Println(\u0026#34;Signal to goroutine exit...\u0026#34;) ch \u0026lt;- true fmt.Println(\u0026#34;Signal sent.\u0026#34;) wg.Wait() // ç­‰å¾…åç¨‹å®Œå…¨é€€å‡º fmt.Println(\u0026#34;Exit.\u0026#34;) } func looper(ch \u0026lt;-chan bool){ for { select { case \u0026lt;-ch: fmt.Println(\u0026#34;go break signal\u0026#34;) return default: fmt.Println(\u0026#34;looper is running...\u0026#34;) time.Sleep(time.Second * 1) } } } ä¸Šè¿°ä¾‹å­é€šè¿‡ä¸€ä¸ªch channel å‘é€ä¿¡å·ï¼Œè®©åç¨‹æ”¶åˆ°ä¿¡å·åç»ˆæ­¢å¾ªç¯ã€‚\nä½¿ç”¨Contextæ§åˆ¶åç¨‹é€€å‡º ä¸Šè¿°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡select+ channel çš„æ–¹å¼è¿›è¡Œæ§åˆ¶åç¨‹çš„é€€å‡ºï¼Œä½†æ˜¯é‚£æ˜¯å•ä¸ªåç¨‹çš„é€€å‡ºï¼Œå½“æˆ‘ä»¬æƒ³è¦æ§åˆ¶å¤šä¸ªåç¨‹çš„é€€å‡ºæ—¶ï¼Œä¹Ÿå¯ä»¥ç”¨å®šä¹‰å¤šä¸ªchannelçš„æ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¼šè®©ä»£ç å˜å¾—ååˆ†å¤æ‚ã€‚\nè€ŒContextï¼Œå¯ä»¥è®©æˆ‘ä»¬è·Ÿè¸ªåˆ°æ¯ä¸ªåç¨‹ï¼Œä»è€Œæ›´å¥½åœ°è¿›è¡Œé™åˆ¶å’Œæ§åˆ¶ã€‚\nä½¿ç”¨ Context æ”¹é€ ä¸Šè¿°çš„ä»£ç ï¼š\nfunc main() { var wg sync.WaitGroup ctx, stop := context.WithCancel(context.Background()) go func() { defer wg.Done() looper(ctx) }() wg.Add(1) time.Sleep(time.Second * 5) fmt.Println(\u0026#34;Signal to goroutine exit...\u0026#34;) stop()\t// å‘contextå‘é€åœæ­¢æŒ‡ä»¤ fmt.Println(\u0026#34;Signal sent.\u0026#34;) wg.Wait() fmt.Println(\u0026#34;Exit.\u0026#34;) } func looper(ctx context.Context){ for { select { case \u0026lt;-ctx.Done(): fmt.Println(\u0026#34;go break signal\u0026#34;) return default: fmt.Println(\u0026#34;looper is running...\u0026#34;) time.Sleep(time.Second * 1) } } } ä¸Šè¿°ä»£ç å®ç°çš„åŠŸèƒ½å’Œä½¿ç”¨select + channelä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦æ”¹åŠ¨ä¸ºï¼š\nlooperçš„chå‚æ•°æ”¹ä¸ºäº†ctx context.Context ä½¿ç”¨ case \u0026lt;- ctx.Done() æ¥åˆ¤æ–­æ˜¯å¦æ¥å—åˆ°ç»ˆæ­¢ä¿¡å· ä½¿ç”¨ context.WithCancel(context.Backgroud())æ¥ç”Ÿæˆä¸€ä¸ªå¯ä»¥å–æ¶ˆçš„Contextï¼Œè¿”å›ä¸¤ä¸ªå†…å®¹ï¼š contextå’Œ stopå‡½æ•°ï¼Œstopå‡½æ•°ç”¨äºå‘contextå‘é€ç»ˆæ­¢æŒ‡ä»¤ã€‚context.Backgroud()ç”¨äºç”Ÿæˆä¸€ä¸ªç©ºçš„Contextï¼Œ ä¸€èˆ¬ä½œä¸ºæ•´ä¸ªContextæ ‘çš„æ ¹èŠ‚ç‚¹ åŸæ¥çš„å‘é€åœæ­¢æŒ‡ä»¤ä¸ºå‘chchannelå‘é€trueï¼Œä½œä¸ºä¸€ä¸ªåœæ­¢çš„æŒ‡ä»¤ï¼Œè€Œç°åœ¨é€šè¿‡è°ƒç”¨ stop()æ¥å‘ctxå‘é€ç»ˆæ­¢ä¿¡å·ã€‚ ä»€ä¹ˆæ˜¯Context Contextæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œå…·å¤‡æ‰‹åŠ¨ã€å®šæ—¶ã€è¶…æ—¶å‘å‡ºå–æ¶ˆä¿¡å·ã€ä¼ å€¼ç­‰åŠŸèƒ½ï¼Œä¸»è¦ç”¨äºæ§åˆ¶å¤šä¸ªåç¨‹ä¹‹é—´çš„åä½œï¼Œå°¤å…¶æ˜¯å–æ¶ˆæ“ä½œã€‚ä¸€æ—¦å–æ¶ˆæŒ‡ä»¤ä¸‹è¾¾ï¼Œé‚£ä¹ˆè¢«Contextè·Ÿè¸ªçš„è¿™äº›åç¨‹éƒ½ä¼šæ”¶åˆ°å–æ¶ˆä¿¡å·ï¼Œå°±å¯ä»¥åšæ¸…ç†å’Œé€€å‡ºæ“ä½œ\nContextçš„ä»£ç å®šä¹‰ï¼š type Context interface { Deadline() (deadline time.Time, ok bool) Done() \u0026lt;-chan struct{} Err() error Value(key interface{}) interface{} } Deadlineæ–¹æ³•å¯ä»¥è·å–è®¾ç½®çš„æˆªæ­¢æ—¶é—´ï¼Œç¬¬ä¸€ä¸ªè¿”å›çš„å€¼deadlineæ˜¯æˆªæ­¢æ—¶é—´ï¼Œåˆ°äº†è¿™ä¸ªæ—¶é—´ï¼ŒContextå°±ä¼šè‡ªåŠ¨å‘èµ·å–æ¶ˆè¯·æ±‚ï¼Œç¬¬äºŒä¸ªè¿”å›å€¼okè¡¨ç¤ºè¿™ä¸ªContextæ˜¯å¦è®¾ç½®äº†æˆªæ­¢æ—¶é—´ã€‚ Doneæ–¹æ³•è¿”å›ä¸€ä¸ªåªè¯»çš„channelï¼Œç±»å‹ä¸ºstruct{}ã€‚åç¨‹ä¸­ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å›çš„chanå¯ä»¥è¢«è¯»å–ï¼Œæ„å‘³ç€Contextå·²ç»å‘èµ·äº†ç»ˆæ­¢ä¿¡å·ï¼Œæˆ‘ä»¬çš„åç¨‹æ”¶åˆ°è¿™ä¸ªä¿¡å·ä¹‹åï¼Œå°±å¯ä»¥åšåç¨‹çš„æ¸…ç†å’Œé€€å‡ºæ“ä½œäº† Erræ–¹æ³•è¿”å›å–æ¶ˆçš„é”™è¯¯åŸå› ï¼Œæ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´Contxtè¢«å–æ¶ˆã€‚ Valueæ–¹æ³•å¯ä»¥è·å–è¯¥Contextä¸Šç»‘å®šçš„å€¼ï¼Œæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œéœ€è¦é€šè¿‡keyæ¥è·å– æœ€å¸¸ç”¨çš„æ˜¯Doneæ–¹æ³•ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥åˆ¤æ–­å½“å‰contextæ˜¯å¦è¢«å–æ¶ˆã€‚\nContextæ ‘ æˆ‘ä»¬ä¸éœ€è¦è‡ªå·±å®ç°Contextæ¥å£ï¼Œå› ä¸ºGolangæä¾›äº†å¤šä¸ªå‡½æ•°å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆä¸åŒçš„Contextï¼Œé€šè¿‡è¿™äº›å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€é¢—Contextæ ‘ï¼Œå°†ä¸åŒçš„Contextå…³è”èµ·æ¥ï¼Œè¿™æ ·ï¼Œå½“çˆ¶Contextå‘å‡ºå–æ¶ˆä¿¡å·çš„æ—¶å€™ï¼Œå­Contextä¹Ÿä¼šå‘å‡ºè¯¥ä¿¡å·ï¼Œä»¥ä¾¿æ§åˆ¶ä¸åŒå±‚çº§çš„åç¨‹é€€å‡ºã€‚\nåŠŸèƒ½ä¸Šåˆ†ï¼Œæœ‰å››ç§å®ç°å¥½çš„Contextï¼š\nç©ºContextï¼šcontext.Backgroud()ï¼Œä¸å¯å–æ¶ˆï¼Œæ²¡æœ‰æˆªæ­¢æ—¶é—´ï¼Œä¸»è¦ç”¨äºContextçš„æ ¹èŠ‚ç‚¹\nå¯å–æ¶ˆçš„Contextï¼šcontext.WithCancel(parent context.Context)ï¼Œç”¨äºå‘é€å–æ¶ˆä¿¡å·ï¼Œå½“å–æ¶ˆæ—¶ï¼Œå­Contextä¹Ÿä¼šå–æ¶ˆ\nå¯ä»¥å®šæ—¶å–æ¶ˆçš„Contextï¼š\ncontext.WithDeadline(parant context.Context, d time.Time)ï¼Œ è®¾ç½®deadlineï¼Œåœ¨æŸä¸ªæ—¶é—´å–æ¶ˆ context.WithTimeout(parant context.Context, timeout time.Duration)ï¼Œ è®¾ç½®å¤šé•¿æ—¶é—´åè‡ªåŠ¨å–æ¶ˆ å€¼Contextï¼šcontext.WithValue(parant context.Context, key, val interface{})ï¼Œç”¨äºå­˜å‚¨key-valueé”®å€¼å¯¹\nä¸Šè¿°å‰ä¸‰ç§éƒ½æ˜¯å¯å–æ¶ˆçš„Contextï¼Œå€¼Contextåˆ™ç”¨äºå­˜å‚¨key-valueé”®å€¼å¯¹\nä½¿ç”¨Contextå–æ¶ˆå¤šä¸ªåç¨‹ ä»¥ä¸Šè¿°çš„looperå¾ªç¯ä¾‹å­ä¸ºä¾‹ï¼Œä½¿ç”¨ContextåŒæ—¶å–æ¶ˆå¤šä¸ªåç¨‹\nfunc main() { var wg sync.WaitGroup wg.Add(4) ctx, stop := context.WithCancel(context.Background()) for i := 0;i \u0026lt; 3; i++ { // å¯åŠ¨3ä¸ªåç¨‹ï¼Œä½¿ç”¨çˆ¶è¿›ç¨‹ctxæ§åˆ¶è¿™äº›è¿›ç¨‹çš„å–æ¶ˆ go func(id int) { defer wg.Done() looper(ctx, id) }(i) } // åˆ›å»ºä¸€ä¸ªå­Contextï¼Œå½“çˆ¶Contextå–æ¶ˆæ—¶ï¼ŒsubCtxä¹Ÿä¼šå‘å‡ºå–æ¶ˆä¿¡å· subCtx, _ := context.WithCancel(ctx) go func() { defer wg.Done() looper(subCtx, 3) fmt.Println(\u0026#34;looper 3 exist because parent context exit.\u0026#34;) }() time.Sleep(time.Second * 5) fmt.Println(\u0026#34;Signal to goroutine exit...\u0026#34;) stop()\t// å‘contextå‘é€åœæ­¢æŒ‡ä»¤ fmt.Println(\u0026#34;Signal sent.\u0026#34;) wg.Wait() fmt.Println(\u0026#34;Exit.\u0026#34;) } func looper(ctx context.Context, id int){ for { select { case \u0026lt;-ctx.Done(): fmt.Printf(\u0026#34;looper %d: go break signal\\n\u0026#34;, id) return default: fmt.Printf(\u0026#34;looper %d is running...\\n\u0026#34;, id) time.Sleep(time.Second * 1) } } } Context ä¹‹é—´çš„å–æ¶ˆå…³ç³»å›¾ï¼š\ngraph LR Ctx1 --\u0026gt; Ctx2:::canceled Ctx2:::canceled -.cancel.-\u0026gt; Ctx3:::canceled Ctx2:::canceled -.cancel.-\u0026gt; Ctx4:::canceled Ctx1 --\u0026gt; Ctx5 --\u0026gt; Ctx6 classDef canceled fill:#f9a; å¯ä»¥çœ‹åˆ°ï¼Œå½“èŠ‚ç‚¹Ctx2å–æ¶ˆæ—¶ï¼Œå­èŠ‚ç‚¹Ctx4ã€Ctx5ä¹Ÿä¸€åŒè¢«å–æ¶ˆäº†ã€‚å¦‚æœCtx4ã€Ctx5è¿˜æœ‰æ›´å¤šçš„å­èŠ‚ç‚¹çš„è¯ï¼Œä¹Ÿä¼šä¸€å¹¶å–æ¶ˆã€‚\nContextä¼ å€¼ æˆ‘ä»¬æ”¹é€ ä¸Šè¿°ä»£ç ï¼š\nfunc main() { var wg sync.WaitGroup wg.Add(1) // åˆ›å»ºä¸€ä¸ªå¯å–æ¶ˆçš„parent Context ctx, stop := context.WithCancel(context.Background()) // åˆ›å»ºä¸€ä¸ªValueContextï¼Œkeyä¸ºuserId, valueä¸º1 valCtx := context.WithValue(ctx, \u0026#34;userId\u0026#34;, 1) go func() { defer wg.Done() getUser(valCtx) }() time.Sleep(time.Second * 2) fmt.Println(\u0026#34;Signal to goroutine exit...\u0026#34;) stop()\t// å‘contextå‘é€åœæ­¢æŒ‡ä»¤ fmt.Println(\u0026#34;Signal sent.\u0026#34;) wg.Wait() fmt.Println(\u0026#34;Exit.\u0026#34;) } func getUser(ctx context.Context){ for { select { case \u0026lt;-ctx.Done(): fmt.Printf(\u0026#34;gorouting [getUser]: go break signal\\n\u0026#34;) return default: value := ctx.Value(\u0026#34;userId\u0026#34;) fmt.Printf(\u0026#34;gorouting [getUser], userId=%v\\n\u0026#34;, value) time.Sleep(time.Second * 1) } } } å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬é€šè¿‡context.WithValueåˆ›å»ºä¸€ä¸ªå«å€¼çš„Contextï¼Œç„¶ååˆ°goroutineä¸­ï¼Œåœ¨goroutineä¸­é€šè¿‡ctx.Value(\u0026quot;userId\u0026quot;)å°†æˆ‘ä»¬ä¼ å…¥çš„å€¼è·å–å‡ºæ¥ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œcontext.WithValueæ˜¯æ²¡æœ‰è¿”å›cancelFuncçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½å¤Ÿé€šè¿‡å€¼Contextä¸»åŠ¨å‘Šè¯‰åç¨‹å»ç»ˆæ­¢ï¼Œè€Œæ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ªå¯å–æ¶ˆçš„çˆ¶Contextï¼Œé€šè¿‡è¿™ä¸ªçˆ¶Contextå‘é€å–æ¶ˆä¿¡å·ã€‚\nContextä½¿ç”¨åŸåˆ™ Contextä¸è¦æ”¾åœ¨ç»“æ„ä½“ä¸­ï¼Œè¦ä»¥å‚æ•°çš„æ–¹å¼ä¼ é€’ Contextä½œä¸ºå‡½æ•°å‚æ•°çš„æ—¶å€™ï¼Œè¦ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•° è¦ä½¿ç”¨context.Backgroud()å‡½æ•°ç”Ÿæˆæ ¹èŠ‚ç‚¹Contextï¼Œä¹Ÿå°±æ˜¯é¡¶å±‚Context Contextä¼ å€¼è¦ä¼ é€’å¿…é¡»ä¼ é€’çš„å€¼ï¼Œè€Œä¸”è¦å°½å¯èƒ½å°‘ï¼Œä¸è¦ä»€ä¹ˆéƒ½ä¼  Contextå¤šåç¨‹å®‰å…¨ï¼Œå¯ä»¥åœ¨å¤šä¸ªåç¨‹ä¸­æ”¾å¿ƒä½¿ç”¨ æ€»ç»“ï¼š Context é€šè¿‡ With ç³»åˆ—å‡½æ•°ç”Ÿæˆ Context æ ‘ï¼ŒæŠŠç›¸å…³çš„ Context å…³è”èµ·æ¥ï¼Œè¿™æ ·å°±å¯ä»¥ç»Ÿä¸€è¿›è¡Œæ§åˆ¶ã€‚ä¸€å£°ä»¤ä¸‹ï¼Œå…³è”çš„ Context éƒ½ä¼šå‘å‡ºå–æ¶ˆä¿¡å·ï¼Œä½¿ç”¨è¿™äº› Context çš„åç¨‹å°±å¯ä»¥æ”¶åˆ°å–æ¶ˆä¿¡å·ï¼Œç„¶åæ¸…ç†é€€å‡ºã€‚æˆ‘ä»¬åœ¨å®šä¹‰å‡½æ•°çš„æ—¶å€™ï¼Œå¦‚æœæƒ³è®©å¤–éƒ¨ç»™å‡½æ•°å‘å–æ¶ˆä¿¡å·ï¼Œå°±å¯ä»¥ä¸ºè¿™ä¸ªå‡½æ•°å¢åŠ ä¸€ä¸ª Context å‚æ•°ï¼Œè®©å¤–éƒ¨çš„è°ƒç”¨è€…å¯ä»¥é€šè¿‡ Context è¿›è¡Œæ§åˆ¶ï¼Œæ¯”å¦‚ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶è¶…æ—¶é€€å‡ºçš„éœ€æ±‚ã€‚\n","permalink":"https://zihuanling.github.io/posts/2022-02-27-go-8-concurrency/","summary":"\u003ch2 id=\"åç¨‹å¦‚ä½•é€€å‡º\"\u003eåç¨‹å¦‚ä½•é€€å‡º\u003c/h2\u003e\n\u003cp\u003eä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬æ‰§è¡Œåç¨‹ï¼Œéœ€è¦ç­‰åˆ°åç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œæ‰èƒ½å¤Ÿé€€å‡ºã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬æƒ³è¦è®©åç¨‹æå‰é€€å‡ºï¼Œå°±éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œå»æ§åˆ¶åç¨‹çš„é€€å‡ºã€‚\u003c/p\u003e\n\u003cp\u003eä»¥ä¸‹ä¾‹å­ä½¿ç”¨\u003ccode\u003eselect + channel\u003c/code\u003eçš„æ–¹å¼ï¼Œæ§åˆ¶åç¨‹çš„é€€å‡º\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ech\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e make(\u003cspan style=\"color:#66d9ef\"\u003echan\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003ebool\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// å¼€å¯looperåç¨‹\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003elooper\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ech\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// 5ç§’åå‘é€ä¸­æ–­ä¿¡å·\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSecond\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Signal to goroutine exit...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ech\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Signal sent.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eWait\u003c/span\u003e()  \u003cspan style=\"color:#75715e\"\u003e// ç­‰å¾…åç¨‹å®Œå…¨é€€å‡º\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Exit.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elooper\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ech\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003echan\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003ebool\u003c/span\u003e){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003eselect\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ech\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;go break signal\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003edefault\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;looper is running...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSecond\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šè¿°ä¾‹å­é€šè¿‡ä¸€ä¸ª\u003ccode\u003ech\u003c/code\u003e channel å‘é€ä¿¡å·ï¼Œè®©åç¨‹æ”¶åˆ°ä¿¡å·åç»ˆæ­¢å¾ªç¯ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä½¿ç”¨contextæ§åˆ¶åç¨‹é€€å‡º\"\u003eä½¿ç”¨Contextæ§åˆ¶åç¨‹é€€å‡º\u003c/h2\u003e\n\u003cp\u003eä¸Šè¿°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡select+ channel çš„æ–¹å¼è¿›è¡Œæ§åˆ¶åç¨‹çš„é€€å‡ºï¼Œä½†æ˜¯é‚£æ˜¯å•ä¸ªåç¨‹çš„é€€å‡ºï¼Œå½“æˆ‘ä»¬æƒ³è¦æ§åˆ¶å¤šä¸ªåç¨‹çš„é€€å‡ºæ—¶ï¼Œä¹Ÿå¯ä»¥ç”¨å®šä¹‰å¤šä¸ªchannelçš„æ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¼šè®©ä»£ç å˜å¾—ååˆ†å¤æ‚ã€‚\u003c/p\u003e\n\u003cp\u003eè€ŒContextï¼Œå¯ä»¥è®©æˆ‘ä»¬è·Ÿè¸ªåˆ°æ¯ä¸ªåç¨‹ï¼Œä»è€Œæ›´å¥½åœ°è¿›è¡Œé™åˆ¶å’Œæ§åˆ¶ã€‚\u003c/p\u003e\n\u003cp\u003eä½¿ç”¨ Context æ”¹é€ ä¸Šè¿°çš„ä»£ç ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ectx\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003estop\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003econtext\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eWithCancel\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003econtext\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eBackground\u003c/span\u003e())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003elooper\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ectx\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSecond\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Signal to goroutine exit...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003estop\u003c/span\u003e()\t\u003cspan style=\"color:#75715e\"\u003e// å‘contextå‘é€åœæ­¢æŒ‡ä»¤\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Signal sent.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Exit.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elooper\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ectx\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003econtext\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eContext\u003c/span\u003e){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003eselect\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ectx\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eDone\u003c/span\u003e():\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;go break signal\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003edefault\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;looper is running...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSecond\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šè¿°ä»£ç å®ç°çš„åŠŸèƒ½å’Œä½¿ç”¨\u003ccode\u003eselect + channel\u003c/code\u003eä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦æ”¹åŠ¨ä¸ºï¼š\u003c/p\u003e","title":"8. goå¹¶å‘ï¼šContext-å¤šçº¿ç¨‹å¹¶å‘æ§åˆ¶ç¥å™¨"},{"content":"åœ¨æŸäº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å†™çš„bashè„šæœ¬éœ€è¦è·å–å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„æŸäº›å‚æ•°ï¼Œç”¨ä»¥åˆ¤æ–­æŸäº›æ¡ä»¶ï¼Œæˆ–è€…è®¾ç½®æŸäº›å˜é‡ç­‰ã€‚\ngetoptså¯ä»¥è®©æˆ‘ä»¬é€šè¿‡æŒ‡å®š -a 1 çš„æ–¹å¼æŒ‡å®šå¯¹åº”çš„å‚æ•°åç§°å’Œå‚æ•°å€¼ã€‚\nä¸€ä¸ªæ›´è¯¦ç»†çš„å°æ•™ç¨‹ï¼Œå¯ä»¥çœ‹è¿™é‡Œï¼š getopts_tutorial ä½¿ç”¨ å¯ä»¥ä½¿ç”¨ while getopts \u0026quot;:a:p:\u0026quot; opt; do... çš„æ–¹å¼ï¼Œå°†å‚æ•°åç§°è¯»å–åˆ° opt å˜é‡ä¸­ï¼Œç„¶åï¼Œåœ¨å¾ªç¯ä½“ä¸­ï¼Œä½¿ç”¨ $OPTARG è·å–åˆ°å…·ä½“çš„å‚æ•°å€¼ã€‚\nä¸€ä¸ªå°æ —å­ï¼Œç”¨äºå¿«æ·åˆ›å»ºæ–°çš„ gihub pages åšå®¢æ¨¡æ¿ï¼š\n#!/usr/bin/env bash # ç”¨äºå¿«æ·åˆ›å»ºæ–°åšå®¢ # å‘½ä»¤ï¼š ./new.sh -t æ ‡ç­¾1,æ ‡ç­¾2 -n æ–‡ç« æ ‡é¢˜ -l layout -c 1 layout=\u0026#34;post\u0026#34; title=\u0026#34;new-post\u0026#34; now=$(date +%Y-%m-%d) can_comment=\u0026#34;false\u0026#34; author=\u0026#34;ZihuanLing\u0026#34; while getopts \u0026#34;:l:t:c:n:\u0026#34; opt; do case $opt in l) layout=\u0026#34;$OPTARG\u0026#34; ;; t) tags=\u0026#34;[$OPTARG]\u0026#34; ;; c) can_comment=\u0026#34;true\u0026#34; ;; n) title=$(echo \u0026#34;$OPTARG\u0026#34; | sed \u0026#34;s/ /\\-/g\u0026#34;) ;; \\?) echo \u0026#34;Invalid option -$OPTARG\u0026#34; \u0026gt;\u0026amp;2 exit 1 ;; esac done if [ -z $tags ]; then tags=\u0026#34;[]\u0026#34; fi filename=\u0026#34;_posts/${now}-${title}.md\u0026#34; read -r -d \u0026#39;\u0026#39; content \u0026lt;\u0026lt; EOM --- layout: ${layout} title: \u0026#34;${title}\u0026#34; date: ${now} tags: ${tags} comments: ${can_comment} author: ${author} --- \u0026lt;!-- more --\u0026gt; EOM echo \u0026#34;$filename\u0026#34; echo \u0026#34;$content\u0026#34; echo \u0026#34;$content\u0026#34; \u0026gt; $filename ","permalink":"https://zihuanling.github.io/posts/2022-02-24-try-linux-getopts/","summary":"\u003cp\u003eåœ¨æŸäº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å†™çš„bashè„šæœ¬éœ€è¦è·å–å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„æŸäº›å‚æ•°ï¼Œç”¨ä»¥åˆ¤æ–­æŸäº›æ¡ä»¶ï¼Œæˆ–è€…è®¾ç½®æŸäº›å˜é‡ç­‰ã€‚\u003c/p\u003e\n\u003cp\u003egetoptså¯ä»¥è®©æˆ‘ä»¬é€šè¿‡æŒ‡å®š \u003ccode\u003e-a 1\u003c/code\u003e çš„æ–¹å¼æŒ‡å®šå¯¹åº”çš„å‚æ•°åç§°å’Œå‚æ•°å€¼ã€‚\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003ch3 id=\"ä¸€ä¸ªæ›´è¯¦ç»†çš„å°æ•™ç¨‹å¯ä»¥çœ‹è¿™é‡Œ-getopts_tutorialhttpswikibash-hackersorghowtogetopts_tutorial\"\u003eä¸€ä¸ªæ›´è¯¦ç»†çš„å°æ•™ç¨‹ï¼Œå¯ä»¥çœ‹è¿™é‡Œï¼š \u003ca href=\"https://wiki.bash-hackers.org/howto/getopts_tutorial\"\u003egetopts_tutorial\u003c/a\u003e\u003c/h3\u003e\n\u003ch3 id=\"ä½¿ç”¨\"\u003eä½¿ç”¨\u003c/h3\u003e\n\u003cp\u003eå¯ä»¥ä½¿ç”¨ \u003ccode\u003ewhile getopts \u0026quot;:a:p:\u0026quot; opt; do...\u003c/code\u003e çš„æ–¹å¼ï¼Œå°†å‚æ•°åç§°è¯»å–åˆ° \u003ccode\u003eopt\u003c/code\u003e å˜é‡ä¸­ï¼Œç„¶åï¼Œåœ¨å¾ªç¯ä½“ä¸­ï¼Œä½¿ç”¨ \u003ccode\u003e$OPTARG\u003c/code\u003e è·å–åˆ°å…·ä½“çš„å‚æ•°å€¼ã€‚\u003c/p\u003e\n\u003cp\u003eä¸€ä¸ªå°æ —å­ï¼Œç”¨äºå¿«æ·åˆ›å»ºæ–°çš„ gihub pages åšå®¢æ¨¡æ¿ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/usr/bin/env bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ç”¨äºå¿«æ·åˆ›å»ºæ–°åšå®¢\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# å‘½ä»¤ï¼š ./new.sh -t æ ‡ç­¾1,æ ‡ç­¾2 -n æ–‡ç« æ ‡é¢˜ -l layout -c 1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003elayout\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;post\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etitle\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;new-post\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enow\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003edate +%Y-%m-%d\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecan_comment\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;false\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eauthor\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ZihuanLing\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e getopts \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;:l:t:c:n:\u0026#34;\u003c/span\u003e opt; \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e $opt in \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    l\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      layout\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$OPTARG\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      ;;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    t\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      tags\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[\u003c/span\u003e$OPTARG\u003cspan style=\"color:#e6db74\"\u003e]\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      ;;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    c\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      can_comment\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      ;;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    n\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      title\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$OPTARG\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e | sed \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;s/ /\\-/g\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      ;;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#ae81ff\"\u003e\\?\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e echo \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Invalid option -\u003c/span\u003e$OPTARG\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u0026gt;\u0026amp;\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    exit \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    ;;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eesac\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e -z $tags \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  tags\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;[]\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003efilename\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;_posts/\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003enow\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003etitle\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e.md\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eread -r -d \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e content \u003cspan style=\"color:#e6db74\"\u003e\u0026lt;\u0026lt; EOM\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e---\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003elayout: ${layout}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003etitle: \u0026#34;${title}\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003edate: ${now}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003etags: ${tags}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003ecomments: ${can_comment}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eauthor: ${author}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e---\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026lt;!-- more --\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eEOM\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$filename\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$content\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$content\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u0026gt; $filename\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"ä½¿ç”¨ getopts è·å–å‘½ä»¤è¡Œä¸­çš„å‚æ•°"},{"content":"ä» lemonchan.github.io forkäº†è¿™ä¸ªåšå®¢é¡¹ç›®ï¼Œæ„Ÿè§‰å¤ªæ£’äº†ï¼Œè®¾è®¡å¾ˆç®€æ´ï¼Œæˆ‘éœ€è¦çš„åŠŸèƒ½åŸºæœ¬ä¸Šéƒ½æœ‰ã€‚\næ„Ÿè°¢ï¼\n","permalink":"https://zihuanling.github.io/posts/2022-02-23-first-github-page-blog/","summary":"\u003cp\u003eä» \u003ca href=\"https://github.com/lemonchann/lemonchann.github.io\"\u003elemonchan.github.io\u003c/a\u003e forkäº†è¿™ä¸ªåšå®¢é¡¹ç›®ï¼Œæ„Ÿè§‰å¤ªæ£’äº†ï¼Œè®¾è®¡å¾ˆç®€æ´ï¼Œæˆ‘éœ€è¦çš„åŠŸèƒ½åŸºæœ¬ä¸Šéƒ½æœ‰ã€‚\u003c/p\u003e\n\u003cp\u003eæ„Ÿè°¢ï¼\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e","title":"ç¬¬ä¸€ç¯‡GitHub Pageåšå®¢"},{"content":"goåœ¨å¹¶å‘çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°å¤šä¸ªåç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªèµ„æºçš„æ—¶å€™ï¼Œè¿™å°±å‡ºç°äº†èµ„æºç«äº‰ã€‚ä¹Ÿå¯èƒ½å‡ºç°åç¨‹è¿˜åœ¨è¿è¡Œï¼Œä½†æ˜¯ä¸»ç¨‹åºå´é€€å‡ºäº†çš„æƒ…å†µï¼Œè¿™æ˜¯ç¼ºå°‘æ§åˆ¶å¯¼è‡´çš„ã€‚\nç”¨syncåŒ…ï¼Œå¯ä»¥æ–¹ä¾¿çš„æ§åˆ¶èµ„æºçš„è®¿é—®ï¼Œä¹Ÿå¯ä»¥æ–¹ä¾¿å®ç°é˜»å¡ç­‰å¾…ï¼Œè®©åç¨‹æ‰§è¡Œå®Œæ¯•å†é€€å‡ºç¨‹åºï¼Œæˆ–è€…æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚\nèµ„æºç«äº‰ åœ¨åŒä¸€ä¸ªgoroutineä¸­ï¼Œå¦‚æœåˆ†é…çš„å†…å­˜æ²¡æœ‰è¢«å…¶ä»–çš„goroutineè®¿é—®ï¼Œåªåœ¨è¯¥goroutineä¸­ä½¿ç”¨ï¼Œåˆ™ä¸å­˜åœ¨èµ„æºç«äº‰é—®é¢˜\nå¦‚æœåŒä¸€å—å†…å­˜è¢«å¤šä¸ªgoroutineåŒæ—¶è®¿é—®ï¼Œå°±ä¼šäº§ç”Ÿä¸çŸ¥é“è°å…ˆè®¿é—®ï¼Œä¹Ÿæ— æ³•é¢„æ–™æœ€åç»“æœçš„æƒ…å†µï¼Œè¿™å°±æ˜¯èµ„æºç«äº‰ï¼š\n// å…±äº«çš„èµ„æº var sum = 0 func main(){ for i := 0; i \u0026lt; 100; i++ { go add(10) } // goroutine ä¸ä¼šé˜»å¡ä¸‹é¢çš„ä»£ç ï¼Œæ­¤å¤„Sleepä¸€ä¸‹ï¼Œé˜²æ­¢main goroutineç›´æ¥é€€å‡º // è€Œå¯¼è‡´æœªå®Œæˆçš„goroutineä¹Ÿè¢«ç»ˆæ­¢ time.Sleep(time.Second * 2) fmt.Println(\u0026#34;Sum is:\u0026#34;, sum) } func add(i int) { sum += i } ä¸Šè¿°ä¾‹å­ä¸­ï¼Œsumå˜é‡ä¸ºå…±äº«çš„èµ„æºï¼Œç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿèµ„æºç«äº‰ã€‚\nä½¿ç”¨ go buildã€go runã€go test è¿™äº› Go è¯­è¨€å·¥å…·é“¾æä¾›çš„å‘½ä»¤æ—¶ï¼Œæ·»åŠ  -race æ ‡è¯†å¯ä»¥å¸®ä½ æ£€æŸ¥ Go è¯­è¨€ä»£ç æ˜¯å¦å­˜åœ¨èµ„æºç«äº‰\nåŒæ­¥åŸè¯­ sync.Mutex äº’æ–¥é”ï¼ŒåŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªgoroutineèƒ½æ‰§è¡ŒæŸæ®µä»£ç ï¼Œå…¶ä»–åç¨‹éœ€è¦ç­‰å¾…è¯¥åç¨‹æ‰§è¡Œå®Œæ¯•åæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚\nvar ( sum int mutex sync.Mutex ) func add(i int) { mutex.Lock() // defer mutex.Unlock()\t// ä½¿ç”¨deferï¼Œå…³é—­æ›´åŠ ä¼˜é›… sum += i mutex.Unlock() } sync.RWMutex è¯»å†™é”\næœ‰å‡ ç§æƒ…å†µï¼š\nå†™çš„æ—¶å€™ä¸èƒ½åŒæ—¶è¯»ï¼Œè¿™ä¸ªæ—¶å€™è¯»å–çš„è¯å¯èƒ½è¯»åˆ°è„æ•°æ® è¯»çš„æ—¶å€™ä¸èƒ½åŒæ—¶å†™ï¼Œä¹Ÿå¯èƒ½äº§ç”Ÿä¸å¯é¢„æ–™çš„ç»“æœ è¯»çš„æ—¶å€™å¯ä»¥åŒæ—¶è¯»ï¼Œå› ä¸ºæ•°æ®ä¸ä¼šæ”¹å˜ã€‚ // å…±äº«çš„èµ„æº var ( sum = 0 mutex sync.RWMutex ) func main(){ for i := 0; i \u0026lt; 100; i++ { go add(10) } for i := 0; i \u0026lt; 10; i++ { go fmt.Println(\u0026#34;sum is:\u0026#34;, readSum()) } time.Sleep(time.Second) } func readSum() int { // è¯»å–çš„æ—¶å€™ä½¿ç”¨RLockï¼ˆè¯»é”ï¼‰ mutex.RLock() defer mutex.RUnlock() d := sum return d } func add(i int) { mutex.Lock() defer mutex.Unlock() sum += i } sync.WaitGroup ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç”¨åˆ°äº† time.Sleep æ¥é˜²æ­¢goroutineæ‰§è¡Œå®Œæ¯•ä¹‹å‰ï¼Œä¸»ç¨‹åºé€€å‡ºã€‚\nç”±äºä¸çŸ¥é“å¤šä¸ªåç¨‹æ‰§è¡Œå®Œæ¯•éœ€è¦å¤šå°‘æ—¶é—´ï¼Œå› æ­¤è®¾ç½®äº†ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œè°ƒç”¨Sleep\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨sync.WaitGroupæ¥ç›‘å¬åç¨‹çš„è¿è¡Œæƒ…å†µï¼š\nfunc main(){ wg := sync.WaitGroup wg.Add(110) // ç›‘å¬ 110 ä¸ªgoroutine for i := 0; i \u0026lt; 100; i++ { go func(){ defer wg.Done()\t// wgè®¡æ•°å™¨å‡ä¸€ add(10) }() } for i := 0; i \u0026lt; 10; i++ { go func(){ defer wg.Done() fmt.Println(\u0026#34;sum is : \u0026#34;, readSum()) }() } // ä¸€ç›´ç­‰å¾…ï¼ˆé˜»å¡ï¼‰ï¼Œç›´åˆ°è®¡æ•°å™¨ä¸º0 wg.Wait() } sync.WaitGroup çš„ä½¿ç”¨æ­¥éª¤:\nå£°æ˜ä¸€ä¸ªWaitGroupï¼Œwg := sync.WaitGroup,ç„¶åè°ƒç”¨wg.Addæ–¹æ³•ï¼Œè®¾ç½®éœ€è¦è·Ÿè¸ªçš„åç¨‹æ•°é‡ åœ¨æ¯ä¸ªåç¨‹æ‰§è¡Œå®Œæ¯•æ—¶è°ƒç”¨ wg.Doneï¼Œè®©è®¡æ•°å™¨å€¼å‡ä¸€ï¼Œå‘Šè¯‰sync.WaitGroupï¼Œè¯¥åç¨‹æ‰§è¡Œå®Œæ¯• åœ¨éœ€è¦é˜»å¡çš„åœ°æ–¹ï¼Œè°ƒç”¨wg.Waitæ–¹æ³•ï¼ŒçŸ¥é“è®¡æ•°å™¨å€¼ä¸º0 sync.Once func main() { var once sync.Once var wg sync.WaitGroup wg.Add(10) onceBody := func() { fmt.Println(\u0026#34;only once.\u0026#34;) } //å¯åŠ¨10ä¸ªåç¨‹æ‰§è¡Œonce.Do(onceBody) for i := 0; i \u0026lt; 10; i++ { go func() { defer wg.Done() //æŠŠè¦æ‰§è¡Œçš„å‡½æ•°(æ–¹æ³•)ä½œä¸ºå‚æ•°ä¼ ç»™once.Doæ–¹æ³•å³å¯ once.Do(onceBody) }() } wg.Wait() }\tsync.Once é€‚ç”¨äºåˆ›å»ºæŸä¸ªå¯¹è±¡çš„å•ä¾‹ã€åªåŠ è½½ä¸€æ¬¡çš„èµ„æºç­‰åªæ‰§è¡Œä¸€æ¬¡çš„åœºæ™¯\nsync.Cond sync.Cond å¯ä»¥ä¸€å£°ä»¤ä¸‹è®©æ‰€æœ‰åç¨‹éƒ½å¼€å§‹æ‰§è¡Œï¼Œå…³é”®ç‚¹åœ¨äºåç¨‹å¼€å§‹çš„æ—¶å€™æ˜¯ç­‰å¾…çš„ï¼Œè¦ç­‰å¾… sync.Cond å”¤é†’æ‰èƒ½æ‰§è¡Œ\nsync.Cond å¯ä»¥ç”¨äºæ§åˆ¶åç¨‹çš„é˜»å¡å’Œå”¤é†’ã€‚\nfunc main() { cond := sync.NewCond(\u0026amp;sync.Mutex{}) var wg sync.WaitGroup wg.Add(11) // 10 ä¸ªäººèµ›è·‘ for i := 1; i \u0026lt;= 10; i++ { go func(num int) { defer wg.Done() fmt.Printf(\u0026#34;%-2d is ready.\\n\u0026#34;, num) cond.L.Lock() defer cond.L.Unlock() cond.Wait()\t// è¿›å…¥ç­‰å¾…ï¼Œç›´åˆ° cond.Signal() æˆ–è€… cond.Broadcast() fmt.Printf(\u0026#34;%-2d is running...\\n\u0026#34;, num) }(i) } time.Sleep(time.Second) // 1 ä¸ªè£åˆ¤å‘å·æ–½ä»¤ go func() { defer wg.Done() fmt.Println(\u0026#34;judgement is ready.\u0026#34;) fmt.Println(\u0026#34;Run!\u0026#34;) cond.Broadcast() // Broadcast è®©æ‰€æœ‰çš„åç¨‹å¼€å§‹è¿è¡Œ }() wg.Wait() } sync.Cond çš„ä¸‰ä¸ªæ–¹æ³•ï¼š\nWaitï¼šé˜»å¡å½“å‰åç¨‹ï¼ŒçŸ¥é“è¢«å…¶ä»–åç¨‹è°ƒç”¨Broadcastæˆ–è€…Signalæ–¹æ³•å”¤é†’ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦åŠ é”ï¼Œç›´æ¥ä½¿ç”¨sync.Condä¸­çš„é”å³å¯ï¼ˆLå­—æ®µï¼‰ Signalï¼šå”¤é†’ä¸€ä¸ªç­‰å¾…æ—¶é—´æœ€é•¿çš„åç¨‹ Broadcastï¼šå”¤é†’æ‰€æœ‰ç­‰å¾…çš„åç¨‹ åœ¨è°ƒç”¨ cond.Signal æˆ–è€… cond.Broadcast ä¹‹å‰ï¼Œè¦ç¡®ä¿ç›®æ ‡åç¨‹å¤„äºWaité˜»å¡çŠ¶æ€ï¼Œå¦åˆ™ä¼šæœ‰æ­»é”é—®é¢˜ã€‚\nsync.Map æ–¹æ³•ï¼š\nStoreï¼šå­˜å‚¨ä¸€å †key-valueå€¼ Loadï¼šæ ¹æ®keyè·å–å¯¹åº”çš„valueå€¼ï¼Œä¸”å¯åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨ LoadOrStoreï¼šå¦‚æœkeyå¯¹åº”çš„valueå­˜åœ¨ï¼Œåˆ™è¿”å›valueï¼›å¦åˆ™ï¼Œå­˜å‚¨å¯¹åº”çš„value Deleteï¼šåˆ é™¤ä¸€ä¸ªkey-valueé”®å€¼å¯¹ Rangeï¼šå¾ªç¯è¿­ä»£sync.Mapï¼Œæ•ˆæœä¸for-rangeä¸€æ · func main() { var mp sync.Map var wg sync.WaitGroup wg.Add(10) for i := 0; i \u0026lt; 10; i++ { go func(id int) { defer wg.Done() if _, loaded := mp.LoadOrStore(\u0026#34;initialized\u0026#34;, id); !loaded { fmt.Println(id, \u0026#34;mapper not initialized, init now.\u0026#34;) return } value, loaded := mp.LoadOrStore(id, id) if loaded { fmt.Println(id, \u0026#34;Loaded value \u0026#34;, value) if value != id { fmt.Println(id, \u0026#34;Insert from other goroutine, delete it\u0026#34;) mp.Delete(id) } } else { fmt.Println(id, \u0026#34;Store value \u0026#34;, id) } mp.Store(id + 1, id) }(i) } wg.Wait() wg.Add(1) go func() { defer wg.Done() mp.Range(func(key, value interface{}) bool { fmt.Printf(\u0026#34;range for k = %v, value = %v\\n\u0026#34;, key, value) return true }) }() wg.Wait() } ","permalink":"https://zihuanling.github.io/posts/2022-02-19-go-7-concurrency/","summary":"\u003cp\u003egoåœ¨å¹¶å‘çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°å¤šä¸ªåç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªèµ„æºçš„æ—¶å€™ï¼Œè¿™å°±å‡ºç°äº†èµ„æºç«äº‰ã€‚ä¹Ÿå¯èƒ½å‡ºç°åç¨‹è¿˜åœ¨è¿è¡Œï¼Œä½†æ˜¯ä¸»ç¨‹åºå´é€€å‡ºäº†çš„æƒ…å†µï¼Œè¿™æ˜¯ç¼ºå°‘æ§åˆ¶å¯¼è‡´çš„ã€‚\u003c/p\u003e\n\u003cp\u003eç”¨syncåŒ…ï¼Œå¯ä»¥æ–¹ä¾¿çš„æ§åˆ¶èµ„æºçš„è®¿é—®ï¼Œä¹Ÿå¯ä»¥æ–¹ä¾¿å®ç°é˜»å¡ç­‰å¾…ï¼Œè®©åç¨‹æ‰§è¡Œå®Œæ¯•å†é€€å‡ºç¨‹åºï¼Œæˆ–è€…æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003ch2 id=\"èµ„æºç«äº‰\"\u003eèµ„æºç«äº‰\u003c/h2\u003e\n\u003cp\u003eåœ¨åŒä¸€ä¸ªgoroutineä¸­ï¼Œå¦‚æœåˆ†é…çš„å†…å­˜æ²¡æœ‰è¢«å…¶ä»–çš„goroutineè®¿é—®ï¼Œåªåœ¨è¯¥goroutineä¸­ä½¿ç”¨ï¼Œåˆ™ä¸å­˜åœ¨èµ„æºç«äº‰é—®é¢˜\u003c/p\u003e\n\u003cp\u003eå¦‚æœåŒä¸€å—å†…å­˜è¢«å¤šä¸ªgoroutineåŒæ—¶è®¿é—®ï¼Œå°±ä¼šäº§ç”Ÿä¸çŸ¥é“è°å…ˆè®¿é—®ï¼Œä¹Ÿæ— æ³•é¢„æ–™æœ€åç»“æœçš„æƒ…å†µï¼Œè¿™å°±æ˜¯èµ„æºç«äº‰ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å…±äº«çš„èµ„æº\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e = \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e \u0026lt; \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e; \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eadd\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// goroutine ä¸ä¼šé˜»å¡ä¸‹é¢çš„ä»£ç ï¼Œæ­¤å¤„Sleepä¸€ä¸‹ï¼Œé˜²æ­¢main goroutineç›´æ¥é€€å‡º\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#75715e\"\u003e// è€Œå¯¼è‡´æœªå®Œæˆçš„goroutineä¹Ÿè¢«ç»ˆæ­¢\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSecond\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Sum is:\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eadd\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šè¿°ä¾‹å­ä¸­ï¼Œsumå˜é‡ä¸ºå…±äº«çš„èµ„æºï¼Œç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿèµ„æºç«äº‰ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eä½¿ç”¨ go buildã€go runã€go test è¿™äº› Go è¯­è¨€å·¥å…·é“¾æä¾›çš„å‘½ä»¤æ—¶ï¼Œæ·»åŠ  -race æ ‡è¯†å¯ä»¥å¸®ä½ æ£€æŸ¥ Go è¯­è¨€ä»£ç æ˜¯å¦å­˜åœ¨èµ„æºç«äº‰\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"åŒæ­¥åŸè¯­\"\u003eåŒæ­¥åŸè¯­\u003c/h2\u003e\n\u003ch3 id=\"syncmutex\"\u003esync.Mutex\u003c/h3\u003e\n\u003cp\u003eäº’æ–¥é”ï¼ŒåŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªgoroutineèƒ½æ‰§è¡ŒæŸæ®µä»£ç ï¼Œå…¶ä»–åç¨‹éœ€è¦ç­‰å¾…è¯¥åç¨‹æ‰§è¡Œå®Œæ¯•åæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003emutex\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eMutex\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eadd\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003emutex\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eLock\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// defer mutex.Unlock()\t\t// ä½¿ç”¨deferï¼Œå…³é—­æ›´åŠ ä¼˜é›…\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003emutex\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eUnlock\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"syncrwmutex\"\u003esync.RWMutex\u003c/h3\u003e\n\u003cp\u003eè¯»å†™é”\u003c/p\u003e","title":"7. goå¹¶å‘ï¼šåŒæ­¥åŸè¯­ï¼Œç”¨syncåŒ…æ§åˆ¶å¹¶å‘"},{"content":"å¹¶å‘ï¼Œå°±æ˜¯è®©ç¨‹åºåœ¨åŒä¸€æ—¶åˆ»åšå¤šä»¶äº‹æƒ…ã€‚\ngoè¯­è¨€å¤©ç”Ÿè‡ªå¸¦å¹¶å‘å±æ€§ï¼Œä½¿å¾—å¹¶å‘ç¼–ç¨‹åï¼åˆ†ï¼æ–¹ï¼ä¾¿ï¼ï¼Œæˆ‘ä»¬åªéœ€è¦ go å‡½æ•°å() å³å¯ï¼\\(^o^)/\nè¿›ç¨‹å’Œçº¿ç¨‹ è¿›ç¨‹ ç¨‹åºå¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªè¿›ç¨‹\nçº¿ç¨‹ æ˜¯è¿›ç¨‹çš„æ‰§è¡Œç©ºé—´ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹è¢«æ“ä½œç³»ç»Ÿè°ƒåº¦æ‰§è¡Œ ä¸€ä¸ªç¨‹åºå¯åŠ¨ï¼Œå¯¹åº”çš„è¿›ç¨‹ä¼šè¢«åˆ›å»ºï¼ŒåŒæ—¶ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼Œä¸»çº¿ç¨‹ç»“æŸï¼Œæ•´ä¸ªç¨‹åºä¹Ÿå°±é€€å‡ºäº†ã€‚ æˆ‘ä»¬å¯ä»¥ä»ä¸»çº¿ç¨‹åˆ›å»ºå…¶ä»–çš„å­çº¿ç¨‹ï¼Œè¿™å°±æ˜¯å¤šçº¿ç¨‹å¹¶å‘\nåç¨‹ Goroutine goroutineæ¯”çº¿ç¨‹æ›´åŠ è½»ç›ˆï¼Œè¢«Go runtimeè°ƒåº¦ã€‚ å¯åŠ¨åç¨‹ï¼š go function()\n// è¿™é‡Œå¯åŠ¨äº†ä¸¤ä¸ªgoroutineï¼Œ ä¸€ä¸ªæ˜¯ç”¨goå…³é”®å­—è§¦å‘çš„ï¼Œå¦ä¸€ä¸ªæ˜¯ main goroutineï¼ˆä¸»çº¿ç¨‹ï¼‰ func main(){ go fmt.Println(\u0026#34;Hello goroutine.\u0026#34;) fmt.Println(\u0026#34;Main goroutine.\u0026#34;) time.Sleep(time.Second) } Channel å¤šä¸ªgoroutineä¹‹é—´ï¼Œä½¿ç”¨ channelè¿›è¡Œé€šä¿¡\nå£°æ˜ä¸€ä¸ªchannel // ç›´æ¥ä½¿ç”¨ make åˆ›å»ºä¸€ä¸ªchannelï¼Œæ¥å—çš„æ•°æ®ç±»å‹æ˜¯string ch := make(chan string) // ä¸€ä¸ªchannelçš„æ“ä½œåªæœ‰ä¸¤ç§ï¼š // - å‘é€ï¼Œå‘chanä¸­å‘é€å€¼ï¼š chan\u0026lt;- // - æ¥å—ï¼Œä»chanä¸­è·å–å€¼ï¼š \u0026lt;-chan demo\nfunc main(){ ch := make(chan string) go func(){ fmt.Println(\u0026#34;Message in goroutine\u0026#34;) ch \u0026lt;- \u0026#34;goroutine finished.\u0026#34;\t// send message to channel. }() fmt.Println(\u0026#34;Main goroutine.\u0026#34;) v := \u0026lt;-ch\t// receive message from channel fmt.Println(\u0026#34;Message from channel: \u0026#34;, v) } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨æ–°å¯åŠ¨çš„ goroutine ä¸­å‘ chan ç±»å‹çš„å˜é‡ ch å‘é€å€¼ï¼›åœ¨ main goroutine ä¸­ï¼Œä»å˜é‡ ch æ¥æ”¶å€¼ï¼›å¦‚æœ ch ä¸­æ²¡æœ‰å€¼ï¼Œåˆ™é˜»å¡ç­‰å¾…åˆ° ch ä¸­æœ‰å€¼å¯ä»¥æ¥æ”¶ä¸ºæ­¢ã€‚\né€šè¿‡ make åˆ›å»ºçš„ chan ä¸­æ²¡æœ‰å€¼ï¼Œè€Œ main goroutine åˆæƒ³ä» chan ä¸­è·å–å€¼ï¼Œè·å–ä¸åˆ°å°±ä¸€ç›´ç­‰å¾…ï¼Œç­‰åˆ°å¦ä¸€ä¸ª goroutine å‘ chan å‘é€å€¼ä¸ºæ­¢ã€‚\nchannel æœ‰ç‚¹åƒåœ¨ä¸¤ä¸ª goroutine ä¹‹é—´æ¶è®¾çš„ç®¡é“ï¼Œä¸€ä¸ª goroutine å¯ä»¥å¾€è¿™ä¸ªç®¡é“é‡Œå‘é€æ•°æ®ï¼Œå¦å¤–ä¸€ä¸ªå¯ä»¥ä»è¿™ä¸ªç®¡é“é‡Œå–æ•°æ®ï¼Œæœ‰ç‚¹ç±»ä¼¼äºæˆ‘ä»¬è¯´çš„é˜Ÿåˆ—ã€‚\næ— ç¼“å†²channel ä¸Šè¿°çš„channelå°±æ˜¯ä¸€ä¸ªæ— ç¼“å†²çš„channelï¼Œå®¹é‡ä¸º0ï¼Œæ— æ³•å­˜å‚¨æ•°æ®ï¼Œåªèƒ½ä¼ è¾“ã€‚ å®ƒçš„å‘é€å’Œæ¥å—æ“ä½œæ˜¯åŒæ—¶çš„ï¼Œå¯ä»¥ç§°ä¸ºåŒæ­¥channel\næœ‰ç¼“å†²channel ç±»ä¼¼ä¸€ä¸ªå¯é˜»å¡çš„é˜Ÿåˆ—ï¼Œå†…éƒ¨çš„å…ƒç´ å…ˆè¿›å…ˆå‡ºï¼Œé€šè¿‡makeç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šchannelå®¹é‡å¤§å°ï¼š\nch := make(chan int, 5) // åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º5çš„channel ä¸Šè¿°åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º5çš„channelï¼Œå¯ä»¥å­˜æ”¾æœ€å¤š5ä¸ªintç±»å‹çš„å…ƒç´ ï¼Œå…¶å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š\næœ‰ç¼“å†²channelå†…éƒ¨æœ‰ä¸€ä¸ªç¼“å†²é˜Ÿåˆ— å‘é€æ“ä½œæ˜¯å‘é˜Ÿå°¾æ’å…¥å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ªgoroutineæ‰§è¡Œæ¥æ”¶æ“ä½œï¼Œé‡Šæ”¾channelçš„ç©ºé—´ æ¥æ”¶æ“ä½œæ˜¯ä»é˜Ÿå¤´è·å–ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—å·²ç©ºï¼Œé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æœ‰goroutineæ’å…¥æ–°çš„å…ƒç´  å…³é—­channel ä½¿ç”¨å†…ç½®çš„closeå‡½æ•°å…³é—­ï¼š\nclose(ch) å¦‚æœä¸€ä¸ªchannelè¢«å…³é—­äº†ï¼Œå°±ä¸èƒ½å‘é‡Œé¢å‘é€æ•°æ®äº†ï¼Œç»§ç»­å‘é€ä¼šå¼•å‘panicå¼‚å¸¸ã€‚\nä½†æ˜¯å¯ä»¥æ¥å—å·²å…³é—­channelé‡Œé¢çš„æ•°æ®ï¼Œæ— æ•°æ®åˆ™æ¥å—çš„æ˜¯å…ƒç´ ç±»å‹çš„é›¶å€¼ã€‚\nå•å‘channel åªèƒ½å‘é€ä¸èƒ½æ¥æ”¶ï¼Œæˆ–è€…åªèƒ½æ¥æ”¶ä¸èƒ½å‘é€çš„channelï¼Œæˆä¸ºå•å‘channel\nonlySend := make(chan\u0026lt;- int)\t// å•å‘ onlyReceive := make(\u0026lt;-chan int)\t// å•æ”¶ è¿™æ ·çš„channelä¸€èˆ¬åœ¨å‡½æ•°æˆ–è€…æ–¹æ³•çš„å‚æ•°å£°æ˜ä¸­ä½¿ç”¨ï¼š\nfunc counter(sendCh chan\u0026lt;- int){ // åªèƒ½å¾€sendChä¸­å‘é€æ•°æ® // num := \u0026lt;-sendCh // ä¸èƒ½ä»å•å‘channelä¸­æ¥å—æ•°æ®ï¼Œç¼–è¯‘ä¼šä¸é€šè¿‡ } select + channel ç¤ºä¾‹ // ç»“æ„ç¤ºä¾‹ select { case i1 = \u0026lt;-ch1: // todo case ch2 \u0026lt;- i2: // todo default: // default process } æ•´ä½“ç»“æ„ä¸switchå¾ˆåƒï¼Œæœ‰caseå’Œdefaultï¼Œä½†æ˜¯selectçš„caseæ˜¯ä¸€ä¸ªä¸ªå¯ä»¥æ“ä½œçš„channel\n// select ä¸‹è½½ä¾‹å­ func main() { firstCh := make(chan string) secondCh := make(chan string) thirdCh := make(chan string) go func() { firstCh \u0026lt;- downloadFile(\u0026#34;firstCh\u0026#34;) }() go func() { secondCh \u0026lt;- downloadFile(\u0026#34;secondCh\u0026#34;) }() go func() { thirdCh \u0026lt;- downloadFile(\u0026#34;thirdCh\u0026#34;) }() // select å¤šè·¯å¤ç”¨ï¼Œå“ªä¸ªchannelæœ€å…ˆè·å–åˆ°å€¼ï¼Œ // å°±è¯´æ˜å½“å‰channelä¸‹è½½å¥½äº† select { case filePath := \u0026lt;-firstCh: fmt.Println(filePath) case filePath := \u0026lt;-secondCh: fmt.Println(filePath) case filePath := \u0026lt;-thirdCh: fmt.Println(filePath) } } func downloadFile(filename string) string { time.Sleep(time.Second) return \u0026#34;filepath:\u0026#34; + filename } å¦‚æœè¿™äº› case ä¸­æœ‰ä¸€ä¸ªå¯ä»¥æ‰§è¡Œï¼Œselect è¯­å¥ä¼šé€‰æ‹©è¯¥ case æ‰§è¡Œï¼Œå¦‚æœåŒæ—¶æœ‰å¤šä¸ª case å¯ä»¥è¢«æ‰§è¡Œï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªï¼Œè¿™æ ·æ¯ä¸ª case éƒ½æœ‰å¹³ç­‰çš„è¢«æ‰§è¡Œçš„æœºä¼šã€‚å¦‚æœä¸€ä¸ª select æ²¡æœ‰ä»»ä½• caseï¼Œé‚£ä¹ˆå®ƒä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ã€‚\nåœ¨ Go è¯­è¨€ä¸­ï¼Œæå€¡é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜ï¼Œè€Œä¸æ˜¯é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼Œå…¶å®å°±æ˜¯æå€¡é€šè¿‡ channel å‘é€æ¥æ”¶æ¶ˆæ¯çš„æ–¹å¼è¿›è¡Œæ•°æ®ä¼ é€’ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¿®æ”¹åŒä¸€ä¸ªå˜é‡ã€‚æ‰€ä»¥åœ¨æ•°æ®æµåŠ¨ã€ä¼ é€’çš„åœºæ™¯ä¸­è¦ä¼˜å…ˆä½¿ç”¨ channelï¼Œå®ƒæ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œæ€§èƒ½ä¹Ÿä¸é”™ã€‚(å› ä¸ºchannelå†…éƒ¨å¸¦æœ‰åŒæ­¥äº’æ–¥é”)\n","permalink":"https://zihuanling.github.io/posts/2022-02-18-go-6-concurrency/","summary":"\u003cp\u003eå¹¶å‘ï¼Œå°±æ˜¯è®©ç¨‹åºåœ¨åŒä¸€æ—¶åˆ»åšå¤šä»¶äº‹æƒ…ã€‚\u003c/p\u003e\n\u003cp\u003egoè¯­è¨€å¤©ç”Ÿè‡ªå¸¦å¹¶å‘å±æ€§ï¼Œä½¿å¾—å¹¶å‘ç¼–ç¨‹\u003cstrong\u003eåï¼åˆ†ï¼æ–¹ï¼ä¾¿ï¼\u003c/strong\u003eï¼Œæˆ‘ä»¬åªéœ€è¦ \u003ccode\u003ego å‡½æ•°å()\u003c/code\u003e å³å¯ï¼\u003ccode\u003e\\(^o^)/\u003c/code\u003e\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003ch2 id=\"è¿›ç¨‹å’Œçº¿ç¨‹\"\u003eè¿›ç¨‹å’Œçº¿ç¨‹\u003c/h2\u003e\n\u003ch3 id=\"è¿›ç¨‹\"\u003eè¿›ç¨‹\u003c/h3\u003e\n\u003cp\u003eç¨‹åºå¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªè¿›ç¨‹\u003c/p\u003e\n\u003ch3 id=\"çº¿ç¨‹\"\u003eçº¿ç¨‹\u003c/h3\u003e\n\u003cp\u003eæ˜¯è¿›ç¨‹çš„æ‰§è¡Œç©ºé—´ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹è¢«æ“ä½œç³»ç»Ÿè°ƒåº¦æ‰§è¡Œ\nä¸€ä¸ªç¨‹åºå¯åŠ¨ï¼Œå¯¹åº”çš„è¿›ç¨‹ä¼šè¢«åˆ›å»ºï¼ŒåŒæ—¶ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼Œä¸»çº¿ç¨‹ç»“æŸï¼Œæ•´ä¸ªç¨‹åºä¹Ÿå°±é€€å‡ºäº†ã€‚\næˆ‘ä»¬å¯ä»¥ä»ä¸»çº¿ç¨‹åˆ›å»ºå…¶ä»–çš„å­çº¿ç¨‹ï¼Œè¿™å°±æ˜¯å¤šçº¿ç¨‹å¹¶å‘\u003c/p\u003e\n\u003ch3 id=\"åç¨‹-goroutine\"\u003eåç¨‹ Goroutine\u003c/h3\u003e\n\u003cp\u003egoroutineæ¯”çº¿ç¨‹æ›´åŠ è½»ç›ˆï¼Œè¢«Go runtimeè°ƒåº¦ã€‚\nå¯åŠ¨åç¨‹ï¼š \u003ccode\u003ego function()\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// è¿™é‡Œå¯åŠ¨äº†ä¸¤ä¸ªgoroutineï¼Œ ä¸€ä¸ªæ˜¯ç”¨goå…³é”®å­—è§¦å‘çš„ï¼Œå¦ä¸€ä¸ªæ˜¯ main goroutineï¼ˆä¸»çº¿ç¨‹ï¼‰\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Hello goroutine.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Main goroutine.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eSecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"channel\"\u003eChannel\u003c/h2\u003e\n\u003cp\u003eå¤šä¸ªgoroutineä¹‹é—´ï¼Œä½¿ç”¨ channelè¿›è¡Œé€šä¿¡\u003c/p\u003e\n\u003ch3 id=\"å£°æ˜ä¸€ä¸ªchannel\"\u003eå£°æ˜ä¸€ä¸ªchannel\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ç›´æ¥ä½¿ç”¨ make åˆ›å»ºä¸€ä¸ªchannelï¼Œæ¥å—çš„æ•°æ®ç±»å‹æ˜¯string\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ech\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e make(\u003cspan style=\"color:#66d9ef\"\u003echan\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ä¸€ä¸ªchannelçš„æ“ä½œåªæœ‰ä¸¤ç§ï¼š\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// - å‘é€ï¼Œå‘chanä¸­å‘é€å€¼ï¼š chan\u0026lt;-\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// - æ¥å—ï¼Œä»chanä¸­è·å–å€¼ï¼š \u0026lt;-chan\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003edemo\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003ech\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e make(\u003cspan style=\"color:#66d9ef\"\u003echan\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Message in goroutine\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ech\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;goroutine finished.\u0026#34;\u003c/span\u003e\t\u003cspan style=\"color:#75715e\"\u003e// send message to channel.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  }()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Main goroutine.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ech\u003c/span\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e// receive message from channel\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Message from channel: \u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cblockquote\u003e\n\u003cp\u003eåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨æ–°å¯åŠ¨çš„ goroutine ä¸­å‘ chan ç±»å‹çš„å˜é‡ ch å‘é€å€¼ï¼›åœ¨ main goroutine ä¸­ï¼Œä»å˜é‡ ch æ¥æ”¶å€¼ï¼›å¦‚æœ ch ä¸­æ²¡æœ‰å€¼ï¼Œåˆ™\u003cstrong\u003eé˜»å¡\u003c/strong\u003eç­‰å¾…åˆ° ch ä¸­æœ‰å€¼å¯ä»¥æ¥æ”¶ä¸ºæ­¢ã€‚\u003c/p\u003e","title":"6. goå¹¶å‘ï¼šGoroutineså’ŒChannelsçš„å£°æ˜å’Œä½¿ç”¨"},{"content":"æ­£ç¡®å¤„ç†é”™è¯¯ï¼Œå¯ä»¥è®©ç¨‹åºæ›´åŠ ç¨³å®šã€‚erroræ˜¯ä¸€ä¸ªé”™è¯¯æ¥å£ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œerroræ˜¯ä¸ä¼šå½±å“åˆ°æ•´ä¸ªç¨‹åºè¿è¡Œçš„ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªè¡Œå¤„ç†ã€‚ è€Œpanicæ˜¯ä¼šå¯¼è‡´ç¨‹åºç›´æ¥å´©æºƒé€€å‡ºçš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ goè‡ªå¸¦çš„recover()æ¥æ¢å¤panicï¼Œåœ¨ç¨‹åºå´©æºƒå‰è¿›è¡Œèµ„æºçš„é‡Šæ”¾å·¥ä½œã€‚\né”™è¯¯ erroræ¥å£ erroræ¥å£åªæœ‰ä¸€ä¸ªErroræ–¹æ³•ï¼Œè¿”å›å…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼ˆstringï¼‰\ntype error interface { Error() string } ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ•´æ•°çš„ä¾‹å­ï¼š\nfunc main(){ // try to conver alpha \u0026#34;a\u0026#34; to integer i, err := strconv.Atoi(\u0026#34;a\u0026#34;) if err != nil { fmt.Println(err) } else { fmt.Println(i) } } å°è¯•å°†å­—ç¬¦ a è½¬æ¢æˆä¸º æ•´æ•°ï¼Œæ˜¾ç„¶æ˜¯ä¸æˆåŠŸçš„ï¼Œå› æ­¤è¿”å›äº†err\nä¸€èˆ¬è€Œè¨€ï¼Œerror æ¥å£ç”¨äºå½“æ–¹æ³•æˆ–è€…å‡½æ•°æ‰§è¡Œé‡åˆ°é”™è¯¯æ—¶è¿›è¡Œè¿”å›ï¼Œè€Œä¸”æ˜¯ç¬¬äºŒä¸ªè¿”å›å€¼ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥è®©è°ƒç”¨è€…è‡ªå·±æ ¹æ®é”™è¯¯ä¿¡æ¯å†³å®šå¦‚ä½•è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ã€‚\nerror å·¥å‚å‡½æ•° é™¤äº†å¯ä»¥ä½¿ç”¨å…¶ä»–å‡½æ•°ï¼Œè‡ªå·±å®šä¹‰çš„å‡½æ•°ä¹Ÿå¯ä»¥è¿”å›é”™è¯¯ä¿¡æ¯ç»™è°ƒç”¨è€…\nè‡ªå®šä¹‰error è‡ªå®šä¹‰errorå°±æ˜¯å…ˆè‡ªå®šä¹‰ä¸€ä¸ªæ–°çš„ç±»å‹ï¼Œç„¶åå®ç°erroræ¥å£\n// è‡ªå®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œæºå¸¦é”™è¯¯ç å’Œå…·ä½“çš„é”™è¯¯ä¿¡æ¯ type commonError struct { errorCode int\t// é”™è¯¯ç  errorMsg string // é”™è¯¯ä¿¡æ¯ } // å®ç°erroræ¥å£ func (ce *commonError) Error() string { return ce.errorMsg } error æ–­è¨€ func add(a, b int) int, error { if a \u0026lt; 0 || b \u0026lt; 0 { return 0, \u0026amp;commonError{ errorCode: 1, errorMsg: \u0026#34;a and b must \u0026gt;= 0\u0026#34; } } return a + b, nil } func main(){ sum, err := add(-1, 2) // é”™è¯¯ç±»å‹æ–­è¨€ if cm, ok := err.(*commonError); ok { fmt.Printf(\u0026#34;Error code = %d, error message = %s\\n\u0026#34;, cm.errorCode, cm.errorMsg) } else { fmt.Printf(\u0026#34;Sum = %d\\n\u0026#34;, sum) } } é”™è¯¯åµŒå¥— Error Wrapping éœ€æ±‚ï¼Œå°†ä¸€ä¸ªé”™è¯¯åµŒå¥—åˆ°å¦ä¸€ä¸ªé”™è¯¯ä¸­ï¼š\næ¯”å¦‚è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›äº†ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ errorï¼Œåœ¨ä¸æƒ³ä¸¢å¤±è¿™ä¸ª error çš„æƒ…å†µä¸‹ï¼Œåˆæƒ³æ·»åŠ ä¸€äº›é¢å¤–ä¿¡æ¯è¿”å›æ–°çš„ errorã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„åº”è¯¥æ˜¯è‡ªå®šä¹‰ä¸€ä¸ª structï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š\ntype MyError struct { err error\t// æŒ‡å‘åŸæœ‰çš„error msg string\t// å½“å‰errorçš„é”™è¯¯ä¿¡æ¯ } // ä¸Šè¿°å°±æ˜¯é”™è¯¯çš„åµŒå¥— // MyError å®ç°erroræ¥å£ï¼Œè¿”å›å½“å‰é”™è¯¯ä¿¡æ¯ï¼Œå’ŒåŸæœ‰é”™è¯¯ä¿¡æ¯ func (me *MyError) Error() string { return fmt.Sprintf(\u0026#34;Wrapped error: %s -\u0026gt; %s\u0026#34;, me.err.Error(), me.msg) } func main(){ newError := MyError{err, \u0026#34;New error message.\u0026#34;} } ä¸Šè¿°å®ç°æ–¹å¼æ¯”è¾ƒç¹çï¼Œä»Go 1.13å¼€å§‹ï¼Œgoæ ‡å‡†åº“æ–°å¢äº†Error WrappingåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ fmt.Errorf åŠ  %w çš„æ–¹å¼ï¼Œå®ç°é”™è¯¯çš„åµŒå¥—\ne := errors.New(\u0026#34;Original Error\u0026#34;) w := fmt.Errorf(\u0026#34;Wrapped Error: %w\u0026#34;, e) fmt.Println(w) errors.Unwrap å‡½æ•° é€šè¿‡ errors.Unwrap è§£å¼€åµŒå¥—çš„é”™è¯¯\nerrors.Unwrap(w) // w æ˜¯ä¸€ä¸ªåµŒå¥—çš„é”™è¯¯ï¼Œä¼šè¿”å›åµŒå¥—å‰çš„åŸå§‹é”™è¯¯ errors.Unwrap(e)\t// e æ˜¯ä¸€ä¸ªåŸå§‹çš„é”™è¯¯ï¼Œä¼šè¿”å›ä¸€ä¸ªnil errors.Is å‡½æ•° ä½¿ç”¨ Error Wrapping ä¹‹åï¼ŒåŸæ¥ä½¿ç”¨ == åˆ¤æ–­æ˜¯å¦åŒä¸€ä¸ªé”™è¯¯çš„æ–¹å¼å¤±æ•ˆäº†\nä½¿ç”¨ errors.Isï¼š\nfunc Is(err, target error) bool å¦‚æœerrå’Œtarget æ˜¯åŒä¸€ä¸ªï¼Œè¿”å›true å¦‚æœerræ˜¯ä¸€ä¸ªwrapping errorï¼Œä¸”targetä¹ŸåŒ…å«åœ¨è¿™ä¸ªåµŒå¥—çš„erroré“¾ä¸­çš„è¯ï¼Œä¹Ÿè¿”å›true errors.As å‡½æ•° errors.Asæ˜¯åµŒå¥—errorçš„æ–­è¨€\nvar cm *commonError if errors.As(err,\u0026amp;cm){ fmt.Println(\u0026#34;é”™è¯¯ä»£ç ä¸º:\u0026#34;,cm.errorCode,\u0026#34;ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š\u0026#34;,cm.errorMsg) } else { fmt.Println(sum) } Deffered å‡½æ•° defer å‡½æ•°ç”¨äºä¿è¯æ‰“å¼€çš„æ–‡ä»¶ä¸€å®šä¼šè¢«å…³é—­ï¼ŒåŠŸèƒ½æœ‰ç‚¹ç±»ä¼¼äº python çš„ with\ndefer çš„æ‰§è¡Œå…³ç³»æ˜¯å…ˆè°ƒç”¨åæ‰§è¡Œ\ndefer func() {fmt.Println(\u0026#34;A\u0026#34;)}() defer func() {fmt.Println(\u0026#34;B\u0026#34;)}() defer func() {fmt.Println(\u0026#34;C\u0026#34;)}() // æœ€åè¾“å‡ºCã€Bã€A defer æœ‰ä¸€ä¸ªè°ƒç”¨æ ˆï¼Œè¶Šæ—©å®šä¹‰è¶Šé è¿‘æ ˆçš„åº•éƒ¨ï¼Œè¶Šæ™šå®šä¹‰æœˆé è¿‘æ ˆçš„é¡¶éƒ¨ï¼Œæ‰§è¡Œè¿™äº›deferè¯­å¥çš„æ—¶å€™ï¼Œä¼šå…ˆä»æ ˆé¡¶å¼¹å‡ºä¸€ä¸ªdeferç„¶åæ‰§è¡Œå®ƒã€‚\nPanic å¼‚å¸¸ goè¯­è¨€æ˜¯ä¸€é—¨é™æ€çš„å¼ºç±»å‹è¯­è¨€ï¼Œå¾ˆå¤šé—®é¢˜éƒ½å°½å¯èƒ½åœ°åœ¨ç¼–è¯‘æ˜¯æ•è·ï¼Œä½†æ˜¯æœ‰ä¸€äº›åªèƒ½åœ¨è¿è¡Œæ—¶æ£€æŸ¥ï¼Œæ¯”å¦‚æ•°ç»„è¶Šç•Œè®¿é—®ã€ä¸ç›¸åŒçš„ç±»å‹å¼ºåˆ¶è½¬æ¢ç­‰ï¼Œè¿™ç±»è¿è¡Œæ—¶é—®é¢˜éƒ½ä¼šå¼•èµ·panicå¼‚å¸¸ã€‚\npanicå¼‚å¸¸ç›´æ¥å°†è¿è¡Œä¸­çš„ç¨‹åºä¸­æ–­\npanicå¯ä»¥æ¥å— interface{}ç±»å‹çš„å‚æ•°ï¼ˆç©ºæ¥å£ï¼‰ï¼Œä»»ä½•ç±»å‹çš„å€¼éƒ½å¯ä»¥ä¼ åˆ°panic\nfunc panic(v interface{}) panic å¼‚å¸¸æ˜¯ä¸€ç§éå¸¸ä¸¥é‡çš„æƒ…å†µï¼Œä¼šè®©ç¨‹åºä¸­æ–­è¿è¡Œï¼Œä½¿ç¨‹åºå´©æºƒï¼Œæ‰€ä»¥å¦‚æœæ˜¯ä¸å½±å“ç¨‹åºè¿è¡Œçš„é”™è¯¯ï¼Œä¸è¦ä½¿ç”¨ panicï¼Œä½¿ç”¨æ™®é€šé”™è¯¯ error å³å¯\nä½¿ç”¨Recoveræ•è·panicå¼‚å¸¸ é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸éœ€è¦å¯¹panicè¿›è¡Œå¤„ç†ï¼Œç›´æ¥è®©å…¶ä¸­æ–­ç¨‹åºå³å¯\nä½†å½“æˆ‘ä»¬éœ€è¦åœ¨ç¨‹åºå´©æºƒå‰åšä¸€äº›èµ„æºé‡Šæ”¾å¤„ç†æ—¶ï¼Œè¿™æ—¶å°±å¾—ä»panicæ¢å¤ï¼Œç„¶åè¿›è¡Œå¤„ç†\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨goè¯­è¨€å†…ç½®çš„recoverå‡½æ•°æ¢å¤panicå¼‚å¸¸ï¼Œåªæœ‰deferä¿®é¥°çš„å‡½æ•°æ‰èƒ½åœ¨ç¨‹åºå´©æºƒæ—¶æ‰§è¡Œï¼Œæ‰€ä»¥ï¼š\nrecoverå‡½æ•°è¦ç»“åˆdeferå…³é”®å­—ä½¿ç”¨æ‰èƒ½ç”Ÿæ•ˆ\nfunc connectMysql(ip, username, password string) { if ip == \u0026#34;\u0026#34; { panic(\u0026#34;Invalid ip, expect not empty string.\u0026#34;) } else { fmt.Printf(\u0026#34;Connecting to ip[] with %s@%s\\n\u0026#34;, ip, username, password) } } func main(){ defer func(){ if p := recover(); p != nil { fmt.Printf(\u0026#34;go panic: %v\u0026#34;, p) } }() connectMysql(\u0026#34;\u0026#34;, \u0026#34;root\u0026#34;, \u0026#34;root\u0026#34;) } ","permalink":"https://zihuanling.github.io/posts/2022-02-17-go-5-basic/","summary":"\u003cp\u003eæ­£ç¡®å¤„ç†é”™è¯¯ï¼Œå¯ä»¥è®©ç¨‹åºæ›´åŠ ç¨³å®šã€‚erroræ˜¯ä¸€ä¸ªé”™è¯¯æ¥å£ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œerroræ˜¯ä¸ä¼šå½±å“åˆ°æ•´ä¸ªç¨‹åºè¿è¡Œçš„ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªè¡Œå¤„ç†ã€‚\nè€Œpanicæ˜¯ä¼šå¯¼è‡´ç¨‹åºç›´æ¥å´©æºƒé€€å‡ºçš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ goè‡ªå¸¦çš„\u003ccode\u003erecover()\u003c/code\u003eæ¥æ¢å¤panicï¼Œåœ¨ç¨‹åºå´©æºƒå‰è¿›è¡Œèµ„æºçš„é‡Šæ”¾å·¥ä½œã€‚\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003ch2 id=\"é”™è¯¯\"\u003eé”™è¯¯\u003c/h2\u003e\n\u003ch3 id=\"erroræ¥å£\"\u003eerroræ¥å£\u003c/h3\u003e\n\u003cp\u003eerroræ¥å£åªæœ‰ä¸€ä¸ªErroræ–¹æ³•ï¼Œè¿”å›å…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼ˆstringï¼‰\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eerror\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003einterface\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eError\u003c/span\u003e() \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ•´æ•°çš„ä¾‹å­ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// try to conver alpha \u0026#34;a\u0026#34; to integer\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003estrconv\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eAtoi\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;a\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå°è¯•å°†å­—ç¬¦ a è½¬æ¢æˆä¸º æ•´æ•°ï¼Œæ˜¾ç„¶æ˜¯ä¸æˆåŠŸçš„ï¼Œå› æ­¤è¿”å›äº†err\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eä¸€èˆ¬è€Œè¨€ï¼Œerror æ¥å£ç”¨äºå½“æ–¹æ³•æˆ–è€…å‡½æ•°æ‰§è¡Œé‡åˆ°é”™è¯¯æ—¶è¿›è¡Œè¿”å›ï¼Œè€Œä¸”æ˜¯ç¬¬äºŒä¸ªè¿”å›å€¼ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥è®©è°ƒç”¨è€…è‡ªå·±æ ¹æ®é”™è¯¯ä¿¡æ¯å†³å®šå¦‚ä½•è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"error-å·¥å‚å‡½æ•°\"\u003eerror å·¥å‚å‡½æ•°\u003c/h3\u003e\n\u003cp\u003eé™¤äº†å¯ä»¥ä½¿ç”¨å…¶ä»–å‡½æ•°ï¼Œè‡ªå·±å®šä¹‰çš„å‡½æ•°ä¹Ÿå¯ä»¥è¿”å›é”™è¯¯ä¿¡æ¯ç»™è°ƒç”¨è€…\u003c/p\u003e\n\u003ch3 id=\"è‡ªå®šä¹‰error\"\u003eè‡ªå®šä¹‰error\u003c/h3\u003e\n\u003cp\u003eè‡ªå®šä¹‰errorå°±æ˜¯å…ˆè‡ªå®šä¹‰ä¸€ä¸ªæ–°çš„ç±»å‹ï¼Œç„¶åå®ç°erroræ¥å£\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// è‡ªå®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œæºå¸¦é”™è¯¯ç å’Œå…·ä½“çš„é”™è¯¯ä¿¡æ¯\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecommonError\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eerrorCode\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e\t\u003cspan style=\"color:#75715e\"\u003e// é”™è¯¯ç \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#a6e22e\"\u003eerrorMsg\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e// é”™è¯¯ä¿¡æ¯\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å®ç°erroræ¥å£\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ece\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ecommonError\u003c/span\u003e) \u003cspan style=\"color:#a6e22e\"\u003eError\u003c/span\u003e() \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ece\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eerrorMsg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"error-æ–­è¨€\"\u003eerror æ–­è¨€\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eadd\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003eerror\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e \u0026lt; \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e \u0026lt; \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ecommonError\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a6e22e\"\u003eerrorCode\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a6e22e\"\u003eerrorMsg\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;a and b must \u0026gt;= 0\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eadd\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// é”™è¯¯ç±»å‹æ–­è¨€\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecm\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eok\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e.(\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ecommonError\u003c/span\u003e); \u003cspan style=\"color:#a6e22e\"\u003eok\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Error code = %d, error message = %s\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ecm\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eerrorCode\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ecm\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eerrorMsg\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Sum = %d\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"é”™è¯¯åµŒå¥—-error-wrapping\"\u003eé”™è¯¯åµŒå¥— Error Wrapping\u003c/h3\u003e\n\u003cp\u003eéœ€æ±‚ï¼Œå°†ä¸€ä¸ªé”™è¯¯åµŒå¥—åˆ°å¦ä¸€ä¸ªé”™è¯¯ä¸­ï¼š\u003c/p\u003e","title":"5. goåŸºç¡€ï¼šé€šè¿‡ error/deffer/panic å¤„ç†é”™è¯¯"},{"content":"å‡½æ•°å’Œæ–¹æ³•ï¼Œå¤§å¤§æé«˜äº†æˆ‘ä»¬çš„ä»£ç å¤ç”¨ç‡ï¼Œä¹Ÿæé«˜äº†ä»£ç çš„å¯è¯»æ€§ã€‚ goè¯­è¨€çš„å‡½æ•°å’Œæ–¹æ³•çš„å®šä¹‰ååˆ†ç®€å•ï¼Œç›´æ¥ä½¿ç”¨ func å…³é”®å­—å³å¯ã€‚\nä¸åŒäºpythonã€C++ç­‰æœ‰ç±»çš„æ¦‚å¿µï¼Œè€Œè¿™äº›ç±»ä¸­ï¼Œåˆæœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œæˆ–è€…çˆ¶ç±»çš„æ–¹æ³•ã€‚goè¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç„¶åç»™è¿™ä¸ªæ•°æ®ç»“æ„å®ç°è‡ªå·±çš„æ–¹æ³•ï¼ŒåŒæ ·å¯ä»¥å®ç°ã€ç±»ã€‘çš„æ•ˆæœï¼Œé€šè¿‡ç»„åˆï¼ŒåŒä¸€ä¸ªç»“æ„ä½“ä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æˆ–è€…è¦†å†™å…¶ä»–ç»“æ„ä½“çš„æ–¹æ³•ã€‚\nå‡½æ•° å‡½æ•°çš„ç»„æˆï¼š å…³é”®å­— func å‡½æ•°å funcName å‚æ•° params è¿”å›å€¼ï¼ˆè¿”å›å€¼ç±»å‹ï¼‰ å‡½æ•°ä½“ func funcName(params) result { // body } // ç¤ºä¾‹1ï¼šæ™®é€šçš„å‡½æ•°å®šä¹‰ func sum(a int, b int) int { return a + b } // ç¤ºä¾‹2ï¼šå‚æ•°è¡¨çš„ç±»å‹åˆå¹¶ï¼Œ(a int, b int) -\u0026gt; (a, b int) func sum2(a, b int) int { return a + b } // ç¤ºä¾‹3ï¼šå¤šå€¼è¿”å›ï¼Œç”¨ ï¼ˆï¼‰ åŒ…è£¹èµ·æ¥ func sum3(a, b int) (int, error) { if a \u0026lt; 0 || b \u0026lt; 0 { return 0, errors.New(\u0026#34;invalid params\u0026#34;) } return a + b, nil } // ç¤ºä¾‹4ï¼šå‘½åè¿”å›å‚æ•° // è¿™é‡Œå‘½åçš„è¿”å›å€¼æ˜¯ res å’Œ err // æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°ä½“ä¸­ç›´æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªå˜é‡ func sum4(a, b int) (res int, err error) { if a \u0026lt; 0 || b \u0026lt; 0 { // å¯ä»¥ç›´æ¥è¿”å› return 0, errors.New(\u0026#34;invalid params\u0026#34;) } // ä¹Ÿå¯ä»¥ç»™å‚æ•°èµ‹å€¼ï¼Œç„¶åreturn res = a + b err = nil return } å¯å˜å‚æ•° // è¿™é‡Œçš„å¯å˜å‚æ•°ç±»å‹æ˜¯ä¸€ä¸ªåˆ‡ç‰‡ func sum5(params ...int) int { res := 0 for _, num := range params { res += num } return res } éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å‡½æ•°ä¸­æœ‰æ™®é€šå‚æ•°ï¼Œä¹Ÿæœ‰å¯å˜å‚æ•°çš„æ—¶å€™ï¼Œé‚£ä¹ˆå¯å˜å‚æ•°ä¸€å®šæ˜¯æ”¾åœ¨å‚æ•°è¡¨çš„æœ€åçš„ã€‚\nåŒ…çº§å‡½æ•° å‡½æ•°åç§°çš„é¦–å­—æ¯å°å†™ä»£è¡¨ç§æœ‰å‡½æ•°ï¼Œåªæœ‰åœ¨åŒä¸€ä¸ªåŒ…ä¸­æ‰èƒ½è°ƒç”¨ å‡½æ•°åç§°çš„é¦–å­—æ¯å¤§å†™ä»£è¡¨å…¬æœ‰å‡½æ•°ï¼Œå¯ä»¥åœ¨ä¸åŒçš„åŒ…ä¸­è¢«è°ƒç”¨ ä»»ä½•ä¸€ä¸ªå‡½æ•°éƒ½ä¼šä»å±äºä¸€ä¸ªåŒ… åŒ¿åå‡½æ•°å’Œé—­åŒ… åŒ¿åå‡½æ•°å°±æ˜¯æ²¡æœ‰åç§°çš„å‡½æ•°ï¼Œå¯ä»¥èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡\nsum6 := func(a, b int) int { return a + b } fmt.Println(sum6(1, 2)) é—­åŒ…ï¼šåœ¨å‡½æ•°ä¸­å†å®šä¹‰å‡½æ•°ï¼ˆåŒ¿åå‡½æ•°ï¼‰ï¼Œç§°ä¸ºå†…éƒ¨å‡½æ•°ï¼Œè¿™ä¸ªå†…éƒ¨å‡½æ•°å¯ä»¥ä½¿ç”¨å¤–éƒ¨å‡½æ•°çš„å˜é‡ï¼Œè¿™ç§å®šä¹‰æ–¹å¼ç§°ä¸ºé—­åŒ…\nfunc closure() func() int { // è¿™ä¸ªé—­åŒ…å‡½æ•°è¿”å›ä¸€ä¸ªå‡½æ•°Aï¼Œè¿™ä¸ªå‡½æ•°Açš„è¿”å›å€¼ç±»å‹æ˜¯ int [func() int] i := 0 return func() int { i++\t// è¿™é‡Œä½¿ç”¨çš„iæ˜¯å¤–éƒ¨å‡½æ•°çš„å˜é‡ i return i } } func main(){ cl := closure() fmt.Println(cl())\t// è¾“å‡º 1 fmt.Println(cl())\t// è¾“å‡º 2 fmt.Println(cl())\t// è¾“å‡º 3 } æ–¹æ³• æ–¹æ³•ä¸åŒäºå‡½æ•°ï¼Œæ–¹æ³•éœ€è¦ä¸€ä¸ªæ¥æ”¶è€…ï¼Œè€Œå‡½æ•°ä¸éœ€è¦\nè¿™ä¸ªæ¥æ”¶è€…æ˜¯ä¸€ä¸ªç±»å‹ï¼Œè¿™æ ·æ–¹æ³•å°±å’Œè¿™ä¸ªç±»å‹ç»‘å®šåœ¨ä¸€èµ·äº†ï¼Œç§°ä¸ºè¿™ä¸ªç±»å‹çš„æ–¹æ³•\n// å®šä¹‰ä¸€ä¸ªAgeç±»å‹ type Age uint func (age Age) String() { fmt.Println(\u0026#34;age is \u0026#34;, age) } ä¸Šè¿°çš„ String() å°±æ˜¯Ageçš„æ–¹æ³•ï¼Œç±»å‹Ageæ˜¯String()çš„æ¥æ”¶è€…ï¼ˆæ¥æ”¶è€…å†™åœ¨æ–¹æ³•åå‰é¢ï¼Œä½¿ç”¨å°æ‹¬å·()åŒ…è£¹ï¼‰\nè°ƒç”¨æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ç‚¹æ“ä½œç¬¦\nage := Age(20) age.String() å€¼ç±»å‹æ¥æ”¶è€…å’ŒæŒ‡é’ˆç±»å‹æ¥æ”¶è€… å¯¹æŒ‡é’ˆç±»å‹æ¥æ”¶è€…çš„ä¿®æ”¹æ˜¯æœ‰æ•ˆçš„ å¯¹å€¼ç±»å‹æ¥æ”¶è€…çš„ä¿®æ”¹æ˜¯æ— æ•ˆçš„ // æŒ‡é’ˆç±»å‹æ¥æ”¶è€…æ–¹æ³• func (age *Age) Modify(){ *age = Age(30) } age := Age(20) age.String() // age is 20 age.Modify() // ä½¿ç”¨ä¸€ä¸ªå€¼ç±»å‹å˜é‡è°ƒç”¨æŒ‡é’ˆç±»å‹æ¥æ”¶è€…æ–¹æ³•ï¼ŒGoä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å–æŒ‡é’ˆè°ƒç”¨ // ï¼ˆ\u0026amp;age).Modify() è·Ÿä¸Šè¿°è¯­å¥æ˜¯ä¸€æ ·çš„ // ä½¿ç”¨æŒ‡é’ˆç±»å‹å˜é‡è°ƒç”¨å€¼ç±»å‹æ¥æ”¶è€…æ–¹æ³•ï¼Œgoä¼šå¸®æˆ‘ä»¬ã€è§£å¼•ç”¨è°ƒç”¨ã€‘ // (\u0026amp;age).String() åŒ age.String() age.String() // age is 30 ç®€å•åœ°ç†è§£ä¸ºï¼š\nå€¼æ¥æ”¶è€…ä½¿ç”¨çš„æ˜¯å€¼çš„å‰¯æœ¬æ¥è°ƒç”¨æ–¹æ³•ï¼Œè€ŒæŒ‡é’ˆæ¥æ”¶è€…ä½¿ç”¨å®é™…çš„å€¼æ¥è°ƒç”¨æ–¹æ³•ã€‚\næ–¹æ³•æ˜¯å¦å¯ä»¥èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ å¯ä»¥\ntype Age uint // å€¼ç±»å‹æ¥æ”¶è€…æ–¹æ³• func (age Age) String() { fmt.Println(\u0026#34;age is \u0026#34;, age) } // æŒ‡é’ˆç±»å‹æ¥æ”¶è€…æ–¹æ³• func (age *Age) Incr() { *age++ } age := Age(10) // å€¼ç±»å‹æ¥æ”¶è€…æ–¹æ³•èµ‹å€¼ç»™å˜é‡ sm := Age.String sm(age) // è°ƒç”¨ // æŒ‡é’ˆç±»å‹æ¥æ”¶è€…æ–¹æ³•èµ‹å€¼ç»™å˜é‡ im := (*Age).Incr im(\u0026amp;age)\t// è°ƒç”¨ sm(age) ä¸ç®¡æ–¹æ³•æ˜¯å¦æœ‰å‚æ•°ï¼Œé€šè¿‡æ–¹æ³•è¡¨è¾¾å¼è°ƒç”¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯æ¥æ”¶è€…ï¼Œç„¶åæ‰æ˜¯æ–¹æ³•è‡ªèº«çš„å‚æ•°ã€‚\n","permalink":"https://zihuanling.github.io/posts/2022-02-15-go-3-basic/","summary":"\u003cp\u003eå‡½æ•°å’Œæ–¹æ³•ï¼Œå¤§å¤§æé«˜äº†æˆ‘ä»¬çš„ä»£ç å¤ç”¨ç‡ï¼Œä¹Ÿæé«˜äº†ä»£ç çš„å¯è¯»æ€§ã€‚\ngoè¯­è¨€çš„å‡½æ•°å’Œæ–¹æ³•çš„å®šä¹‰ååˆ†ç®€å•ï¼Œç›´æ¥ä½¿ç”¨ \u003ccode\u003efunc\u003c/code\u003e å…³é”®å­—å³å¯ã€‚\u003c/p\u003e\n\u003cp\u003eä¸åŒäºpythonã€C++ç­‰æœ‰\u003cstrong\u003eç±»\u003c/strong\u003eçš„æ¦‚å¿µï¼Œè€Œè¿™äº›ç±»ä¸­ï¼Œåˆæœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œæˆ–è€…çˆ¶ç±»çš„æ–¹æ³•ã€‚goè¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç„¶åç»™è¿™ä¸ªæ•°æ®ç»“æ„å®ç°è‡ªå·±çš„æ–¹æ³•ï¼ŒåŒæ ·å¯ä»¥å®ç°ã€\u003cstrong\u003eç±»\u003c/strong\u003eã€‘çš„æ•ˆæœï¼Œé€šè¿‡\u003cstrong\u003eç»„åˆ\u003c/strong\u003eï¼ŒåŒä¸€ä¸ªç»“æ„ä½“ä¸­ï¼Œä¹Ÿå¯ä»¥\u003cstrong\u003eä½¿ç”¨æˆ–è€…è¦†å†™\u003c/strong\u003eå…¶ä»–ç»“æ„ä½“çš„æ–¹æ³•ã€‚\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003ch2 id=\"å‡½æ•°\"\u003eå‡½æ•°\u003c/h2\u003e\n\u003ch3 id=\"å‡½æ•°çš„ç»„æˆ\"\u003eå‡½æ•°çš„ç»„æˆï¼š\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eå…³é”®å­— func\u003c/li\u003e\n\u003cli\u003eå‡½æ•°å funcName\u003c/li\u003e\n\u003cli\u003eå‚æ•° params\u003c/li\u003e\n\u003cli\u003eè¿”å›å€¼ï¼ˆè¿”å›å€¼ç±»å‹ï¼‰\u003c/li\u003e\n\u003cli\u003eå‡½æ•°ä½“\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efuncName\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eparams\u003c/span\u003e) \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// body\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ç¤ºä¾‹1ï¼šæ™®é€šçš„å‡½æ•°å®šä¹‰\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ç¤ºä¾‹2ï¼šå‚æ•°è¡¨çš„ç±»å‹åˆå¹¶ï¼Œ(a int, b int) -\u0026gt; (a, b int)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum2\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ç¤ºä¾‹3ï¼šå¤šå€¼è¿”å›ï¼Œç”¨ ï¼ˆï¼‰ åŒ…è£¹èµ·æ¥\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum3\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e) (\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003eerror\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e \u0026lt; \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e \u0026lt; \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerrors\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eNew\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;invalid params\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ç¤ºä¾‹4ï¼šå‘½åè¿”å›å‚æ•°\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// è¿™é‡Œå‘½åçš„è¿”å›å€¼æ˜¯ res å’Œ err\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°ä½“ä¸­ç›´æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªå˜é‡\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum4\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e) (\u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eerror\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e \u0026lt; \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e \u0026lt; \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e// å¯ä»¥ç›´æ¥è¿”å›\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerrors\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eNew\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;invalid params\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// ä¹Ÿå¯ä»¥ç»™å‚æ•°èµ‹å€¼ï¼Œç„¶åreturn\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e = \u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e = \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"å¯å˜å‚æ•°\"\u003eå¯å˜å‚æ•°\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// è¿™é‡Œçš„å¯å˜å‚æ•°ç±»å‹æ˜¯ä¸€ä¸ªåˆ‡ç‰‡\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum5\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eparams\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e...\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003enum\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eparams\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enum\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å‡½æ•°ä¸­æœ‰æ™®é€šå‚æ•°ï¼Œä¹Ÿæœ‰å¯å˜å‚æ•°çš„æ—¶å€™ï¼Œé‚£ä¹ˆå¯å˜å‚æ•°ä¸€å®šæ˜¯æ”¾åœ¨å‚æ•°è¡¨çš„æœ€åçš„ã€‚\u003c/p\u003e","title":"3. goåŸºç¡€ï¼šå‡½æ•°å’Œæ–¹æ³•"},{"content":"æ¥å£æ˜¯ä¸€ç§èšåˆç±»å‹ï¼Œç»“æ„ä½“æ˜¯å’Œè°ƒç”¨æ–¹çš„ä¸€ç§çº¦å®šï¼Œæœ‰ç‚¹æŠ½è±¡ç±»çš„æ„æ€ã€‚:)\nç»“æ„ä½“ ç»“æ„ä½“å®šä¹‰ ç»“æ„ä½“æ˜¯ä¸€ç§èšåˆç±»å‹ï¼Œé‡Œé¢å¯ä»¥åŒ…å«ä»»æ„ç±»å‹çš„å€¼ï¼Œè¿™äº›å€¼å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„ç»“æ„ä½“æˆå‘˜ï¼Œä¹Ÿç§°ä¸ºå­—æ®µ\nåœ¨goè¯­è¨€ä¸­ï¼Œè¦å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œéœ€è¦ä½¿ç”¨ type+struct å…³é”®å­—ç»„åˆã€‚\n// å®šä¹‰ä¸€ä¸ªä»£è¡¨ã€äººã€‘çš„ç»“æ„ä½“ type person struct { name string\t// åç§° age uint\t// å¹´é¾„ } ç»“æ„ä½“çš„æˆå‘˜å­—æ®µå¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œä¹Ÿå¯ä»¥ä¸€ä¸ªå­—æ®µéƒ½æ²¡æœ‰ï¼Œè¿™ç§ç»“æ„ä½“æˆä¸ºç©ºç»“æ„ä½“ã€‚\ntype s struct {} ç»“æ„ä½“å£°æ˜ä½¿ç”¨ // ä½¿ç”¨varå£°æ˜ä¸€ä¸ªpersonå˜é‡ï¼Œæœªåˆå§‹åŒ–ï¼Œé‡Œé¢çš„å€¼ä¸ºå„è‡ªå˜é‡çš„é›¶å€¼ var p person // å¯ä»¥ä½¿ç”¨ç»“æ„ä½“å­—é¢é‡åˆå§‹åŒ–çš„æ–¹å¼ p2 := person{\u0026#34;Mike\u0026#34;, 10} // ç¬¬ä¸€ä¸ªå€¼ä¸º nameï¼Œç¬¬äºŒä¸ªå€¼ä¸ºageï¼Œä¸ç»“æ„ä½“å­—æ®µå®šä¹‰é¡ºåºæœ‰å…³ // å¯ä»¥æŒ‡å®šå­—æ®µååˆå§‹åŒ–ï¼Œä¸æŒ‰å®šä¹‰é¡ºåº p3 := person{age: 10, name: \u0026#34;Mike\u0026#34;} å­—æ®µç»“æ„ä½“ type address struct { province string city string } // ç»“æ„ä½“çš„å­—æ®µå¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„ç»“æ„ä½“ type person struct { name string age uint addr address } // åˆå§‹åŒ– p := person{ name: \u0026#34;Mike\u0026#34;, age: 10, addr: address{ province: \u0026#34;Guandong\u0026#34;, city: \u0026#34;Maoming\u0026#34;, }, } fmt.Println(p.addr.province) æ¥å£ æ¥å£çš„å®šä¹‰ æ¥å£æ˜¯å’Œè°ƒç”¨æ–¹çš„ä¸€ç§çº¦å®šï¼Œæ˜¯ä¸€ä¸ªé«˜åº¦æŠ½è±¡çš„ç±»å‹ï¼Œä¸éœ€è¦å’Œå…·ä½“çš„å®ç°ç»†èŠ‚ç»‘å®šåœ¨ä¸€èµ·ã€‚ æ¥å£è¦åšçš„å°±æ˜¯å®šä¹‰å¥½çº¦å®šï¼Œå‘Šè¯‰è°ƒç”¨æ–¹ï¼Œè‡ªå·±å¯ä»¥åšä»€ä¹ˆï¼Œä½†æ˜¯ä¸éœ€è¦çŸ¥é“å®ƒçš„å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„ æˆ‘ä»¬é€šè¿‡ type + interfaceå…³é”®å­—å®šä¹‰ä¸€ä¸ªæ¥å£\ntype Stringer interface { String() string } ä¸Šè¿°æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ¥å£ Stringerï¼Œè¿™ä¸ªæ¥å£æœ‰ä¸ªæ–¹æ³• String() string\nStringeræ˜¯Go SDKçš„ä¸€ä¸ªæ¥å£ï¼Œå±äºfmtåŒ…\næ¥å£çš„å®ç° æ¥å£çš„å®ç°è€…å¿…é¡»æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»å‹\nfunc (p person) String() string { return fmt.Sprintf(\u0026#34;name = %s, age = %d\u0026#34;, p.name, p.age) } è¿™é‡Œ person å®ç°äº† Stringeræ¥å£çš„ String() æ–¹æ³• æˆ‘ä»¬æ¥ä¸‹æ¥å®ç°å¯ä»¥æ‰“å°Stringeræ¥å£æ–¹æ³•çš„å‡½æ•°ï¼š\nfunc printString(s fmt.Stringer){ fmt.Println(s.String()) } æˆ‘ä»¬å¯ä»¥è°ƒç”¨ printString(p)æ¥æ‰“å°personçš„å†…å®¹ï¼Œå› ä¸º personå®ç°äº† fmt.Stringer è¿™ä¸ªæ¥å£ åŒæ ·ï¼Œæˆ‘ä»¬è®© address ä¹Ÿå®ç°Stringeræ¥å£\nfunc (addr address) String() string { return fmt.Sprintf(\u0026#34;Addr province = %s, city = %s\u0026#34;, addr.province, addr.city) } ç„¶ååŒæ ·å¯ä»¥è°ƒç”¨ printString æ¥è¾“å‡ºï¼š printString(p.addr)\nè¿™å°±æ˜¯é¢å‘æ¥å£çš„å¥½å¤„ï¼Œåªè¦å®šä¹‰å’Œè°ƒç”¨åŒæ–¹æ»¡è¶³çº¦å®šï¼Œå°±å¯ä»¥ä½¿ç”¨ï¼Œè€Œä¸ç”¨ç®¡å…·ä½“å®ç°ã€‚æ¥å£çš„å®ç°è€…ä¹Ÿå¯ä»¥æ›´å¥½çš„å‡çº§é‡æ„ï¼Œè€Œä¸ä¼šæœ‰ä»»ä½•å½±å“ï¼Œå› ä¸ºæ¥å£çº¦å®šæ²¡æœ‰å˜ã€‚\nå€¼æ¥æ”¶è€…å’ŒæŒ‡é’ˆæ¥æ”¶è€… è°ƒç”¨printString(\u0026amp;p)ï¼Œå¯ä»¥å‘ç°ä»¥å€¼ç±»å‹æ¥æ”¶è€…å®ç°æ¥å£çš„æ—¶å€™ï¼Œä¸ç®¡æ˜¯ç±»å‹æœ¬èº«ï¼Œè¿˜æ˜¯è¯¥ç±»å‹çš„æŒ‡é’ˆç±»å‹ï¼Œéƒ½å®ç°äº†æ”¹æ¥å£\nä½†æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨å°†æ¥æ”¶è€…æ”¹ä¸ºæŒ‡é’ˆç±»å‹ï¼š\nfunc (p *person) String() string { return fmt.Sprintf(\u0026#34;name: %s, age: %d\u0026#34;, p.name, p.age) } ç„¶åè°ƒç”¨ printString(p)ï¼Œå°†ä¼šæç¤ºç¼–è¯‘ä¸é€šè¿‡ï¼Œå› ä¸ºpersonæ²¡æœ‰å®ç°Stringeræ¥å£ã€‚ è¯´æ˜ï¼šä»¥æŒ‡é’ˆç±»å‹æ¥æ”¶è€…å®ç°æ¥å£çš„æ—¶å€™ï¼Œåªæœ‰å¯¹åº”çš„æŒ‡é’ˆç±»å‹æ‰è¢«è®¤ä¸ºå®ç°äº†è¯¥æ¥å£\næ¥å£å®ç°è§„åˆ™\næ–¹æ³•æ¥æ”¶è€… å®ç°çš„æ¥å£ç±»å‹ (p person) person å’Œ *person (p *person) *person å½“å€¼ç±»å‹ä½œä¸ºæ¥æ”¶è€…æ—¶ï¼Œperson ç±»å‹å’Œ*personç±»å‹éƒ½å®ç°äº†è¯¥æ¥å£ã€‚ å½“æŒ‡é’ˆç±»å‹ä½œä¸ºæ¥æ”¶è€…æ—¶ï¼Œåªæœ‰*personç±»å‹å®ç°äº†è¯¥æ¥å£ã€‚ å·¥å‚å‡½æ•° å·¥å‚å‡½æ•°ä¸€èˆ¬ç”¨äºåˆ›å»ºè‡ªå®šä¹‰çš„ç»“æ„ä½“ï¼Œä¾¿äºä½¿ç”¨è€…è°ƒç”¨\nfunc NewPerson(name string) *person { return \u0026amp;person{name: name} } p1 := NewPerson(\u0026#34;Mike\u0026#34;) ä»¥ errors.New è¿™ä¸ª Go è¯­è¨€è‡ªå¸¦çš„å·¥å‚å‡½æ•°ä¸ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•é€šè¿‡å·¥å‚å‡½æ•°åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œå¹¶éšè—å…¶å†…éƒ¨å®ç°ï¼š\n// å·¥å‚å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªerroræ¥å£ï¼Œå…·ä½“å®ç°æ˜¯*errorString func New(text string) error { return \u0026amp;errorString{text} } // ç»“æ„ä½“ï¼Œå†…éƒ¨ä¸€ä¸ªå­—æ®µsï¼Œå­˜å‚¨é”™è¯¯ä¿¡æ¯ type errorString struct { s string } // å®ç°erroræ¥å£ func (e *errorString) Error() string { return e.s } ç»§æ‰¿å’Œç»„åˆ åœ¨ Go è¯­è¨€ä¸­æ²¡æœ‰ç»§æ‰¿çš„æ¦‚å¿µï¼Œæ‰€ä»¥ç»“æ„ã€æ¥å£ä¹‹é—´ä¹Ÿæ²¡æœ‰çˆ¶å­å…³ç³»ï¼ŒGo è¯­è¨€æå€¡çš„æ˜¯ç»„åˆï¼Œåˆ©ç”¨ç»„åˆè¾¾åˆ°ä»£ç å¤ç”¨çš„ç›®çš„ï¼Œè¿™ä¹Ÿæ›´çµæ´»ã€‚\nä»¥ioæ ‡å‡†åŒ…è‡ªå¸¦çš„æ¥å£ä¸ºä¾‹ï¼š\ntype Reader interface { Read(p []byte) (n int, err error) } type Writer interface { Write(p []byte) (n int, err error) } // ReadWriter æ˜¯ Readerå’ŒWriterçš„ç»„åˆ type ReadWriter interface { Reader Writer } ReadWriter æ¥å£å°±æ˜¯ Reader å’Œ Writer çš„ç»„åˆï¼Œç»„åˆåï¼ŒReadWriter æ¥å£å…·æœ‰ Reader å’Œ Writer ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œè¿™æ ·æ–°æ¥å£ ReadWriter å°±ä¸ç”¨å®šä¹‰è‡ªå·±çš„æ–¹æ³•äº†ï¼Œç»„åˆ Reader å’Œ Writer çš„å°±å¯ä»¥äº†ã€‚\næ¥å£å¯ä»¥ç»„åˆï¼Œç»“æ„ä½“ä¹Ÿå¯ä»¥ç»„åˆï¼š\ntype address struct { province string city string } type person struct { name string age uint address } // åˆå§‹åŒ– p := person{ name: \u0026#34;mike\u0026#34;, age: 10, address: address{ province: \u0026#34;Guangdong\u0026#34;, city: \u0026#34;Maoming\u0026#34;, }, } // åƒä½¿ç”¨è‡ªå·±çš„å­—æ®µä¸€æ ·ä½¿ç”¨addressçš„å­—æ®µ fmt.Println(\u0026#34;my address is \u0026#34;, p.province, p.city) ç±»å‹ç»„åˆåï¼Œå¤–éƒ¨ç±»å‹ä¸ä»…å¯ä»¥ä½¿ç”¨å†…éƒ¨ç±»å‹çš„å­—æ®µï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å†…éƒ¨ç±»å‹çš„æ–¹æ³•ï¼Œå°±åƒä½¿ç”¨è‡ªå·±çš„æ–¹æ³•ä¸€æ ·ã€‚å¦‚æœå¤–éƒ¨ç±»å‹å®šä¹‰äº†å’Œå†…éƒ¨ç±»å‹åŒæ ·çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå¤–éƒ¨ç±»å‹çš„ä¼šè¦†ç›–å†…éƒ¨ç±»å‹ï¼Œè¿™å°±æ˜¯æ–¹æ³•çš„è¦†å†™ã€‚\ntype address struct { province string city string } type person struct { name string age uint address } func (addr *address) detail() { fmt.Printf(\u0026#34;Address detail: province = %s, city = %s\\n\u0026#34;, addr.province, addr.city) } func (addr *address) who(){ fmt.Println(\u0026#34;I am address.\u0026#34;) } func (p *person) who() { fmt.Println(\u0026#34;I am person\u0026#34;) } p := person{ name: \u0026#34;mike\u0026#34;, age: 10, address: address{ province: \u0026#34;Guangdong\u0026#34;, city: \u0026#34;Maoming\u0026#34;, }, } p.who()\t// è¾“å‡º I am person, è¦†å†™äº†address.who æ–¹æ³• p.address.who()\t// å¯ä»¥è°ƒç”¨ address.whoï¼Œå› ä¸ºæ–¹æ³•è¦†å†™ä¸ä¼šå½±å“åˆ°å†…éƒ¨çš„æ–¹æ³•å®ç° p.detail()\t// è¾“å‡º Address detail: province = Guangdong, city = Maomingï¼Œ personæ²¡æœ‰å®ç°è¯¥æ–¹æ³•ï¼Œå› æ­¤ç›´æ¥è°ƒç”¨addressçš„detailæ–¹æ³• p.address.detail()// è¾“å‡º Address detail: province = Guangdong, city = Maoming ç±»å‹æ–­è¨€ ç±»å‹æ–­è¨€ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ¥å£çš„å€¼æ˜¯å¦å®ç°æ”¹æ¥å£çš„çš„æŸä¸ªå…·ä½“ç±»å‹\n\u0026lt;æ¥å£ç±»å‹å˜é‡\u0026gt;.(æ–­è¨€ç±»å‹)\nå¦‚ï¼š\nvar s fmt.Stringer s = p // æ–­è¨€æ¥å£çš„å€¼ s æ˜¯å¦ä¸ºä¸€ä¸ª person if _, ok := s.(person); ok { fmt.Println(\u0026#34;person yes\u0026#34;) }else { fmt.Println(\u0026#34;person no\u0026#34;) } ç±»å‹æ–­è¨€ä¼šè¿”å›ä¸¤ä¸ªå€¼ value, ok, å¦‚æœç±»å‹æ–­è¨€æˆåŠŸï¼Œvalueå°†ä¼šæ˜¯ä¸€ä¸ªæ–­è¨€å¯¹è±¡çš„å®ä¾‹ï¼Œå¦‚ä¸Šè¿°ä»£ç ï¼Œæ–­è¨€æˆåŠŸåä¼šè¿”å›ä¸€ä¸ªpersonå®ä¾‹ï¼Œok=trueï¼Œå¦åˆ™ï¼Œok=false\nç»“æ„ä½“æ˜¯å¯¹ç°å®ä¸–ç•Œçš„æè¿°ï¼Œæ¥å£æ˜¯å¯¹æŸä¸€ç±»è¡Œä¸ºçš„è§„èŒƒå’ŒæŠ½è±¡ã€‚é€šè¿‡å®ƒä»¬ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä»£ç çš„æŠ½è±¡å’Œå¤ç”¨ï¼ŒåŒæ—¶å¯ä»¥é¢å‘æ¥å£ç¼–ç¨‹ï¼ŒæŠŠå…·ä½“å®ç°ç»†èŠ‚éšè—èµ·æ¥ï¼Œè®©å†™å‡ºæ¥çš„ä»£ç æ›´çµæ´»ï¼Œé€‚åº”èƒ½åŠ›ä¹Ÿæ›´å¼ºã€‚\n","permalink":"https://zihuanling.github.io/posts/2022-02-16-go-4-basic/","summary":"\u003cp\u003eæ¥å£æ˜¯ä¸€ç§\u003cstrong\u003eèšåˆç±»å‹\u003c/strong\u003eï¼Œç»“æ„ä½“æ˜¯å’Œè°ƒç”¨æ–¹çš„\u003cstrong\u003eä¸€ç§çº¦å®š\u003c/strong\u003eï¼Œæœ‰ç‚¹\u003cstrong\u003eæŠ½è±¡ç±»\u003c/strong\u003eçš„æ„æ€ã€‚:)\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003ch2 id=\"ç»“æ„ä½“\"\u003eç»“æ„ä½“\u003c/h2\u003e\n\u003ch3 id=\"ç»“æ„ä½“å®šä¹‰\"\u003eç»“æ„ä½“å®šä¹‰\u003c/h3\u003e\n\u003cp\u003eç»“æ„ä½“æ˜¯ä¸€ç§\u003cstrong\u003eèšåˆç±»å‹\u003c/strong\u003eï¼Œé‡Œé¢å¯ä»¥åŒ…å«ä»»æ„ç±»å‹çš„å€¼ï¼Œè¿™äº›å€¼å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„ç»“æ„ä½“æˆå‘˜ï¼Œä¹Ÿç§°ä¸º\u003cstrong\u003eå­—æ®µ\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eåœ¨goè¯­è¨€ä¸­ï¼Œè¦å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œéœ€è¦ä½¿ç”¨ \u003cstrong\u003etype+struct\u003c/strong\u003e å…³é”®å­—ç»„åˆã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å®šä¹‰ä¸€ä¸ªä»£è¡¨ã€äººã€‘çš„ç»“æ„ä½“\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eperson\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e\t\u003cspan style=\"color:#75715e\"\u003e// åç§°\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#a6e22e\"\u003eage\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003euint\u003c/span\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e// å¹´é¾„\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eç»“æ„ä½“çš„æˆå‘˜å­—æ®µå¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œä¹Ÿå¯ä»¥ä¸€ä¸ªå­—æ®µéƒ½æ²¡æœ‰ï¼Œè¿™ç§ç»“æ„ä½“æˆä¸ºç©ºç»“æ„ä½“ã€‚\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003es\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e {}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"ç»“æ„ä½“å£°æ˜ä½¿ç”¨\"\u003eç»“æ„ä½“å£°æ˜ä½¿ç”¨\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ä½¿ç”¨varå£°æ˜ä¸€ä¸ªpersonå˜é‡ï¼Œæœªåˆå§‹åŒ–ï¼Œé‡Œé¢çš„å€¼ä¸ºå„è‡ªå˜é‡çš„é›¶å€¼\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ep\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eperson\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å¯ä»¥ä½¿ç”¨ç»“æ„ä½“å­—é¢é‡åˆå§‹åŒ–çš„æ–¹å¼\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ep2\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eperson\u003c/span\u003e{\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Mike\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e} \u003cspan style=\"color:#75715e\"\u003e// ç¬¬ä¸€ä¸ªå€¼ä¸º nameï¼Œç¬¬äºŒä¸ªå€¼ä¸ºageï¼Œä¸ç»“æ„ä½“å­—æ®µå®šä¹‰é¡ºåºæœ‰å…³\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å¯ä»¥æŒ‡å®šå­—æ®µååˆå§‹åŒ–ï¼Œä¸æŒ‰å®šä¹‰é¡ºåº\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ep3\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eperson\u003c/span\u003e{\u003cspan style=\"color:#a6e22e\"\u003eage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Mike\u0026#34;\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"å­—æ®µç»“æ„ä½“\"\u003eå­—æ®µç»“æ„ä½“\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eaddress\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eprovince\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003ecity\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ç»“æ„ä½“çš„å­—æ®µå¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„ç»“æ„ä½“\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eperson\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eage\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003euint\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eaddr\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eaddress\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// åˆå§‹åŒ–\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ep\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eperson\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Mike\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eaddr\u003c/span\u003e: \u003cspan style=\"color:#a6e22e\"\u003eaddress\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eprovince\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Guandong\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ecity\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Maoming\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ep\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eaddr\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eprovince\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"æ¥å£\"\u003eæ¥å£\u003c/h2\u003e\n\u003ch3 id=\"æ¥å£çš„å®šä¹‰\"\u003eæ¥å£çš„å®šä¹‰\u003c/h3\u003e\n\u003cp\u003eæ¥å£æ˜¯å’Œè°ƒç”¨æ–¹çš„\u003cstrong\u003eä¸€ç§çº¦å®š\u003c/strong\u003eï¼Œæ˜¯ä¸€ä¸ª\u003cstrong\u003eé«˜åº¦æŠ½è±¡\u003c/strong\u003eçš„ç±»å‹ï¼Œä¸éœ€è¦å’Œå…·ä½“çš„å®ç°ç»†èŠ‚ç»‘å®šåœ¨ä¸€èµ·ã€‚\næ¥å£è¦åšçš„å°±æ˜¯å®šä¹‰å¥½çº¦å®šï¼Œå‘Šè¯‰è°ƒç”¨æ–¹ï¼Œè‡ªå·±å¯ä»¥åšä»€ä¹ˆï¼Œä½†æ˜¯ä¸éœ€è¦çŸ¥é“å®ƒçš„å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„\næˆ‘ä»¬é€šè¿‡ \u003ccode\u003etype + interface\u003c/code\u003eå…³é”®å­—å®šä¹‰ä¸€ä¸ªæ¥å£\u003c/p\u003e","title":"4. goåŸºç¡€ï¼šç»“æ„ä½“å’Œæ¥å£"},{"content":"æ•°ç»„ï¼Œå¤§æ¦‚æ˜¯æ¯ä¸ªå˜æˆè¯­è¨€éƒ½æœ‰åŸºç¡€æ•°æ®ç»“æ„ã€‚\nGoçš„åˆ‡ç‰‡ç±»å‹ï¼ˆsliceï¼‰æä¾›äº†ä¸€ç§æ–¹ä¾¿å’Œæœ‰æ•ˆçš„æ–¹æ³•æ¥å¤„ç†ç±»å‹åŒ–æ•°æ®åºåˆ—ï¼ˆæ•°ç»„ï¼‰ã€‚sliceç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„æ•°ç»„ï¼Œä½†æœ‰ä¸€äº›ä¸åŒå¯»å¸¸çš„å±æ€§ã€‚\nmapå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå­—å…¸ã€‚\næ•°ç»„å£°æ˜ å¯ä»¥ä½¿ç”¨ [é•¿åº¦]ç±»å‹{} æ¥å®šä¹‰ï¼Œæ¯”å¦‚ [2]string{}å®šä¹‰ä¸€ä¸ªé•¿åº¦ä¸º2çš„å­—ç¬¦ä¸²æ•°ç»„\nè¿™é‡Œçš„é•¿åº¦å¿…é¡»æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå¦‚æœè¦ä½¿ç”¨å˜é‡å»åŠ¨æ€ç”Ÿæˆæ•°ç»„çš„è¯ï¼Œéœ€è¦ä½¿ç”¨makeï¼Œå¦‚\nmake([]string, size) è¿™é‡Œçš„sizeæ˜¯ä¸€ä¸ªå˜å˜é‡ï¼Œç”Ÿæˆsizeé•¿åº¦çš„å­—ç¬¦ä¸²æ•°ç»„\nå¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯, [1]string å’Œ [2]string ä¸æ˜¯ç”¨ä¸€ç§ç±»å‹ï¼Œé•¿åº¦ä¹Ÿæ˜¯æ•°ç»„ç±»å‹çš„ä¸€éƒ¨åˆ†\nå®šä¹‰æ•°ç»„æ—¶å¯ä»¥çœç•¥æ•°ç»„çš„é•¿åº¦ï¼Œæ­¤æ—¶ä¼šæ ¹æ®å¤§æ‹¬å·{}é‡Œé¢çš„å…ƒç´ ä¸ªæ•°æ¨åˆ°å‡ºæ•°ç»„çš„é•¿åº¦ï¼š\narr := []string{\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;d\u0026#34;, \u0026#34;e\u0026#34;} è¿™é‡Œä¼šè‡ªåŠ¨ç”Ÿæˆé•¿åº¦ä¸º5çš„å­—ç¬¦ä¸²æ•°ç»„ï¼Œé€‚ç”¨äºæ‰€æœ‰å…ƒç´ éƒ½è¢«åˆå§‹åŒ–çš„æ•°æ®\nä½†æ˜¯å¦‚æœåªæœ‰ç‰¹å®šå…ƒç´ è¢«åˆå§‹åŒ–çš„æ•°ç»„ï¼Œå°±ä¸åˆé€‚äº†ï¼š\narr := [5]string{1: \u0026#34;a\u0026#34;, 3: \u0026#34;c\u0026#34;} ä¸Šè¿°è¡¨ç¤ºæ•°ç»„åˆå§‹åŒ–ç´¢å¼•ä¸º1çš„å€¼ä¸ºaï¼Œç´¢å¼•ä¸º3çš„å€¼ä¸ºcï¼Œå…¶ä»–æœªåˆå§‹åŒ–çš„ä¸ºç©ºå€¼ï¼ˆå­—ç¬¦ä¸²çš„ç©ºå€¼ä¸º\u0026quot;\u0026quot;ï¼‰\nå¦‚æœæˆ‘ä»¬ä¸æŒ‡å®š [5]stringï¼Œé‚£ä¹ˆgoå°±ä¼šæ ¹æ®æˆ‘ä»¬å®šä¹‰çš„æœ€å¤§ç´¢å¼•å€¼3 æ¥ç¡®å®šæ•°ç»„çš„é•¿åº¦ä¸º4\næ•°ç»„å¾ªç¯ ä½¿ç”¨ä¼ ç»Ÿçš„æ•°ç»„å¾ªç¯ï¼š for i := 0; i \u0026lt; len(arr); i++ { fmt.Println(arr[i]) } ä½¿ç”¨ for range æ•°ç»„éå†ï¼Œå†™æ³•æ›´åŠ ç®€æ´ for index, value := range arr { fmt.Printf(\u0026#34;index = %v, value = %v\\n\u0026#34;, index, value) } åˆ‡ç‰‡ Slice åˆ‡ç‰‡çš„åŒºé—´æ˜¯å·¦é—­å³å¼€ï¼Œå¦‚arr[2:5]ï¼Œé€‰å–çš„ç´¢å¼•å–æ•°æ˜¯[2,3,4] åˆ‡ç‰‡çš„åº•å±‚æ˜¯ï¼ˆåŸï¼‰æ•°ç»„ï¼Œå°†åˆ‡ç‰‡å†…å®¹ä¿®æ”¹ä¹‹åï¼ŒåŸæ•°ç»„ä¹Ÿä¼šæ”¹å˜\narr := []int{1,2,3,4,5} sliced := arr[1:3] // sliced = {2,3} sliced[0] = 0 // åˆ‡ç‰‡ä¿®æ”¹åï¼ŒåŸæ•°ç»„å†…å®¹æœ‰ä¼šæ”¹å˜ // arr = {1, 0, 3, 4, 5} ä½¿ç”¨makeå£°æ˜åˆ‡ç‰‡ å£°æ˜ä¸€ä¸ªå…ƒç´ ç±»å‹ä¸ºstringçš„åˆ‡ç‰‡ï¼Œé•¿åº¦ä¸º5ï¼šslice1 := make([]string, 5) è¿˜å¯ä»¥ä¼ å…¥ä¸€ä¸ªå®¹é‡å‚æ•°ï¼šslice2 := make([]string, 4, 8) è¿™é‡Œå£°æ˜äº†ä¸€ä¸ªé•¿åº¦ä¸º4ï¼Œå®¹é‡ä¸º8çš„å­—ç¬¦ä¸²æ•°ç»„ é•¿åº¦æ˜¯åˆ‡ç‰‡å†…å…ƒç´ çš„ä¸ªæ•°ï¼Œå®¹é‡æ˜¯åˆ‡ç‰‡çš„ç©ºé—´\nä¸Šé¢çš„ç¤ºä¾‹è¯´æ˜ï¼ŒGo è¯­è¨€åœ¨å†…å­˜ä¸Šåˆ’åˆ†äº†ä¸€å—å®¹é‡ä¸º 8 çš„å†…å®¹ç©ºé—´ï¼ˆå®¹é‡ä¸º 8ï¼‰ï¼Œä½†æ˜¯åªæœ‰ 4 ä¸ªå†…å­˜ç©ºé—´æ‰æœ‰å…ƒç´ ï¼ˆé•¿åº¦ä¸º 4ï¼‰ï¼Œå…¶ä»–çš„å†…å­˜ç©ºé—´å¤„äºç©ºé—²çŠ¶æ€ï¼Œå½“é€šè¿‡ append å‡½æ•°å¾€åˆ‡ç‰‡ä¸­è¿½åŠ å…ƒç´ çš„æ—¶å€™ï¼Œä¼šè¿½åŠ åˆ°ç©ºé—²çš„å†…å­˜ä¸Šï¼Œå½“åˆ‡ç‰‡çš„é•¿åº¦è¦è¶…è¿‡å®¹é‡çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œæ‰©å®¹ã€‚\né™¤äº†makeï¼ŒåŒæ ·å¯ä»¥é€šè¿‡å­—é¢é‡çš„æ–¹å¼å£°æ˜ï¼š slice1 := []string{\u0026quot;a\u0026quot;, \u0026quot;b\u0026quot;, \u0026quot;c\u0026quot;}\nAppend é€šè¿‡å†…ç½®çš„appendå‡½æ•°å¯¹ä¸€ä¸ªåˆ‡ç‰‡è¿›è¡Œå…ƒç´ è¿½åŠ ï¼Œè¿”å›æ–°çš„åˆ‡ç‰‡\n//è¿½åŠ ä¸€ä¸ªå…ƒç´  slice2:=append(slice1,\u0026#34;f\u0026#34;) //å¤šåŠ å¤šä¸ªå…ƒç´  slice2:=append(slice1,\u0026#34;f\u0026#34;,\u0026#34;g\u0026#34;) //è¿½åŠ å¦ä¸€ä¸ªåˆ‡ç‰‡ slice2:=append(slice1,slice...) åˆ‡ç‰‡å…ƒç´ å¾ªç¯ å¯ä»¥ä½¿ç”¨for rangeï¼ŒåŒarrayä¸€æ ·\nMapæ˜ å°„ mapæ˜¯æ— åºçš„K-Vé”®å€¼å¯¹é›†åˆï¼Œç»“æ„ä¸º map[k]vï¼Œkä¸ºKeyï¼Œvä¸ºValue keyçš„ç±»å‹å¿…é¡»æ”¯æŒ ==è¿ç®—ç¬¦ï¼Œä»¥ä¾¿åˆ¤æ–­å…¶æ˜¯æˆ–å¦å­˜åœ¨ï¼Œå¹¶ä¿è¯Keyçš„å”¯ä¸€\nMapçš„å£°æ˜åˆå§‹åŒ– ä½¿ç”¨å†…ç½®çš„makeå‡½æ•°è¿›è¡Œåˆå§‹åŒ–\n// åˆ›å»ºçš„mapï¼Œkeyç±»å‹ä¸ºstringï¼Œvalueç±»å‹ä¸ºint nameAgeMap := make(map[string]int) èµ‹å€¼ï¼š nameAgeMap[\u0026quot;Mike\u0026quot;] = 10\nMapè·å–å’Œåˆ é™¤ mapçš„æ“ä½œå’Œæ•°ç»„ã€åˆ‡ç‰‡å·®ä¸å¤šï¼Œéƒ½æ˜¯é€šè¿‡[]æ“ä½œç¬¦ï¼Œä¸è¿‡åˆ‡ç‰‡ä¸­çš„[]æ˜¯ç´¢å¼•ï¼Œè€Œmapçš„[]æ˜¯key\nGo è¯­è¨€çš„ map å¯ä»¥è·å–ä¸å­˜åœ¨çš„ K-V é”®å€¼å¯¹ï¼Œå¦‚æœ Key ä¸å­˜åœ¨ï¼Œè¿”å›çš„ Value æ˜¯è¯¥ç±»å‹çš„é›¶å€¼ï¼Œæ¯”å¦‚ int çš„é›¶å€¼å°±æ˜¯ 0ã€‚æ‰€ä»¥å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ¤æ–­ map ä¸­çš„ Key æ˜¯å¦å­˜åœ¨ã€‚\nå¦‚ä½•åˆ¤æ–­mapä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå€¼å‘¢ map çš„ []æ“ä½œä¼šè¿”å›ä¸¤ä¸ªå€¼\nå¯¹åº”çš„Value æ ‡è®°è¯¥Keyæ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™è¯¥æ ‡è®°ä¸ºtrue mapper := map[string]int{\u0026#34;Mike\u0026#34;: 10, \u0026#34;Lisa\u0026#34;: 11} value, tag := mapper[\u0026#34;Mike\u0026#34;] fmt.Println(value, tag)\t// tag ä¸ºtrue value, tag := mapper[\u0026#34;John\u0026#34;] fmt.Println(value, tag)\t// tag ä¸ºfalse ä½¿ç”¨deleteåˆ é™¤mapä¸­çš„å€¼ delete(mapper, \u0026quot;Mike\u0026quot;)\néå†map ä½¿ç”¨ for range ååˆ†æ–¹ä¾¿ï¼Œè¿”å› mapçš„keyå’Œvalue\nmapper := map[string]int{\u0026#34;Mike\u0026#34;: 10, \u0026#34;Lisa\u0026#34;: 11} for key, value := range mapper { fmt.Println(key, value) } éœ€è¦æ³¨æ„çš„æ˜¯ map çš„éå†æ˜¯æ— åºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ æ¯æ¬¡éå†ï¼Œé”®å€¼å¯¹çš„é¡ºåºå¯èƒ½ä¼šä¸ä¸€æ ·ã€‚å¦‚æœæƒ³æŒ‰é¡ºåºéå†ï¼Œå¯ä»¥å…ˆè·å–æ‰€æœ‰çš„ Keyï¼Œå¹¶å¯¹ Key æ’åºï¼Œç„¶åæ ¹æ®æ’åºå¥½çš„ Key è·å–å¯¹åº”çš„ Value\nmapçš„å¤§å° å’Œæ•°ç»„åˆ‡ç‰‡ä¸ä¸€æ ·çš„æ˜¯ï¼Œmapæ˜¯æ²¡æœ‰å®¹é‡çš„ï¼Œåªæœ‰é•¿åº¦ï¼Œè·å–é•¿åº¦åªéœ€è¦ä½¿ç”¨lenå‡½æ•°å³å¯ï¼š fmt.Println(len(mapper))\nstring å’Œ []byte å­—ç¬¦ä¸²stringä¹Ÿæ˜¯ä¸€ä¸ªä¸å¯å˜çš„å­—èŠ‚åºåˆ—ï¼Œå¯ä»¥ç›´æ¥è½¬ä¸ºå­—èŠ‚åˆ‡ç‰‡ []byte\ns := \u0026#34;ä½ å¥½golang\u0026#34; bs := []byte(s) fmt.Println(bs) // åŒæ ·å¯ä»¥ä½¿ç”¨[] æ“ä½œç¬¦æ¥è·å–æŒ‡å®šç´¢å¼•çš„å­—èŠ‚å€¼ï¼š fmt.Println(s[0], s[11]) // åœ¨goè¯­è¨€ä¸­ï¼Œutf8ç¼–ç ä¸‹ï¼Œä¸€ä¸ªæ±‰å­—å¯¹åº”ä¸‰ä¸ªå­—èŠ‚ï¼Œå› æ­¤ï¼Œsè™½ç„¶åªæœ‰8ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯é•¿åº¦å´æ˜¯12ã€‚ å¦‚æœæˆ‘ä»¬æƒ³æŠŠæ±‰å­—å½“æˆä¸€ä¸ªé•¿åº¦è®¡ç®—ï¼Œå¯ä»¥ä½¿ç”¨utf8.RuneCountInStringå‡½æ•°\n","permalink":"https://zihuanling.github.io/posts/2022-02-10-go-2-basic/","summary":"\u003cp\u003eæ•°ç»„ï¼Œå¤§æ¦‚æ˜¯æ¯ä¸ªå˜æˆè¯­è¨€éƒ½æœ‰åŸºç¡€æ•°æ®ç»“æ„ã€‚\u003c/p\u003e\n\u003cp\u003eGoçš„åˆ‡ç‰‡ç±»å‹ï¼ˆsliceï¼‰æä¾›äº†ä¸€ç§æ–¹ä¾¿å’Œæœ‰æ•ˆçš„æ–¹æ³•æ¥å¤„ç†ç±»å‹åŒ–æ•°æ®åºåˆ—ï¼ˆæ•°ç»„ï¼‰ã€‚sliceç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„æ•°ç»„ï¼Œä½†æœ‰ä¸€äº›ä¸åŒå¯»å¸¸çš„å±æ€§ã€‚\u003c/p\u003e\n\u003cp\u003emapå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå­—å…¸ã€‚\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003ch2 id=\"æ•°ç»„å£°æ˜\"\u003eæ•°ç»„å£°æ˜\u003c/h2\u003e\n\u003cp\u003eå¯ä»¥ä½¿ç”¨ \u003ccode\u003e[é•¿åº¦]ç±»å‹{}\u003c/code\u003e æ¥å®šä¹‰ï¼Œæ¯”å¦‚  \u003ccode\u003e[2]string{}\u003c/code\u003eå®šä¹‰ä¸€ä¸ªé•¿åº¦ä¸º2çš„å­—ç¬¦ä¸²æ•°ç»„\u003c/p\u003e\n\u003cp\u003eè¿™é‡Œçš„é•¿åº¦å¿…é¡»æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå¦‚æœè¦ä½¿ç”¨å˜é‡å»åŠ¨æ€ç”Ÿæˆæ•°ç»„çš„è¯ï¼Œéœ€è¦ä½¿ç”¨makeï¼Œå¦‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003emake([]string, size)\u003c/code\u003e è¿™é‡Œçš„\u003cstrong\u003esize\u003c/strong\u003eæ˜¯ä¸€ä¸ªå˜å˜é‡ï¼Œç”Ÿæˆsizeé•¿åº¦çš„å­—ç¬¦ä¸²æ•°ç»„\u003c/p\u003e\n\u003cp\u003eå¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯, \u003ccode\u003e[1]string\u003c/code\u003e å’Œ \u003ccode\u003e[2]string\u003c/code\u003e  ä¸æ˜¯ç”¨ä¸€ç§ç±»å‹ï¼Œ\u003cstrong\u003eé•¿åº¦ä¹Ÿæ˜¯æ•°ç»„ç±»å‹çš„ä¸€éƒ¨åˆ†\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eå®šä¹‰æ•°ç»„æ—¶å¯ä»¥çœç•¥æ•°ç»„çš„é•¿åº¦ï¼Œæ­¤æ—¶ä¼šæ ¹æ®å¤§æ‹¬å·\u003ccode\u003e{}\u003c/code\u003eé‡Œé¢çš„å…ƒç´ ä¸ªæ•°æ¨åˆ°å‡ºæ•°ç»„çš„é•¿åº¦ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003earr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e []\u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e{\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;a\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;b\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;c\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;d\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;e\u0026#34;\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™é‡Œä¼šè‡ªåŠ¨ç”Ÿæˆ\u003cstrong\u003eé•¿åº¦ä¸º5\u003c/strong\u003eçš„å­—ç¬¦ä¸²æ•°ç»„ï¼Œé€‚ç”¨äºæ‰€æœ‰å…ƒç´ éƒ½è¢«åˆå§‹åŒ–çš„æ•°æ®\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯å¦‚æœåªæœ‰ç‰¹å®šå…ƒç´ è¢«åˆå§‹åŒ–çš„æ•°ç»„ï¼Œå°±ä¸åˆé€‚äº†ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003earr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e [\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e]\u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e{\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;a\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;c\u0026#34;\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šè¿°è¡¨ç¤ºæ•°ç»„åˆå§‹åŒ–ç´¢å¼•ä¸º1çš„å€¼ä¸ºaï¼Œç´¢å¼•ä¸º3çš„å€¼ä¸ºcï¼Œå…¶ä»–æœªåˆå§‹åŒ–çš„ä¸ºç©ºå€¼ï¼ˆå­—ç¬¦ä¸²çš„ç©ºå€¼ä¸º\u0026quot;\u0026quot;ï¼‰\u003c/p\u003e\n\u003cp\u003eå¦‚æœæˆ‘ä»¬ä¸æŒ‡å®š \u003ccode\u003e[5]string\u003c/code\u003eï¼Œé‚£ä¹ˆgoå°±ä¼šæ ¹æ®æˆ‘ä»¬å®šä¹‰çš„æœ€å¤§ç´¢å¼•å€¼\u003cstrong\u003e3\u003c/strong\u003e æ¥ç¡®å®šæ•°ç»„çš„é•¿åº¦ä¸º\u003cstrong\u003e4\u003c/strong\u003e\u003c/p\u003e\n\u003ch2 id=\"æ•°ç»„å¾ªç¯\"\u003eæ•°ç»„å¾ªç¯\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eä½¿ç”¨ä¼ ç»Ÿçš„æ•°ç»„å¾ªç¯ï¼š\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e \u0026lt; len(\u003cspan style=\"color:#a6e22e\"\u003earr\u003c/span\u003e); \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003earr\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eä½¿ç”¨ \u003ccode\u003efor range\u003c/code\u003e æ•°ç»„éå†ï¼Œå†™æ³•æ›´åŠ ç®€æ´\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eindex\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003evalue\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003earr\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;index = %v, value = %v\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eindex\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003evalue\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"åˆ‡ç‰‡-slice\"\u003eåˆ‡ç‰‡ Slice\u003c/h2\u003e\n\u003cp\u003eåˆ‡ç‰‡çš„åŒºé—´æ˜¯\u003cstrong\u003eå·¦é—­å³å¼€\u003c/strong\u003eï¼Œå¦‚arr[2:5]ï¼Œé€‰å–çš„ç´¢å¼•å–æ•°æ˜¯[2,3,4]\nåˆ‡ç‰‡çš„åº•å±‚æ˜¯ï¼ˆåŸï¼‰æ•°ç»„ï¼Œå°†åˆ‡ç‰‡å†…å®¹ä¿®æ”¹ä¹‹åï¼ŒåŸæ•°ç»„ä¹Ÿä¼šæ”¹å˜\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003earr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e []\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e{\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003esliced\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003earr\u003c/span\u003e[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// sliced = {2,3}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esliced\u003c/span\u003e[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e] = \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// åˆ‡ç‰‡ä¿®æ”¹åï¼ŒåŸæ•°ç»„å†…å®¹æœ‰ä¼šæ”¹å˜\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// arr = {1, 0, 3, 4, 5}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"ä½¿ç”¨makeå£°æ˜åˆ‡ç‰‡\"\u003eä½¿ç”¨makeå£°æ˜åˆ‡ç‰‡\u003c/h3\u003e\n\u003cp\u003eå£°æ˜ä¸€ä¸ªå…ƒç´ ç±»å‹ä¸ºstringçš„åˆ‡ç‰‡ï¼Œé•¿åº¦ä¸º5ï¼š\u003ccode\u003eslice1 := make([]string, 5)\u003c/code\u003e\nè¿˜å¯ä»¥ä¼ å…¥ä¸€ä¸ªå®¹é‡å‚æ•°ï¼š\u003ccode\u003eslice2 := make([]string, 4, 8)\u003c/code\u003e è¿™é‡Œå£°æ˜äº†ä¸€ä¸ªé•¿åº¦ä¸º4ï¼Œå®¹é‡ä¸º8çš„å­—ç¬¦ä¸²æ•°ç»„\né•¿åº¦æ˜¯åˆ‡ç‰‡å†…\u003cstrong\u003eå…ƒç´ çš„ä¸ªæ•°\u003c/strong\u003eï¼Œå®¹é‡æ˜¯åˆ‡ç‰‡çš„\u003cstrong\u003eç©ºé—´\u003c/strong\u003e\u003c/p\u003e","title":"2. goåŸºç¡€ï¼šä½¿ç”¨array/slice/map"},{"content":"goæœ€è¿‘å¾ˆç«å•Šï¼Œè‡ªå¸¦é«˜å¹¶å‘ï¼Œå†…ç½®ç½‘ç»œæ¨¡å—å¼ºå¤§ï¼Œä½œä¸ºåç«¯å·¥ç¨‹å¸ˆä¸€æšï¼Œè‡ªç„¶ä¹Ÿè¦å­¦èµ·æ¥ï¼\ngo çš„åŸºç¡€éƒ¨åˆ†è·Ÿæˆ‘ä»¬ä¹‹å‰å­¦è¿‡çš„å¤§éƒ¨åˆ†è¯­è¨€æ˜¯éƒ½æ˜¯ååˆ†ç›¸ä¼¼çš„ï¼Œä¸Šæ‰‹ååˆ†ç®€å•ã€‚\nç¬¬ä¸€ä¸ªgoç¨‹åº ç¬¬ä¸€ä¸ªç¨‹åºå¤§éƒ½æ˜¯helloå˜›ï¼Œå‘æ–°ä¸–ç•Œæ‰“ä¸ªæ‹›å‘¼ :)\nimport fmt func main(){ fmt.Println(\u0026#34;hello golang!\u0026#34;) } æ•°æ®ç±»å‹ä»¥åŠå˜é‡å£°æ˜çš„æ–¹å¼ å˜é‡å£°æ˜çš„æ–¹å¼ // var å˜é‡å ç±»å‹ = è¡¨è¾¾å¼ var num int = 1 // ä¹Ÿå¯ä»¥å£°æ˜å˜é‡ï¼Œä½†æ˜¯ä¸èµ‹å€¼ var num int\t// è¿™æ ·çš„é»˜è®¤å€¼å°±æ˜¯intçš„é»˜è®¤å€¼ 0 // å¯ä»¥ç›´æ¥èµ‹å€¼å¹¶ä¸”å£°æ˜ç±»å‹ num := 1 // å¯ä»¥å®ç°å¤šå€¼å®šä¹‰ a, b, c := 1, 2, \u0026#34;hello\u0026#34; var ( a = 1 b = 2 c = \u0026#34;hello\u0026#34; ) å¸¸é‡å£°æ˜ å¸¸é‡å£°æ˜ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ const å…³é”®å­—ï¼Œä¸éœ€è¦æŒ‡å®šæ•°æ®çš„ç±»å‹ï¼Œé€šå¸¸ï¼Œå¸¸é‡æˆ‘ä»¬ç”¨å¤§å†™è¿›è¡Œå‘½å\næˆ‘ä»¬æŒ‡å®šå˜é‡çš„å€¼ï¼Œä¼šè‡ªå®šå°†å˜é‡è½¬ä¸ºå¯¹åº”çš„ç±»å‹\nconst MAX_SIZE = 10 åŸºç¡€ç±»å‹ æ•´å‹ æœ‰ç¬¦å·ï¼šintï¼Œ int8ï¼Œ int16ï¼Œ int32ï¼Œ int64 æ— ç¬¦å·ï¼šuintï¼Œuint8ï¼Œuint16ï¼Œuint32ï¼Œuint64 æµ®ç‚¹æ•°ï¼šfloatï¼Œfloat32ï¼Œ float64 å¸ƒå°”å‹ï¼šbool å­—ç¬¦ä¸²ï¼šstring æŒ‡é’ˆ å¸¸é‡ï¼šä½¿ç”¨constå£°æ˜ const name = \u0026quot;Mike\u0026quot; å­—ç¬¦ä¸²è½¬æ¢ å­—ç¬¦ä¸²è½¬æ•°å­—ï¼š strconv.Atoi(\u0026quot;123\u0026quot;) æ•°å­—è½¬å­—ç¬¦ä¸²ï¼šstrconv.Itoa(123) æ•°å­—ç±»å‹çš„å¼ºåˆ¶è½¬æ¢ï¼š\nint -\u0026gt; float: i2f = float(i) float -\u0026gt; int: f2i = int(f) 3. æ§åˆ¶ç»“æ„ï¼šif/for/switch if // å•çº¯çš„if if you == \u0026#34;mike\u0026#34; { fmt.Println(\u0026#34;Yes, I am mike.\u0026#34;) } // if + else if you == \u0026#34;mike\u0026#34; { fmt.Println(\u0026#34;Yes, I am mike.\u0026#34;) } else { fmt.Println(\u0026#34;No, my name is \u0026#34;, you) } // if + else if + else if you == \u0026#34;mike\u0026#34; { fmt.Println(\u0026#34;Yes, I am mike.\u0026#34;) } else if you == \u0026#34;lisa\u0026#34; { fmt.Println(\u0026#34;Ok, I am lisa.\u0026#34;) } else { fmt.Println(\u0026#34;No, my name is \u0026#34;, you) } switch switch è‡ªå¸¦break å¯ä»¥ä½¿ç”¨fallthroughï¼Œè®©ç¨‹åºæ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªæ¡ä»¶ switch you { case \u0026#34;mike\u0026#34;: // yes I am mike case \u0026#34;lisa\u0026#34;: // yes I am lisa case \u0026#34;john\u0026#34;: // I am john, fall through to default fallthrough default: // nothing match } for // ç®€å•forå¾ªç¯ for i := 0; i \u0026lt; 100; i++ { // do something... } // for å®ç°whileå¾ªç¯ for { // do something // then break } // æˆ–è€… for i \u0026lt; 100 { // do something // increase i // i++ } // ä½¿ç”¨for range éå†æ•°ç»„æˆ–è€…å…¶ä»–å¯è¿­ä»£å¯¹è±¡ nums := []int{1,2,3} for index, num := range nums { // print(idx, num) } ","permalink":"https://zihuanling.github.io/posts/2022-01-07-go-1-basic/","summary":"\u003cp\u003egoæœ€è¿‘å¾ˆç«å•Šï¼Œè‡ªå¸¦é«˜å¹¶å‘ï¼Œå†…ç½®ç½‘ç»œæ¨¡å—å¼ºå¤§ï¼Œä½œä¸ºåç«¯å·¥ç¨‹å¸ˆä¸€æšï¼Œè‡ªç„¶ä¹Ÿè¦å­¦èµ·æ¥ï¼\u003c/p\u003e\n\u003cp\u003ego çš„åŸºç¡€éƒ¨åˆ†è·Ÿæˆ‘ä»¬ä¹‹å‰å­¦è¿‡çš„å¤§éƒ¨åˆ†è¯­è¨€æ˜¯éƒ½æ˜¯ååˆ†ç›¸ä¼¼çš„ï¼Œä¸Šæ‰‹ååˆ†ç®€å•ã€‚\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003ch1 id=\"ç¬¬ä¸€ä¸ªgoç¨‹åº\"\u003eç¬¬ä¸€ä¸ªgoç¨‹åº\u003c/h1\u003e\n\u003cp\u003eç¬¬ä¸€ä¸ªç¨‹åºå¤§éƒ½æ˜¯helloå˜›ï¼Œå‘æ–°ä¸–ç•Œæ‰“ä¸ªæ‹›å‘¼ :)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;hello golang!\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch1 id=\"æ•°æ®ç±»å‹ä»¥åŠå˜é‡å£°æ˜çš„æ–¹å¼\"\u003eæ•°æ®ç±»å‹ä»¥åŠå˜é‡å£°æ˜çš„æ–¹å¼\u003c/h1\u003e\n\u003ch2 id=\"å˜é‡å£°æ˜çš„æ–¹å¼\"\u003eå˜é‡å£°æ˜çš„æ–¹å¼\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// var å˜é‡å ç±»å‹ = è¡¨è¾¾å¼\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enum\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e = \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ä¹Ÿå¯ä»¥å£°æ˜å˜é‡ï¼Œä½†æ˜¯ä¸èµ‹å€¼\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enum\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e// è¿™æ ·çš„é»˜è®¤å€¼å°±æ˜¯intçš„é»˜è®¤å€¼ 0 \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å¯ä»¥ç›´æ¥èµ‹å€¼å¹¶ä¸”å£°æ˜ç±»å‹\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003enum\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å¯ä»¥å®ç°å¤šå€¼å®šä¹‰\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;hello\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e = \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e = \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;hello\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"å¸¸é‡å£°æ˜\"\u003eå¸¸é‡å£°æ˜\u003c/h2\u003e\n\u003cp\u003eå¸¸é‡å£°æ˜ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ \u003ccode\u003econst\u003c/code\u003e å…³é”®å­—ï¼Œä¸éœ€è¦æŒ‡å®šæ•°æ®çš„ç±»å‹ï¼Œé€šå¸¸ï¼Œå¸¸é‡æˆ‘ä»¬ç”¨å¤§å†™è¿›è¡Œå‘½å\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬æŒ‡å®šå˜é‡çš„å€¼ï¼Œä¼šè‡ªå®šå°†å˜é‡è½¬ä¸ºå¯¹åº”çš„ç±»å‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eMAX_SIZE\u003c/span\u003e = \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"åŸºç¡€ç±»å‹\"\u003eåŸºç¡€ç±»å‹\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eæ•´å‹\n\u003cul\u003e\n\u003cli\u003eæœ‰ç¬¦å·ï¼šintï¼Œ int8ï¼Œ int16ï¼Œ int32ï¼Œ int64\u003c/li\u003e\n\u003cli\u003eæ— ç¬¦å·ï¼šuintï¼Œuint8ï¼Œuint16ï¼Œuint32ï¼Œuint64\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eæµ®ç‚¹æ•°ï¼šfloatï¼Œfloat32ï¼Œ float64\u003c/li\u003e\n\u003cli\u003eå¸ƒå°”å‹ï¼šbool\u003c/li\u003e\n\u003cli\u003eå­—ç¬¦ä¸²ï¼šstring\u003c/li\u003e\n\u003cli\u003eæŒ‡é’ˆ\u003c/li\u003e\n\u003cli\u003eå¸¸é‡ï¼šä½¿ç”¨constå£°æ˜ \u003ccode\u003econst name = \u0026quot;Mike\u0026quot;\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å­—ç¬¦ä¸²è½¬æ¢\"\u003eå­—ç¬¦ä¸²è½¬æ¢\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eå­—ç¬¦ä¸²è½¬æ•°å­—ï¼š \u003ccode\u003estrconv.Atoi(\u0026quot;123\u0026quot;)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eæ•°å­—è½¬å­—ç¬¦ä¸²ï¼š\u003ccode\u003estrconv.Itoa(123)\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæ•°å­—ç±»å‹çš„å¼ºåˆ¶è½¬æ¢ï¼š\u003c/p\u003e","title":"1. goåŸºç¡€ï¼šæ•°æ®ç±»å‹ï¼Œä»¥åŠæ§åˆ¶ç»“æ„"},{"content":"searchHidden: true\n","permalink":"https://zihuanling.github.io/leetcode/","summary":"\u003cp\u003esearchHidden: true\u003c/p\u003e","title":"Leetcode"}]